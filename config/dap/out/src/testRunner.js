"use strict";var YT=Object.create;var Wc=Object.defineProperty;var Zb=Object.getOwnPropertyDescriptor;var ZT=Object.getOwnPropertyNames;var eR=Object.getPrototypeOf,tR=Object.prototype.hasOwnProperty;var m=(i,e)=>()=>(i&&(e=i(i=0)),e);var rR=(i,e)=>()=>(e||i((e={exports:{}}).exports,e),e.exports),ew=(i,e)=>{for(var t in e)Wc(i,t,{get:e[t],enumerable:!0})},tw=(i,e,t,r)=>{if(e&&typeof e=="object"||typeof e=="function")for(let o of ZT(e))!tR.call(i,o)&&o!==t&&Wc(i,o,{get:()=>e[o],enumerable:!(r=Zb(e,o))||r.enumerable});return i};var w=(i,e,t)=>(t=i!=null?YT(eR(i)):{},tw(e||!i||!i.__esModule?Wc(t,"default",{value:i,enumerable:!0}):t,i)),oR=i=>tw(Wc({},"__esModule",{value:!0}),i),f=(i,e,t,r)=>{for(var o=r>1?void 0:r?Zb(e,t):e,n=i.length-1,s;n>=0;n--)(s=i[n])&&(o=(r?s(e,t,o):s(o))||o);return r&&o&&Wc(e,t,o),o},u=(i,e)=>(t,r)=>e(t,r,i);function Lp(i,e){let t={};for(let r of Object.keys(i)){let o=i[r];e(o,r)&&(t[r]=o)}return t}function Po(i,e){let t={};for(let r of Object.keys(i)){let o=i[r];t[r]=e(o,r)}return t}function ow(i,e){let t={};for(let r of Object.keys(i))e(r,i[r])&&(t[r]=i[r]);return t}function iw(...i){if(i.length===0)return{};let e={},t=Object.create(null);for(let r of i)if(r)for(let o of Object.keys(r)){let n=o.toLowerCase();t[n]?e[t[n]]=r[o]:(t[n]=o,e[o]=r[o])}return e}function nw(i,e){if(i.hasOwnProperty(e))return i[e];let t=e.toLowerCase();for(let r of Object.keys(i))if(r.toLowerCase()===t)return i[r]}function F(i){let e=vg,t=(...r)=>(e===vg&&(t.value=e=i(...r)),e);return t.forget=()=>{e=vg,t.value=void 0},t.value=void 0,t}function ko(i){let e=new Map,t=r=>{if(e.has(r))return e.get(r);let o=i(r);return e.set(r,o),o};return t.clear=()=>e.clear(),t}function sw(i){let e,t=r=>(e?.arg===r||(e={arg:r,val:i(r)}),e.val);return t.clear=()=>e=void 0,t}function aw(i,e){let t,r=()=>{t!==void 0&&clearTimeout(t),t=setTimeout(()=>{t=void 0,e()},i)};return r.clear=()=>{t&&(clearTimeout(t),t=void 0)},r}function cw(i,e){let t,r=()=>{t===void 0&&(t=setTimeout(()=>{t=void 0,e()},i))};return r.queued=()=>!!t,r.clear=()=>{t&&(clearTimeout(t),t=void 0)},r}async function lw(i,e){let t=[],r=[];for(let o of i)await e(o)?t.push(o):r.push(o);return[t,r]}function xo(i){let e=[];for(let t of i)e=e.concat(t);return e}var Ae,gs,rw,Yi,Dp,vg,Xo,iR,_p,M=m(()=>{"use strict";Ae=i=>!!i,gs=i=>Lp(i,e=>e!==null),rw=i=>Lp(i,e=>e!==void 0),Yi=i=>e=>e instanceof i,Dp=(i,e)=>{debugger;throw new Error(e.replace("{value}",JSON.stringify(i)))};vg=Symbol("unset");Xo=i=>i,iR=2**31-1,_p=()=>{let i=0;return()=>i++&iR}});var pw,uw,dw,Ep,ot,Ap=m(()=>{"use strict";M();pw="--remote-debugging-port",uw="--remote-debugging-pipe",dw=i=>{let e={};for(let t of i){let r=t.indexOf("=");r===-1?e[t]=null:e[t.slice(0,r)]=t.slice(r+1)}return e},Ep=i=>{let e=[];for(let t of Object.keys(i)){let r=i[t];r!==void 0&&e.push(r===null?t:`${t}=${r}`)}return e},ot=class i{constructor(e=[]){this.args=e;this.argMap=F(()=>dw(this.args))}static{this.default=new i(["--disable-background-networking","--disable-background-timer-throttling","--disable-backgrounding-occluded-windows","--disable-breakpad","--disable-client-side-phishing-detection","--disable-default-apps","--disable-dev-shm-usage","--disable-renderer-backgrounding","--disable-sync","--metrics-recording-only","--no-first-run","--no-default-browser-check"])}add(e,t=null){return new i(Ep({...this.argMap(),[e]:t}))}remove(e){return new i(Ep({...this.argMap(),[e]:void 0}))}merge(e){return new i(Ep({...this.argMap(),...e instanceof i?e.argMap():dw(e)}))}setConnection(e){return new i(Ep({...this.argMap(),[uw]:e==="pipe"?null:void 0,[pw]:e!=="pipe"?String(e):void 0}))}getSuggestedConnection(){let e=this.argMap();if(e.hasOwnProperty(uw))return"pipe";let t=e[pw];if(t!==void 0)return t&&Number(t)||0}filter(e){let t=this.argMap(),r=[];for(let o of Object.keys(t)){let n=t[o];e(o,n)&&r.push(n===null?o:`${o}=${n}`)}return new i(r)}toArray(){return this.args.slice()}}});var nR={};var qr,mw=m(()=>{"use strict";Ap();qr=require("chai");describe("BrowserArgs",()=>{it("merge",()=>{let i=new ot(["--a","--b=foo"]).merge(["--b=bar","--c"]);(0,qr.expect)(i.toArray()).to.deep.equal(["--a","--b=bar","--c"])}),it("add",()=>{let i=new ot(["--a","--b=foo"]).add("--a").add("--b","bar").add("--c");(0,qr.expect)(i.toArray()).to.deep.equal(["--a","--b=bar","--c"])}),it("remove",()=>{let i=new ot(["--a","--b=foo"]).remove("--b");(0,qr.expect)(i.toArray()).to.deep.equal(["--a"])}),it("getSuggestedConnection",()=>{(0,qr.expect)(new ot(["--a","--b=foo"]).getSuggestedConnection()).to.be.undefined,(0,qr.expect)(new ot(["--a","--remote-debugging-port=42"]).getSuggestedConnection()).to.equal(42),(0,qr.expect)(new ot(["--a","--remote-debugging-pipe"]).getSuggestedConnection()).to.equal("pipe")}),it("setConnection",()=>{let i=new ot(["--a","--remote-debugging-port=42","--remote-debugging-pipe"]);(0,qr.expect)(i.setConnection("pipe").toArray()).to.deep.equal(["--a","--remote-debugging-pipe"]),(0,qr.expect)(i.setConnection(1337).toArray()).to.deep.equal(["--a","--remote-debugging-port=1337"])}),it("filter",()=>{let i=new ot(["--a","--b=42","--c=44"]).filter((e,t)=>e==="--b"||t==="44");(0,qr.expect)(i.toArray()).to.deep.equal(["--b=42","--c=44"])})})});function _t(i,e,t){let r=ko(s=>{if(s)return new Sg.URL(s);throw new Error(`A valid url wasn't supplied: <${s}>`)}),o={"url.hostname":()=>r(e).hostname,"url.port":()=>r(e).port,browserInspectUri:()=>encodeURIComponent(t),browserInspectUriPath:()=>new Sg.URL(t).pathname,wsProtocol:()=>r(e).protocol==="https:"?"wss":"ws"};return i.replace(/{([^\}]+)}/g,(s,a)=>o.hasOwnProperty(a)?o[a]():s)}var Sg,Fp=m(()=>{"use strict";Sg=require("url");M()});var fs,j,ze=m(()=>{"use strict";M();fs={dispose:()=>{}},j=class{constructor(e){this.disposed=!1;this.items=[];e&&(this.items=e.slice())}get isDisposed(){return this.disposed}callback(...e){for(let t of e)this.push({dispose:t})}push(...e){return this.disposed?(e.forEach(t=>t.dispose()),e[0]):(this.items.push(...e),e[0])}disposeObject(e){this.items=this.items.filter(t=>t!==e),e.dispose()}dispose(){let e=Promise.all(this.items.map(t=>t.dispose()));return this.items=[],this.disposed=!0,e}}});var Vc,gw,Np,sR,Mp,fw=m(()=>{"use strict";Vc=require("fs"),gw=require("path"),Np=require("zlib"),sR=(i,e)=>e instanceof Error?{message:e.message,stack:e.stack}:typeof e=="bigint"?e.toString():e,Mp=class{constructor(e,t){this.file=e;this.dap=t;try{(0,Vc.mkdirSync)((0,gw.dirname)(e),{recursive:!0})}catch{}e.endsWith(".gz")?(this.stream=(0,Np.createGzip)(),this.stream.pipe((0,Vc.createWriteStream)(e))):this.stream=(0,Vc.createWriteStream)(e)}async setup(){this.dap?.output({category:"console",output:`Verbose logs are written to:
${this.file}
`})}dispose(){this.stream&&(this.stream.end(),this.stream=void 0)}write(e){this.stream&&(this.stream.write(JSON.stringify(e,sR)+`
`),this.stream.flush?.(Np.constants.Z_SYNC_FLUSH))}}});function Ig(i,e=(0,bw.tmpdir)()){if(i===!1)return{stdio:!1,logFile:null};let t={stdio:!0,logFile:ww.join(e,`vscode-debugadapter-${(0,hw.randomBytes)(4).toString("hex")}.json.gz`)};return i===!0?t:{...t,...i}}function yw(i,e){let t=Ig(e),r={sinks:[]};return t.logFile&&r.sinks.push(new Mp(t.logFile,i)),r}var hw,bw,ww,aR,oE,C,_=m(()=>{"use strict";hw=require("crypto"),bw=require("os"),ww=w(require("path"));fw();aR={runtime:null,"runtime.sourcecreate":null,"runtime.assertion":null,"runtime.launch":null,"runtime.target":null,"runtime.welcome":null,"runtime.exception":null,"runtime.sourcemap":null,"runtime.breakpoints":null,"sourcemap.parsing":null,"perf.function":null,"cdp.send":null,"cdp.receive":null,"dap.send":null,"dap.receive":null,internal:null,proxyActivity:null},oE=Object.keys(aR),C=Symbol("ILogger")});var Re,je,xr,Cr,Co=m(()=>{"use strict";Re=class{constructor(e,t){this.lineNumber=e;this.columnNumber=t}get base0(){return this}get base1(){return new je(this.lineNumber+1,this.columnNumber+1)}get base01(){return new xr(this.lineNumber,this.columnNumber+1)}compare(e){let t=e.base0;return this.lineNumber-t.lineNumber||this.columnNumber-t.columnNumber}},je=class{constructor(e,t){this.lineNumber=e;this.columnNumber=t}get base0(){return new Re(this.lineNumber-1,this.columnNumber-1)}get base1(){return this}get base01(){return new xr(this.lineNumber-1,this.columnNumber)}compare(e){let t=e.base1;return this.lineNumber-t.lineNumber||this.columnNumber-t.columnNumber||0}},xr=class{constructor(e,t){this.lineNumber=e;this.columnNumber=t}get base0(){return new Re(this.lineNumber-1,this.columnNumber)}get base1(){return new je(this.lineNumber,this.columnNumber+1)}get base01(){return this}compare(e){let t=e.base01;return this.lineNumber-t.lineNumber||this.columnNumber-t.columnNumber}},Cr=class i{constructor(e,t){this.begin=e;this.end=t}static{this.ZERO=new i(new Re(0,0),new Re(0,0))}static{this.INFINITE=new i(new Re(0,0),new Re(1/0,1/0))}static simplify(e){if(e.length===0)return[];let t=e.slice().sort((n,s)=>n.begin.compare(s.begin)),r=[],o=t[0];for(let n=1;n<t.length;n++){let s=t[n];o.end.compare(s.begin)>=0?o=new i(o.begin,s.end):(r.push(o),o=s)}return r.push(o),r}contains(e){return e.compare(this.begin)>=0&&e.compare(this.end)<=0}toString(){let e=this.begin.base0,t=this.end.base0;return`Range[${e.lineNumber}:${e.columnNumber} -> ${t.lineNumber}:${t.columnNumber}]`}}});function Hr(i){return new Promise((e,t)=>{let r=i.length;for(let o of i)o.then(n=>{n?(e(n),r=-1):--r===0&&e(void 0)}).catch(t)})}function ne(){let i=null,e=null,t=!1,r,o=new Promise((n,s)=>{i=a=>{t=!0,r=a,n(a)},e=a=>{t=!0,s(a)}});return{resolve:i,reject:e,promise:o,get settledValue(){return r},hasSettled:()=>t}}var x,vw,U=m(()=>{"use strict";x=i=>isFinite(i)?new Promise(e=>setTimeout(e,i)):new Promise(()=>{}),vw=(i,e)=>{let t=setTimeout(i,e);return{dispose:()=>clearTimeout(t)}}});async function hR(i){switch(i.type){case 0:try{let e=await Pg.promises.readFile(i.file);return{id:i.id,hash:i.mode===0?(0,Zi.hash)(e):(0,Zi.shaHash)(e)}}catch{return{id:i.id}}case 1:try{return{id:i.id,hash:(0,Zi.hash)(Iw(i.data))}}catch{return{id:i.id}}case 2:try{let e=await Pg.promises.readFile(i.file);return{id:i.id,matches:Sw(e,i.expected,i.checkNode)}}catch{return{id:i.id,matches:!1}}case 3:try{return{id:i.id,matches:Sw(Iw(i.data),i.expected,i.checkNode)}}catch{return{id:i.id,matches:!1}}}}function bR(i){i.on("message",e=>{hR(e).then(t=>i.postMessage(t))})}var Zi,Pg,kg,cR,lR,pR,uR,dR,mR,gR,fR,Sw,Iw,Pw=m(()=>{"use strict";Zi=require("@c4312/chromehash"),Pg=require("fs"),kg=require("worker_threads"),cR=Buffer.from("(function (exports, require, module, __filename, __dirname) { "),lR=Buffer.from(`
});`),pR=Buffer.from("(function (exports, require, module, __filename, __dirname, process, global, Buffer) { return function (exports, require, module, __filename, __dirname) { "),uR=Buffer.from(`
}.call(this, exports, require, module, __filename, __dirname); });`),dR=Buffer.from("#!"),mR=Buffer.from("\r")[0],gR=Buffer.from(`
`)[0],fR=(i,e)=>i.slice(0,e.length).equals(e),Sw=(i,e,t)=>{let r=e.length===64?Zi.shaHash:Zi.hash;if(r(i)===e)return!0;if(t){if(fR(i,dR)){let o=i.indexOf(gR);return i[o-1]===mR&&o--,r(i.slice(o))===e}if(r(Buffer.concat([cR,i,lR]))===e)return!0}return r(Buffer.concat([pR,i,uR]))===e},Iw=i=>i instanceof Buffer?i:Buffer.from(i,"utf-8");kg.parentPort&&bR(kg.parentPort)});var kw,xw,Bp,Cw=m(()=>{"use strict";kw=require("path"),xw=require("worker_threads");M();U();Pw();Bp=class{constructor(e=3,t=(0,kw.join)(__dirname,"hash.js")){this.maxFailures=e;this.hasherScriptPath=t;this.idCounter=0;this.failureCount=0;this.deferredMap=new Map;this.deferCleanup=aw(3e4,()=>this.cleanup())}async hashBytes(e,t){return(await this.send({type:1,data:t,mode:e,id:this.idCounter++})).hash}async hashFile(e,t){return(await this.send({type:0,file:t,mode:e,id:this.idCounter++})).hash}async verifyBytes(e,t,r){return(await this.send({type:3,data:e,id:this.idCounter++,expected:t,checkNode:r})).matches}async verifyFile(e,t,r){return(await this.send({type:2,file:e,id:this.idCounter++,expected:t,checkNode:r})).matches}dispose(){this.cleanup(),this.deferCleanup.clear()}send(e){let t=this.getProcess();if(!t)throw new Error("hash.js process unexpectedly exited");this.deferCleanup();let r=ne();return this.deferredMap.set(e.id,{deferred:r,request:e}),t.postMessage(e),r.promise}cleanup(){this.instance&&(this.instance.removeAllListeners("exit"),this.instance.terminate(),this.instance=void 0,this.failureCount=0)}getProcess(){if(this.instance)return this.instance;if(this.failureCount>this.maxFailures)return;let e=this.instance=new xw.Worker(this.hasherScriptPath);return e.setMaxListeners(1/0),e.on("message",t=>{let r=t,o=this.deferredMap.get(r.id);o&&(o.deferred.resolve(r),this.deferredMap.delete(r.id))}),e.on("exit",()=>{this.instance=void 0,this.failureCount++;let t=this.getProcess();if(t){this.deferCleanup();for(let{request:r}of this.deferredMap.values())t.postMessage(r)}else{for(let{deferred:r}of this.deferredMap.values())r.reject(new Error("hash.js process unexpectedly exited"));this.deferredMap.clear(),this.deferCleanup.clear()}}),e}}});async function hs({access:i},e){if(!e)return!1;try{return await i(e),!0}catch{return!1}}async function Vt({stat:i},e){if(e)try{return await i(e)}catch{return}}async function Rw({lstat:i},e){if(e)try{return await i(e)}catch{return}}async function Dw({copyFile:i,rename:e,unlink:t},r,o){try{await e(r,o)}catch{await i(r,o),await t(r)}}function or(i){return new Promise(e=>{To.readFile(i,"utf8",async(t,r)=>{e(t?"":r)})})}var To,Tw,wE,mt,se,xg,Op,ae=m(()=>{"use strict";To=w(require("fs")),Tw=w(require("util"));wE=Tw.promisify(To.writeFile),mt=Symbol("FsUtils"),se=class{constructor(e){this.fs=e}realPath(e){return this.fs.realpath(e)}async exists(e){try{return await this.fs.access(e,To.constants.F_OK),!0}catch{return!1}}readFile(e){return this.fs.readFile(e)}},xg=class{constructor(e){this.dap=e}async realPath(){throw new Error("not implemented")}async exists(e){try{let{doesExists:t}=await this.dap.remoteFileExistsRequest({localFilePath:e});return t}catch{return!1}}readFile(){throw new Error("not implemented")}},Op=class{constructor(e,t,r){this.remoteFilePrefix=e;this.localFsUtils=t;this.remoteFsUtils=r}static create(e,t,r){let o=new se(t);return e!==void 0?new this(e.toLowerCase(),o,new xg(r)):o}async exists(e){return this.selectFs(e).exists(e)}async readFile(e){return this.selectFs(e).readFile(e)}async realPath(e){return this.selectFs(e).realPath(e)}selectFs(e){return e.toLowerCase().startsWith(this.remoteFilePrefix)?this.remoteFsUtils:this.localFsUtils}}});async function bs(i,e,t){let r;if(process.platform==="win32"){let o=t.WINDIR||"C:\\Windows";r=Z.join(o,"System32","where.exe")}else r="/usr/bin/which";try{if(await Vt(i,r)){let n=(await(0,_w.default)(r,[e],{env:gs(t)})).stdout.split(/\r?\n/);if(process.platform==="win32"){let s=String(t.PATHEXT||".exe").toUpperCase().split(";");for(let a of n){let c=Z.extname(a).toUpperCase();if(c&&s.includes(c))return a}}else if(n.length>0)return n[0];return}return e}catch{}}async function Fw(i,e,t){if(e){if(process.platform==="win32"&&!Z.extname(e)){let r=t.lookup("PATHEXT");if(r){let o=r.split(";");for(let n of o){let s=e+n;if(await Vt(i,s))return s}}}if(await Vt(i,e))return e}}function Yo(...i){return Z.posix.isAbsolute(i[0])?B(Z.posix.join(...i)):Z.win32.isAbsolute(i[0])?Z.win32.join(...i):Z.join(...i)}function $t(...i){return Z.posix.isAbsolute(i[0])?Z.posix.resolve(...i):Z.win32.isAbsolute(i[0])?Z.win32.resolve(...i):Z.resolve(...i)}function qc(i,e){return Z.posix.isAbsolute(i)?Z.posix.relative(i,e):Z.win32.isAbsolute(i)?Z.win32.relative(i,e):Z.relative(i,e)}function fe(i,e=!1){if(!i)return i;if(Nw(i)){let t=$c.length;i=$c+i[t].toLowerCase()+i.substr(t+1)}else Wp(i)&&(i=(e?i[0].toUpperCase():i[0].toLowerCase())+i.substr(1));return i}function K(i,e=!1){if(!i)return i;if(i=fe(i,e),Nw(i)){let t=$c.length;i=i.substr(0,t+1)+i.substr(t+1).replace(/\//g,"\\")}else Wp(i)&&(i=i.replace(/\//g,"\\"));return i}function B(i){return i.replace(/\\\//g,"/").replace(/\\/g,"/")}var Lw,_w,Ew,Z,wR,yR,Aw,Mw,vR,$c,Nw,Cg,jp,Up,Tg,Wp,ee=m(()=>{"use strict";Lw=require("crypto"),_w=w(require("execa")),Ew=require("os"),Z=w(require("path"));ae();M();wR=process.platform==="win32"?"\\\\.\\pipe\\":(0,Ew.tmpdir)(),yR=0,Aw=()=>Z.join(wR,`node-cdp.${process.pid}-${(0,Lw.randomBytes)(4).toString("hex")}-${yR++}.sock`);Mw=i=>i.includes(`.asar${Z.sep}`);vR=/\/|\\/,$c="file:///",Nw=i=>i.startsWith($c)&&i[$c.length+1]===":",Cg=i=>i.split(vR);jp=(i,e)=>{let t=Z.relative(i,e);return t.length&&!Z.isAbsolute(t)&&!t.startsWith("..")},Up=(i,e)=>{let t=Z.relative(i,e);return!Z.isAbsolute(t)&&!t.startsWith("..")},Tg=i=>i.startsWith("\\\\"),Wp=i=>/^[A-Za-z]:/.test(i)||Tg(i)});async function jw(i,e,t){return!i||Mw(i)?void 0:e?(typeof t=="string"?await Bw.verifyBytes(t,e,!0):await Bw.verifyFile(i,e,!0))?i:void 0:await new se(Ow.promises).exists(i)?i:void 0}var Ow,Bw,Uw=m(()=>{"use strict";Cw();ae();ee();Ow=require("fs"),Bw=new Bp});function qw(i,e,t){return e.length>1||e[0].type!=="FunctionDeclaration"?Gw(i,e,!0,t):Hw(i,[{type:"ReturnStatement",argument:{type:"CallExpression",optional:!1,arguments:[{type:"ThisExpression"},...i.map(r=>({type:"Identifier",name:r}))],callee:{type:"MemberExpression",property:{type:"Identifier",name:"call"},computed:!1,optional:!1,object:{type:"FunctionExpression",params:e[0].params,body:e[0].body}}}}],!0,t)}function Gw(i,e,t,r){let o=e[e.length-1];if(o.type!=="ReturnStatement"){let n=PR(o);n&&(e=[...e.slice(0,-1),{type:"ReturnStatement",argument:n}])}return Hw(i,e,t,r)}function PR(i){switch(i.type){case"ExpressionStatement":return i.expression;case"BlockStatement":return{type:"CallExpression",arguments:[],callee:{type:"ArrowFunctionExpression",params:[],expression:!1,body:i},optional:!1};case"ReturnStatement":return i.argument||void 0;default:return}}var Ww,$p,Vw,Rg,Zo,Dg,$w,zr,qp,Hw,IR,zw,ei,Hp,Vp,en=m(()=>{"use strict";Ww=require("./vendor/acorn.js"),$p=require("./vendor/acorn-loose.js"),Vw=w(require("eslint-visitor-keys")),Rg={ecmaVersion:"latest",locations:!0,allowAwaitOutsideFunction:!0,allowImportExportEverywhere:!0,allowReserved:!0,allowReturnOutsideFunction:!0},Zo=i=>i.start,Dg=i=>i.end,$w=(i,e)=>i.slice(Zo(e),Dg(e)),zr=(i,e=!1)=>(e?Ww.parse:$p.parse)(i,Rg),qp=i=>{let e=zr(i);for(let t of e.body)t.type==="FunctionDeclaration"&&t.id&&(0,$p.isDummy)(t.id)&&(t.id=null);return e.body};Hw=(i,e,t,r)=>{let o={type:"Identifier",name:"e"},s=r?[{type:"TryStatement",block:{type:"BlockStatement",body:e},handler:{type:"CatchClause",param:o,body:{type:"BlockStatement",body:[{type:"ReturnStatement",argument:{type:"LogicalExpression",left:{type:"LogicalExpression",left:{type:"MemberExpression",object:o,property:{type:"Identifier",name:"stack"},computed:!1,optional:!1},operator:"||",right:{type:"MemberExpression",object:o,property:{type:"Identifier",name:"message"},computed:!1,optional:!1}},operator:"||",right:{type:"CallExpression",callee:{type:"Identifier",name:"String"},arguments:[o],optional:!1}}}]}}}]:e;return t?{type:"FunctionExpression",id:{type:"Identifier",name:"_generatedCode"},params:i.map(a=>({type:"Identifier",name:a})),body:{type:"BlockStatement",body:s}}:{type:"ArrowFunctionExpression",params:i.map(a=>({type:"Identifier",name:a})),expression:!1,body:{type:"BlockStatement",body:s}}},IR=(i,e)=>({type:"CallExpression",arguments:i.map(t=>({type:"Identifier",name:t})),callee:e,optional:!1}),zw=(i,e,t)=>IR(i,Gw(i,e,t,!0));ei=(i,e)=>{Vp(i,e)},Hp=(i,e)=>{let t=Vp(i,e);return t&&typeof t=="object"?t.replace:i},Vp=(i,e,t)=>{if(!i)return;let r=e.enter(i,t);if(r===0)return 0;if(r&&typeof r=="object")return r;if(r===1)return;let o=Vw.KEYS[i.type];if(o)for(let n of o){let s=i[n];if(s instanceof Array)for(let[a,c]of s.entries()){let l=Vp(c,e,i);if(l===0)return 0;l&&typeof l=="object"&&(s[a]=l.replace)}else if(s){let a=Vp(s,e,i);if(a===0)return 0;a&&typeof a=="object"&&(i[n]=a.replace)}}e.leave?.(i)}});var S,Hc,O=m(()=>{"use strict";M();S=class{constructor(){this._listeners=new Set;this.event=(e,t,r)=>{let o={listener:e,thisArg:t};this._listeners.add(o);let n={dispose:()=>{n.dispose=()=>{},this._listeners.delete(o)}};return r&&r.push(n),n}}get size(){return this._listeners.size}fire(e){let t=!this._deliveryQueue;this._deliveryQueue||(this._deliveryQueue=[]);for(let r of this._listeners)this._deliveryQueue.push({data:r,event:e});if(t){for(let r=0;r<this._deliveryQueue.length;r++){let{data:o,event:n}=this._deliveryQueue[r];o.listener.call(o.thisArg,n)}this._deliveryQueue=void 0}}dispose(){this._listeners.clear(),this._deliveryQueue&&(this._deliveryQueue=[])}},Hc=class{constructor(){this.map=new Map;this.listeners=this.map}listen(e,t){let r=this.map.get(e);r||(r=new S,this.map.set(e,r));let o=r.event(t);return{dispose:F(()=>{o.dispose(),r?.size===0&&this.map.delete(e)})}}emit(e,t){this.listeners.get(e)?.fire(t)}}});function rn(i){return kR(""+i)}function kR(i){let e=(0,Jw.parseExpressionAt)(i,0,{ecmaVersion:"latest",locations:!0});if(e.type!=="FunctionExpression")throw new Error(`Could not find function declaration for:

${i}`);let t=e.params.map(s=>{if(s.type!=="Identifier")throw new Error("Parameter must be identifier");return s.name}),{start:r,end:o}=e.body,n=s=>`
    ${s.map((a,c)=>`let ${t[c]} = ${a}`).join("; ")};
    ${i.slice(r+1,o-1)}
  `;return{expr:(...s)=>`(()=>{${n(s)}})();
${Pe()}`,decl:(...s)=>`function(...runtimeArgs){${n(s)};
${Pe()}}`}}function Je(i){let e=(""+i).replace("}",Pe()+"}"),t=async({cdp:r,args:o,...n})=>{let s=await r.Runtime.callFunctionOn({functionDeclaration:e,arguments:o.map(a=>a instanceof zc?{objectId:a.objectId}:{value:a}),...n});if(!s)throw new tn({exceptionId:0,text:"No response from CDP",lineNumber:0,columnNumber:0});if(s.exceptionDetails)throw new tn(s.exceptionDetails);return s.result};return t.source=e,t}var Jw,Kw,Pe,tn,zc,Ke=m(()=>{"use strict";Jw=require("./vendor/acorn.js"),Kw=require("crypto");It();Pe=()=>`
//# sourceURL=eval-${(0,Kw.randomBytes)(4).toString("hex")}.cdp
`;tn=class extends Error{constructor(t){super(t.text);this.details=t}},zc=class{constructor(e){this.objectId=e}}});var Qw,Xw=m(()=>{"use strict";Ke();Qw=()=>"globalThis.__jsDebugIsReady = true; "+Pe()});var Yw,Gc,Gp,Lg,xR,ws,ti=m(()=>{"use strict";Yw=require("url");O();N();Xw();Gc=new Set(["page","iframe","worker","service_worker"]),Gp=new Set(["page","iframe"]),Lg=new Set(["page","iframe"]),xR=Lg,ws=class i{constructor(e,t,r,o,n,s,a,c,l){this._manager=e;this._targetInfo=t;this.launchConfig=s;this.sessionId=a;this.logger=c;this._attached=!1;this._onNameChangedEmitter=new S;this.onNameChanged=this._onNameChangedEmitter.event;this.entryBreakpoint=void 0;this._children=new Map;this.sourcePathResolver=this._manager._sourcePathResolver;this._cdp=r,r.pause(),this.parentTarget=o,this._waitingForDebugger=n,this._updateFromInfo(t),this._ondispose=l}get targetInfo(){return this._targetInfo}get targetId(){return this._targetInfo.targetId}get independentLifeycle(){return Lg.has(this.type())}get supplementalConfig(){let e=this.type();return{__browserTargetType:e,__usePerformanceFromParent:e!=="page"}}targetOrigin(){return this._manager._targetOrigin}id(){return this.sessionId}cdp(){return this._cdp}name(){return this._computeName()}fileName(){return this._targetInfo.url}type(){return this._targetInfo.type}afterBind(){return this._cdp.resume(),Promise.resolve()}initialize(){return Promise.resolve()}async runIfWaitingForDebugger(){await Promise.all([this._cdp.Runtime.runIfWaitingForDebugger({}),this._cdp.Runtime.evaluate({expression:Qw()})])}parent(){return this.parentTarget&&!Gc.has(this.parentTarget.type())?this.parentTarget.parentTarget:this.parentTarget}children(){let e=[];for(let t of this._children.values())Gc.has(t.type())?e.push(t):e.push(...t.children());return e}canStop(){return xR.has(this.type())}stop(){if(this._manager.targetList().includes(this))if(this.type()==="service_worker"){if(this._manager.serviceWorkerModel.stopWorker(this.id()),!this.parentTarget)return;this._manager.serviceWorkerModel.stopWorker(this.parentTarget.id())}else this._cdp.Target.closeTarget({targetId:this._targetInfo.targetId})}canRestart(){return Lg.has(this.type())}restart(){this._cdp.Page.reload({})}waitingForDebugger(){return this._waitingForDebugger}canAttach(){return!this._attached}async attach(){return this._waitingForDebugger=!1,this._attached=!0,Promise.resolve(this._cdp)}canDetach(){return this._attached}async detach(){this._attached=!1,this._manager._detachedFromTarget(this.sessionId)}executionContextName(e){let t=e.auxData,r=e.name;if(!t)return r;let o=t.frameId,n=o?this._manager.frameModel.frameForId(o):void 0;return n&&t.isDefault&&!n.parentFrame()?"top":n&&t.isDefault?n.displayName():n?`${r}`:r}supportsCustomBreakpoints(){return Gp.has(this.type())}supportsXHRBreakpoints(){return Gp.has(this.type())}scriptUrlToUrl(e){return Tr(this._targetInfo.url,e)||e}_updateFromInfo(e){this._targetInfo={...e,type:this._targetInfo.type},this._onNameChangedEmitter.fire()}setComputeNameFn(e){this._customNameComputeFn=e,this._onNameChangedEmitter.fire()}_computeName(){let e=this._customNameComputeFn?.(this);if(e)return e;if(this.type()==="service_worker"){let o=this._manager.serviceWorkerModel.version(this.id());if(o)return o.label()+" [Service Worker]"}let t=this._targetInfo.title;if(!(t&&this._manager.targetList().some(o=>o instanceof i&&o!==this&&o._targetInfo.title===this._targetInfo.title)))return t;try{let o=new Yw.URL(this._targetInfo.url);o.protocol==="data:"?t=" <data>":o?t+=` (${this._targetInfo.url.replace(/^[a-z]+:\/\/|\/$/gi,"")})`:t+=` (${this._targetInfo.url})`}catch{t+=` (${this._targetInfo.url})`}return t}async _detached(){await this._manager.serviceWorkerModel.detached(this._cdp),this._ondispose(this)}}});function Jc(i){return i instanceof Array?i:[i]}function Zw(i,e,t){let r=0,o=i.length-1;for(;r<=o;){let n=(r+o)/2|0,s=t(i[n],e);if(s<0)r=n+1;else if(s>0)o=n-1;else return n}return r}function ey(i,e){let t=new Map;for(let r of i){let o=e(r),n=t.get(o);n?n.push(r):t.set(o,[r])}return t}function ri(i){return i.next().value}var oi=m(()=>{"use strict"});var Jp,ft,ys=m(()=>{"use strict";Jp=class{constructor(e,t){this.key=e;this.value=t}toString(){return`${this.key}: ${this.value}`}},ft=class{constructor(e,t){this.projection=e;this.initialContents=t;let r=Array.from(t||[]).map(o=>[this.projection(o[0]),new Jp(o[0],o[1])]);this.projectionToKeyAndValue=new Map(r)}clear(){this.projectionToKeyAndValue.clear()}delete(e){let t=this.projection(e);return this.projectionToKeyAndValue.delete(t)}forEach(e,t){this.projectionToKeyAndValue.forEach(r=>{e.call(t,r.value,r.key,this)},t)}get(e){let t=this.projection(e),r=this.projectionToKeyAndValue.get(t);return r?r.value:void 0}has(e){return this.projectionToKeyAndValue.has(this.projection(e))}set(e,t){return this.projectionToKeyAndValue.set(this.projection(e),new Jp(e,t)),this}get size(){return this.projectionToKeyAndValue.size}*entries(){for(let e of this.projectionToKeyAndValue.values())yield[e.key,e.value]}*keys(){for(let e of this.projectionToKeyAndValue.values())yield e.key}*values(){for(let e of this.projectionToKeyAndValue.values())yield e.value}[Symbol.iterator](){return this.entries()}get[Symbol.toStringTag](){return JSON.stringify(Array.from(this.entries()))}toString(){return`MapUsingProjection<${JSON.stringify([...this.entries()])}>`}}});function Gr(i,e){return i.length<=e?i:i.substr(0,e-1)+"\u2026"}function vs(i,e){if(i.length<=e)return i;let t=e>>1,r=e-t-1,o=i.codePointAt(i.length-r-1);o&&o>=65536&&(--r,++t);let n=i.codePointAt(t-1);return t>0&&n&&n>=65536&&--t,i.substr(0,t)+"\u2026"+i.substr(i.length-r,r)}function nt(i,e){let t=ty.split("").filter(o=>!e||e.indexOf(o)<0).join("").replace(/[\\\]]/g,"\\$&"),r=new RegExp(`[${t}]`,"g");return i.replace(r,"\\$&")}var ty,ry,ii,Rr=m(()=>{"use strict";ty="/\\.?*()^${}|[]+",ry=i=>ty.includes(i);ii=class{constructor(e){this.source=e;this.lines=[];this.lines.push(0);for(let t=e.indexOf(`
`);t!==-1;t=e.indexOf(`
`,t+1))this.lines.push(t+1)}getLineOffset(e){return e>=this.lines.length?this.source.length:this.lines[e]}convert(e){let t=e.base0;if(t.lineNumber>this.lines.length)return this.source.length;let r=this.lines[t.lineNumber],o=this.lines[t.lineNumber+1]??this.source.length+1;return r+Math.min(o-r-1,t.columnNumber)}}});function Qp(){Ss=process.platform!=="win32"}function Xp(i){Ss=i}function Xc(){return Ss}function Yp(i){return Ss?i:i.toLowerCase()}function Zp(i,e){return Ss?i===e:i.toLowerCase()===e.toLowerCase()}function on(){return Xc()?new Map:new ft(Yp)}function Tr(i,e){try{return new Ro.URL(e,i).href}catch{}}function tu(i,e){try{return new Ro.URL(e),e}catch{}let t;try{t=new Ro.URL(i||"")}catch{return e}let r=t.protocol+"//";return t.username&&(r+=t.username+":"+t.password+"@"),r+=t.host,r+=qt.dirname(t.pathname),r[r.length-1]!=="/"&&(r+="/"),r+=e,r}function ru(i){try{return new Ro.URL(i),!0}catch{return!1}}function ay(i){return i.replace(/\/$/,"").replace(/\\$/,"")}function De(i){let e=DR.exec(i);if(e)i=`${e[1]}:///${e[2]}`;else if(i.startsWith("vscode-webview-resource://"))i=new Ro.URL(i).pathname.replace(/%2F/gi,"/").replace(/^\/([a-z0-9\-]+)(\/{1,2})/i,(r,o,n)=>n.length===1?`${o}:///`:`${o}://`);else if(!ir(i))return;return i=i.replace("file:///",""),i=decodeURIComponent(i),i.startsWith("/")&&process.platform==="win32"&&i[1]!=="/"&&(i="/"+i),i[0]!=="/"&&!i.match(/^[A-Za-z]:/)&&(i="/"+i),K(i)}function cy(i){return ir(i)&&(i=i.replace("file:///","\\\\"),i=i.replace(/\//g,"\\"),i=decodeURIComponent(i)),i}function W(i){return Fg==="win32"?"file:///"+ni(i):"file://"+ni(i)}function Do(i){return i.startsWith("/")?"file://"+ni(i):"file:///"+ni(i)}function ht(i){return qt.posix.isAbsolute(i)||qt.win32.isAbsolute(i)}function st(i){return!!i&&i.startsWith("data:")}function Ge(i,[e,t]=[0,i.length]){if(t<=e)return i;let r=[],o=Eg(i,0,e,!1),n=Eg(i,t,i.length,!1),s=i.slice(e,t);for(let a of[decodeURIComponent(s),De(s)]){if(!a)continue;let c=Eg(a,0,a.length,!0);r.push(_R(`${o}${c}${n}`).concat("($|\\?)"))}return r.join("|")}function ir(i){return i.startsWith("file:///")}function ni(i){return i=Pt(i),Fg==="win32"?(Tg(i)&&(i=i.slice(1)),i.split(/[\\//]/g).map((e,t)=>t>0?encodeURIComponent(e):e).join("/")):i.split("/").map(encodeURIComponent).join("/")}function Pt(i){return i&&Fg==="win32"&&i[1]===":"?i[0].toUpperCase()+i.substring(1):i}function ER(i){return!!i&&!qt.isAbsolute(i)&&!!(0,Ro.parse)(i).protocol}var iy,qt,Ro,Ss,oy,eu,Ag,Is,TR,RR,Kp,ny,sy,Ps,DR,_g,LR,Kc,Eg,_R,Fg,si,ks,AR,N=m(()=>{"use strict";iy=require("dns"),qt=w(require("path")),Ro=require("url");ti();oi();ys();M();ee();Rr();Ss=process.platform!=="win32";oy=process.platform==="win32"?process.env.PATHEXT?.toLowerCase().split(";"):void 0,eu=i=>{let e=Yp(qt.basename(i));if(oy){for(let t of oy)if(e.endsWith(t))return e.slice(0,-t.length)}return e},Ag=async(i,e)=>{for(;;){if(await e(i))return i;let t=qt.dirname(i);if(t===i)return;i=t}},Is=(i,e,t)=>Ag(e,r=>i.exists(qt.join(r,t))),TR=new Set(["localhost","127.0.0.1","::1"]),RR=new Set(["0.0.0.0","::","0000:0000:0000:0000:0000:0000:0000:0000"]),Kp=i=>TR.has(i.toLowerCase()),ny=i=>{try{return new Ro.URL(i).hostname.replace(/^\[|\]$/g,"")}catch{return i}},sy=i=>RR.has(ny(i)),Ps=ko(async i=>{let e=ny(i);if(Kp(e))return!0;try{let t=await iy.promises.lookup(e);return Kp(t.address)}catch{return!1}});DR=/^https:\/\/([a-z0-9\-]+)\+\.vscode-resource\.vscode-(?:webview|cdn)\.net\/(.+)/i;_g=(i,e,t)=>{if(!t||i===":"){e.add(i);return}if(i==="/"){e.add(`\\${i}`);return}ry(i)?e.add(`\\${i}`):e.add(i);let r=encodeURIComponent(i);i!=="\\"&&r!==i&&e.add(r)},LR=i=>{switch(i.size){case 0:return"";case 1:return ri(i.values());default:let e=[...i];return e.some(t=>t.length>1)?`(?:${e.join("|")})`:`[${e.join("")}]`}},Kc=new Set,Eg=(i,e,t,r)=>{let o="";for(let n of i.slice(e,t))Ss?_g(n,Kc,r):(_g(n.toLowerCase(),Kc,r),_g(n.toUpperCase(),Kc,r)),o+=LR(Kc),Kc.clear();return o};_R=i=>i.replace(/^(file:\\\/\\\/\\\/)?([a-z]):/i,(e,t="",r)=>`${t}[${r.toUpperCase()}${r.toLowerCase()}]:`);Fg=process.platform;si=(i,e=[])=>{let t=i.urlFilter||"file"in i&&i.file||i.url,r=t?AR(t,...e):void 0;return o=>!o.url.startsWith("devtools://")&&r?.(o.url)!==!1},ks=i=>e=>e.type==="page"&&i(e);AR=(...i)=>{let e=o=>{o=o.toLowerCase();let n=De(o);n?o=n:ER(o)&&o.includes("://")&&(o=o.substr(o.indexOf("://")+3)),o.endsWith("/")&&(o=o.substr(0,o.length-1));let s=o.indexOf("#");return s!==-1&&(o=o.slice(0,o[s-1]==="/"?s-1:s)),o},t=i.map(o=>nt(e(o),"/*").replace(/(\/\*$)|\*/g,".*")),r=new RegExp("^("+t.join("|")+")$","g");return o=>(r.lastIndex=0,r.test(e(o)))}});var ai,xs,Mg=m(()=>{"use strict";ai=require("@jridgewell/trace-mapping");ee();N();xs=class i{constructor(e,t,r,o,n){this.original=e;this.metadata=t;this.actualRoot=r;this.actualSources=o;this.hasNames=n;this.sourceActualToOriginal=new Map;this.sourceOriginalToActual=new Map;this.id=i.idCounter++;if(o.length!==e.sources.length)throw new Error("Expected actualSources.length === original.source.length");for(let s=0;s<o.length;s++){let a=o[s],c=e.sources[s];a!==null&&c!==null&&(this.sourceActualToOriginal.set(a,c),this.sourceOriginalToActual.set(c,a))}}static{this.idCounter=0}get sources(){return this.actualSources.slice()}get sourceRoot(){return this.actualRoot}computedSourceUrl(e){return K(tu(st(this.metadata.sourceMapUrl)?this.metadata.compiledPath:this.metadata.sourceMapUrl,this.sourceRoot+e))}originalPositionFor(e){let t=(0,ai.originalPositionFor)(this.original,e);return t.source&&(t.source=this.sourceOriginalToActual.get(t.source)??t.source),t}generatedPositionFor(e){return(0,ai.generatedPositionFor)(this.original,{...e,source:this.sourceActualToOriginal.get(e.source)??e.source})}allGeneratedPositionsFor(e){return(0,ai.allGeneratedPositionsFor)(this.original,{...e,source:this.sourceActualToOriginal.get(e.source)??e.source})}sourceContentFor(e){e=this.sourceActualToOriginal.get(e)??e;let t=this.original.sources.indexOf(e);return t===-1?null:this.original.sourcesContent?.[t]??null}eachMapping(e){(0,ai.eachMapping)(this.original,e)}}});async function py(i,e,t,r){let o=iu.Parser.parse(e,{locations:!0,ecmaVersion:"latest"}),n=new ci.GenMapping({file:i}),s=(0,Ng.generate)(o,{sourceMap:{addMapping:a=>ci.addSegment(n,a.original.line-1,a.original.column,i,a.generated.line-1,a.generated.column)}});return ci.setSourceContent(n,i,s),new xs(new ou.AnyMap(ci.toDecodedMap(n)),{sourceMapUrl:r,compiledPath:t},"",[i],!1)}function uy(i){let e;try{e=zr(i)}catch{return}let t=(c,l)=>({type:"ExpressionStatement",expression:{type:"AssignmentExpression",operator:"=",left:c,right:l}}),r=!1,o=!1,n=Hp(e,{enter(c,l){switch(c.type){case"ClassDeclaration":return{replace:t(c.id||{type:"Identifier",name:"_default"},{...c,type:"ClassExpression"})};case"FunctionDeclaration":return{replace:t(c.id||{type:"Identifier",name:"_default"},{...c,type:"FunctionExpression"})};case"FunctionExpression":case"ArrowFunctionExpression":case"MethodDefinition":return 1;case"AwaitExpression":r=!0;return;case"ForOfStatement":c.await&&(r=!0);return;case"ReturnStatement":o=!0;return;case"VariableDeclaration":if(!l||!("body"in l)||!(l.body instanceof Array))return;let p=l.body,d=c.declarations.map(b=>({type:"ExpressionStatement",expression:{type:"UnaryExpression",operator:"void",prefix:!0,argument:{type:"AssignmentExpression",operator:"=",left:b.id,right:b.init||{type:"Identifier",name:"undefined"}}}}));p.splice(p.indexOf(c),1,...d)}}});if(!r||o)return;let s=e.body[e.body.length-1];s.type==="ExpressionStatement"&&(e.body[e.body.length-1]={type:"ReturnStatement",argument:s.expression});let a={type:"ExpressionStatement",expression:{type:"CallExpression",callee:{type:"ArrowFunctionExpression",params:[],generator:!1,expression:!1,async:!0,body:{type:"BlockStatement",body:n.body}},arguments:[],optional:!1}};return(0,Ng.generate)(a)}function Yc(i){try{let e=(0,iu.parseExpressionAt)(i,0,Rg);return e.end<i.length||e.type!=="ObjectExpression"?i:`(${i})`}catch{return i}}function Cs(i){if(!i)return;let e="sourceMappingURL",t=i.length,r=e.length,o=t,n=0;for(;;){if(o=i.lastIndexOf(e,o),o===-1||o<4)return;if(o-=4,i[o]==="/"&&i[o+1]==="/"&&!(i[o+2]!=="#"&&i[o+2]!=="@")&&!(i[o+3]!==" "&&i[o+3]!=="	")&&(n=o+4+r,!(n<t&&i[n]!=="=")))break}let s=i.substring(n+1),a=s.indexOf(`
`);return a!==-1&&(s=s.substring(0,a)),s.trim()}function nu(i,e,t){let r=t.generatedPositionFor({source:i,line:e.lineNumber,column:e.columnNumber-1,bias:ou.GREATEST_LOWER_BOUND}),o=a=>{if(a.line===null||a.column===null)return 1e11;let c=t.originalPositionFor(a);return c.line!==null?Math.abs(e.lineNumber-c.line):1e11},n=o(r),s=t.allGeneratedPositionsFor({source:i,line:e.lineNumber,column:e.columnNumber-1}).filter(a=>a.line!==null&&a.column!==null).sort((a,c)=>a.line!==c.line?a.line-c.line:a.column-c.column).map(a=>[a,o(a)]);return s.push([r,n]),s.sort(([a,c],[l,p])=>c-p||a.line-l.line||a.column-l.column),s[0][0]}function li(i){try{new Function(i)}catch(e){return e}}function MR(i,e){let t=zr(i),r,o;return ei(t,{enter:n=>{let s=n;e>=s.start&&e<s.end&&(n.type==="CallExpression"||n.type==="NewExpression"?o=n:r=n)}}),o||r}function dy(i,e){try{let r=MR(i,e);if(r&&"callee"in r){let o=r.callee;return{text:`${i.slice(o.start,o.end)}(...)`,start:o.start,end:o.end}}else{let o=r;return{text:i.slice(o.start,o.end),start:o.start,end:o.end}}}catch{}ly.lastIndex=e-1;let t=ly.exec(i);if(t)return{text:t[0],start:e,end:e+t[0].length}}var ci,ou,iu,Ng,Bg,ly,It=m(()=>{"use strict";ci=w(require("@jridgewell/gen-mapping")),ou=require("@jridgewell/trace-mapping"),iu=require("./vendor/acorn.js"),Ng=require("astring");en();Mg();Bg=(i,e)=>!!e&&((e.type==="FunctionExpression"||e.type==="FunctionDeclaration"||e.type==="ArrowFunctionExpression")&&e.params.includes(i)||(e.type==="ForInStatement"||e.type==="ForOfStatement")&&e.left===i||e.type==="VariableDeclarator"&&e.id===i||e.type==="AssignmentPattern"&&e.left===i||e.type==="CatchClause"&&e.param===i||"kind"in e&&e.kind==="init"&&e.value===i||e.type==="RestElement"&&e.argument===i||e.type==="AssignmentPattern"&&e.left===i);ly=/^[^()]+/g});function hy(i,e){if(!e)return i;let{lineNumber:t,columnNumber:r}=i;return e&&(t+=e.lineOffset,t<=1&&(r+=e.columnOffset)),{...i,lineNumber:t,columnNumber:r}}function by(i,e){if(!e)return i;let{lineNumber:t,columnNumber:r}=i;return e&&(t=Math.max(1,t-e.lineOffset),t<=1&&(r=Math.max(1,r-e.columnOffset))),{...i,lineNumber:t,columnNumber:r}}var my,gy,fy,nn,Zc,Me,au,kt,sn,an,Og,wy,Lo,Dr=m(()=>{"use strict";my=w(require("@vscode/l10n")),gy=require("path"),fy=require("url");Uw();M();ee();U();It();It();N();nn=class{constructor(e,t,r,o,n,s,a,c){this.url=t;this.inlineScriptOffset=s;this.runtimeScriptOffset=a;this.contentHash=c;this._scripts=[];this.sourceReference=e.getSourceReference(t),this._contentGetter=F(o),this._container=e,this.absolutePath=r||"",this._fqname=this._fullyQualifiedName(),this._name=this._humanName(),this.setSourceMapUrl(n),this._existingAbsolutePath=this.checkContentHash(c)}checkContentHash(e){return jw(this.absolutePath,this.inlineScriptOffset||this.runtimeScriptOffset?void 0:e,this._container._fileContentOverridesForTest.get(this.absolutePath))}offsetScriptToSource(e){return this.runtimeScriptOffset?{...e,lineNumber:Math.max(1,e.lineNumber-this.runtimeScriptOffset.lineOffset),columnNumber:e.columnNumber-this.runtimeScriptOffset.columnOffset}:e}offsetSourceToScript(e){return this.runtimeScriptOffset?{...e,lineNumber:e.lineNumber+this.runtimeScriptOffset.lineOffset,columnNumber:e.columnNumber+this.runtimeScriptOffset.columnOffset}:e}setSourceMapUrl(e){if(!e){this.sourceMap=void 0;return}this.sourceMap={type:0,sourceByUrl:new Map,value:ne(),metadata:e}}addScript(e){this._scripts.push(e)}filterScripts(e){this._scripts=this._scripts.filter(e)}get scripts(){return this._scripts}get getSuggestedMimeType(){if(this.url.endsWith(".wat"))return"text/wat";if(!/\.[^/]+$/.test(this.url)||this.url.includes("?"))return"text/javascript"}async content(){let e=await this._contentGetter();return this.inlineScriptOffset?.lineOffset&&(e=`
`.repeat(this.inlineScriptOffset.lineOffset)+e),e}async prettyPrint(){if(!this._container)return;if(sn(this)&&this.sourceMap.metadata.sourceMapUrl.endsWith("-pretty.map")){let c=this.sourceMap.value.settledValue;return c&&{map:c,source:[...this.sourceMap.sourceByUrl.values()][0]}}let e=await this.content();if(!e)return;let t=this.url||`eval://${this.sourceReference}.js`,r=t+"-pretty.map",n=t.split(/[\/\\]/).pop()+"-pretty.js",s=await py(n,e,t,r);if(!s)return;this.setSourceMapUrl({compiledPath:this.absolutePath,sourceMapUrl:""}),this.sourceMap.value.resolve(s);let a=this;return await this._container._addSourceMapSources(a,s),{map:s,source:[...a.sourceMap.sourceByUrl.values()][0]}}async toDap(){return this.toDapShallow()}async toDapShallow(){let e=await this._existingAbsolutePath,t={name:this._name,path:this._fqname,sourceReference:this.sourceReference,presentationHint:this.blackboxed()?"deemphasize":void 0,origin:this.blackboxed()?my.t("Skipped by skipFiles"):void 0};return e&&(t.sourceReference=0,t.path=e),t}existingAbsolutePath(){return this._existingAbsolutePath}async prettyName(){let e=await this._existingAbsolutePath;return e||this._fqname}_humanName(){if(ht(this._fqname)){for(let e of this._container.rootPaths)if(jp(e,this._fqname))return B((0,gy.relative)(e,this._fqname))}return this._fqname}_fullyQualifiedName(){if(!this.url)return"<eval>/VM"+this.sourceReference;if(this.url.endsWith(".repl"))return"repl";if(this.absolutePath.startsWith("<node_internals>"))return this.absolutePath;if(ht(this.url))return this.url;let e=De(this.url);if(e)return e;let t=this.url;try{let r=[],o=new fy.URL(this.url);if(o.protocol==="data:")return"<eval>/VM"+this.sourceReference;o.hostname&&r.push(o.hostname),o.port&&r.push("\uA789"+o.port),o.pathname&&r.push(/^\/[a-z]:/.test(o.pathname)?o.pathname.slice(1):o.pathname);let n=o.searchParams?.toString();n&&r.push("?"+n),t=r.join("")}catch{}return t.endsWith("/")&&(t+="(index)"),this.inlineScriptOffset&&(t+=`\uA789${this.inlineScriptOffset.lineOffset+1}:${this.inlineScriptOffset.columnOffset+1}`),t}blackboxed(){return this._container.isSourceSkipped(this.url)}};(r=>{async function i(o){return o.value.promise}r.waitForValue=i;function e(o,n){return o.type===0&&o.value.settledValue?Promise.resolve(o.value.settledValue):Promise.race([i(o),x(n)])}r.waitForValueWithTimeout=e;async function t(o){return await i(o),o.sourceByUrl}r.waitForSources=t})(Zc||={});Me=class extends nn{constructor(){super(...arguments);this.compiledToSourceUrl=new Map}},au=class extends nn{constructor(t,r,o){super(t,r.url,o,()=>Promise.resolve("Binary content not shown, see the decompiled WAT file"),void 0,void 0,void 0,void 0);this.event=r;this.sourceMap={type:1,value:ne(),sourceByUrl:new Map}}checkContentHash(){return Promise.resolve(void 0)}offsetScriptToSource(t){return t}offsetSourceToScript(t){return t}},kt=i=>!!i&&i instanceof nn&&!!i.sourceMap,sn=i=>kt(i)&&i.sourceMap.type===0,an=i=>kt(i)&&i.sourceMap.type===1,Og=i=>!!i&&typeof i.getDisassembly=="function";wy=i=>({lineNumber:i.lineNumber+1,columnNumber:i.columnNumber+1}),Lo=i=>({lineNumber:i.lineNumber-1,columnNumber:i.columnNumber-1})});var jg,Ts,NR,BR,mA,OR,pi,Qe,Et,nr,Ug,el,A=m(()=>{"use strict";jg=new Map([["pwa-node","node"],["pwa-chrome","chrome"],["pwa-extensionHost","extensionHost"],["pwa-msedge","msedge"]]),Ts=i=>jg.get(i)||i,NR={"pwa-extensionHost":null,"node-terminal":null,"pwa-node":null,"pwa-chrome":null,"pwa-msedge":null},BR={"extension.js-debug.addCustomBreakpoints":null,"extension.js-debug.addXHRBreakpoints":null,"extension.js-debug.editXHRBreakpoints":null,"extension.pwa-node-debug.attachNodeProcess":null,"extension.js-debug.clearAutoAttachVariables":null,"extension.js-debug.setAutoAttachVariables":null,"extension.js-debug.autoAttachToProcess":null,"extension.js-debug.createDebuggerTerminal":null,"extension.js-debug.createDiagnostics":null,"extension.js-debug.getDiagnosticLogs":null,"extension.js-debug.debugLink":null,"extension.js-debug.npmScript":null,"extension.js-debug.pickNodeProcess":null,"extension.js-debug.prettyPrint":null,"extension.js-debug.removeXHRBreakpoint":null,"extension.js-debug.removeAllCustomBreakpoints":null,"extension.js-debug.revealPage":null,"extension.js-debug.startProfile":null,"extension.js-debug.stopProfile":null,"extension.js-debug.toggleSkippingFile":null,"extension.node-debug.startWithStopOnEntry":null,"extension.js-debug.requestCDPProxy":null,"extension.js-debug.openEdgeDevTools":null,"extension.js-debug.callers.add":null,"extension.js-debug.callers.goToCaller":null,"extension.js-debug.callers.gotToTarget":null,"extension.js-debug.callers.remove":null,"extension.js-debug.callers.removeAll":null,"extension.js-debug.enableSourceMapStepping":null,"extension.js-debug.disableSourceMapStepping":null},mA=new Set(Object.keys(BR)),OR=new Set(Object.keys(NR)),pi=i=>OR.has(i),Qe=(i,e,t)=>i.registerCommand(e,t),Et=async(i,e,...t)=>await i.executeCommand(e,...t),nr=(i,e,t)=>i.getConfiguration(void 0,t).get(e),Ug=(i,e,t,r)=>i.getConfiguration().update(e,t,r),el=async(i,e,t)=>await i.executeCommand("setContext",e,t)});function _o(i){return{"webpack:///./~/*":`${i}/node_modules/*`,"webpack:////*":"/*","webpack://@?:*/?:*/*":`${i}/*`,"webpack://?:*/*":`${i}/*`,"webpack:///([a-z]):/(.+)":"$1:/$2","meteor://\u{1F4BB}app/*":`${i}/*`}}function qg({...i}){return lu(i),i.request==="attach"?{...ui,...i}:{...rl,...i}}function UR(i,e){return i.request==="attach"?{...ol,browserAttachLocation:e,...i}:{...Rs,browserLaunchLocation:e,...i}}function WR(i,e){return i.request==="attach"?{...Vg,browserAttachLocation:e,...i}:{...$g,browserLaunchLocation:e,...i}}function VR(i){let e={...Wg,...i};return e.skipFiles=[...e.skipFiles,"**/node_modules.asar/**","**/bootstrap-fork.js"],e}function Hg(i){return lu(i),i.request==="launch"?{...yy,...i}:{...jR,...i}}function Ds(i,e){let t,r=e==="remote"?"ui":"workspace";switch(i.type){case"pwa-node":t=qg(i);break;case"pwa-msedge":t=WR(i,r);break;case"pwa-chrome":t=UR(i,r);break;case"pwa-extensionHost":t=VR(i);break;case"node-terminal":t=Hg(i);break;default:throw Dp(i,"Unknown config: {value}")}return Gg(t)}function zg(i){let e="${workspaceFolder}",t={...i,rootPath:void 0,outFiles:i.outFiles.filter(r=>!r.includes(e)),sourceMapPathOverrides:Lp(i.sourceMapPathOverrides,r=>!r.includes("${workspaceFolder}"))};return"vueComponentPaths"in t&&(t.vueComponentPaths=t.vueComponentPaths.filter(r=>!r.includes(e))),"resolveSourceMapLocations"in t&&(t.resolveSourceMapLocations=t.resolveSourceMapLocations?.filter(r=>!r.includes(e))??null),"cwd"in t&&t.cwd?.includes(e)&&(t.cwd=void 0),"webRoot"in t&&t.webRoot?.includes(e)&&(t.webRoot="/"),t}function Gg(i){return i.__workspaceFolder||(i=zg(i)),i=Jr(i,"workspaceFolder",i.__workspaceFolder),i=Jr(i,"webRoot","webRoot"in i?i.webRoot:i.__workspaceFolder),i}function Jr(i,e,t){let r;if(typeof i=="string")r=i.replace(new RegExp(`\\$\\{${e}\\}`,"g"),()=>{if(!t)throw new Error(`Unable to resolve \${${e}} in configuration (${JSON.stringify(e)})`);return t});else if(i instanceof Array)r=i.map(o=>Jr(o,e,t));else if(typeof i=="object"&&i){let o={};for(let[n,s]of Object.entries(i))o[Jr(n,e,t)]=Jr(s,e,t);r=o}else r=i;return r}var X,cu,tl,yy,jR,Wg,rl,ol,Vg,Rs,$g,ui,lu,pu,uu,cn,$R,du,bA,$=m(()=>{"use strict";A();M();X=Symbol("AnyLaunchConfiguration"),cu={type:"",name:"",request:"",trace:!1,outputCapture:"console",timeout:1e4,timeouts:{},showAsyncStacks:!0,skipFiles:[],smartStep:!0,sourceMaps:!0,sourceMapRenames:!0,pauseForSourceMap:!0,resolveSourceMapLocations:null,rootPath:"${workspaceFolder}",outFiles:["${workspaceFolder}/**/*.(m|c|)js","!**/node_modules/**"],sourceMapPathOverrides:_o("${workspaceFolder}"),enableContentValidation:!0,cascadeTerminateToConfigurations:[],enableDWARF:!0,__workspaceFolder:"",__remoteFilePrefix:void 0,__breakOnConditionalError:!1,customDescriptionGenerator:void 0,customPropertiesGenerator:void 0},tl={...cu,cwd:"${workspaceFolder}",env:{},envFile:null,pauseForSourceMap:!1,sourceMaps:!0,localRoot:null,remoteRoot:null,resolveSourceMapLocations:["**","!**/node_modules/**"],autoAttachChildProcesses:!0,runtimeSourcemapPausePatterns:[],skipFiles:["<node_internals>/**"]},yy={...tl,showAsyncStacks:{onceBreakpointResolved:16},type:"node-terminal",request:"launch",name:"JavaScript Debug Terminal"},jR={...tl,type:"node-terminal",request:"attach",name:yy.name,showAsyncStacks:{onceBreakpointResolved:16},delegateId:-1},Wg={...tl,type:"pwa-extensionHost",name:"Debug Extension",request:"launch",args:["--extensionDevelopmentPath=${workspaceFolder}"],outFiles:["${workspaceFolder}/out/**/*.js"],resolveSourceMapLocations:["${workspaceFolder}/**","!**/node_modules/**"],rendererDebugOptions:{},runtimeExecutable:"${execPath}",autoAttachChildProcesses:!1,debugWebviews:!1,debugWebWorkerHost:!1,__sessionId:""},rl={...tl,type:"pwa-node",request:"launch",program:"",cwd:"${workspaceFolder}",stopOnEntry:!1,console:"internalConsole",restart:!1,args:[],runtimeExecutable:"node",runtimeVersion:"default",runtimeArgs:[],profileStartup:!1,attachSimplePort:null,killBehavior:"forceful"},ol={...cu,type:"pwa-chrome",request:"attach",address:"localhost",port:0,disableNetworkCache:!0,pathMapping:{},url:null,restart:!1,urlFilter:"",sourceMapPathOverrides:_o("${webRoot}"),webRoot:"${workspaceFolder}",server:null,browserAttachLocation:"workspace",targetSelection:"automatic",vueComponentPaths:["${workspaceFolder}/**/*.vue","!**/node_modules/**"],perScriptSourcemaps:"auto"},Vg={...ol,type:"pwa-msedge",useWebView:!1},Rs={...ol,type:"pwa-chrome",request:"launch",cwd:null,file:null,env:{},urlFilter:"*",includeDefaultArgs:!0,includeLaunchArgs:!0,runtimeArgs:null,runtimeExecutable:"*",userDataDir:!0,browserLaunchLocation:"workspace",profileStartup:!1,cleanUp:"wholeBrowser"},$g={...Rs,type:"pwa-msedge",useWebView:!1},ui={...tl,type:"pwa-node",attachExistingChildren:!0,address:"localhost",port:9229,restart:!1,request:"attach",continueOnAttach:!1};lu=i=>{!i.sourceMapPathOverrides&&i.cwd&&(i.sourceMapPathOverrides=_o(i.cwd)),i.resolveSourceMapLocations===void 0&&(i.resolveSourceMapLocations=i.outFiles)};pu=["javascript","typescript","typescriptreact","javascriptreact","fsharp","html","wat","c","cpp","rust","zig"],uu="js-debug",cn="1.86.1",$R="ms-vscode",du=uu.includes("nightly"),bA=`${$R}.${uu}`});function Jg(i,e){let t=zr(i),r=(a,{loc:c}=a,{loc:l}=a)=>{if(!c||!l)throw new Error("should include locations");let p=e(c,l);if(n.length>0){let d=n[n.length-1];d.scopeNode.children??=[],d.scopeNode.children.push(p)}n.push({node:a,scopeNode:p})},o=new Set,n=[],s;return ei(t,{enter:a=>{switch(a.type){case"FunctionDeclaration":case"ArrowFunctionExpression":r(a,a.params[0]||a.body,a.body),o.add(a.body);break;case"Program":r(a),s=n[0].scopeNode;break;case"ForStatement":case"ForOfStatement":case"ForInStatement":r(a),o.add(a.body);break;case"BlockStatement":o.has(a)||r(a);break}},leave:a=>{a===n[n.length-1].node&&n.pop()}}),s}var Ls,vy=m(()=>{"use strict";Ls=require("worker_threads");en();Ls.isMainThread||Ls.parentPort?.postMessage(Jg(Ls.workerData,(i,e)=>({start:i.start,end:e.end})))});function Iy(i){return i.length<qR?HR(i):new Promise((e,t)=>{let r=new Sy.Worker(`${__dirname}/renameWorker.js`,{workerData:i});r.on("message",o=>e(_s.hydrate(o))),r.on("error",t),r.on("exit",()=>t("rename worker exited"))})}function HR(i){return Jg(i,(e,t)=>new _s(new Cr(new xr(e.start.line,e.start.column).base0,new xr(t.end.line,t.end.column).base0)))}var Sy,_s,qR,Py=m(()=>{"use strict";Sy=require("worker_threads");Co();vy();_s=class i{constructor(e){this.range=e}static hydrate(e){let t=new i(new Cr(new Re(e.start.line,e.start.column),new Re(e.end.line,e.end.column)));return t.children=e.children?.map(i.hydrate),t}search(e){if(this.range.contains(e)){if(!this.children)return this;for(let t of this.children){let r=t.search(e);if(r)return r}return this}}findDeepest(e,t){if(this.range.contains(e)){if(this.children)for(let r of this.children){let o=r.findDeepest(e,t);if(o!==void 0)return o}return t(this)}}filterHoist(e){if(this.children)for(let t=0;t<this.children.length;t++){let r=this.children[t];if(r.filterHoist(e),!e(r)){let o=r.children||[];this.children.splice(t,1,...o),t--}}}forEach(e){e(this),this.children?.forEach(t=>t.forEach(e))}toJSON(){return{range:this.range,children:this.children}}},qR=1024*512});var mu,ln,il=m(()=>{"use strict";mu=class extends Error{constructor(t,r,o){super(`Unexpected ${t} response from ${r}: ${o??"<empty body>"}`);this.statusCode=t;this.url=r;this.body=o}},ln=Symbol("IResourceProvider")});var I,oe=m(()=>{"use strict";I=class extends Error{constructor(t){super("__errorMarker"in t?t.error.format:t.format);this._cause="__errorMarker"in t?t.error:t}get cause(){return this._cause}}});function ky(i,e){i.output({category:"console",output:e+`
`})}function ce(i,e=9222){return{__errorMarker:!0,error:{id:e,format:i,showUser:!1}}}function ue(i,e=9223){return{__errorMarker:!0,error:{id:e,format:i,showUser:!0}}}var ye,Kg,xy,Cy,Qg,Ty,Ry,Dy,Xg,Ly,Yg,Es,_y,Ey,gu,Zg,nl,fu,Ay,di,ef,hu,Fy,My,Ny,By,Oy,le=m(()=>{"use strict";ye=w(require("@vscode/l10n"));oe();Kg=()=>ue(ye.t("Attribute 'runtimeVersion' requires Node.js version manager 'nvs', 'nvm' or 'fnm' to be installed."),9224),xy=()=>ue(ye.t("Attribute 'runtimeVersion' with a flavor/architecture requires 'nvs' to be installed."),9225),Cy=()=>ue(ye.t("Attribute 'runtimeVersion' requires Node.js version manager 'nvm-windows' or 'nvs'."),9226),Qg=(i,e)=>ue(ye.t("Node.js version '{0}' not installed using version manager {1}.",i,e),9226),Ty=i=>ue(ye.t("Cannot launch debug target in terminal ({0}).",i),9227),Ry=i=>ue(ye.t("Can't load environment variables from file ({0}).",i),9228),Dy=i=>ue(ye.t("The configured `cwd` {0} does not exist.",i),9245),Xg=(i,e)=>ue(ye.t(`Can't find Node.js binary "{0}": {1}. Make sure Node.js is installed and in your PATH, or set the "runtimeExecutable" in your launch.json`,i,e),9229),Ly=(i,e)=>ue(ye.t('The Node version in "{0}" is outdated (version {1}), we require at least Node 8.x.',e,i),9230),Yg=i=>ue(ye.t('Invalid hit condition "{0}". Expected an expression like "> 42" or "== 2".',i),9231),Es=()=>ue(ye.t("An error occurred taking a profile from the target."),9235),_y=()=>ue(ye.t("Please stop the running profile before starting a new one."),9236),Ey=i=>ce(i,9238),gu=(i,e,t)=>ue(e==="*"&&!t.length?ye.t('Unable to find an installation of the browser on your system. Try installing it, or providing an absolute path to the browser in the "runtimeExecutable" in your launch.json.'):ye.t('Unable to find {0} version {1}. Available auto-discovered versions are: {2}. You can set the "runtimeExecutable" in your launch.json to one of these, or provide an absolute path to the browser executable.',i,e,JSON.stringify([...new Set(t)])),9233),Zg=i=>ue(ye.t('Unable to launch browser: "{0}"',i.message),9240),nl=i=>ue(i??ye.t("Unable to attach to browser"),9242),fu=()=>ue(ye.t('Target page not found. You may need to update your "urlFilter" to match the page you want to debug.'),9241),Ay=()=>ce(ye.t("Variables not available in async stacks"),9234),di=(i,e)=>ue(ye.t("Syntax error setting breakpoint with condition {0} on line {1}: {2}",JSON.stringify(i.condition),i.line,e),9237),ef=()=>ce(ye.t("Thread not found"),9244),hu=(i,e)=>ue(ye.t("Could not read source map for {0}: {1}",i,e)),Fy=()=>ue(ye.t("UWP webview debugging is not available on your platform.")),My=()=>ue(ye.t("Could not connect to any UWP Webview pipe. Make sure your webview is hosted in debug mode, and that the `pipeName` in your `launch.json` is correct.")),Ny=i=>typeof i=="object"&&!!i&&"__errorMarker"in i,By=(i,e)=>i instanceof I&&i.cause.id===e,Oy=i=>ue(ye.t("The browser process exited with code {0} before connecting to the debug server. Make sure the `runtimeExecutable` is configured correctly and that it can run without errors.",i))});var jy,Uy=m(()=>{"use strict";jy=new WeakSet});var zR,GR,At,Fs,As,Lr=m(()=>{"use strict";_();U();le();Uy();oe();zR="Request",GR=i=>i.endsWith("Request"),At=Symbol("IDapApi"),Fs=Symbol("IRootDapApi"),As=class{constructor(e,t){this.transport=e;this.logger=t;this._pendingRequests=new Map;this._requestHandlers=new Map;this._eventListeners=new Map;this.disposables=[];this._initialized=ne();this.closed=!1;this._sequence=1,this.disposables.push(this.transport.messageReceived(r=>this._onMessage(r.message,r.receivedTime))),this._dap=this._createApi()}get initializedBlocker(){return this._initialized.promise}attachTelemetry(e){this.telemetryReporter=e,e.attachDap(this._dap)}dap(){return this._dap}_createApi(){return new Proxy({},{get:(e,t)=>{if(t!=="then")return t==="on"?(r,o)=>(this._requestHandlers.set(r,o),()=>this._requestHandlers.delete(r)):t==="off"?r=>this._requestHandlers.delete(r):r=>{if(GR(t))return this.enqueueRequest(t.slice(0,-zR.length),r);this._send({seq:0,type:"event",event:t,body:r})}}})}createTestApi(){let e=(o,n)=>{let s=this._eventListeners.get(o);s||(s=new Set,this._eventListeners.set(o,s)),s.add(n)},t=(o,n)=>{let s=this._eventListeners.get(o);s&&s.delete(n)},r=(o,n)=>new Promise(s=>{let a=c=>{n&&!n(c)||(t(o,a),s(c))};e(o,a)});return new Proxy({},{get:(o,n)=>n==="on"?e:n==="off"?t:n==="once"?r:s=>this.enqueueRequest(n,s)})}enqueueRequest(e,t){return new Promise(r=>{let o={seq:0,type:"request",command:e,arguments:t||{}};this._send(o),this._pendingRequests.set(o.seq,r)})}stop(){this.closed=!0,this.transport.close()}_send(e,t){if(this.closed)this.logger.warn("dap.send","Not sending message because the connection has ended",e),t?.();else{e.seq=this._sequence++;let r=e.type!=="event"||!jy.has(e.body);this.transport.send(e,r,t)}}async _onMessage(e,t){if(e.type==="request"){let r={seq:0,type:"response",request_seq:e.seq,command:e.command,success:!0};try{let o=this._requestHandlers.get(e.command);if(!o)console.error(`Unknown request: ${e.command}`);else{let n=await o(e.arguments);if(Ny(n))this._send({...r,success:!1,message:n.error.format,body:{error:n.error}});else{let s={...r,body:n};r.command==="initialize"?(this._send(s),this._initialized.resolve(this)):r.command==="disconnect"?this._send({...r,body:n},()=>{this.stop()}):this._send(s)}}this.telemetryReporter?.reportOperation("dapOperation",e.command,t.elapsed().ms)}catch(o){o instanceof I?this._send({...r,success:!1,body:{error:o.cause}}):(console.error(o),this._send({...r,success:!1,body:{error:{id:9221,format:`Error processing ${e.command}: ${o.stack||o.message}`,showUser:!1,sendTelemetry:!1}}})),this.telemetryReporter?.reportOperation("dapOperation",e.command,t.elapsed().ms,o)}}if(e.type==="event"){let r=this._eventListeners.get(e.event)||new Set;for(let o of r)o(e.body)}if(e.type==="response"){let r=this._pendingRequests.get(e.request_seq);if(!this.logger.assert(r,`Expected callback for request sequence ID ${e.request_seq}`))return;if(this._pendingRequests.delete(e.request_seq),e.success)r(e.body);else{let o=e.body?.error?.format;r(o||e.message||"Unknown error")}}}}});var ge,Ft=m(()=>{"use strict";ge=Symbol("ISourcePathResolver")});var Wy,Kr,Qr,tf,pn,sl,mi,al=m(()=>{"use strict";Wy=require("@jridgewell/trace-mapping"),Kr=require("inversify");il();Lr();le();ys();_();M();Ft();N();Mg();Qr=Symbol("ISourceMapFactory"),tf=Symbol("IRootSourceMapFactory"),pn=class{constructor(e,t){this.root=e;this.resourceProvider=t}load(e){return this.root.load(this.resourceProvider,e)}guardSourceMapFn(e,t,r){return this.root.guardSourceMapFn(e,t,r)}};pn=f([(0,Kr.injectable)(),u(0,(0,Kr.inject)(tf)),u(1,(0,Kr.inject)(ln))],pn);sl=class{constructor(e,t,r){this.pathResolve=e;this.dap=t;this.logger=r;this.hasWarnedAboutMaps=new WeakSet}async load(e,t){let r=await this.parseSourceMap(e,t.sourceMapUrl),o;"sourceRoot"in r&&(o=r.sourceRoot,r.sourceRoot=void 0);let n=!1,s=[];if("sections"in r){s=[];let a=0;for(let c of r.sections){let l=c.map;s.push(...l.sources),l.sources=l.sources.map(()=>`source${a++}.js`),n||=!!l.names?.length}}else"sources"in r&&Array.isArray(r.sources)&&(s=r.sources,r.sources=r.sources.map((a,c)=>`source${c}.js`),n=!!r.names?.length);return new xs(new Wy.AnyMap(r),t,o??"",s,n)}async parseSourceMap(e,t){let r;try{r=await this.parseSourceMapDirect(e,t)}catch(o){if(r=await this.parsePathMappedSourceMap(e,t),!r)throw o}if("sections"in r){let o=await Promise.all(r.sections.map((n,s)=>"url"in n?this.parseSourceMap(e,n.url).then(a=>({offset:n.offset,map:a})).catch(a=>{this.logger.warn("sourcemap.parsing",`Error parsing nested map ${s}: ${a}`)}):n));r.sections=o.filter(Ae)}return r}async parsePathMappedSourceMap(e,t){if(st(t))return;let r=await this.pathResolve.urlToAbsolutePath({url:t});if(r)try{return this.parseSourceMapDirect(e,r)}catch(o){this.logger.info("sourcemap.parsing","Parsing path mapped source map failed.",o)}}guardSourceMapFn(e,t,r){try{return t()}catch(o){if(!/error parsing/i.test(String(o.message)))throw o;if(!this.hasWarnedAboutMaps.has(e)){let n=hu(e.metadata.compiledPath,o.message).error;this.dap.output({output:n.format+`
`,category:"stderr"}),this.hasWarnedAboutMaps.add(e)}return r()}}dispose(){}async parseSourceMapDirect(e,t){let r=De(t);r&&(r=this.pathResolve.rebaseRemoteToLocal(r));let o=await e.fetch(r||t);if(!o.ok)throw o.error;let n=o.body;return n.slice(0,3)===")]}"&&(n=n.substring(n.indexOf(`
`))),JSON.parse(n)}};sl=f([(0,Kr.injectable)(),u(0,(0,Kr.inject)(ge)),u(1,(0,Kr.inject)(Fs)),u(2,(0,Kr.inject)(C))],sl);mi=class extends sl{constructor(){super(...arguments);this.knownMaps=new ft(t=>t.toLowerCase())}load(t,r){let o=this.knownMaps.get(r.sourceMapUrl);if(!o)return this.loadNewSourceMap(t,r);let n=r.cacheKey,s=o.metadata.cacheKey;return o.reloadIfNoMtime?n&&s&&n===s?(o.reloadIfNoMtime=!1,o.prom):this.loadNewSourceMap(t,r):s&&n&&n!==s?this.loadNewSourceMap(t,r):o.prom}loadNewSourceMap(t,r){let o=super.load(t,r);return this.knownMaps.set(r.sourceMapUrl,{metadata:r,reloadIfNoMtime:!1,prom:o}),o}dispose(){this.knownMaps.clear()}invalidateCache(){for(let t of this.knownMaps.values())t.reloadIfNoMtime=!0}};mi=f([(0,Kr.injectable)()],mi)});var Ns,Vy,gi,Ms,sr,cl=m(()=>{"use strict";Ns=require("inversify");Dr();$();oi();_();Co();Rr();Py();al();Vy=/[$a-z_][$0-9A-Z_$]*/iy,gi=Symbol("IRenameProvider"),Ms=class{constructor(e,t,r){this.logger=e;this.sourceMapFactory=t;this.launchConfig=r;this.renames=new Map}provideOnStackframe(e){if(!this.launchConfig.sourceMapRenames)return sr.None;let t=e.uiLocation();return t===void 0?sr.None:"then"in t?t.then(r=>this.provideForSource(r?.source)):this.provideForSource(t?.source)}provideForSource(e){if(!this.launchConfig.sourceMapRenames||!(e instanceof Me))return sr.None;let t=ri(e.compiledToSourceUrl.keys());if(!t)throw new Error("unreachable");if(!sn(t))return sr.None;let r=this.renames.get(t.url);if(r)return r;let o=this.sourceMapFactory.load(t.sourceMap.metadata).then(async n=>{if(!n?.hasNames)return sr.None;let s=await t.content();return s?await this.createFromSourceMap(n,s):sr.None}).catch(()=>sr.None);return this.renames.set(t.url,o),o}async createFromSourceMap(e,t){let r=Date.now(),o;try{o=await Iy(t)}catch(a){return this.logger.info("runtime",`Error parsing content for source tree: ${a}}`,{url:e.metadata.compiledPath}),sr.None}let n=new ii(t);e.eachMapping(a=>{if(!a.name)return;let c=new xr(a.generatedLine,a.generatedColumn).base0,l=n.convert(c);Vy.lastIndex=l;let p=Vy.exec(t);if(!p)return;let d=p[0];if(d===a.name)return;let b=o.search(c)||o;b.data??=[],b.data.some(y=>y.compiled==d)||b.data.push({compiled:d,original:a.name})}),o.filterHoist(a=>!!a.data);let s=Date.now();return this.logger.info("runtime",`renames calculated in ${s-r}ms`,{url:e.metadata.compiledPath}),new sr(o)}};Ms=f([(0,Ns.injectable)(),u(0,(0,Ns.inject)(C)),u(1,(0,Ns.inject)(Qr)),u(2,(0,Ns.inject)(X))],Ms);sr=class i{constructor(e){this.renames=e}static{this.None=new i(new _s(Cr.ZERO))}getOriginalName(e,t){return this.getClosestRename(t,r=>r.compiled===e)?.original}getCompiledName(e,t){return this.getClosestRename(t,r=>r.original===e)?.compiled}getClosestRename(e,t){return this.renames.findDeepest(e,r=>r.data?.find(t))}}});var Bs,Xr,Mt,ar,Os,ke,of,ll,G,Eo,un,l0,wu,rf,ve,yu,cr,H=m(()=>{"use strict";Bs=Symbol("IContainer"),Xr=Symbol("StoragePath"),Mt=Symbol("IInitializeParams"),ar=Symbol("VSCodeApi"),Os=Symbol("IsVSCode"),ke=Symbol("ExtensionContext"),of=Symbol("ProcessEnv"),ll=Symbol("execa"),G=Symbol("FS"),Eo="ExtensionLocation",un=Symbol("IBrowserFinder"),l0=Symbol("DwarfDebugging"),wu=Symbol("SessionSubStates"),rf=new WeakMap,ve=(i,e)=>{if(!(typeof e=="object"&&e&&"dispose"in e))return e;let t=e,r=rf.get(i.container);return r?r.push(t):rf.set(i.container,[t]),e},yu=i=>{rf.get(i)?.forEach(e=>e.dispose())},cr=Symbol("IExtensionContribution")});var at,js=m(()=>{"use strict";at=Symbol("ITelemetryReporter")});var $y,fi,Us,pl=m(()=>{"use strict";$y=require("inversify");ze();fi=Symbol("IShutdownParticipants"),Us=class{constructor(){this.participants=[]}register(e,t){if(this.shutdownStage!==void 0&&this.shutdownStage>=e)return t(),fs;for(;this.participants.length<=e;)this.participants.push(new Set);return this.participants[e].add(t),{dispose:()=>this.participants[e].delete(t)}}async shutdown(){for(this.shutdownStage=0;this.shutdownStage<this.participants.length;this.shutdownStage++)await Promise.all([...this.participants[this.shutdownStage]].map(e=>e()))}};Us=f([(0,$y.injectable)()],Us)});var vu,Su,qy=m(()=>{"use strict";vu=class{constructor(e=!1,t=!1){this.verified=e;this.hit=t}},Su=class{constructor(){this._statisticsById=new Map}registerBreakpoints(e){e.forEach(t=>{t.id!==void 0&&!this._statisticsById.has(t.id)&&this._statisticsById.set(t.id,new vu(t.verified,!1))})}registerResolvedBreakpoint(e){this.getStatistics(e).verified=!0}registerBreakpointHit(e){this.getStatistics(e).hit=!0}getStatistics(e){let t=this._statisticsById.get(e);if(t!==void 0)return t;{let r=new vu;return this._statisticsById.set(e,r),r}}statistics(){let e=0,t=0,r=0;for(let o of this._statisticsById.values())e++,o.hit&&r++,o.verified&&t++;return{set:e,verified:t,hit:r}}}});var Iu,nf=m(()=>{"use strict";_();Iu=async(i,e,t,r={})=>{let o=Date.now();try{return await t()}finally{i.verbose("perf.function","",{method:e,duration:Date.now()-o,...r})}}});var dn,ul,Ht,Yr,Ao,Ws=m(()=>{"use strict";dn=require("inversify"),ul=w(require("path"));$();ee();Ht=class{get empty(){return this.patterns.length===0}constructor({rootPath:e,patterns:t}){!e||!t?(this.rootPath="",this.patterns=[]):(this.rootPath=e,this.patterns=t.map(r=>{let o=r.startsWith("!");return{negated:o,pattern:r.slice(o?1:0)}}))}*explode(){for(let e=0;e<this.patterns.length;e++){let{negated:t,pattern:r}=this.patterns[e];if(t)continue;let o=ul.resolve(this.rootPath,r).split(/[\\/]/g),n=o.findIndex(c=>c.includes("*"));if(n===-1){yield{cwd:o.slice(0,-1).join("/"),pattern:o[o.length-1],negations:[]};continue}let s=o.slice(0,n).join("/"),a=[];for(let c=e+1;c<this.patterns.length;c++){let{negated:l,pattern:p}=this.patterns[c];if(l)if(p.startsWith("**"))a.push(B(p));else{let d=ul.relative(s,ul.resolve(this.rootPath,p));d.startsWith("..")||a.push(B(d))}}yield{cwd:s,negations:a,pattern:o.slice(n).join("/")}}}};Ht=f([(0,dn.injectable)()],Ht);Yr=class extends Ht{constructor({rootPath:e,outFiles:t}){super({rootPath:e,patterns:t})}};Yr=f([(0,dn.injectable)(),u(0,(0,dn.inject)(X))],Yr);Ao=class extends Ht{constructor(e){super({rootPath:e.rootPath,patterns:"vueComponentPaths"in e?e.vueComponentPaths:[]})}};Ao=f([(0,dn.injectable)(),u(0,(0,dn.inject)(X))],Ao)});var Hy,Vs,T0,zy,dl=m(()=>{"use strict";Hy=require("path");ae();It();N();Vs=Symbol("ISearchStrategy"),T0=Symbol("ISearchStrategyFallback"),zy=async(i,e,t)=>{let r,n=`${(0,Hy.basename)(i)}.map`;if(e.siblings.includes(n)&&(r=n),r||(typeof t>"u"&&(t=await or(i)),r=Cs(t)),!(!r||(st(r)||(r=Tr(W(i),r)),!r))&&!(!r.startsWith("data:")&&!r.startsWith("file://")))return{compiledPath:i,sourceMapUrl:r,cacheKey:e.mtime}}});var ml,Xe,Pu,sf,Gy,mn,Zr,$s,qs,fn,gn,ku=m(()=>{"use strict";ml=require("fs"),Xe=require("inversify"),Pu=w(require("path"));O();Ws();_();ee();al();dl();Ft();It();N();$();nf();sf=Symbol("InlineSourceMapUrl"),Gy=10*1e3,mn=class{constructor(e){e.__workspaceCachePath&&(this.path=Pu.join(e.__workspaceCachePath,"bp-predict.json"))}async load(){if(this.value||!this.path)return this.value;try{this.value=JSON.parse(await ml.promises.readFile(this.path,"utf-8"))}catch{}return this.value}async store(e){this.value=e,this.path&&(await ml.promises.mkdir(Pu.dirname(this.path),{recursive:!0}),await ml.promises.writeFile(this.path,JSON.stringify(e)))}};mn=f([(0,Xe.injectable)(),u(0,(0,Xe.inject)(X))],mn);Zr=class{constructor(e,t,r,o,n,s){this.outFiles=e;this.repo=t;this.logger=r;this.sourceMapFactory=o;this.sourcePathResolver=n;this.state=s}async createMapping(e){if(this.outFiles.empty)return new Map;let t=on(),r=await this.state.load();try{let{state:o}=await this.repo.streamChildrenWithSourcemaps({files:this.outFiles,processMap:async n=>{let s=[],a=await this.sourceMapFactory.load(n);for(let c of a.sources){if(c===null)continue;let l=this.sourcePathResolver?await this.sourcePathResolver.urlToAbsolutePath({url:c,map:a}):De(c);l&&s.push({...n,sourceMapUrl:st(n.sourceMapUrl)?{[sf]:n.sourceMapUrl}:n.sourceMapUrl,resolvedPath:l,sourceUrl:c})}return{discovered:s,compiledPath:K(n.compiledPath)}},onProcessedMap:({discovered:n})=>{for(let s of n){let a=t.get(s.resolvedPath);a||(a=new Set,t.set(s.resolvedPath,a)),a.add(s)}},lastState:r,...e});o&&this.state.store(o).catch(n=>this.logger.warn("runtime.exception","Error saving sourcemap cache",{error:n}))}catch(o){this.logger.warn("runtime.exception","Error reading sourcemaps from disk",{error:o})}return t}};Zr=f([(0,Xe.injectable)(),u(0,(0,Xe.inject)(Yr)),u(1,(0,Xe.inject)(Vs)),u(2,(0,Xe.inject)(C)),u(3,(0,Xe.inject)(Qr)),u(4,(0,Xe.inject)(ge)),u(5,(0,Xe.inject)(mn))],Zr);$s=class extends Zr{async getMetadataForPaths(t){this.sourcePathToCompiled||(this.sourcePathToCompiled=this.createInitialMapping());let r=await this.sourcePathToCompiled;return t.map(o=>r.get(o))}async createInitialMapping(){return Iu(this.logger,"BreakpointsPredictor.createInitialMapping",()=>this.createMapping())}};$s=f([(0,Xe.injectable)()],$s);qs=class extends Zr{constructor(){super(...arguments);this.sourcePathToCompiled=new Map}async getMetadataForPaths(t){let r=t.map(s=>this.sourcePathToCompiled.get(s)),o=t.map((s,a)=>a).filter(s=>!r[s]);if(o.length){let s=new Set(o.map(c=>K(t[c]))),a=this.createMapping({filter:(c,l)=>!l||l.discovered.some(p=>s.has(p.resolvedPath))});for(let c of o)this.sourcePathToCompiled.set(t[c],a),r[c]=a}return await Promise.all(r.map(async(s,a)=>(await s).get(t[a])))}};qs=f([(0,Xe.injectable)()],qs);fn=Symbol("IBreakpointsPredictor"),gn=class{constructor(e,t,r,o){this.bpSearch=e;this.outFiles=t;this.logger=r;this.sourceMapFactory=o;this.predictedLocations=new Map;this.longParseEmitter=new S;this.targetedMode=!1;this.onLongParse=this.longParseEmitter.event}async predictBreakpoints(e){if(!e.source.path||!e.breakpoints?.length)return;let t=await this.getMetadataForPaths([e.source.path]).then(o=>o[0]);if(!t)return;let r=async(o,n,s)=>{let a=typeof s.sourceMapUrl=="string"?s.sourceMapUrl:s.sourceMapUrl.hasOwnProperty(sf)?s.sourceMapUrl[sf]:await ml.promises.readFile(s.compiledPath,"utf8").then(Cs);if(!a)return[];let c=await this.sourceMapFactory.load({...s,sourceMapUrl:a}),l=this.sourceMapFactory.guardSourceMapFn(c,()=>nu(s.sourceUrl,{lineNumber:o,columnNumber:n||1},c),()=>null);if(!l||l.line===null)return[];let p=await this.getMetadataForPaths([s.compiledPath]).then(d=>d[0]);return p?(await Promise.all([...p].map(b=>r(l.line,l.column,b)))).flat():[{absolutePath:s.compiledPath,lineNumber:l.line||1,columnNumber:l.column?l.column+1:1}]};for(let o of e.breakpoints??[]){let n=`${e.source.path}:${o.line}:${o.column||1}`;if(this.predictedLocations.has(n))return;let s=[];this.predictedLocations.set(n,s);for(let a of t)s.push(...await r(o.line,o.column||0,a))}}async getPredictionForSource(e){return this.getMetadataForPaths([e]).then(t=>t[0])}async getMetadataForPaths(e){let t=setTimeout(()=>{this.longParseEmitter.fire(),this.logger.warn("runtime.sourcemap","Long breakpoint predictor runtime",{longPredictionWarning:Gy,patterns:[...this.outFiles.explode()].join(", ")})},Gy),r=await this.bpSearch.getMetadataForPaths(e);return clearTimeout(t),r}predictedResolvedLocations(e){let t=`${e.absolutePath}:${e.lineNumber}:${e.columnNumber||1}`;return this.predictedLocations.get(t)??[]}};gn=f([(0,Xe.injectable)(),u(0,(0,Xe.inject)(Zr)),u(1,(0,Xe.inject)(Yr)),u(2,(0,Xe.inject)(C)),u(3,(0,Xe.inject)(Qr))],gn)});function QR(){if(parseInt(process.versions.node,10)>=11)return setImmediate;let i=!1,e=[],t=()=>{let r=e.shift();if(!r){i=!1;return}setImmediate(t),r()};return r=>{e.push(r),i||(i=!0,setImmediate(t))}}var JR,xe,hn,Ue,KR,xu,We=m(()=>{"use strict";O();_();N();JR=0,xe=Symbol("ICdpApi"),hn=class extends Error{constructor(t){super("<<message>>");this.method=t}setCause(t,r){return this.cause={code:t,message:r},this.message=`CDP error ${t} calling method ${this.method}: ${r}`,this.stack=this.stack?.replace("<<message>>",this.message),this}},Ue=class{constructor(e,t,r){this.logger=t;this.telemetryReporter=r;this._connectionId=JR++;this._lastId=1e3;this._disposedSessions=new Map;this._onDisconnectedEmitter=new S;this.waitWrapper=QR();this.onDisconnected=this._onDisconnectedEmitter.event;this._transport=e,this._transport.onMessage(([o,n])=>this._onMessage(o,n)),this._transport.onEnd(()=>this._onTransportClose()),this._sessions=new Map,this._closed=!1,this._rootSession=new xu(this,"",this.logger),this._sessions.set("",this._rootSession)}rootSession(){return this._rootSession.cdp()}_send(e,t={},r){let o=++this._lastId,n={id:o,method:e,params:t};r&&(n.sessionId=r);let s=JSON.stringify(n);return this.logger.verbose("cdp.send",void 0,{connectionId:this._connectionId,message:n}),this._transport.send(s),o}_onMessage(e,t){let r=JSON.parse(e),o=r;r.result&&r.result.scriptSource?o={...r,result:{...r.result,scriptSource:"<script source>"}}:r.method==="Debugger.scriptParsed"&&r.params&&st(r.params.sourceMapURL)&&(o={...r,params:{...r.params,sourceMapURL:"<data source map url>"}}),this.logger.verbose("cdp.receive",void 0,{connectionId:this._connectionId,message:o});let n=this._sessions.get(r.sessionId||"");if(!n){let c=this._disposedSessions.get(r.sessionId);if(c){let l=(Date.now()-c.getTime())/1e3;this.logger.warn("internal",`Got message for a session disposed ${l} seconds ago`,{sessionId:r.sessionId,disposeOn:c});return}else throw new Error(`Unknown session id: ${r.sessionId} while processing: ${r.method}`)}let s=r.method,a;try{n._onMessage(r)}catch(c){a=c}s&&this.telemetryReporter.reportOperation("cdpOperation",s,t.elapsed().ms,a)}_onTransportClose(){if(!this._closed){this._closed=!0,this._transport.dispose(),this.logger.info("cdp.receive","Connection closed",{connectionId:this._connectionId});for(let e of this._sessions.values())e._onClose();this._sessions.clear(),this._onDisconnectedEmitter.fire()}}close(){this._onTransportClose()}isClosed(){return this._closed}createSession(e){let t=new xu(this,e,this.logger);return this._sessions.set(e,t),t.cdp()}disposeSession(e){let t=this._sessions.get(e);t&&(t._onClose(),this._disposedSessions.set(t.sessionId(),new Date),this._sessions.delete(t.sessionId()))}},KR=+process.version.substring(1).split(".")[0]<11,xu=class{constructor(e,t,r){this.logger=r;this._queue=[];this._prefixListeners=new Hc;this._directListeners=new Hc;this.paused=!1;this._callbacks=new Map,this._connection=e,this._sessionId=t,this._cdp=this._createApi()}pause(){this.paused=!0}resume(){if(!this.paused)return;this.paused=!1;let e=this._queue;this._queue=[],this.logger.verbose("cdp.receive","Dequeue messages",{message:e});for(let t of e)this._processResponse(t)}cdp(){return this._cdp}sessionId(){return this._sessionId}_createApi(){return new Proxy({},{get:(e,t)=>t==="pause"?()=>this.pause():t==="resume"?()=>this.resume():t==="session"?this:new Proxy({},{get:(r,o)=>{if(o!=="then")return o==="on"?(n,s)=>this.on(`${t}.${n}`,s):n=>this.send(`${t}.${o}`,n)}})})}on(e,t){return this._directListeners.listen(e,t)}onPrefix(e,t){return this._prefixListeners.listen(e,t)}send(e,t={}){return this.sendOrDie(e,t).catch(()=>{})}sendOrDie(e,t={}){if(!this._connection)return Promise.reject(new hn(e).setCause(0,"Connection is closed"));let r=this._connection._send(e,t,this._sessionId);return new Promise((o,n)=>{this._callbacks.set(r,{resolve:o,reject:n,from:new hn(e),method:e})})}_onMessage(e){if(this.paused&&e.id){this._processResponse(e);return}if(this._queue.length>0){this._queue.push(e);return}if(!KR&&!this.paused){this._processResponse(e);return}this._queue.push(e),this.paused||this._processQueue()}_processQueue(){this._connection?.waitWrapper(()=>{if(this.paused)return;let e=this._queue.shift();e&&(this._processResponse(e),this._queue.length&&this._processQueue())})}_processResponse(e){if(e.id===void 0){let r=e;this._directListeners.emit(r.method,r.params);for(let[o,n]of this._prefixListeners.listeners)r.method.startsWith(o)&&n.fire(r);return}let t=this._callbacks.get(e.id);t&&(this._callbacks.delete(e.id),"error"in e?t.reject(t.from.setCause(e.error.code,e.error.message)):"result"in e&&t.resolve(e.result))}async detach(){if(!this._connection)throw new Error("Session already detached. Most likely the target has been closed.");this._connection._send("Target.detachFromTarget",{},this._sessionId)}isClosed(){return!this._connection}_onClose(){for(let e of this._callbacks.values())e.reject(e.from.setCause(0,"Connection is closed"));this._callbacks.clear(),this._connection=void 0}}});var Ky,Qy,gl,Fo,XR,Jy,lr,Hs,YR,bn=m(()=>{"use strict";Ky=require("astring"),Qy=require("crypto"),gl=require("inversify");We();en();cl();It();Ke();Fo="$returnValue",XR="__js_debug_hoisted_",Jy=()=>XR+(0,Qy.randomBytes)(8).toString("hex"),lr=Symbol("IEvaluator"),Hs=class{constructor(e,t){this.cdp=e;this.renameProvider=t}get hasReturnValue(){return!!this.returnValue}setReturnedValue(e){this.returnValue=e}prepare(e,{isInternalScript:t,hoist:r,renames:o}={}){t!==!1&&(e+=Pe());let n=new Map;n.set(Fo,Jy());for(let c of r??[])n.set(c,Jy());let{transformed:s,hoisted:a}=this.replaceVariableInExpression(e,n,o);return a.size?{canEvaluateDirectly:!1,invoke:(c,l={})=>Promise.all([...n].map(([p,d])=>this.hoistValue(p===Fo?this.returnValue:l[p],d))).then(()=>this.cdp.Debugger.evaluateOnCallFrame({...c,expression:s}))}:{canEvaluateDirectly:!0,invoke:c=>this.cdp.Debugger.evaluateOnCallFrame({...c,expression:s})}}async evaluate(e,t){if(!("callFrameId"in e))return this.cdp.Runtime.evaluate(e);let r=t;if(t?.stackFrame){let o=await this.renameProvider.provideOnStackframe(t.stackFrame);r={...r,renames:{mapping:o,position:t.stackFrame.rawPosition}}}return this.prepare(e.expression,r).invoke(e)}async hoistValue(e,t){let r=e?.objectId,o=`setTimeout(() => { delete globalThis.${t} }, 0)`;r?await this.cdp.Runtime.callFunctionOn({objectId:r,functionDeclaration:`function() { globalThis.${t} = this; ${o}; ${Pe()} }`}):await this.cdp.Runtime.evaluate({expression:`globalThis.${t} = ${JSON.stringify(e?.value)};${o};`+Pe()})}replaceVariableInExpression(e,t,r){let o=new Set,n=!1,s=(d,b)=>({type:"ConditionalExpression",test:{type:"BinaryExpression",left:{type:"UnaryExpression",operator:"typeof",prefix:!0,argument:{type:"Identifier",name:d}},operator:"!==",right:{type:"Literal",value:"undefined"}},consequent:{type:"Identifier",name:d},alternate:b}),a=[],c=zr(e),l=Hp(c,{enter(d,b){let y=d;if(d.type!=="Identifier"||e[y.start-1]===".")return;let v=t.get(d.name);if(v)return o.add(d.name),n=!0,{replace:Bg(d,b)?{type:"Identifier",name:v}:s(v,YR)};let D=r?.mapping.getCompiledName(d.name,r.position);if(D)return n=!0,{replace:Bg(d,b)?{type:"Identifier",name:D}:s(D,d)}},leave:()=>{a.pop()}});if(!n)return{hoisted:o,transformed:e};let p=c.body[c.body.length-1].end;return{hoisted:o,transformed:(0,Ky.generate)(l)+e.slice(p)}}};Hs=f([(0,gl.injectable)(),u(0,(0,gl.inject)(xe)),u(1,(0,gl.inject)(gi))],Hs);YR={type:"Identifier",name:"undefined"}});var Cu,af,cf=m(()=>{"use strict";It();le();oe();Cu=class i{static parse(e,t,r,o){t=af(t,r);let n=t&&li(t);if(n)throw new I(di(e,n.message));let{canEvaluateDirectly:s,invoke:a}=o.prepare(t);return new i(s?t:a)}constructor(e){typeof e=="function"?this.invoke=e:this.breakCondition=e}async shouldStayPaused(e){return this.invoke?(await this.invoke({callFrameId:e.callFrames[0].callFrameId,returnByValue:!0}))?.result.value===!0:Promise.resolve(!0)}},af=(i,e)=>`(()=>{try{return ${i};}catch(e){console.error(\`Breakpoint condition error: \${e.message||e}\`);return ${!!e}}})()`});var ZR,zs,eD,lf=m(()=>{"use strict";le();oe();ZR=/^(>|>=|={1,3}|<|<=|%)?\s*([0-9]+)$/,zs=class i{constructor(e){this.predicate=e;this.hits=0;this.breakCondition=void 0}shouldStayPaused(){return Promise.resolve(this.predicate(++this.hits))}static parse(e){let t=ZR.exec(e);if(!t)throw new I(Yg(e));let[,r="=",o]=t;return new i(eD(e,r,Number(o)))}},eD=(i,e,t)=>{switch(e){case"=":case"==":case"===":return r=>r===t;case">":return r=>r>t;case">=":return r=>r>=t;case"<":return r=>r<t;case"<=":return r=>r<=t;case"%":return r=>r%t===0;default:throw new I(Yg(i))}}});var Tu,Xy=m(()=>{"use strict";Tu=class{constructor(e){this.invoke=e;this.breakCondition=void 0}async shouldStayPaused(e){return await this.invoke({callFrameId:e.callFrames[0].callFrameId}),!1}}});var wn,pf=m(()=>{"use strict";It();le();oe();wn=class{constructor(e,t){this.breakCondition=t;let r=t&&li(t);if(r)throw new I(di(e,r.message))}shouldStayPaused(){return Promise.resolve(!0)}}});var Yy,Zy,Ru,hi,uf=m(()=>{"use strict";Yy=require("astring"),Zy=require("crypto"),Ru=require("inversify");en();It();le();oe();bn();Xy();pf();hi=class{constructor(e){this.evaluator=e}compile(e,t){let r=this.logMessageToExpression(t),o=li(r);if(o)throw new I(di(e,o.message));let{canEvaluateDirectly:n,invoke:s}=this.evaluator.prepare(r);return n?new wn(e,this.logMessageToExpression(t)):new Tu(s)}serializeLogStatements(e){return zw([],e,!1)}logMessageToExpression(e){let t=l=>l.replace(/%/g,"%%"),r=[],o=[],n=0;for(;;){let l=e.indexOf("{",n);if(l===-1){r.push(t(e.slice(n)));break}r.push(t(e.slice(n,l)));let[p]=qp(e.slice(l));if(n=l+p.end,n-1===l+1||e[n-1]!=="}"){r.push(t(e.slice(l,n)));continue}if(p.type!=="BlockStatement")break;o.push((0,Yy.generate)(this.serializeLogStatements(p.body))),r.push("%O")}let a=`console.log(${[JSON.stringify(r.join("")),...o].join(", ")}), false`,c=(0,Zy.createHash)("sha1").update(a).digest("hex").slice(0,7);return a+`
//# sourceURL=logpoint-${c}.cdp`}};hi=f([(0,Ru.injectable)(),u(0,(0,Ru.inject)(lr))],hi)});var Js,tD,RF,Du,Gs,df=m(()=>{"use strict";Js=require("inversify");$();bn();cf();lf();uf();pf();tD=new wn({line:0},void 0),RF=new wn({line:0},"false"),Du=Symbol("IBreakpointConditionFactory"),Gs=class{constructor(e,t,r){this.logPointCompiler=e;this.evaluator=t;this.breakOnError=r.__breakOnConditionalError}getConditionFor(e){return e.condition?Cu.parse(e,e.condition,this.breakOnError,this.evaluator):e.logMessage?this.logPointCompiler.compile(e,e.logMessage):e.hitCondition?zs.parse(e.hitCondition):tD}};Gs=f([(0,Js.injectable)(),u(0,(0,Js.inject)(hi)),u(1,(0,Js.inject)(lr)),u(2,(0,Js.inject)(X))],Gs)});var Lu,_u,ev,rD,Ks,Eu=m(()=>{"use strict";_();N();Dr();Lu=(i,e)=>i.lineNumber===e.lineNumber&&i.columnNumber===e.columnNumber,_u=i=>!("location"in i),ev=i=>"location"in i,rD=(i,e)=>i.url&&e===i.url||i.urlRegex&&new RegExp(i.urlRegex).test(e),Ks=class{constructor(e,t,r){this._manager=e;this._source=t;this._originalPosition=r;this.isEnabled=!1;this.setInCdpScriptIds=new Set;this.cdpScriptIds=this.setInCdpScriptIds;this.cdpBreakpoints=[];this._cdpIds=new Set}get enabled(){return this.isEnabled}get cdpIds(){return this._cdpIds}get source(){return this._source}get originalPosition(){return this._originalPosition}async updateSourceLocation(e,t,r){this._source=t,this._originalPosition=r;let o=[];for(let n of this.cdpBreakpoints)n.state===1&&o.push(this.updateUiLocations(e,n.cdpId,n.locations));await Promise.all(o)}async refreshUiLocations(e){await Promise.all(this.cdpBreakpoints.filter(t=>t.state===1).map(t=>this.updateUiLocations(e,t.cdpId,t.locations)))}async enable(e){if(this.isEnabled)return;this.isEnabled=!0;let t=[this._setPredicted(e)],r=this._manager._sourceContainer.source(this.source);if((!r||!(r instanceof Me))&&t.push(this._setByPath(e,r?.offsetSourceToScript(this.originalPosition)||this.originalPosition)),await Promise.all(t),r&&this.isEnabled){let o=await this._manager._sourceContainer.currentSiblingUiLocations({lineNumber:this.originalPosition.lineNumber,columnNumber:this.originalPosition.columnNumber,source:r});await Promise.all(o.map(n=>this._setByUiLocation(e,r.offsetSourceToScript(n))))}}async updateUiLocations(e,t,r){this.updateExistingCdpRef(t,a=>({...a,locations:r}));let o=(await Promise.all(r.map(a=>e.rawLocationToUiLocation(e.rawLocation(a))))).find(a=>!!a);if(!o)return;let n=this._manager._sourceContainer.source(this.source);if(!n)return;let s=await this._manager._sourceContainer.currentSiblingUiLocations(o);this.updateExistingCdpRef(t,a=>{let c=s.filter(l=>l.source===n);return{...a,locations:r,uiLocations:c.length?c:s}})}compare(e){let t=this.originalPosition,r=e.originalPosition;return t.lineNumber!==r.lineNumber?t.lineNumber-r.lineNumber:t.columnNumber-r.columnNumber}async disable(){if(!this.isEnabled)return;this.isEnabled=!1;let e=this.cdpBreakpoints.map(t=>this.removeCdpBreakpoint(t));await Promise.all(e)}async updateForNewLocations(e,t){let r=this._manager._sourceContainer.source(this.source);if(!r)return[];let o=await this._manager._sourceContainer.currentSiblingUiLocations({lineNumber:this.originalPosition.lineNumber,columnNumber:this.originalPosition.columnNumber,source:r},await t.source);if(!o.length)return[];let n=[];for(let s of o)n.push(this._setForSpecific(e,t,r.offsetSourceToScript(s)));for(let s of this.cdpBreakpoints){if(!_u(s.args)||!rD(s.args,t.url))continue;let a=s.args;o.some(c=>c.columnNumber-1===a.columnNumber&&c.lineNumber-1===a.lineNumber)||(this._manager.logger.verbose("runtime.sourcemap","Adjusted breakpoint due to overlaid sourcemap",{url:r.url}),n.push(this.removeCdpBreakpoint(s)))}return await Promise.all(n),o}executionContextWasCleared(){this.updateCdpRefs(e=>e.filter(t=>_u(t.args)))}hasResolvedAt(e,t){let{lineNumber:r,columnNumber:o}=t.base0;return this.cdpBreakpoints.some(n=>n.state===1&&n.locations.some(s=>s.scriptId===e&&s.lineNumber===r&&(s.columnNumber===void 0||s.columnNumber===o)))}getBreakCondition(){}updateExistingCdpRef(e,t){this.updateCdpRefs(r=>r.map(o=>o.state!==1||o.cdpId!==e?o:t(o)))}updateCdpRefs(e){let t=this;t.cdpBreakpoints=e(this.cdpBreakpoints);let r=new Set;this.setInCdpScriptIds.clear();for(let o of this.cdpBreakpoints)if(o.state===1){r.add(o.cdpId);for(let n of o.locations)this.setInCdpScriptIds.add(n.scriptId)}this._cdpIds=r}async _setPredicted(e){if(!this.source.path||!this._manager._breakpointsPredictor)return;let t=this._manager._breakpointsPredictor.predictedResolvedLocations({absolutePath:this.source.path,lineNumber:this.originalPosition.lineNumber,columnNumber:this.originalPosition.columnNumber}),r=[];for(let o of t){let n=this._manager._sourceContainer.sourcePathResolver.absolutePathToUrlRegexp(o.absolutePath);n!==void 0&&(typeof n=="string"?r.push(this._setByUrlRegexp(e,n,o)):r.push(n.then(s=>s?this._setByUrlRegexp(e,s,o):void 0)))}await Promise.all(r)}async _setByUiLocation(e,t){await Promise.all(t.source.scripts.map(r=>this._setForSpecific(e,r,t)))}async _setByPath(e,t){let r=this._manager._sourceContainer.source({path:this.source.path});if(!(r instanceof Me&&[...r.compiledToSourceUrl.keys()].some(n=>n.absolutePath===this.source.path)))if(this.source.path){let o=await this._manager._sourceContainer.sourcePathResolver.absolutePathToUrlRegexp(this.source.path);if(!o)return;await this._setByUrlRegexp(e,o,t)}else{let n=this._manager._sourceContainer.source(this.source)?.url;if(!n)return;await this._setByUrl(e,n,t),this.source.path!==n&&this.source.path!==void 0&&await this._setByUrl(e,W(this.source.path),t)}}hasSetOnLocation(e,t){return this.cdpBreakpoints.find(r=>e.scriptId&&ev(r.args)&&r.args.location.scriptId===e.scriptId&&Lu(r.args.location,t)||e.url&&!e.hasSourceURL&&_u(r.args)&&(r.args.urlRegex?new RegExp(r.args.urlRegex).test(e.url):e.url===r.args.url)&&Lu(r.args,t))}hasSetOnLocationByUrl(e,t,r){return this.cdpBreakpoints.find(o=>{if(_u(o.args))return Lu(o.args,r)?e==="url"?o.args.urlRegex?new RegExp(o.args.urlRegex).test(t):o.args.url===t:e==="re"&&o.args.urlRegex===t:!1;let n=this._manager._sourceContainer.getScriptById(o.args.location.scriptId);if(n)return Lu(o.args.location,r)&&e==="re"?new RegExp(t).test(n.url):n.url===t})}async _setForSpecific(e,t,r){return t.url&&!t.hasSourceURL&&(!t.embedderName||t.embedderName===t.url)?this._setByUrl(e,t.url,r):this._setByScriptId(e,t,r)}async _setByUrl(e,t,r){r=Lo(r);let o=this.hasSetOnLocationByUrl("url",t,r);if(o){o.state===0&&await o.done;return}return this._setAny(e,{url:t,condition:this.getBreakCondition(),...r})}async _setByUrlRegexp(e,t,r){r=Lo(r);let o=this.hasSetOnLocationByUrl("re",t,r);if(o){o.state===0&&await o.done;return}return this._setAny(e,{urlRegex:t,condition:this.getBreakCondition(),...r})}async _setByScriptId(e,t,r){r=Lo(r);let o=this.hasSetOnLocation(t,r);if(o){o.state===0&&await o.done;return}return this._setAny(e,{condition:this.getBreakCondition(),location:{scriptId:t.scriptId,...r}})}async _setAny(e,t){if(!this.isEnabled)return;let r={state:0,args:t,deadletter:!1};r.done=(async()=>{let o=ev(t)?await e.cdp().Debugger.setBreakpoint(t):await e.cdp().Debugger.setBreakpointByUrl(t);if(!o)return;if(r.deadletter){await e.cdp().Debugger.removeBreakpoint({breakpointId:o.breakpointId});return}let n="actualLocation"in o?[o.actualLocation]:o.locations;this._manager._resolvedBreakpoints.set(o.breakpointId,this);let s={state:1,cdpId:o.breakpointId,args:t,locations:n,uiLocations:[]};return this.updateCdpRefs(a=>a.map(c=>c===r?s:c)),await this.updateUiLocations(e,o.breakpointId,n),s})(),this.updateCdpRefs(o=>[...o,r]),await r.done}async removeCdpBreakpoint(e){this.updateCdpRefs(t=>t.filter(r=>r!==e)),e.state===0?(e.deadletter=!0,await e.done):(await this._manager._thread?.cdp().Debugger.removeBreakpoint({breakpointId:e.cdpId}),this._manager._resolvedBreakpoints.delete(e.cdpId))}}});var Au,eo,mf=m(()=>{"use strict";Au=require("path");Rr();bi();Eu();eo=class i extends Ks{constructor(t,r,o){super(t,r,{lineNumber:1,columnNumber:1});this.mode=o}static getModeKeyForSource(t,r){return t===1?(0,Au.basename)(r,(0,Au.extname)(r)||void 0):r}_setPredicted(){return Promise.resolve()}_setByPath(t,r){if(!this.source.path)return Promise.resolve();let o=i.getModeKeyForSource(this.mode,this.source.path);return this.mode===1?super._setByUrlRegexp(t,nt(o),r):super._setByPath(t,r)}}});var rv,pr,fl=m(()=>{"use strict";rv=w(require("@vscode/l10n"));U();Eu();pr=class extends Ks{constructor(t,r,o,n,s){super(t,o,{lineNumber:n.line,columnNumber:n.column||1});this.dapId=r;this.dapParams=n;this.condition=s;this.completedSet=ne()}equivalentTo(t){return t.dapParams.column===this.dapParams.column&&t.dapParams.line===this.dapParams.line&&t.dapParams.hitCondition===this.dapParams.hitCondition&&t.dapParams.condition===this.dapParams.condition&&t.dapParams.logMessage===this.dapParams.logMessage}untilSetCompleted(){return this.completedSet.promise}markSetCompleted(){this.completedSet.resolve()}testHitCondition(t){return this.condition.shouldStayPaused(t)}async toDap(){let t=this.enabled&&this.getResolvedUiLocation();return t?{id:this.dapId,verified:!0,source:await t.source.toDap(),line:t.lineNumber,column:t.columnNumber}:{id:this.dapId,verified:!1,message:rv.t("Unbound breakpoint")}}diagnosticDump(){return{source:this.source,params:this.dapParams,cdp:this.cdpBreakpoints}}getBreakCondition(){return this.condition.breakCondition}updateCdpRefs(t){let r=this.getResolvedUiLocation();super.updateCdpRefs(t),this.getResolvedUiLocation()!==r&&this.notifyResolved()}getResolvedUiLocation(){for(let t of this.cdpBreakpoints)if(t.state===1&&t.uiLocations.length)return t.uiLocations[0]}async notifyResolved(){await this._manager.notifyBreakpointChange(this,this.completedSet.hasSettled())}}});var Fu,ov=m(()=>{"use strict";fl();lf();Fu=class extends pr{constructor(e,t,r,o){super(e,t,r,o,new zs(()=>!1))}getResolvedUiLocation(){}}});var iv,hl,nv=m(()=>{"use strict";iv=require("micromatch");ee();bi();mf();hl=class extends eo{constructor(t,r){super(t,{path:r},1);this.pattern=r}async enable(t){if(this.isEnabled)return;this.isEnabled=!0;let r=(0,iv.makeRe)(B(this.pattern),{contains:!0,lookbehinds:!1});await this._setAny(t,{urlRegex:r.source.replace(/([a-z]):/i,(o,n)=>`[${n.toLowerCase()}${n.toUpperCase()}]:`),lineNumber:0,columnNumber:0})}}});var Qs,Mu=m(()=>{"use strict";Qs=Symbol("IExperimentationService")});var Xs,iD,nD,sv,sD,Ce,bl=m(()=>{"use strict";Xs=require("inversify");ze();O();U();Lr();Mu();js();iD=/\/node_modules\/|^node\:/,nD=2,sv=5e3,sD=sv/2,Ce=class{constructor(e,t,r){this.telemetry=t;this.experimentation=r;this.disposable=new j;this.hadBreakpoint=!1;this.didVerifyBreakpoint=!1;this.hadNonModuleSourcemap=!1;this.startedAt=Date.now();this.disposable.push(Ce.didVerifyEmitter.event(()=>{this.didVerifyBreakpoint=!0})),Ce.consecutiveQualifyingSessions>=nD&&this.disposable.push(vw(async()=>{this.currentlyQualifying&&await this.experimentation.getTreatment("diagnosticPrompt",!0)&&(t.report("diagnosticPrompt",{event:"suggested"}),Ce.didSuggest=!0,e.suggestDiagnosticTool({}))},sv))}get currentlyQualifying(){return this.hadBreakpoint&&!this.didVerifyBreakpoint&&this.hadNonModuleSourcemap}notifyHadBreakpoint(){this.hadBreakpoint=!0}notifyVerifiedBreakpoint(){this.didVerifyBreakpoint||(Ce.didVerifyEmitter.fire(),Ce.didSuggest&&(Ce.didSuggest=!1,this.telemetry.report("diagnosticPrompt",{event:"resolved"})))}attach(e){if(!this.hadNonModuleSourcemap){let t=this.disposable.push(e.Debugger.on("scriptParsed",r=>{r.sourceMapURL&&!iD.test(r.url)&&(this.hadNonModuleSourcemap=!0,this.disposable.disposeObject(t))}))}}dispose(){this.currentlyQualifying&&Date.now()-sD>this.startedAt?Ce.consecutiveQualifyingSessions++:Ce.consecutiveQualifyingSessions=0,this.disposable.dispose()}};Ce.consecutiveQualifyingSessions=0,Ce.didVerifyEmitter=new S,Ce.didSuggest=!1,Ce=f([(0,Xs.injectable)(),u(0,(0,Xs.inject)(Fs)),u(1,(0,Xs.inject)(at)),u(2,(0,Xs.inject)(Qs))],Ce)});var av,Nu,cv,lv=m(()=>{"use strict";av=w(require("fs")),Nu=w(require("path")),cv=i=>{let e={};b(e);function t(v,D){return i({category:"telemetry",output:v,data:D})}let r=v=>t("js-debug/dap/operation",{...e,...v}),o=v=>t("js-debug/cdp/operation",{...e,...v}),n=v=>t("js-debug/error",{...e,...v}),s=v=>{e.browser=(v.targetProject||v.targetProject)+"/"+v.targetVersion,t("js-debug/browserVersion",{...e,...v})},a=v=>t("js-debug/breakpointStats",{...e,...v}),c=v=>t("js-debug/statistics",{...e,...v}),l=v=>{e.nodeVersion=v.version,t("js-debug/nodeRuntime",{...e,...v})},p=v=>{t("js-debug/launch",{...e,...v,parameters:JSON.stringify(v.parameters)})},d=v=>{t("js-debug/diagnosticPrompt",{...e,...v})};function b(v){try{let D=Nu.resolve(Nu.dirname(__filename),"..","..",".gitcommit");v.jsDebugCommitId=av.readFileSync(D,"utf8")}catch{}}return{breakpointStats:a,statistics:c,browserVersion:s,cdpOperation:o,dapOperation:r,error:n,launch:p,nodeRuntime:l,diagnosticPrompt:d,setGlobalMetric:(v,D)=>{e[v]=D}}}});var wl,pv=m(()=>{"use strict";wl=class{constructor(e=!0){this.isVSCode=e;this.measurements=Object.create(null)}add(e,t,r){let o=this.measurements[e];o||(o=this.measurements[e]={times:[],errors:[]}),o.times.push(t),r&&o.errors.push(r)}flush(){let e={errors:[]};for(let t in this.measurements){let{times:r,errors:o}=this.measurements[t],n={operation:t,totalTime:0,max:0,avg:0,stddev:0,count:r.length,failed:o.length};for(let s of r)n.totalTime+=s,n.max=Math.max(n.max,s);n.avg=n.totalTime/n.count;for(let s of r)n.stddev+=(s-n.avg)**2;n.stddev=Math.sqrt(n.stddev/(r.length-1)),e[n.operation]=n,e[`!${n.operation}.errors`]=o,this.isVSCode||(e[`${n.operation}.errors`]=o)}return this.measurements=Object.create(null),e}}});function ff(i){let e=String(i.message),t=String(i.name);uv.lastIndex=0;let r=typeof i.stack=="string"?i.stack.replace(uv,"$1"):void 0;return{error:{message:e,name:t,stack:r}}}var Bu,ur,gf,uv,Ou=m(()=>{"use strict";Bu=require("inversify");O();M();H();lv();pv();ur=class{constructor(e=!0){this.isVsCode=e;this.target=[];this.flushEmitter=new S;this.loggers=cv(e=>this.pushOutput(e));this.batchFlushTimeout={};this.batchers={dapOperation:new wl(this.isVsCode),cdpOperation:new wl(this.isVsCode)};this.onFlush=this.flushEmitter.event;this.setGlobalMetric=this.loggers.setGlobalMetric}report(e,...t){let r=this.loggers[e];r(...t)}reportOperation(e,t,r,o){this.batchers[e].add(t,r,o),this.batchFlushTimeout[e]===void 0&&(this.batchFlushTimeout[e]=setTimeout(()=>{this.report(e,this.batchers[e].flush()),this.batchFlushTimeout[e]=void 0},ur.batchFlushInterval))}attachDap(e){this.target instanceof Array&&this.target.forEach(t=>e.output(t)),this.target=e}flush(){this.flushEmitter.fire();let e=Object.entries(this.batchFlushTimeout);for(let[t,r]of e){let o=this.batchers[t].flush();o.length&&this.report(t,o),this.batchFlushTimeout[t]=void 0,clearTimeout(r)}}dispose(){for(let e of Object.values(this.batchFlushTimeout))e&&clearTimeout(e)}pushOutput(e){e.data=gf(e.data),this.target instanceof Array?this.target.push(e):this.target.output(e)}};ur.batchFlushInterval=5e3,ur=f([(0,Bu.injectable)(),u(0,(0,Bu.inject)(Os))],ur);gf=i=>typeof i=="number"?Number(i.toFixed(1)):typeof i!="object"||!i?i:i instanceof Error?ff(i):i instanceof Array?i.map(gf):Po(i,gf),uv=/(?:[A-z]:)?(?:[\\/][^:]*)+[\\/]([^:]*:)/g});var ju=m(()=>{"use strict"});var yn,Uu=m(()=>{"use strict";yn=Symbol("IDwarfModuleProvider")});var mv,to,Vu,wf,Ys,Zs,Wu,hf,aD,bf,yl=m(()=>{"use strict";mv=require("crypto"),to=require("inversify");We();oi();_();M();Co();$();le();oe();ju();Ke();Uu();Vu=Symbol("IWasmSymbolProvider"),wf=Symbol("IWasmWorkerFactory"),Ys=class{constructor(e,t){this.dwarf=e;this.launchConfig=t;this.cdpCounter=0;this.cdp=new Map;this.prompt=F(()=>this.dwarf.prompt())}async spawn(e){if(!this.launchConfig.enableDWARF)return null;this.worker??=this.dwarf.load().then(o=>{if(!o)return null;let n=o.spawn({getWasmGlobal:(s,a)=>this.loadWasmValue(`globals[${s}]`,a),getWasmLocal:(s,a)=>this.loadWasmValue(`locals[${s}]`,a),getWasmOp:(s,a)=>this.loadWasmValue(`stack[${s}]`,a),getWasmLinearMemory:(s,a,c)=>this.loadWasmValue(`[].slice.call(new Uint8Array(memories[0].buffer, ${+s}, ${+a}))`,c).then(l=>new Uint8Array(l).buffer)});return n.rpc.sendMessage("hello",[],!1),n});let t=await this.worker;if(!t)return null;let r=this.cdpCounter++;return this.cdp.set(r,e),{rpc:t.rpc,getStopId:o=>`${r}:${o}`,dispose:()=>(this.cdp.delete(r),t.dispose())}}async dispose(){await this.worker?.then(e=>e?.dispose()),this.worker=Promise.resolve(null)}async loadWasmValue(e,t){let r=t,o=r.indexOf(":"),n=r.substring(0,o),s=r.substring(o+1),a=await this.cdp.get(+n)?.Debugger.evaluateOnCallFrame({callFrameId:s,expression:e+Pe(),silent:!0,returnByValue:!0,throwOnSideEffect:!0});if(!a||a.exceptionDetails)throw new Error(`evaluate failed: ${a?.exceptionDetails?.text||"unknown"}`);return a.result.value}};Ys=f([(0,to.injectable)(),u(0,(0,to.inject)(yn)),u(1,(0,to.inject)(X))],Ys);Zs=class{constructor(e,t,r,o){this.dwarf=e;this.cdp=t;this.logger=r;this.launchConfig=o;this.worker=F(()=>this.dwarf.spawn(this.cdp))}async loadWasmSymbols(e){if(!this.launchConfig.enableDWARF)return this.defaultSymbols(e);let t=await this.worker();if(!t){let a=this.defaultSymbols(e);return a.onDidDisassemble=this.dwarf.prompt,a}let{rpc:r}=t,o=(0,mv.randomUUID)(),n=e.debugSymbols?.externalURL,s;try{s=await r.sendMessage("addRawModule",o,n,{url:e.url,code:!n&&e.url.startsWith("wasm://")?await this.getBytecode(e.scriptId):void 0})}catch{return this.defaultSymbols(e)}return!(s instanceof Array)||s.length===0?(r.sendMessage("removeRawModule",o),this.defaultSymbols(e)):(this.logger.info("sourcemap.parsing","parsed files from wasm",{files:s}),new hf(e,this.cdp,o,t,s))}async dispose(){await this.worker.value?.then(e=>e?.dispose())}defaultSymbols(e){return new Wu(e,this.cdp,[])}async getBytecode(e){let r=(await this.cdp.Debugger.getScriptSource({scriptId:e}))?.bytecode;return r?Buffer.from(r,"base64").buffer:void 0}};Zs=f([(0,to.injectable)(),u(0,(0,to.inject)(wf)),u(1,(0,to.inject)(xe)),u(2,(0,to.inject)(C)),u(3,(0,to.inject)(X))],Zs);Wu=class{constructor(e,t,r){this.event=e;this.cdp=t;this.doDisassemble=F(async()=>{let e=[],t;for await(let r of this.getDisassembledStream()){e=e.concat(r.lines);let o;if(t){let n=new Uint32Array(t.length+r.lines.length);o=t.length,n.set(t),t=n}else t=new Uint32Array(r.lines.length),o=0;for(let n=0;n<r.lines.length;n++)t[o+n]=r.bytecodeOffsets[n]}return t??=new Uint32Array(0),{lines:e,byteOffsetsOfLines:t}});r.push(this.decompiledUrl=e.url.replace(".wasm",".wat")),this.files=r}async getDisassembly(){let{lines:e}=await this.doDisassemble();return this.onDidDisassemble?.(),e.join(`
`)}originalPositionFor(e){return this.disassembledPositionFor(e)}async disassembledPositionFor(e){let{byteOffsetsOfLines:t}=await this.doDisassemble(),r=Zw(t,e.base0.columnNumber,(o,n)=>o-n);if(r!==t.length)return{url:this.decompiledUrl,position:new Re(r,0)}}async compiledPositionFor(e,t){if(e!==this.decompiledUrl)return[];let{byteOffsetsOfLines:r}=await this.doDisassemble(),{lineNumber:o}=t.base0;if(o>=r.length)return[];let n=r[t.base0.lineNumber];return[new Re(0,n)]}dispose(){}async*getDisassembledStream(){let{scriptId:e}=this.event,t=await this.cdp.Debugger.disassembleWasmModule({scriptId:e});if(t)for(yield t.chunk;t.streamId;){let r=await this.cdp.Debugger.nextWasmDisassemblyChunk({streamId:t.streamId});if(!r)return;yield r.chunk}}},hf=class extends Wu{constructor(t,r,o,n,s){super(t,r,s);this.moduleId=o;this.worker=n;this.mappedLines=new Map}get codeOffset(){return this.event.codeOffset||0}async originalPositionFor(t){let r=await this.worker.rpc.sendMessage("rawLocationToSourceLocation",{codeOffset:t.base0.columnNumber-this.codeOffset,inlineFrameIndex:t.base0.lineNumber,rawModuleId:this.moduleId});return r.length?{position:new Re(r[0].lineNumber,r[0].columnNumber),url:r[0].sourceFileURL}:super.originalPositionFor(t)}async compiledPositionFor(t,r){if(t===this.decompiledUrl)return super.compiledPositionFor(t,r);let{lineNumber:o,columnNumber:n}=r.base0,s=await this.worker.rpc.sendMessage("sourceLocationToRawLocation",{lineNumber:o,columnNumber:n===0?-1:n,rawModuleId:this.moduleId,sourceFileURL:t});if(n===0&&s.length===0){let a=await this.getMappedLines(t),c=a.find(l=>l>o);if(!a.includes(o)&&c)return this.compiledPositionFor(t,new Re(c,0))}return s.filter(a=>a.rawModuleId===this.moduleId).map(a=>new Re(0,this.codeOffset+a.startOffset))}dispose(){return this.worker.rpc.sendMessage("removeRawModule",this.moduleId)}async getVariablesInScope(t,r){let o={codeOffset:r.base0.columnNumber-this.codeOffset,inlineFrameIndex:r.base0.lineNumber,rawModuleId:this.moduleId};return(await this.worker.rpc.sendMessage("listVariablesInScope",o)).map(s=>({name:s.name,scope:s.scope,type:s.type,evaluate:async()=>{let a=await this.worker.rpc.sendMessage("evaluate",s.name,o,this.worker.getStopId(t));return a?new bf(a,this.worker.rpc):aD}}))}async getFunctionStack(t){let r=await this.worker.rpc.sendMessage("getFunctionInfo",{codeOffset:t.base0.columnNumber-this.codeOffset,inlineFrameIndex:t.base0.lineNumber,rawModuleId:this.moduleId});return"frames"in r?r.frames:[]}async getStepSkipList(t,r,o,n){if(o===this.decompiledUrl)return[];let s={codeOffset:r.base0.columnNumber-this.codeOffset,inlineFrameIndex:r.base0.lineNumber,rawModuleId:this.moduleId},a=()=>n&&o?this.worker.rpc.sendMessage("sourceLocationToRawLocation",{lineNumber:n.base0.lineNumber,columnNumber:-1,rawModuleId:this.moduleId,sourceFileURL:o}):[],c;switch(t){case 2:{c=await this.worker.rpc.sendMessage("getInlinedFunctionRanges",s);break}case 1:{let l=await Promise.all([this.worker.rpc.sendMessage("getInlinedCalleesRanges",s),a()]);c=xo(l);break}case 0:c=await a();break;default:c=[];break}return c.map(l=>new Cr(new Re(0,l.startOffset+this.codeOffset),new Re(0,l.endOffset+this.codeOffset)))}async evaluate(t,r,o){try{return await this.worker.rpc.sendMessage("evaluate",o,{codeOffset:r.base0.columnNumber-this.codeOffset,inlineFrameIndex:r.base0.lineNumber,rawModuleId:this.moduleId},this.worker.getStopId(t))??void 0}catch(n){throw new I(ce(n.message))}}getMappedLines(t){let r=this.mappedLines.get(t);if(r)return r;let o=(async()=>{try{let n=await this.worker.rpc.sendMessage("getMappedLines",this.moduleId,t);return new Uint32Array(n?.sort((s,a)=>s-a)||[])}catch{return new Uint32Array}})();return this.mappedLines.set(t,o),o}},aD={type:"null",description:"no properties"},bf=class i{constructor(e,t){if(this.type=e.type,this.description=e.description,this.linearMemoryAddress=e.linearMemoryAddress,this.linearMemorySize=e.linearMemoryAddress,e.objectId&&e.hasChildren){let r=e.objectId;this.getChildren=F(()=>this._getChildren(t,r))}}async _getChildren(e,t){return(await e.sendMessage("getProperties",t)).map(o=>({name:o.name,value:new i(o.value,e)}))}}});var wi,vl=m(()=>{"use strict";wi=Symbol("IScriptSkipper")});function gv(i){return typeof i.lineNumber=="number"&&typeof i.columnNumber=="number"&&!!i.source}var $u,dr,wv,fv,cD,lD,pD,hv,bv,Ye,Mo=m(()=>{"use strict";$u=require("@jridgewell/trace-mapping"),dr=require("inversify"),wv=require("js-xxhash");ys();O();_();ee();Co();al();Ft();It();N();$();Lr();le();H();Ou();yl();il();vl();Dr();fv=()=>({source:null,line:null,column:null,name:null,lastColumn:null,isSourceMapLoadFailure:!0}),cD=/\?t=[0-9]+$/,lD=i=>i.endsWith(".hot-update.js")||cD.test(i),pD={load:0,resolveLocation:2e3,sourceMapMinPause:1e3,output:1e3,sourceMapCumulativePause:1e4},hv=(i,e)=>e instanceof Me&&e.compiledToSourceUrl.has(i),bv=2**31-1,Ye=class{constructor(e,t,r,o,n,s,a,c,l){this.sourceMapFactory=t;this.logger=r;this.launchConfig=o;this.initializeConfig=n;this.sourcePathResolver=s;this.scriptSkipper=a;this.resourceProvider=c;this.wasmSymbols=l;this.rootPaths=[];this.scriptsById=new Map;this.onSourceMappedSteppingChangeEmitter=new S;this.onScriptEmitter=new S;this._sourceByOriginalUrl=new ft(e=>e.toLowerCase());this._sourceByReference=new Map;this._sourceMapSourcesByUrl=new Map;this._sourceByAbsolutePath=on();this._sourceMapTimeouts=pD;this._fileContentOverridesForTest=new Map;this._temporarilyDisabledSourceMaps=new Set;this._permanentlyDisabledSourceMaps=new Set;this.onScript=this.onScriptEmitter.event;this._statistics={fallbackSourceMapCount:0};this._doSourceMappedStepping=this.launchConfig.sourceMaps;this.onSourceMappedSteppingChange=this.onSourceMappedSteppingChangeEmitter.event;this._dap=e;let p="webRoot"in o?o.webRoot:o.rootPath;p&&(this.rootPaths=[p,$t(p,"..","ClientApp")]),a.setSourceContainer(this),this.setSourceMapTimeouts({...this.sourceMapTimeouts(),...o.timeouts})}get sources(){return this._sourceByReference.values()}statistics(){return this._statistics}get doSourceMappedStepping(){return this._doSourceMappedStepping}set doSourceMappedStepping(e){e!==this._doSourceMappedStepping&&(this._doSourceMappedStepping=e,this.onSourceMappedSteppingChangeEmitter.fire(e))}setSourceMapTimeouts(e){this._sourceMapTimeouts=e}sourceMapTimeouts(){return this._sourceMapTimeouts}setFileContentOverrideForTest(e,t){t===void 0?this._fileContentOverridesForTest.delete(e):this._fileContentOverridesForTest.set(e,t)}async loadedSources(){let e=[];for(let t of this._sourceByReference.values())e.push(t.toDap());return await Promise.all(e)}source(e){if(e.sourceReference)return this._sourceByReference.get(e.sourceReference);if(e.path)return this._sourceByAbsolutePath.get(e.path)}isSourceSkipped(e){return this.scriptSkipper.isScriptSkipped(e)}addScriptById(e){this.scriptsById.set(e.scriptId,e),"source"in e&&this.onScriptEmitter.fire(e)}getSourceScriptById(e){return this.scriptsById.get(e)}getScriptById(e){let t=this.scriptsById.get(e);return t&&"source"in t?t:void 0}getSourceByOriginalUrl(e){return this._sourceByOriginalUrl.get(e)}getSourceReference(e){let t=(0,wv.xxHash32)(e)&bv;for(let r=0;r<65535;r++){if(!this._sourceByReference.has(t))return t;t===bv&&(t=0),t++}return this.logger.assert(!1,"Max iterations exceeding for source reference assignment"),t}async preferredUiLocation(e){let t=!1,r=4;for(;;){let o=await this._originalPositionFor(e);if(!gv(o)){r=t?void 0:o;break}e=o,t=!0,r=void 0}return{...e,isMapped:t,unmappedReason:r}}async currentSiblingUiLocations(e,t){let r=await this._uiLocations(e);return t?r.filter(o=>o.source===t):r}clear(e){this.scriptsById.clear();for(let t of this._sourceByReference.values())this.removeSource(t,e);this._sourceByReference.clear(),this.sourceMapFactory instanceof mi&&this.sourceMapFactory.invalidateCache()}async _uiLocations(e){let[t,r]=await Promise.all([this.getSourceMapUiLocations(e),this.getCompiledLocations(e)]);return[...t,e,...r]}async getSourceMapUiLocations(e){let t=await this._originalPositionFor(e);if(!gv(t))return[];let r=await this.getSourceMapUiLocations(t);return r.push(t),r}async _originalPositionFor(e){if(!kt(e.source))return 1;let t=await Zc.waitForValueWithTimeout(e.source.sourceMap,this._sourceMapTimeouts.resolveLocation);if(!t)return 2;if(this._doSourceMappedStepping)return this._originalPositionForMap(e,t);if(Og(t)){let r=await t.disassembledPositionFor(new je(e.lineNumber,e.columnNumber)),o=r&&e.source.sourceMap.sourceByUrl.get(r.url);if(o)return o?{columnNumber:r.position.base1.lineNumber,lineNumber:r.position.base1.lineNumber,source:o}:3}return 0}async _originalPositionForMap(e,t){let r=e.source;if(!kt(r))return 1;if(this._temporarilyDisabledSourceMaps.has(r)||this._permanentlyDisabledSourceMaps.has(r))return 0;let o=await this.getOptiminalOriginalPosition(t,by(e,r.inlineScriptOffset));if(!o)return 3;let n=r.sourceMap.sourceByUrl.get(o.url);if(!n)return 3;let s=o.position.base1;return{lineNumber:s.lineNumber,columnNumber:s.columnNumber,source:n}}async getCompiledLocations(e){if(!(e.source instanceof Me))return[];let t=[];for(let[r,o]of e.source.compiledToSourceUrl){let n=await Zc.waitForValueWithTimeout(r.sourceMap,this._sourceMapTimeouts.resolveLocation);if(!n)continue;let s;if("decompiledUrl"in n){let a=await n.compiledPositionFor(o,new je(e.lineNumber,e.columnNumber));if(!a)continue;s=a.map(c=>({lineNumber:c.base1.lineNumber,columnNumber:c.base1.columnNumber,source:r}))}else{let a=this.sourceMapFactory.guardSourceMapFn(n,()=>nu(o,e,n),fv);if(!a)continue;let{lineNumber:c,columnNumber:l}=hy({lineNumber:a.line||1,columnNumber:(a.column||0)+1},r.inlineScriptOffset),p={lineNumber:c,columnNumber:l,source:r};s=[p,...await this.getCompiledLocations(p)]}t=t.concat(s)}return t}async getOptiminalOriginalPosition(e,t){if(Og(e))return await e.originalPositionFor(new je(t.lineNumber,t.columnNumber));let r=this.sourceMapFactory.guardSourceMapFn(e,()=>{let o=e.originalPositionFor({line:t.lineNumber,column:t.columnNumber-1,bias:$u.GREATEST_LOWER_BOUND});return o.line!==null?o:e.originalPositionFor({line:t.lineNumber,column:t.columnNumber-1,bias:$u.LEAST_UPPER_BOUND})},fv);if(!(r.column===null||r.line===null||r.source===null))return{position:new xr(r.line,r.column),url:r.source}}async addSource(e,t,r,o,n,s){let a=await this.sourcePathResolver.urlToAbsolutePath({url:e.url});this.logger.verbose("runtime.sourcecreate","Creating source from url",{inputUrl:e.url,absolutePath:a});let c;return e.scriptLanguage==="WebAssembly"?c=new au(this,e,a):c=new nn(this,e.url,a,t,r&&this.sourcePathResolver.shouldResolveSourceMap({sourceMapUrl:r,compiledPath:a||e.url})?{sourceMapUrl:r,compiledPath:a||e.url,cacheKey:e.hash}:void 0,o,n,s),this._addSource(c),c}async _addSource(e){let t=e.url&&this._sourceByOriginalUrl.get(e.url);t&&!hv(t,e)&&this.removeSource(t,!0),this._sourceByOriginalUrl.set(e.url,e),this._sourceByReference.set(e.sourceReference,e),e instanceof Me&&this._sourceMapSourcesByUrl.set(e.url,e);let r=this._sourceByAbsolutePath.get(e.absolutePath);(r===void 0||r.url.length>=e.url.length||hv(r,e))&&this._sourceByAbsolutePath.set(e.absolutePath,e),this.scriptSkipper.initializeSkippingValueForSource(e),e.toDap().then(o=>this._dap.loadedSource({reason:"new",source:o})),sn(e)?this._finishAddSourceWithSourceMap(e):an(e)&&this._finishAddSourceWithWasm(e)}async _finishAddSourceWithWasm(e){let t=await this.wasmSymbols.loadWasmSymbols(e.event),r=[];for(let o of t.files){let n=await this.sourcePathResolver.urlToAbsolutePath({url:o}),s=n?W(n):o;this.logger.verbose("runtime.sourcecreate","Creating wasm source from source map",{inputUrl:o,absolutePath:n,resolvedUrl:s});let a=n&&W(n),c=o===t.decompiledUrl?()=>t.getDisassembly():()=>a?this.resourceProvider.fetch(a).then(p=>p.body):Promise.resolve(`Could not read ${o}`),l=new Me(this,s,n,c);l.compiledToSourceUrl.set(e,o),e.sourceMap.sourceByUrl.set(o,l),r.push(this._addSource(l))}await Promise.all(r),e.sourceMap.value.resolve(t)}async _finishAddSourceWithSourceMap(e){let t=e.sourceMap.value,r;try{r=await this.sourceMapFactory.load(e.sourceMap.metadata)}catch(o){if(this.initializeConfig.clientID==="visualstudio"){let n=e.sourceMap.metadata.sourceMapUrl;try{let s=await this.sourcePathResolver.urlToAbsolutePath({url:n});s&&(e.sourceMap.metadata.sourceMapUrl=W(s)),r=await this.sourceMapFactory.load(e.sourceMap.metadata),this._statistics.fallbackSourceMapCount++,this.logger.info("sourcemap.parsing","Failed to process original source-map; falling back to storage source-map",{fallbackSourceMapUrl:e.sourceMap.metadata.sourceMapUrl,originalSourceMapUrl:n,originalSourceMapError:ff(o)})}catch{}}if(r===void 0)return this._dap.output({output:hu(e.url,o.message).error.format+`
`,category:"stderr"}),t.resolve(void 0)}if(this._sourceByReference.get(e.sourceReference)!==e)return t.resolve(void 0);this.logger.verbose("sourcemap.parsing","Creating sources from source map",{sourceMapId:r.id,metadata:r.metadata});try{await this._addSourceMapSources(e,r)}finally{t.resolve(r)}this.scriptSkipper.initializeSkippingValueForSource(e)}removeSource(e,t=!1){let r=this._sourceByReference.get(e.sourceReference);if(r!==void 0){if(this.logger.assert(e===r,"Expected source to be the same as the existing reference"),this._sourceByReference.delete(e.sourceReference),this._sourceByOriginalUrl.get(e.url)===e&&this._sourceByOriginalUrl.delete(e.url),e instanceof Me){this._sourceMapSourcesByUrl.delete(e.url);for(let[o,n]of e.compiledToSourceUrl)o.sourceMap.sourceByUrl.delete(n)}this._sourceByAbsolutePath.delete(e.absolutePath),kt(e)&&(this._permanentlyDisabledSourceMaps.delete(e),this._temporarilyDisabledSourceMaps.delete(e)),t||e.toDap().then(o=>this._dap.loadedSource({reason:"removed",source:o})),an(e)&&e.sourceMap.value.promise.then(o=>o?.dispose()),kt(e)&&this._removeSourceMapSources(e,t)}}async _addSourceMapSources(e,t){let r=[];for(let o of t.sources){if(o===null)continue;let n=await this.sourcePathResolver.urlToAbsolutePath({url:o,map:t}),s=n?W(n):t.computedSourceUrl(o),a=this._sourceMapSourcesByUrl.get(s);if(e===a)continue;if(a)if(lD(e.url))this.removeSource(a);else{a.compiledToSourceUrl.set(e,o),e.sourceMap.sourceByUrl.set(o,a);continue}this.logger.verbose("runtime.sourcecreate","Creating source from source map",{inputUrl:o,sourceMapId:t.id,absolutePath:n,resolvedUrl:s});let c=n&&W(n),l=this.sourceMapFactory.guardSourceMapFn(t,()=>t.sourceContentFor(o),()=>null),p;if(l){let b=Cs(l);if(b&&(!st(b)&&n?p=Tr(n?W(n):o,b):p=b),n&&p){let y={sourceMapUrl:p,compiledPath:n};this.sourcePathResolver.shouldResolveSourceMap(y)||(p=void 0)}}let d=new Me(this,s,n,l!==null?()=>Promise.resolve(l):c?()=>this.resourceProvider.fetch(c).then(b=>b.body):()=>e.content(),p?{compiledPath:n||s,sourceMapUrl:p,cacheKey:t.metadata.cacheKey}:void 0,void 0,e.runtimeScriptOffset);d.compiledToSourceUrl.set(e,o),e.sourceMap.sourceByUrl.set(o,d),r.push(this._addSource(d))}await Promise.all(r)}_removeSourceMapSources(e,t){for(let r of e.sourceMap.sourceByUrl.keys()){let o=e.sourceMap.sourceByUrl.get(r);o&&(e.sourceMap.sourceByUrl.delete(r),o.compiledToSourceUrl.delete(e),!o.compiledToSourceUrl.size&&this.removeSource(o,t))}}async waitForSourceMapSources(e){return kt(e)?[...(await Zc.waitForSources(e.sourceMap)).values()]:[]}async revealUiLocation(e){this._dap.revealLocationRequested({source:await e.source.toDap(),line:e.lineNumber,column:e.columnNumber})}disableSourceMapForSource(e,t=!1){t?this._permanentlyDisabledSourceMaps.add(e):this._temporarilyDisabledSourceMaps.add(e)}clearDisabledSourceMaps(e){e?this._temporarilyDisabledSourceMaps.delete(e):this._temporarilyDisabledSourceMaps.clear()}};Ye=f([(0,dr.injectable)(),u(0,(0,dr.inject)(At)),u(1,(0,dr.inject)(Qr)),u(2,(0,dr.inject)(C)),u(3,(0,dr.inject)(X)),u(4,(0,dr.inject)(Mt)),u(5,(0,dr.inject)(ge)),u(6,(0,dr.inject)(wi)),u(7,(0,dr.inject)(ln)),u(8,(0,dr.inject)(Vu))],Ye)});var ro,yv,vv,Sv,mr,bi=m(()=>{"use strict";ro=require("inversify");_();M();U();N();$();Lr();oe();qy();nf();ku();df();mf();ov();nv();fl();bl();Dr();Mo();yv=i=>i.originalPosition.columnNumber===1&&i.originalPosition.lineNumber===1,vv=500,Sv=Symbol("DontCompare"),mr=class{constructor(e,t,r,o,n,s,a){this.logger=r;this.launchConfig=o;this.conditionFactory=n;this.suggester=s;this._breakpointsPredictor=a;this._resolvedBreakpoints=new Map;this._totalBreakpointsCount=0;this._launchBlocker=new Set;this._predictorDisabledForTest=!1;this._breakpointsStatisticsCalculator=new Su;this.entryBreakpointMode=0;this._enabledFilter=()=>!0;this._byDapId=new Map;this._byPath=on();this._byRef=new Map;this.moduleEntryBreakpoints=on();this._dap=e,this._sourceContainer=t,a?.onLongParse(()=>e.longPrediction({})),t.onScript(c=>{c.source.then(l=>{let p=this._thread;p&&this._byRef.get(l.sourceReference)?.forEach(d=>d.updateForNewLocations(p,c))})}),t.onSourceMappedSteppingChange(()=>{if(this._thread)for(let c of this._byDapId.values())c.refreshUiLocations(this._thread)}),this._scriptSourceMapHandler=async(c,l)=>{if(!r.assert(this._thread,"Expected thread to be set for the breakpoint source map handler"))return[];let p=[],d=[l];for(let b=0;b<d.length;b++)for(let y of d[b]){let v=y.absolutePath,D=v?this._byPath.get(v):void 0;for(let pe of D||[])p.push(pe.updateForNewLocations(this._thread,c));let Te=this._byRef.get(y.sourceReference);for(let pe of Te||[])p.push(pe.updateForNewLocations(this._thread,c));y.sourceMap&&d.push(y.sourceMap.sourceByUrl.values())}return xo(await Promise.all(p))}}get appliedByPath(){return this._byPath}get appliedByRef(){return this._byRef}hasAtLocation(e){let t=this._byPath.get(e.source.absolutePath)||[],r=this._byRef.get(e.source.sourceReference)||[];return t.concat(r).some(o=>o.originalPosition.columnNumber===e.columnNumber&&o.originalPosition.lineNumber===e.lineNumber)}async moveBreakpoints(e,t,r,o){let n=p=>lw(p,async d=>{let b=await this._sourceContainer.getOptiminalOriginalPosition(r,d.originalPosition);if(!b)return!1;let y=b.position.base1;return d.updateSourceLocation(e,{path:o.absolutePath,sourceReference:o.sourceReference},{lineNumber:y.lineNumber,columnNumber:y.columnNumber,source:o}),!1}),s=t.absolutePath,a=o.absolutePath,c=s?this._byPath.get(s):void 0;if(c&&a){let[p,d]=await n(c);this._byPath.set(s,p),this._byPath.set(a,d)}let l=this._byRef.get(t.sourceReference);if(l){let[p,d]=await n(l);this._byRef.set(t.sourceReference,p),this._byRef.set(o.sourceReference,d)}}async updateEntryBreakpointMode(e,t){if(t===this.entryBreakpointMode)return;let r=[...this.moduleEntryBreakpoints.values()];this.moduleEntryBreakpoints.clear(),this.entryBreakpointMode=t,await Promise.all(r.map(o=>this.ensureModuleEntryBreakpoint(e,o.source)))}async applyEnabledFilter(e,t=Sv){if(t!==Sv&&this._enabledFilter!==t)return;this._enabledFilter=e||(()=>!0);let r=this._thread;r&&await Promise.all([...this._byDapId.values()].map(o=>this._enabledFilter(o)?o.enable(r):o.disable()))}async getBreakpointLocations(e,t,r,o){let n=r.base1,s=o.base1,[a,c]=await Promise.all([this._sourceContainer.currentSiblingUiLocations({source:t,lineNumber:n.lineNumber,columnNumber:n.columnNumber}),this._sourceContainer.currentSiblingUiLocations({source:t,lineNumber:s.lineNumber,columnNumber:s.columnNumber})]);if(a.length!==c.length)return this.logger.warn("internal","Expected to have the same number of start and end locations"),[];let l=[],p=[];for(let d=0;d<a.length;d++){let b=a[d],y=c[d];if(b.source!==y.source){this.logger.warn("internal","Expected to have the same number of start and end scripts");continue}let v=b.source;if(!v.scripts.length)continue;let{scriptId:D}=v.scripts[v.scripts.length-1];l.push(e.cdp().Debugger.getPossibleBreakpoints({restrictToFunction:!1,start:{scriptId:D,...v.offsetSourceToScript(Lo(b))},end:{scriptId:D,...v.offsetSourceToScript(Lo(y))}}).then(Te=>{if(Te?.locations)return Promise.all(Te.locations.map(async pe=>{let{lineNumber:ut,columnNumber:Io=0}=pe,dt=await this._sourceContainer.currentSiblingUiLocations({source:v,...v.offsetScriptToSource(wy({lineNumber:ut,columnNumber:Io}))});p.push({breakLocation:pe,uiLocations:dt})}))}))}return await Promise.all(l),p}setThread(e){this._thread=e,this._thread.cdp().Debugger.on("breakpointResolved",t=>{let r=this._resolvedBreakpoints.get(t.breakpointId);r&&r.updateUiLocations(e,t.breakpointId,[t.location])}),this._thread.setSourceMapDisabler(t=>{let r=[];for(let o of t){let n=this._resolvedBreakpoints.get(o);if(n){let s=this._sourceContainer.source(n.source);kt(s)&&r.push(s)}}return r});for(let t of this._byPath.values())t.forEach(r=>this._setBreakpoint(r,e)),this.ensureModuleEntryBreakpoint(e,t[0]?.source);for(let t of this._byRef.values())t.forEach(r=>this._setBreakpoint(r,e));"runtimeSourcemapPausePatterns"in this.launchConfig&&this.launchConfig.runtimeSourcemapPausePatterns.length&&this.setRuntimeSourcemapPausePatterns(e,this.launchConfig.runtimeSourcemapPausePatterns),this._byDapId.size>0&&this._installSourceMapHandler(this._thread)}async launchBlocker(){Iu(this.logger,"BreakpointManager.launchBlocker",async()=>{this._predictorDisabledForTest||await Promise.all([...this._launchBlocker])})}setRuntimeSourcemapPausePatterns(e,t){return Promise.all(t.map(r=>this._setBreakpoint(new hl(this,r),e)))}addLaunchBlocker(...e){for(let t of e)this._launchBlocker.add(t),t.finally(()=>this._launchBlocker.delete(t))}setPredictorDisabledForTest(e){this._predictorDisabledForTest=e}_installSourceMapHandler(e){let t=this.launchConfig.perScriptSourcemaps==="yes",r;t?r=Promise.all([this.updateEntryBreakpointMode(e,1),e.setScriptSourceMapHandler(!1,this._scriptSourceMapHandler)]).then(()=>!0):this._breakpointsPredictor&&!this.launchConfig.pauseForSourceMap?r=e.setScriptSourceMapHandler(!1,this._scriptSourceMapHandler):r=e.setScriptSourceMapHandler(!0,this._scriptSourceMapHandler),this._sourceMapHandlerInstalled={entryBpSet:r}}async _uninstallSourceMapHandler(e){e.setScriptSourceMapHandler(!1),this._sourceMapHandlerInstalled=void 0}_setBreakpoint(e,t){this._enabledFilter(e)&&this.addLaunchBlocker(Promise.race([x(vv),e.enable(t)]))}async setBreakpoints(e,t){!this._sourceMapHandlerInstalled&&this._thread&&e.breakpoints?.length&&this._installSourceMapHandler(this._thread);let r=await this._sourceMapHandlerInstalled?.entryBpSet;e.source.path=Pt(e.source.path);let o=this._sourceContainer.source(e.source);if(!r&&this._breakpointsPredictor&&!o){let p=this._breakpointsPredictor.predictBreakpoints(e);this.addLaunchBlocker(p),await p}let n=this._thread;if(n?.debuggerReady.hasSettled()===!1){let p=n.debuggerReady.promise;this.addLaunchBlocker(p),await p}let s=p=>{let d={unbound:p.slice(),new:[],list:[]};if(!e.breakpoints)return d;for(let b=0;b<e.breakpoints.length;b++){let y=e.breakpoints[b],v;try{v=new pr(this,t[b],e.source,y,this.conditionFactory.getConditionFor(y))}catch(pe){if(!(pe instanceof I))throw pe;this._dap.output({category:"stderr",output:pe.message}),v=new Fu(this,t[b],e.source,y)}let D=d.unbound.findIndex(pe=>pe.equivalentTo(v)),Te=d.unbound[D];Te?.equivalentTo?.(v)?(d.list.push(Te),d.unbound.splice(D,1)):(d.new.push(v),d.list.push(v),this._byDapId.set(v.dapId,v))}return d},a=()=>e.source.sourceReference?this._byRef.get(e.source.sourceReference):e.source.path?this._byPath.get(e.source.path):void 0,c=s(a()??[]);if(e.source.sourceReference)this._byRef.set(e.source.sourceReference,c.list);else if(e.source.path)this._byPath.set(e.source.path,c.list);else return{breakpoints:[]};if(c.unbound.length===0&&c.new.length===0)return{breakpoints:[]};if(this._totalBreakpointsCount-=c.unbound.length,await Promise.all(c.unbound.map(p=>(this._byDapId.delete(p.dapId),p.disable()))),this._totalBreakpointsCount+=c.new.length,this._thread&&(this._totalBreakpointsCount===0&&this._sourceMapHandlerInstalled?this._uninstallSourceMapHandler(this._thread):this._totalBreakpointsCount>0&&!this._sourceMapHandlerInstalled&&this._installSourceMapHandler(this._thread)),n&&c.new.length){this.ensureModuleEntryBreakpoint(n,e.source);let p=a(),d=Promise.all(c.new.filter(this._enabledFilter).filter(b=>p?.includes(b)).map(b=>b.enable(n)));this.addLaunchBlocker(Promise.race([x(vv),d])),await d}let l=await Promise.all(c.list.map(p=>p.toDap()));return this._breakpointsStatisticsCalculator.registerBreakpoints(l),x(0).then(()=>c.new.forEach(p=>p.markSetCompleted())),{breakpoints:l}}async notifyBreakpointChange(e,t){if(!this._byDapId.has(e.dapId))return;let r=await e.toDap();r.verified&&(this._breakpointsStatisticsCalculator.registerResolvedBreakpoint(e.dapId),this.suggester.notifyVerifiedBreakpoint()),t&&this._dap.breakpoint({reason:"changed",breakpoint:r})}isEntrypointBreak(e,t){return[...this.moduleEntryBreakpoints.values()].some(o=>o.enabled&&o.cdpScriptIds.has(t))?!0:e.some(o=>{let n=this._resolvedBreakpoints.get(o);return n&&(n instanceof eo||yv(n))})}isEntrypointCdpBreak(e){return this._resolvedBreakpoints.get(e)instanceof eo}async shouldPauseAt(e,t,r,o=!1){if(!t.length)return e.reason!=="instrumentation";let n=0,s=o?1:0;return await Promise.all(t.map(async a=>{if(r?.cdpId===a){n++;return}let c=this._resolvedBreakpoints.get(a);if(c instanceof eo){this.entryBreakpointMode===0&&!(c instanceof hl)&&c.disable(),s++;return}c instanceof pr&&(await c.testHitCondition(e)?n++:s++)})),n>0||s===0}registerBreakpointsHit(e){for(let t of e){let r=this._resolvedBreakpoints.get(t);r instanceof pr&&this._breakpointsStatisticsCalculator.registerBreakpointHit(r.dapId)}}statisticsForTelemetry(){return this._breakpointsStatisticsCalculator.statistics()}ensureModuleEntryBreakpoint(e,t){if(!t.path||(this._byPath.get(t.path)??[]).some(yv))return;let o=eo.getModeKeyForSource(this.entryBreakpointMode,t.path);if(!t.path||this.moduleEntryBreakpoints.has(o))return;let n=new eo(this,t,this.entryBreakpointMode);this.moduleEntryBreakpoints.set(t.path,n),this._setBreakpoint(n,e)}executionContextWasCleared(){for(let e of this._byDapId.values())e.executionContextWasCleared()}async reapply(){let e=[...this._byDapId.values()];if(await Promise.all(e.map(t=>t.disable())),this._thread){let t=this._thread;await Promise.all(e.map(r=>r.enable(t)))}}};mr=f([(0,ro.injectable)(),u(0,(0,ro.inject)(At)),u(1,(0,ro.inject)(Ye)),u(2,(0,ro.inject)(C)),u(3,(0,ro.inject)(X)),u(4,(0,ro.inject)(Du)),u(5,(0,ro.inject)(Ce)),u(6,(0,ro.inject)(fn))],mr)});var he,Sl,Iv=m(()=>{"use strict";he=class i{static{this.Undefined=new i(void 0)}constructor(e){this.element=e,this.next=i.Undefined,this.prev=i.Undefined}},Sl=class{constructor(){this._first=he.Undefined;this._last=he.Undefined;this._size=0}get size(){return this._size}isEmpty(){return this._first===he.Undefined}clear(){let e=this._first;for(;e!==he.Undefined;){let t=e.next;e.prev=he.Undefined,e.next=he.Undefined,e=t}this._first=he.Undefined,this._last=he.Undefined,this._size=0}unshift(e){return this._insert(e,!1)}push(e){return this._insert(e,!0)}_insert(e,t){let r=new he(e);if(this._first===he.Undefined)this._first=r,this._last=r;else if(t){let n=this._last;this._last=r,r.prev=n,n.next=r}else{let n=this._first;this._first=r,r.next=n,n.prev=r}this._size+=1;let o=!1;return()=>{o||(o=!0,this._remove(r))}}shift(){if(this._first!==he.Undefined){let e=this._first.element;return this._remove(this._first),e}}pop(){if(this._last!==he.Undefined){let e=this._last.element;return this._remove(this._last),e}}applyFilter(e){let t=this._first;for(;t!==he.Undefined;){let r=t.next;e(t.element)||this._remove(t),t=r}}_remove(e){if(e.prev!==he.Undefined&&e.next!==he.Undefined){let t=e.prev;t.next=e.next,e.next.prev=t}else e.prev===he.Undefined&&e.next===he.Undefined?(this._first=he.Undefined,this._last=he.Undefined):e.next===he.Undefined?(this._last=this._last.prev,this._last.next=he.Undefined):e.prev===he.Undefined&&(this._first=this._first.next,this._first.prev=he.Undefined);this._size-=1}*[Symbol.iterator](){let e=this._first;for(;e!==he.Undefined;)yield e.element,e=e.next}}});function Nt(i,e,t){if(e.isCancellationRequested)return Promise.reject(new zt(t||"Task cancelled"));let r=ne(),o=e.onCancellationRequested(r.resolve);return Promise.race([r.promise.then(()=>{throw new zt(t||"Task cancelled")}),i.then(n=>(o.dispose(),n)).catch(n=>{throw o.dispose(),n})])}function kv(i,e){let t=new ie(e),r=i.map(async o=>{try{return await o(t.token)}finally{t.cancel()}});return Promise.race(r)}var zt,xv,Ne,yf,ie,ea,Ve=m(()=>{"use strict";le();oe();O();U();zt=class extends I{constructor(e){super({id:9243,format:e,showUser:!0}),this._cause={id:9243,format:e,showUser:!0}}};xv=Object.freeze(function(i,e){let t=setTimeout(i.bind(e),0);return{dispose(){clearTimeout(t)}}}),Ne=Object.freeze({isCancellationRequested:!1,onCancellationRequested:()=>({dispose:()=>{}})}),yf=Object.freeze({isCancellationRequested:!0,onCancellationRequested:xv}),ie=class i{constructor(e){this._token=void 0;this._parentListener=void 0;this._parentListener=e&&e.onCancellationRequested(this.cancel,this)}static withTimeout(e,t){let r=new i(t),o=r._token=new ea,n=setTimeout(()=>o.cancel(),e);return o.onCancellationRequested(()=>clearTimeout(n)),r}get token(){return this._token||(this._token=new ea),this._token}cancel(){this._token?this._token instanceof ea&&this._token.cancel():this._token=yf}dispose(e=!1){e&&this.cancel(),this._parentListener&&this._parentListener.dispose(),this._token?this._token instanceof ea&&this._token.dispose():this._token=Ne}},ea=class{constructor(){this._isCancelled=!1;this._emitter=null}cancel(){this._isCancelled||(this._isCancelled=!0,this._emitter&&(this._emitter.fire(void 0),this.dispose()))}get isCancellationRequested(){return this._isCancelled}get onCancellationRequested(){return this._isCancelled?xv:(this._emitter||(this._emitter=new S),this._emitter.event)}dispose(){this._emitter&&(this._emitter.dispose(),this._emitter=null)}}});var Cv,Tv=m(()=>{"use strict";Cv=(i,e)=>i+Math.floor(Math.random()*(e-i))});async function Be({min:i=53e3,max:e=54e3,attempts:t=1e3,tester:r=_v}={},o=Ne){let n=Cv(i,e);for(let s=Math.min(t,e-i);;s--)try{return await r(n,o)}catch(a){if(s===0||a instanceof zt)throw a;n=n===e-1?i:n+1}}async function Lv(i,e){try{return await _v(i,e),!0}catch{return!1}}function _v(i,e=Ne){let t;return new Promise((r,o)=>{let n=Rv.createServer();n.listen(i,"127.0.0.1",()=>{let s=n.address();n.close(()=>r(s.port))}),n.on("error",o),t=e.onCancellationRequested(()=>{n.close(),o(new zt("Port open lookup cancelled"))})}).finally(()=>t?.dispose())}var Rv,Dv,Ev,Av,yi=m(()=>{"use strict";Rv=w(require("net")),Dv=w(require("ws"));Ve();Tv();Ev=i=>(e,t)=>Av(new Dv.WebSocketServer({host:"127.0.0.1",...i,port:e}),t),Av=(i,e)=>{let t;return new Promise((r,o)=>{i.on("error",o),i.on("listening",()=>r(i)),t=e.onCancellationRequested(()=>{i.close(),o(new zt("Port open lookup cancelled"))})}).finally(()=>t?.dispose())}});var qu,Hu,bt,ta,No=m(()=>{"use strict";qu=require("inversify");Ve();O();yi();U();H();Hu=async(i,e,t)=>{let r=await Be({tester:Ev(e)},t),o=i.register(r.address().port);return r.on("close",()=>o.dispose()),r.on("error",()=>o.dispose()),r},bt=Symbol("IPortLeaseTracker"),ta=class{constructor(e){this.usedPorts=new Set;this.onRegistered=new S;this.isMandated=e==="remote"}register(e){return this.usedPorts.add(e),this.onRegistered.fire(e),{dispose:()=>this.usedPorts.delete(e)}}isRegistered(e,t=2e3){return this.usedPorts.has(e)?Promise.resolve(!0):e<53e3||e>=54e3?Promise.resolve(!1):kv([()=>x(t).then(()=>!1),r=>new Promise(o=>{let n=this.onRegistered.event(s=>{s===e&&o(!0)});r.onCancellationRequested(()=>n.dispose())})])}};ta=f([(0,qu.injectable)(),u(0,(0,qu.inject)(Eo))],ta)});var Nv,oa,Fv,Mv,vf,zu,ra,dD,Sf,If=m(()=>{"use strict";Nv=require("crypto"),oa=require("inversify");We();Iv();ze();_();No();Fv="JsDebug",Mv="*",vf=class{constructor(){this.replays=new Map}addReplay(e,t,r){let o=this.replays.get(e);return o||(o=new Sl,this.replays.set(e,o)),o.push({event:`${e}.${t}`,params:r})}capture(e,t,r,o){let n=e[t];if(o===0)n.on(r,s=>this.addReplay(t,r,s));else if(o===2){let s;n.on(r,a=>{s?.(),s=this.addReplay(t,r,a)})}else{let s=new Sl;n.on(r,a=>{s.size===o.cap&&s.shift()?.(),s.push(this.addReplay(t,r,a))})}}filter(e,t){let r=this.replays.get(e);r&&r.applyFilter(t)}clearEvent(e,t){let r=`${e}.${t}`;this.filter(e,o=>o.event!==r)}clearDomain(e){this.replays.delete(e)}read(e){return this.replays.get(e)??[]}},zu=Symbol("ICdpProxyProvider"),ra=class{constructor(e,t,r){this.cdp=e;this.portTracker=t;this.logger=r;this.disposables=new j;this.replay=new vf;this.jsDebugApi={subscribe:(e,{events:t})=>{for(let r of t)r.endsWith(Mv)?e.pushDisposable(this.cdp.session.onPrefix(r.slice(0,-Mv.length),o=>e.send({method:o.method,params:o.params}))):e.pushDisposable(this.cdp.session.on(r,o=>e.send({method:r,params:o})));return{}}};this.replay.capture(e,"CSS","styleSheetAdded",0),this.replay.capture(e,"Debugger","paused",2),this.replay.capture(e,"Runtime","executionContextCreated",{cap:50,type:1}),this.replay.capture(e,"Runtime","consoleAPICalled",{cap:50,type:1}),e.Debugger.on("resumed",()=>{this.replay.clearEvent("Debugger","paused")}),e.CSS.on("fontsUpdated",o=>{o.font&&this.replay.addReplay("CSS","fontsUpdated",o)}),e.CSS.on("styleSheetRemoved",o=>this.replay.filter("CSS",n=>n.params.styleSheetId!==o.styleSheetId))}async proxy(){this.server||(this.server=this.createServer());let{server:e,path:t}=await this.server,r=e.address();return{host:r.address,port:r.port,path:t}}async createServer(){let e=`/${(0,Nv.randomBytes)(20).toString("hex")}`,t=await Hu(this.portTracker,{perMessageDeflate:!0,path:e});return this.logger.info("proxyActivity","activated cdp proxy"),t.on("connection",r=>{let o=new Sf(r,this.logger);this.logger.info("proxyActivity","accepted proxy connection",{id:o.id}),r.on("close",()=>{this.logger.verbose("proxyActivity","closed proxy connection",{id:o.id}),this.disposables.disposeObject(o)}),r.on("message",async n=>{let s;try{s=JSON.parse(n.toString())}catch(b){return o.send({id:0,error:{code:-32700,message:b.message}})}this.logger.verbose("proxyActivity","received proxy message",s);let{method:a,params:c,id:l=0}=s,[p,d]=a.split(".");try{let b=p===Fv?await this.invokeJsDebugDomainMethod(o,d,c):await this.invokeCdpMethod(o,p,d,c);o.send({id:l,result:b})}catch(b){let y=b instanceof hn&&b.cause?b.cause:{code:0,message:b.message};o.send({id:l,error:y})}})}),{server:t,path:e}}dispose(){this.disposables.dispose(),this.server?.then(e=>e.server.close()),this.server=void 0}invokeCdpMethod(e,t,r,o){let n=this.cdp.session.sendOrDie(`${t}.${r}`,o);switch(r){case"enable":for(let s of this.replay.read(t))e.send({method:s.event,params:s.params});break;case"disable":this.replay.clearDomain(t);break;default:}return n}invokeJsDebugDomainMethod(e,t,r){if(!this.jsDebugApi.hasOwnProperty(t))throw new hn(t).setCause(-32601,`${Fv}.${t} not found`);return this.jsDebugApi[t](e,r)}};ra=f([(0,oa.injectable)(),u(0,(0,oa.inject)(xe)),u(1,(0,oa.inject)(bt)),u(2,(0,oa.inject)(C))],ra);dD=0,Sf=class{constructor(e,t){this.webSocket=e;this.logger=t;this.disposables=new j;this.id=dD++}pushDisposable(e){this.disposables.push(e)}dispose(){this.disposables.dispose(),this.webSocket.close()}send(e){this.logger.verbose("proxyActivity","send proxy message",e),this.webSocket.send(JSON.stringify(e))}}});var Pf,Bv,Ov=m(()=>{"use strict";Gu();Ke();Pf=Je(function(i,e,t){let r=t?"variable":"property",o=(p,d,b)=>{if(d!=="function")return r;if(p==="constructor")return"class";let y=String(b);return y.startsWith("class ")||y.includes("[native code]")&&/^[A-Z]/.test(p)?"class":t?"function":"method"},n=p=>{switch(typeof p){case"number":case"boolean":return`${p}`;case"object":return p===null?"null":p.constructor.name||"object";case"function":return`fn(${new Array(p.length).fill("?").join(", ")})`;default:return typeof p}},s=[],a=new Set,c="~",l=i===void 0?this:i;for(;l!=null;l=l.__proto__){c+="~";let p=Object.getOwnPropertyNames(l).filter(d=>d.startsWith(e)&&!d.match(/^\d+$/));for(let d of p){if(a.has(d))continue;a.add(d);let b=Object.getOwnPropertyDescriptor(l,d),y=r,v;try{let D=l[d];y=o(d,typeof b?.value,D),v=n(D)}catch{}s.push({label:d,sortText:c+d.replace(/^_+/,D=>"{".repeat(D.length)),type:y,detail:v})}t=!1}return{result:s,isArray:this instanceof Array}}),Bv=rn(Pf.source)});function gD(i){let e=!1;return ei(i,{enter(t){if(t.type==="CallExpression"||t.type==="NewExpression"||t.type==="UnaryExpression"&&t.operator==="delete"||t.type==="ClassBody")return e=!0,0}}),e}var jv,Il,mD,Ju,ia,Gu=m(()=>{"use strict";jv=require("./vendor/acorn-loose.js"),Il=require("inversify");We();en();Rr();bn();Ov();mD=i=>{switch(i.type){case"ClassDeclaration":case"ClassExpression":return{type:"class",id:i.id};case"MethodDefinition":return{type:i.key?.type==="Identifier"&&i.key.name==="constructor"?"constructor":"method",id:i.key};case"VariableDeclarator":return{type:i.init?.type==="FunctionExpression"||i.init?.type==="ArrowFunctionExpression"?"function":"variable",id:i.id}}};Ju=Symbol("ICompletions"),ia=class{constructor(e,t){this.evaluator=e;this.cdp=t}async completions(e){let t=zr(e.expression),r=new ii(e.expression).convert(e.position),o=()=>Promise.resolve([]);return ei(t,{enter:(n,s)=>{let a=n;if(a.start<r&&r<=a.end){if(n.type==="MemberExpression"||n.type==="Identifier"&&s?.type==="MemberExpression"&&!s.computed&&s.object!==n){let c=n.type==="MemberExpression"?n:s;o=c.computed?()=>this.elementAccessCompleter(e,c,r):()=>this.propertyAccessCompleter(e,c,r)}else n.type==="Identifier"&&(o=()=>this.identifierCompleter(e,t,n,r));s=n}}}),o().then(n=>n.sort((s,a)=>s.sortText>a.sortText?1:-1))}async elementAccessCompleter(e,t,r){if(t.property.type!=="Literal"||typeof t.property.value!="string")return[];let o=e.expression.slice(Zo(t.property)+1,r);return(await this.defaultCompletions(e,o)).filter(s=>s.sortText!=="~~[").map(s=>({...s,text:JSON.stringify(s.text??s.label)+"]",start:Zo(t.property),length:Dg(t.property)-Zo(t.property)}))}async identifierCompleter(e,t,r,o){let n=[];ei(t,{enter(c){let l=mD(c);l?.id?.type==="Identifier"&&n.push({label:l.id.name,type:l.type,sortText:l.id.name})}});let s=e.expression.slice(Zo(r),o),a=[...n,...await this.defaultCompletions(e,s)];return this.evaluator.hasReturnValue&&e.executionContextId!==void 0&&Fo.startsWith(s)&&a.push({sortText:`~${Fo}`,label:Fo,type:"variable"}),a}async propertyAccessCompleter(e,t,r){let{result:o,isArray:n}=await this.completePropertyAccess({executionContextId:e.executionContextId,stackFrame:e.stackFrame,expression:$w(e.expression,t.object),prefix:(0,jv.isDummy)(t.property)?"":e.expression.slice(Zo(t.property),r),throwOnSideEffect:gD(t)}),s=Zo(t.property)-1,a=/^[$a-z_][0-9a-z_$]*$/i;for(let c of o)a.test(c.label)||(c.text=`[${JSON.stringify(c.label)}]`,c.start=s,c.length=1);if(n){let c="index";o.unshift({label:`[${c}]`,text:`[${c}]`,type:"property",sortText:"~~[",start:s,selectionStart:1,selectionLength:c.length,length:1})}return o}async completePropertyAccess({executionContextId:e,stackFrame:t,expression:r,prefix:o,isInGlobalScope:n=!1,throwOnSideEffect:s=!1}){let a={expression:`(${r})`,objectGroup:"console",silent:!0,throwOnSideEffect:s},c=t&&t.callFrameId(),l=await this.evaluator.evaluate(c?{...a,callFrameId:c}:{...a,contextId:e},{stackFrame:t});if(!l||l.exceptionDetails)return{result:[],isArray:!1};if(!l.result.objectId){let p={...a,returnByValue:!0,throwOnSideEffect:!1,expression:Bv.expr(`(${r})`,JSON.stringify(o),JSON.stringify(n))},d=await this.evaluator.evaluate(c?{...p,callFrameId:c}:{...p,contextId:e});return!d||d.exceptionDetails?{result:[],isArray:!1}:d.result.value}try{return(await Pf({cdp:this.cdp,args:[void 0,o,n],objectId:l.result.objectId,returnByValue:!0})).value}catch{return{result:[],isArray:!1}}finally{this.cdp.Runtime.releaseObject({objectId:l.result.objectId})}}async defaultCompletions(e,t=""){for(let r of["self","global","this"]){let{result:o}=await this.completePropertyAccess({executionContextId:e.executionContextId,stackFrame:e.stackFrame,expression:r,prefix:t,isInGlobalScope:!0});if(e.stackFrame){let n=t.toLowerCase(),s=new Set(o.map(a=>a.label));for(let a of await e.stackFrame.completions())s.has(a.label)||!a.label.toLowerCase().includes(n)||(s.add(a.label),o.push(a))}return o.push(...this.syntheticCompletions(e,t)),o}return this.syntheticCompletions(e,t)}syntheticCompletions(e,t){return this.evaluator.hasReturnValue&&Fo.startsWith(t)?[{sortText:`~${Fo}`,label:Fo,type:"variable"}]:[]}};ia=f([(0,Il.injectable)(),u(0,(0,Il.inject)(lr)),u(1,(0,Il.inject)(xe))],ia)});var oo,kf=m(()=>{"use strict";oo=class{constructor(e,t){this._tokens=[];this._separator=t||"",this._budget=e-1-this._separator.length}append(e){if(e.length>this.budget()){this.appendEllipsis();return}this._append(e)}_append(e){this._tokens.length&&(this._budget-=this._separator.length),this._tokens.push(e),this._budget-=e.length}appendEllipsis(){this._tokens[this._tokens.length-1]!=="\u2026"&&this._append("\u2026")}checkBudget(){return this._budget<=0&&this.appendEllipsis(),this._budget>0}budget(){return this._budget-(this._tokens.length?this._separator.length:0)}build(){return this._tokens.join(this._separator)}isEmpty(){return!this._tokens.length}}});function hD(i,e){if(!i.includes("%"))return[{type:"string",value:i}];let t=[];function r(c){if(!c)return;let l=t[t.length-1];l?.type==="string"?l.value+=c:t.push({type:"string",value:c})}function o(c,l,p){t.push({type:"specifier",specifier:c,precision:l,substitutionIndex:p})}let n=0,s=0,a=new RegExp(`%%|%(?:(\\d+)\\$)?(?:\\.(\\d*))?([${e.join("")}])`,"g");for(let c=a.exec(i);c;c=a.exec(i)){let l=c.index;if(l>n&&r(i.substring(n,l)),c[0]==="%%")r("%");else{let[,p,d,b]=c;p&&Number(p)>0&&(s=Number(p)-1);let y=d?Number(d):void 0;o(b,y,s),++s}n=l+c[0].length}return r(i.substring(n)),t}function xf(i,e,t){let r=hD(i,Array.from(t.keys())),o=new Set,n=t.get("");if(!n)throw new Error("Expected to hav a default formatter");let s=new oo(fD),a=!1;for(let c=0;s.checkBudget()&&c<r.length;++c){let l=r[c];if(l.type==="string"){s.append(l.value);continue}let p=l.substitutionIndex;if(p>=e.length){s.append("%"+(l.precision||"")+l.specifier);continue}o.add(p),l.specifier==="c"&&(a=!0);let d=t.get(l.specifier)||n;s.append(d(e[p],{budget:s.budget(),quoted:!1}))}a&&s.append("\x1B[0m");for(let c=0;s.checkBudget()&&c<e.length;++c)o.has(c)||(o.add(c),(i||c)&&s.append(" "),s.append(n(e[c],{budget:s.budget(),quoted:!1})));return{result:s.build(),usedAllSubs:o.size===e.length}}function Uv(i){try{return new Wv.default(i).ansi256().object().ansi256}catch{}}function Vv(i){let e=/\s*(.*?)\s*:\s*(.*?)\s*(?:;|$)/g,t="\x1B[0m",r=e.exec(i);for(;r!==null;){if(r.length===3)switch(r[1]){case"color":let o=Uv(r[2]);o&&(t+=`\x1B[38;5;${o}m`);break;case"background":case"background-color":let n=Uv(r[2]);n&&(t+=`\x1B[48;5;${n}m`);break;case"font-weight":r[2]==="bold"&&(t+="\x1B[1m");break;case"font-style":r[2]==="italic"&&(t+="\x1B[3m");break;case"text-decoration":r[2]==="underline"&&(t+="\x1B[4m");break;default:}r=e.exec(i)}return t}var Wv,fD,Cf=m(()=>{"use strict";Wv=w(require("color"));kf();fD=1e4});var qv,wD,$v,yD,vD,SD,Ku,Pl=m(()=>{"use strict";qv=i=>i.replace(/\\/gm,"\\\\").replace(/\n/gm,"\\n").replace(/\r/gm,"\\r").replace(/\t/gm,"\\t"),wD={budget:1e5,quoted:!0},$v={budget:1e3,quoted:!0,postProcess:qv},yD={budget:1/0,quoted:!1},vD={budget:1e3,quoted:!0,postProcess:qv},SD={budget:1e5,quoted:!0},Ku=i=>{switch(i){case"repl":return wD;case"hover":return $v;case"propertyValue":return $v;case"watch":return vD;case"copy":case"clipboard":return yD;default:return SD}}});function vn(i){return i.type==="function"||i.type==="object"&&!Rf.has(i.subtype)}function Df(i){return i.subtype==="array"||i.subtype==="typedarray"}function Sn(i,e,t){let r=Ku(e),o=Qu(i,r,t);return i.preview?.subtype==="regexp"?o:r.postProcess?.(o)??o}function Qu(i,e,t){return i.type==="function"?i.description?Kv(i.description,e.budget):"<function>":i.type==="object"&&i.subtype==="node"?i.description:"preview"in i&&i.preview?Xu(i.preview,e.budget,t):Jv(i,e.budget,e.quoted,t)}function Xu(i,e,t){return Df(i)?CD(i,e):i.subtype==="internal#entry"?Gr(i.description||"",e):i.type==="function"?Kv(i.description,e):vn(i)?TD(i,e,t):DD(i,e,t)}function CD(i,e){let t=new oo(e),r=i.description,o=r.match(/[^(]*\(([\d]+)\)/);if(!o)return r;let n=parseInt(o[1],10);r.startsWith("Array(")&&(r=r.substring(5)),t.append(Gr(r,t.budget())),t.append(" ");let s=new oo(t.budget()-2,", "),a=-1;for(let c of i.properties){if(!s.checkBudget())break;if(isNaN(c.name))continue;let l=parseInt(c.name,10);l>a+1&&s.appendEllipsis(),a=l,s.append(kl(c,s.budget()))}n>a+1&&s.appendEllipsis();for(let c of i.properties){if(!s.checkBudget())break;isNaN(c.name)&&s.append(kl(c,s.budget(),c.name))}return i.overflow&&s.appendEllipsis(),t.append("["+s.build()+"]"),t.build()}function TD(i,e,t){let r=new oo(e," ");i.description!=="Object"&&r.append(Gr(i.description,r.budget()));let o=new Map,n=i.properties||[];for(let b of n)o.set(b.name,b);let s=o.get("[[PrimitiveValue]]");if(s)return r.append(`(${kl(s,r.budget()-2)})`),r.build();let a=o.get("[[PromiseStatus]]"),c=o.get("[[PromiseValue]]");if(a&&c)return a.value==="pending"?r.append(`{<${a.value}>}`):r.append(`{${kl(c,r.budget()-2,`<${a.value}>`)}}`),r.build();let l=o.get("[[GeneratorStatus]]");if(l)return r.append(`{<${l.value}>}`),r.build();let p=new oo(r.budget()-2,", ");for(let b of n){if(!p.checkBudget())break;p.append(kl(b,p.budget(),b.name))}for(let b of i.entries||[]){if(!p.checkBudget())break;if(b.key){let y=Xu(b.key,Math.min(Tf,p.budget()),t),v=Xu(b.value,Math.min(Tf,p.budget()-y.length-4),t);p.append(na(y," => ",v,p.budget()))}else p.append(Xu(b.value,Math.min(Tf,p.budget()),t))}i.overflow&&p.appendEllipsis();let d=p.build();return d?r.append("{"+d+"}"):r.isEmpty()&&r.append("{}"),r.build()}function zv(i,e){return i.length<=e?i:"\u2026"}function RD(i,e){return i.length>=e?i.slice(0,e-1)+"\u2026":i}function DD(i,e,t){if(i.type==="object"&&i.subtype==="null")return zv("null",e);if(i.type==="undefined")return zv("undefined",e);if(i.type==="string"){let r=i.description??i.value;return t?.hex&&(r=Buffer.from(r,"utf8").toString("hex")),vs(r,e)}return i.type==="number"||i.type==="bigint"?xl(i,!1,e,t):RD(i.description||"",e)}function na(i,e,t,r){return i===void 0?vs(t,r):i.length+e.length>r?Gr(i,r):`${i}${e}${vs(t,r-i.length-e.length)}`}function kl(i,e,t){return e=Math.min(e,PD),i.type==="function"?na(t,": ","\u0192",e):i.type==="object"&&i.value==="Object"?na(t,": ","{\u2026}",e):typeof i.value>"u"?na(t,": ",`<${i.type}>`,e):i.type==="string"?na(t,": ",`'${i.value}'`,e):na(t,": ",i.value??"unknown",e)}function Jv(i,e,t,r){if(i.type==="string"){let o=i.value||(i.description?i.description:"");r?.hex&&(o=Buffer.from(o,"utf8").toString("hex"),t=!1);let n=vs(o,t?e-2:e);return t?`'${n}'`:n}return i.type==="undefined"?"undefined":i.subtype==="null"?"null":i.type==="bigint"||i.type==="number"?xl(i,!1,e,r):i.description?Gr(i.description,Math.max(e,1e5)):Gr(String("value"in i?i.value:i.description),e)}function Kv(i,e){let t=new oo(e),r=i.replace(/^function [gs]et /,"function ").replace(/^function [gs]et\(/,"function(").replace(/^[gs]et /,""),o=r.match(/^(async\s+function)/),n=r.startsWith("function*"),s=r.startsWith("*"),a=!n&&r.startsWith("function"),c=r.startsWith("class ")||r.startsWith("class{"),l=r.indexOf("=>"),p=!o&&!n&&!a&&!c&&l>0,d;if(c){d=r.substring(5);let v=/^[^{\s]+/.exec(d.trim()),D="";v&&(D=v[0].trim()||""),y("class",d,D)}else if(o)d=r.substring(o[1].length),y("async \u0192",d,b(d));else if(n)d=r.substring(9),y("\u0192*",d,b(d));else if(s)d=r.substring(1),y("\u0192*",d,b(d));else if(a)d=r.substring(8),y("\u0192",d,b(d));else if(p){let v=r;r.length>ID&&(v=r.substring(0,l+2)+" {\u2026}"),y("",r,v)}else y("\u0192",r,b(r));return t.build();function b(v){let D=v.indexOf("("),Te=v.match(/\)\s*{/),pe=Te&&Te.index||0;if(D!==-1&&Te&&pe>D){let ut=v.substring(0,D).trim()||"",Io=v.substring(D,pe+1);return ut+Io}return"()"}function y(v,D,Te){t.checkBudget()&&(v.length&&t.append(v+" "),D=D.trim(),D.endsWith(" { [native code] }")&&(D=D.substring(0,D.length-18)),t.budget()>=D.length?t.append(D):t.append(Te.replace(/\n/g," ")))}}function In(i){let e=i;if(e.type!=="object"||e.subtype==="null")return{title:Jv(e,kD,!1,void 0)};let t=e.description??e.className??"Error",r=/^\s+at\s/m.exec(t);if(!r){let o=t.lastIndexOf(`
`);return o===-1?{title:t}:{title:t.substring(0,o)}}return{title:t.substring(0,r.index-1),stackTrace:t.substring(r.index+2)}}function xl(i,e,t,r){if(i.type==="number"){if("unserializableValue"in i)return i.unserializableValue;let s=i.value||+i.description;return r?.hex?s.toString(16):String(s)}if(i.type==="bigint"){let s=i.unserializableValue||i.description;return r?.hex?BigInt(s.slice(0,-1)).toString(16):s}let o=i,n=typeof o.value=="number"?o.value:+String(o.description);return Gr(String(e?Math.floor(n):n),t)}function LD(i,e){return vs(String(typeof i.value<"u"?i.value:i.description),e)}function Qv(i){let e=[],t=new Set([void 0]),r=new Map;for(let p of i.properties.filter(d=>d.valuePreview)){let d=new Map;d.set(void 0,p.name),r.set(void 0,Math.max(r.get(void 0)||0,p.name.length)),e.push(d),p.valuePreview?.properties.map(b=>{b.value&&(t.add(b.name),d.set(b.name,b.value),r.set(b.name,Math.max(r.get(b.name)||0,b.value.length)))})}for(let p of t.values())p&&r.set(p,Math.max(r.get(p)||0,p.length));let o=Array.from(r.values()).reduce((p,d)=>p+d,0),n=Hv-4-(t.size-1)*3;if(o>n){let p=n/o;for(let d of r.keys()){let b=Math.max(xD,r.get(d)*p|0);r.set(d,b)}}let s=[];for(let p of t.values())s.push("-".repeat(r.get(p)));let a="[-"+s.join("-|-")+"-]",c=[];c.push(a.replace("[","\u256D").replace(/\|/g,"\u252C").replace("]","\u256E").replace(/-/g,"\u2504"));let l=[];for(let p of t.values())l.push(Gv(p||"",r.get(p)));c.push("\u250A "+l.join(" \u250A ")+" \u250A"),c.push(a.replace("[","\u251C").replace(/\|/g,"\u253C").replace("]","\u2524").replace(/-/g,"\u2504"));for(let p of e){let d=[];for(let b of t.values())d.push(Gv(p.get(b)||"",r.get(b)));c.push("\u250A "+d.join(" \u250A ")+" \u250A")}return c.push(a.replace("[","\u2570").replace(/\|/g,"\u2534").replace("]","\u256F").replace(/-/g,"\u2504")),c.map(p=>Gr(p,Hv)).join(`
`)}function Gv(i,e){return i.length===e?i:i.length<e?i+" ".repeat(e-i.length):Gr(i,e)}var ID,PD,Tf,kD,xD,Hv,Rf,Lf,sa=m(()=>{"use strict";kf();Rr();Cf();Pl();ID=30,PD=100,Tf=20,kD=1e4,xD=3,Hv=120,Rf=new Set(["null","regexp","date"]);Lf=new Map([["",(i,e)=>Qu(i,e)],["s",(i,e)=>LD(i,e.budget)],["i",(i,e)=>xl(i,!0,e.budget,void 0)],["d",(i,e)=>xl(i,!0,e.budget,void 0)],["f",(i,e)=>xl(i,!1,e.budget,void 0)],["c",i=>Vv(i.value)],["o",(i,e)=>Qu(i,e)],["O",(i,e)=>Qu(i,e)]])});var Yv,Zv=m(()=>{"use strict";Ke();Yv=Je(function(){return this})});var Yu,Zu,eS=m(()=>{"use strict";Yu=w(require("@vscode/l10n"));sa();Zv();Zu=class{constructor(e,t){this.protoObj=e;this.cdp=t}async toDap(e){if(!this.protoObj.objectId)return{category:"stderr",output:Yu.t("Only objects can be queried")};let t=await this.cdp.Runtime.queryObjects({prototypeObjectId:this.protoObj.objectId,objectGroup:"console"});if(await this.cdp.Runtime.releaseObject({objectId:this.protoObj.objectId}),!t)return{category:"stderr",output:Yu.t("Could not query the provided object")};let r;try{r=await Yv({cdp:this.cdp,args:[],objectId:t.objects.objectId,objectGroup:"console",generatePreview:!0})}catch(s){return{category:"stderr",output:Yu.t(s.message)}}let o="\x1B[32mobjects: "+Sn(r,"repl")+"\x1B[0m";return{category:"stdout",output:"",variablesReference:e.replVariables.createVariableForOutput(o,[r]).id}}}});var tS,rS,vi,_f,ed=m(()=>{"use strict";Co();tS=/^(\W*at .*\()(.*):(\d+):(\d+)(\))$/,rS=/^(\W*at )(.*):(\d+):(\d+)$/,vi=class{constructor(e){this.stack=e}static isStackLike(e){return tS.test(e)||rS.test(e)}*[Symbol.iterator](){for(let e of this.stack.split(`
`)){let t=tS.exec(e)||rS.exec(e);if(!t){yield e+`
`;continue}let[,r,o,n,s,a]=t;r&&(yield r),yield new _f(o,new je(Number(n),Number(s))),a&&(yield a),yield`
`}}},_f=class{constructor(e,t){this.path=e;this.position=t}toString(){return`${this.path}:${this.position.lineNumber}:${this.position.columnNumber}`}}});async function Ef(i){let e=await i.uiLocation();return e?e.source.blackboxed()?2:kt(e.source)&&!e.isMapped&&e.unmappedReason===3?1:0:0}var Cl,_D,ED,Si,td=m(()=>{"use strict";Cl=require("inversify");_();M();$();ju();Dr();Mo();Tl();_D=new Set(["breakpoint","exception","entry"]),ED=256,Si=class{constructor(e,t){this.launchConfig=e;this.logger=t;this._smartStepCount=0}resetSmartStepCount(){this._smartStepCount>0&&(this.logger.verbose("internal",`smartStep: skipped ${this._smartStepCount} steps`),this._smartStepCount=0)}async getSmartStepDirection(e,t){if(!this.launchConfig.smartStep||_D.has(e.reason))return;let r=(await e.stackTrace.loadFrames(1)).find(Yi(wt));if((r&&await Ef(r))===0){this.resetSmartStepCount();return}return this._smartStepCount++>ED?2:t?.reason==="step"?t.direction:0}};Si=f([(0,Cl.injectable)(),u(0,(0,Cl.inject)(X)),u(1,(0,Cl.inject)(C))],Si)});var oS,iS,rd,Af=m(()=>{"use strict";Ke();oS=Je(function(){return[Symbol.for("debug.description"),Symbol.for("nodejs.util.inspect.custom")]}),iS=rn(function(i,e){let t={},r="<<default preview>>";if(typeof this!="object"||!this)return t;for(let[o,n]of Object.entries(this)){if(e)try{let s=e.call(n,r);if(s!==r){t[o]=String(s);continue}}catch(s){t[o]=`<<indescribable>>${JSON.stringify([String(s),o])}`;continue}if(typeof n=="object"&&n){let s;for(let a of runtimeArgs[0])if(typeof n[a]=="function")try{s=n[a]();break}catch{}!s&&!String(n.toString).includes("[native code]")&&(s=String(n)),s&&!s.startsWith("[object ")&&(t[o]=s.length>=i?s.slice(0,i)+"\u2026":s)}}return t}),rd=rn(function(i,e){if(e)try{let t="<<default preview>>",r=e.call(this,t);if(r!==t)return String(r)}catch(t){return`<<indescribable>>${JSON.stringify([String(t),"object"])}`}if(typeof this=="object"&&this){let t;for(let r of[Symbol.for("debug.description"),Symbol.for("nodejs.util.inspect.custom")])if(typeof this[r]=="function")try{t=this[r]();break}catch{}if(!t&&!String(this.toString).includes("[native code]")&&(t=String(this)),t&&!t.startsWith("[object "))return t.length>=i?t.slice(0,i)+"\u2026":t}})});var gr,aa=m(()=>{"use strict";gr=class i{constructor(e=process.hrtime()){this.value=e}get ms(){return this.s*1e3}get s(){return this.value[0]+this.value[1]/1e9}elapsed(){return new i().subtract(this)}subtract(e){let t=this.value[1]-e.value[1],r=this.value[0]-e.value[0];return t<0&&(t+=1e9,r--),new i([r,t])}}});var ca,Ff=m(()=>{"use strict";O();N();ca=class{constructor(e,t,r,o,n,s){this.launchConfig=e;this.targetInfo=t;this.parentTarget=r;this.targetOriginValue=o;this.cdp=n;this.logger=s;this.onNameChanged=new S().event;this.attached=!1;this.isWaitingForDebugger=!0;n.pause()}id(){return this.targetInfo.targetId}name(){return this.targetInfo.title}fileName(){return this.targetInfo.url}type(){return"node"}parent(){return this.parentTarget}children(){return[]}canStop(){return!1}stop(){}canRestart(){return!1}restart(){}canAttach(){return!this.attached}async attach(){return await this.cdp.Runtime.enable({}),await this.cdp.Debugger.enable({}),this.attached=!0,this.cdp}canDetach(){return this.attached}async detach(){await this.cdp.Debugger.resume({}),await this.cdp.NodeWorker.detach({sessionId:this.targetInfo.targetId}),this.attached=!1}targetOrigin(){return this.targetOriginValue}afterBind(){return this.cdp.resume(),Promise.resolve()}async runIfWaitingForDebugger(){this.isWaitingForDebugger=!1,await this.cdp.Runtime.runIfWaitingForDebugger({})}initialize(){return Promise.resolve()}waitingForDebugger(){return this.isWaitingForDebugger}supportsCustomBreakpoints(){return!1}supportsXHRBreakpoints(){return!1}scriptUrlToUrl(e){return e[0]==="/"||process.platform==="win32"&&e[1]===":"&&e[2]==="\\"?W(e):e}executionContextName(){return this.targetInfo.title}}});function id(){if(od.size)return od;function i(n,s){for(let a of s)a.group=n,od.set(a.id,a)}function e(n,s){let a=s||n;return{id:"instrumentation:"+n,title:a,group:"",details:c=>{if(n==="webglErrorFired"){let l=c.webglErrorName;return l=l.replace(/^.*(0x[0-9a-f]+).*$/i,"$1"),{short:l,long:Se.t('Paused on WebGL Error instrumentation breakpoint, error "{0}"',l)}}return n==="scriptBlockedByCSP"&&c.directiveText?{short:Se.t('CSP violation "{0}"',c.directiveText),long:Se.t('Paused on Content Security Policy violation instrumentation breakpoint, directive "{0}"',c.directiveText)}:{short:a,long:Se.t('Paused on instrumentation breakpoint "{0}"',a)}},apply:async(c,l)=>(l?await c.EventBreakpoints.setInstrumentationBreakpoint({eventName:n}):await c.EventBreakpoints.removeInstrumentationBreakpoint({eventName:n}))?!0:!!(l?await c.DOMDebugger.setInstrumentationBreakpoint({eventName:n}):await c.DOMDebugger.removeInstrumentationBreakpoint({eventName:n}))}}function t(n,s,a){let c=s===void 0?"*":typeof s=="string"?[s]:s;return{id:"listener:"+n,title:a||n,group:"",details:l=>{let p=(l.targetName||"*").toLowerCase();return{short:p+"."+n,long:Se.t('Paused on event listener breakpoint "{0}", triggered on "{1}"',n,p)}},apply:async(l,p)=>{let d=!0;for(let b of c)p?d=d&&!!await l.DOMDebugger.setEventListenerBreakpoint({eventName:n,targetName:b}):d=d&&!!await l.DOMDebugger.removeEventListenerBreakpoint({eventName:n,targetName:b});return d}}}i("Ad Auction Worklet",[e("beforeBidderWorkletBiddingStart",Se.t("Bidder Bidding Phase Start")),e("beforeBidderWorkletReportingStart",Se.t("Bidder Reporting Phase Start")),e("beforeSellerWorkletScoringStart",Se.t("Seller Scoring Phase Start")),e("beforeSellerWorkletReportingStart",Se.t("Seller Reporting Phase Start"))]),i("Animation",[e("requestAnimationFrame",Se.t("Request Animation Frame")),e("cancelAnimationFrame",Se.t("Cancel Animation Frame")),e("requestAnimationFrame.callback",Se.t("Animation Frame Fired"))]),i("Canvas",[e("canvasContextCreated",Se.t("Create canvas context")),e("webglErrorFired",Se.t("WebGL Error Fired")),e("webglWarningFired",Se.t("WebGL Warning Fired"))]),i("Clipboard",[t("copy"),t("cut"),t("paste"),t("beforecopy"),t("beforecut"),t("beforepaste")]),i("Control",[t("resize"),t("scroll"),t("scrollend"),t("zoom"),t("focus"),t("blur"),t("select"),t("change"),t("submit"),t("reset")]),i("Device",[t("deviceorientation"),t("devicemotion")]),i("DOM Mutation",[t("DOMActivate"),t("DOMFocusIn"),t("DOMFocusOut"),t("DOMAttrModified"),t("DOMCharacterDataModified"),t("DOMNodeInserted"),t("DOMNodeInsertedIntoDocument"),t("DOMNodeRemoved"),t("DOMNodeRemovedFromDocument"),t("DOMSubtreeModified"),t("DOMContentLoaded")]),i("Drag / Drop",[t("drag"),t("dragstart"),t("dragend"),t("dragenter"),t("dragover"),t("dragleave"),t("drop")]),i("Geolocation",[e("Geolocation.getCurrentPosition","getCurrentPosition"),e("Geolocation.watchPosition","watchPosition")]),i("Keyboard",[t("keydown"),t("keyup"),t("keypress"),t("input")]),i("Load",[t("load"),t("beforeunload"),t("unload"),t("abort"),t("error"),t("hashchange"),t("popstate"),t("navigate"),t("navigatesuccess"),t("navigateerror"),t("currentchange"),t("nagivateto"),t("navigatefrom"),t("finish"),t("dispose")]);let r=["audio","video"];i("Media",[t("play",r),t("pause",r),t("playing",r),t("canplay",r),t("canplaythrough",r),t("seeking",r),t("seeked",r),t("timeupdate",r),t("ended",r),t("ratechange",r),t("durationchange",r),t("volumechange",r),t("loadstart",r),t("progress",r),t("suspend",r),t("abort",r),t("error",r),t("emptied",r),t("stalled",r),t("loadedmetadata",r),t("loadeddata",r),t("waiting",r)]),i("Mouse",[t("auxclick"),t("click"),t("dblclick"),t("mousedown"),t("mouseup"),t("mouseover"),t("mousemove"),t("mouseout"),t("mouseenter"),t("mouseleave"),t("mousewheel"),t("wheel"),t("contextmenu")]),i("Notification",[e("Notification.requestPermission","requestPermission")]),i("Parse",[e("Element.setInnerHTML",Se.t("Set innerHTML")),e("Document.write","document.write")]),i("Picture-in-Picture",[t("enterpictureinpicture","video"),t("leavepictureinpicture","video"),t("resize","PictureInPictureWindow"),t("enter","documentPictureInPicture")]),i("Pointer",[t("pointerover"),t("pointerout"),t("pointerenter"),t("pointerleave"),t("pointerdown"),t("pointerup"),t("pointermove"),t("pointercancel"),t("gotpointercapture"),t("lostpointercapture"),t("pointerrawupdate")]),i("Script",[e("scriptFirstStatement",Se.t("Script First Statement")),e("scriptBlockedByCSP",Se.t("Script Blocked by Content Security Policy"))]),i("Timer",[e("setTimeout"),e("clearTimeout"),e("setInterval"),e("clearInterval"),e("setTimeout.callback",Se.t("setTimeout fired")),e("setInterval.callback",Se.t("setInterval fired"))]),i("Touch",[t("touchstart"),t("touchmove"),t("touchend"),t("touchcancel")]),i("WebAudio",[e("audioContextCreated",Se.t("Create AudioContext")),e("audioContextClosed",Se.t("Close AudioContext")),e("audioContextResumed",Se.t("Resume AudioContext")),e("audioContextSuspended",Se.t("Suspend AudioContext"))]),i("Window",[e("DOMWindow.close","window.close")]),i("Worker",[t("message"),t("messageerror")]);let o=["xmlhttprequest","xmlhttprequestupload"];return i("XHR",[t("readystatechange",o),t("load",o),t("loadstart",o),t("loadend",o),t("abort",o),t("error",o),t("progress",o),t("timeout",o)]),od}var Se,od,nS=m(()=>{"use strict";Se=w(require("@vscode/l10n")),od=new Map});var Mf,sS,aS=m(()=>{"use strict";Ke();Mf=rn(function(i,e){let t=" ".repeat(e),r=`
`;function o(s){if(s instanceof Uint8Array)return Uint8Array;if(s instanceof Uint8ClampedArray)return Uint8ClampedArray;if(s instanceof Uint16Array)return Uint16Array;if(s instanceof Uint32Array)return Uint32Array;if(s instanceof BigUint64Array)return BigUint64Array;if(s instanceof Int8Array)return Int8Array;if(s instanceof Int32Array)return Int32Array;if(s instanceof BigInt64Array)return BigInt64Array;if(s instanceof Float32Array)return Float32Array;if(s instanceof Float64Array)return Float64Array}function n(s,a=0,c=[]){switch(typeof s){case"bigint":return`${s}n`;case"boolean":return s.toString();case"function":{let d=s.toString().replace(/^[^\s]+\(/,"function(").split(/\r?\n/g),b=/^$/;for(let y of d){let v=/^[ \t]+/.exec(y);if(v){b=new RegExp(`^[ \\t]{0,${v[0].length}}`);break}}return d.map((y,v)=>v===0?y:(y=y.replace(b,""),v===d.length-1?t.repeat(a)+y:t.repeat(a+1)+y)).join(r)}case"number":return`${s}`;case"object":if(s===null)return"null";if(c.includes(s))return"[Circular]";if(s instanceof Date)return`"${s.toISOString()}"`;if(typeof Node<"u"&&i instanceof Node)return i.outerHTML;let l=o(s);if(l)return`new ${l.name}([${s.join(", ")}])`;if(s instanceof ArrayBuffer)return`new Uint8Array([${new Uint8Array(s).join(", ")}]).buffer`;if(s instanceof Array)return["[",...s.map(d=>t.repeat(a+1)+n(d,a+1,[...c,s])+","),t.repeat(a)+"]"].join(r);let p=s;return["{",...Object.keys(p).map(d=>t.repeat(a+1)+(/^[$a-z_][0-9a-z_$]*$/i.test(d)?d:JSON.stringify(d))+": "+n(p[d],a+1,[...c,s])+","),t.repeat(a)+"}"].join(r);case"string":return JSON.stringify(s);case"symbol":return s.toString();case"undefined":return"undefined";default:return String(s)}}try{return n(i)}catch{return""+i}}),sS=Je(`
  function(spaces2) {
    const result = ${Mf.expr("this","spaces2")};
    return result;
  }
`)});var cS,lS=m(()=>{"use strict";Ke();cS=Je(function(){let i={__proto__:this.__proto__},e=Object.getOwnPropertyNames(this);for(let t=0;t<e.length;++t){let r=e[t],o=r>>>0;if(String(o>>>0)===r&&o>>>0!==4294967295)continue;let n=Object.getOwnPropertyDescriptor(this,r);n&&Object.defineProperty(i,r,n)}return i})});var pS,uS=m(()=>{"use strict";Ke();pS=Je(function(i,e){let t={},r=i===-1?0:i,o=e===-1?this.length:i+e;for(let n=r;n<o&&n<this.length;++n){let s=Object.getOwnPropertyDescriptor(this,n);s&&Object.defineProperty(t,n,s)}return t})});var dS,mS=m(()=>{"use strict";Ke();dS=Je(function(i){return i.call(this)})});var Nf,gS=m(()=>{"use strict";Ke();Nf=Je(function(i,e){let{buffer:t,byteLength:r,byteOffset:o}=this instanceof ArrayBuffer?new DataView(this):this instanceof WebAssembly.Memory?new DataView(this.buffer):this,n=o+Math.min(i,r),s=Math.max(0,Math.min(e,r-i));return a(new Uint8Array(t,n,s));function a(c){let l="0123456789abcdef",p="";for(let d=0;d<c.length;d++){let b=c[d];p+=l[b>>>4]+l[b&15]}return p}})});var Bf,fS=m(()=>{"use strict";Ke();Bf=Je(function(i,e){let t=c(e),{buffer:r,byteLength:o,byteOffset:n}=this instanceof ArrayBuffer?new DataView(this):this instanceof WebAssembly.Memory?new DataView(this.buffer):this,s=n+Math.min(i,o),a=Math.max(0,Math.min(t.length,o-i));return new Uint8Array(r,s,a).set(t.subarray(0,a)),a;function c(l){let p=new Uint8Array(l.length>>>1);for(let d=0;d<l.length;d+=2)p[d>>>1]=parseInt(l.slice(d,d+2),16);return p}})});function kS(i){let e=i.exception&&In(i.exception).title||i.text;return ue(e)}var _r,SS,Pn,_l,Kf,FD,IS,MD,ND,BD,hS,bS,PS,Of,wS,Rl,OD,fr,nd,jf,Uf,Wf,Vf,sd,Dl,yS,$f,ad,qf,Ll,Hf,zf,cd,Gf,la,Jf,Ii,xS=m(()=>{"use strict";_r=w(require("@vscode/l10n")),SS=require("astring"),Pn=require("inversify");We();M();en();cl();$();Lr();le();oe();yl();sa();Pl();Ke();lS();uS();Af();mS();gS();fS();_l=(()=>{let i=0,e=2147483647-1;return()=>i++%e+1})(),Kf=i=>{if(typeof i=="string")return{value:i};let e=i;return e.objectId?{objectId:e.objectId}:e.unserializableValue?{unserializableValue:e.unserializableValue}:{value:e.value}},FD=new Set(["typedarray","dataview","arraybuffer","webassemblymemory"]),IS=1024,MD=/^[$a-z_][0-9a-z_$]*$/i,ND=/^#[0-9a-z_$]+$/i,BD=i=>i.hasOwnProperty("configurable"),hS=(i,e,t)=>{let r=qw(i,qp(e),t);return(0,SS.generate)(r)},bS="<<indescribable>>",PS=i=>{if(!i.startsWith(bS))return i;let e,t;try{[e,t]=JSON.parse(i.slice(bS.length))}catch{return i}return _r.t("{0} (couldn't describe: {1})",e,t)},Of=i=>!!i&&typeof i=="object"&&"readMemory"in i&&"writeMemory"in i,wS={PARAMETER:{name:_r.t("Parameters"),sortOrder:-10},LOCAL:{name:_r.t("Locals"),sortOrder:-9},GLOBAL:{name:_r.t("Globals"),sortOrder:-8}},Rl=class i{constructor(e,t,r,o,n,s,a){this.cdp=e;this.parent=t;this.vars=o;this.locationProvider=n;this.currentRef=s;this.settings=a;this.name=r.name,this.presentationHint=r.presentationHint,this.sortOrder=r.sortOrder||0}get customDescriptionGenerator(){return this.settings.customDescriptionGenerator}createVariable(e,t,...r){let o=new e(new i(this.cdp,this.currentRef?.(),t,this.vars,this.locationProvider,()=>o,this.settings),...r);return o.id>0&&this.vars.add(o),o}createVariableByType(e,t,r){if(Df(t))return this.createVariable(ad,e,t);if(t.objectId){if(t.subtype==="map"||t.subtype==="set")return this.createVariable($f,e,t,r);if(!Rf.has(t.subtype))return this.createVariable(Dl,e,t,r)}return this.createVariable(fr,e,t)}async getDescriptionSymbols(e){return this.settings.descriptionSymbols??=oS({cdp:this.cdp,args:[],objectId:e}).then(t=>({objectId:t.objectId}),()=>({value:[]})),await this.settings.descriptionSymbols}async createObjectPropertyVars(e,t){let r=[];if(this.settings.customPropertiesGenerator){let{result:l,errorDescription:p}=await this.evaluateCodeForObject(e,this.settings.customPropertiesGenerator,[]);l&&l.type!=="undefined"?e=l:r.push([this.createVariable(Vf,{name:"",sortOrder:-1},l,l?.description||p||_r.t("Unknown error"))])}if(!e.objectId)return[];t&&this.cdp.DotnetDebugger.setEvaluationOptions({options:t,type:"variable"});let[o,n,s]=await Promise.all([this.cdp.Runtime.getProperties({objectId:e.objectId,accessorPropertiesOnly:!0,ownProperties:!1,generatePreview:!0}),this.cdp.Runtime.getProperties({objectId:e.objectId,ownProperties:!0,generatePreview:!0}),this.cdp.Runtime.callFunctionOn({functionDeclaration:iS.decl(`${IS}`,this.settings.customDescriptionGenerator||"null"),arguments:[await this.getDescriptionSymbols(e.objectId)],objectId:e.objectId,throwOnSideEffect:!0,returnByValue:!0}).then(l=>l?.result.value||{}).catch(()=>({}))]);if(!o||!n)return[];let a=new Map,c=[];for(let l of o.result){if(l.symbol){c.push(l);continue}l.name==="__proto__"&&n.internalProperties?.some(p=>p.name==="[[Prototype]]")||a.set(l.name,l)}for(let l of n.result)l.get||l.set||(l.symbol?c.push(l):a.set(l.name,l));for(let l of[a.values(),c.values()])for(let p of l)r.push(this.createPropertyVar(p,e,s?.hasOwnProperty(p.name)?PS(s[p.name]):void 0));for(let l of n.privateProperties??[])r.push(this.createPropertyVar(l,e,void 0,{presentationHint:{visibility:"private"},sortOrder:1}));for(let l of n.internalProperties||[]){if(l.name==="[[StableObjectId]]")continue;let p;l.name==="[[FunctionLocation]]"&&l.value&&l.value.subtype==="internal#location"?p=this.createVariable(Wf,{name:l.name,presentationHint:{visibility:"internal",attributes:["readOnly"]},sortOrder:2},l.value):l.value!==void 0&&(p=this.createVariableByType({name:l.name,presentationHint:{visibility:"internal"},sortOrder:2},l.value)),p&&r.push([p])}return xo(await Promise.all(r))}async createPropertyVar(e,t,r,o){let n=[],s=e.get&&e.get.type!=="undefined",a=e.set&&e.set.type!=="undefined",c={name:e.name,presentationHint:{},sortOrder:0,...o};return o||(BD(e)?(e.enumerable===!1&&!s&&(c.presentationHint.visibility="internal",c.sortOrder=1),(e.writable===!1||s&&!a)&&(c.presentationHint.attributes=["readOnly"])):(c.presentationHint.visibility="private",c.sortOrder=1)),"value"in e&&e.value&&n.push(this.createVariableByType(c,e.value,r)),s?n.push(this.createVariable(zf,c,e.get,t)):a&&n.push(this.createVariable(Hf,c,e.set)),n}async evaluateCodeForObject(e,t,r){try{let o=await this.cdp.Runtime.callFunctionOn({objectId:e.objectId,functionDeclaration:t,arguments:r.map(Kf)});if(o){if(o.exceptionDetails===void 0)return{result:o.result};if(o&&o.result.description)return{errorDescription:o.result.description}}return{errorDescription:_r.t("Unknown error")}}catch(o){return{errorDescription:o.stack||o.message||String(o)}}}},OD=i=>typeof i=="number"||/^[0-9]+$/.test(i),fr=class i{constructor(e,t){this.context=e;this.remoteObject=t;this.id=_l()}get name(){return this.context.name}get sortOrder(){return this.context.sortOrder}get accessor(){let{parent:e,name:t}=this.context;if(e instanceof Ll)return e.accessor;if(!(e instanceof i))return this.context.name;let r=e.context.parent;if(r instanceof i){if(this.remoteObject.subtype==="internal#entry")return`[...${r.accessor}.entries()][${+t}]`;if(e.remoteObject.subtype==="internal#entry")return`${e.accessor}[${this.name==="key"?0:1}]`}return OD(t)?`${e.accessor}[${t}]`:MD.test(t)?`${e.accessor}.${t}`:e.accessor==="this"&&ND.test(t)?`${e.accessor}.${t}`:`${e.accessor}[${JSON.stringify(t)}]`}async toDap(e,t){let r=this.context.name;return this.context.parent instanceof la&&(r=await this.context.parent.getRename(r)),Promise.resolve({name:r,value:Sn(this.remoteObject,e,t),evaluateName:this.accessor,type:this.remoteObject.type,variablesReference:0,presentationHint:this.context.presentationHint})}async setProperty(e,t){let r=await this.context.cdp.Runtime.callFunctionOn({objectId:this.remoteObject.objectId,functionDeclaration:`function(a) { return this[a] = ${t}; ${Pe()} }`,arguments:[Kf(e)],silent:!0});if(!r)throw new I(ce(_r.t("Unable to set variable value")));if(r.exceptionDetails)throw new I(kS(r.exceptionDetails));return this.context.createVariableByType({name:e},r.result)}async getChildren(e){return Promise.resolve([])}},nd=class{constructor(e){this.child=e;this.id=_l()}getChildren(){return Promise.resolve([this.child])}},jf=class extends fr{constructor(t,r,o,n){super(t,{type:o[0]?.type??"string"});this.value=r;this.args=o;this.stackTrace=n}toDap(){return Promise.resolve({name:this.context.name,value:this.value,variablesReference:this.stackTrace||this.args.some(vn)?this.id:0})}getChildren(t){let r=[],{args:o,stackTrace:n}=this;for(let s=0;s<o.length;++s)vn(o[s])&&r.push(this.context.createVariableByType({name:`arg${s}`,sortOrder:s},o[s]));return n&&r.push(this.context.createVariable(Uf,{name:"",sortOrder:Number.MAX_SAFE_INTEGER},this.remoteObject,n)),Promise.resolve(r)}},Uf=class extends fr{constructor(t,r,o){super(t,r);this.stacktrace=o}async toDap(){return{name:"",value:await this.stacktrace.format(),variablesReference:0}}},Wf=class extends fr{constructor(t,r){super(t,r);this.location=r.value}async toDap(){return{name:this.context.name,value:await this.context.locationProvider.renderDebuggerLocation(this.location),variablesReference:0,presentationHint:{visibility:"internal"}}}},Vf=class extends fr{constructor(t,r,o){super(t,r);this.message=o}get accessor(){if(!(this.context.parent instanceof fr))throw new Error("ErrorVariable must have a parent Variable");return this.context.parent.accessor}toDap(){return Promise.resolve({name:this.context.name,value:this.message,variablesReference:0})}},sd=Symbol("NoStringRepr"),Dl=class extends fr{constructor(t,r,o){super(t,r);this.customStringRepr=o}async toDap(t,r){let[o,n]=await Promise.all([await super.toDap(t,r),await this.getValueRepresentation(t)]);return{...o,type:this.remoteObject.className||this.remoteObject.subtype||this.remoteObject.type,variablesReference:this.id,memoryReference:FD.has(this.remoteObject.subtype)?String(this.id):void 0,value:n}}async getValueRepresentation(t){if(typeof this.customStringRepr=="string")return this.customStringRepr;if(!this.context.parent&&this.remoteObject.objectId&&this.customStringRepr!==sd)try{let r=await this.context.cdp.Runtime.callFunctionOn({functionDeclaration:rd.decl(`${IS}`,this.context.customDescriptionGenerator||"null"),objectId:this.remoteObject.objectId,returnByValue:!0});if(r?.result.value)return this.customStringRepr=PS(r.result.value)}catch{this.customStringRepr=sd}return this.context.name==="__proto__"&&this.remoteObject.description||Sn(this.remoteObject,t)}async readMemory(t,r){let o=await Nf({cdp:this.context.cdp,args:[t,r],objectId:this.remoteObject.objectId,returnByValue:!0});return Buffer.from(o.value,"hex")}async writeMemory(t,r){return(await Bf({cdp:this.context.cdp,args:[t,r.toString("hex")],objectId:this.remoteObject.objectId,returnByValue:!0})).value}getChildren(t){return this.context.createObjectPropertyVars(this.remoteObject,t.evaluationOptions)}},yS="[[Entries]]",$f=class extends Dl{constructor(t,r){super(t,r,sd);this.baseChildren=F(()=>super.getChildren({variablesReference:this.id}));this.isMap=r.subtype==="map";let o=r.preview;this.size=Number(o?.properties.find(n=>n.name==="size")?.value)??void 0}async toDap(t){let r=await super.toDap(t);return this.size&&this.size>100&&(r.indexedVariables=this.size),r}async getChildren(t){let r=await this.baseChildren();return[...(await r.find(n=>n.name===yS)?.getChildren(t)||[]).filter(n=>n.sortOrder===0),...r.filter(n=>n.name!==yS)]}},ad=class extends Dl{constructor(t,r){super(t,r,sd);this.length=0;let o=String(r.description).match(/\(([0-9]+)\)/);this.length=o?+o[1]:0}async toDap(t){return{...await super.toDap(t),indexedVariables:this.length>100?this.length:void 0,namedVariables:this.length>100?1:void 0}}async getChildren(t){switch(t?.filter){case"indexed":return this.getArraySlots(t);case"named":return this.getArrayProperties();default:return Promise.all([this.getArrayProperties(),this.getArraySlots()]).then(xo)}}async getArrayProperties(){try{let t=await cS({cdp:this.context.cdp,args:[],objectId:this.remoteObject.objectId,generatePreview:!0});return this.context.createObjectPropertyVars(t)}catch{return[]}}async getArraySlots(t){let r=t&&typeof t.start<"u"?t.start:-1,o=t&&typeof t.count<"u"?t.count:-1,n;try{n=await pS({cdp:this.context.cdp,generatePreview:!1,args:[r,o],objectId:this.remoteObject.objectId})}catch{return[]}let s=await this.context.createObjectPropertyVars(n);return n.objectId&&await this.context.cdp.Runtime.releaseObject({objectId:n.objectId}),s}},qf=class extends ad{async toDap(e){return this.remoteObject.preview?{...await super.toDap(e),name:Qv(this.remoteObject.preview)}:super.toDap(e)}},Ll=class extends fr{constructor(e,t){super(e,t)}getChildren(e){return this.context.createObjectPropertyVars(this.remoteObject)}},Hf=class extends Ll{async toDap(e,t){return{...await super.toDap(e,t),value:"write-only",variablesReference:this.id}}},zf=class extends Ll{constructor(t,r,o){super(t,r);this.parentObject=o}async toDap(t,r){let o=await super.toDap(t,r);return o.variablesReference=this.id,o.presentationHint={...o.presentationHint,lazy:!0},o}async getChildren(t){try{let r=await dS({cdp:this.context.cdp,objectId:this.parentObject.objectId,args:[new zc(this.remoteObject.objectId)]});return[this.context.createVariableByType({name:this.name,presentationHint:this.context.presentationHint},r)]}catch(r){if(!(r instanceof tn))throw r}return super.getChildren(t)}},cd=class i{constructor(e,t,r){this.context=e;this.variable=t;this.scopeRef=r;this.id=_l();this.sortOrder=0}static{this.presentationHint={attributes:["readOnly"]}}toDap(){return Promise.resolve({name:this.context.name,value:this.variable.description||"",variablesReference:this.variable.getChildren?this.id:0,memoryReference:this.variable.linearMemoryAddress?String(this.id):void 0,presentationHint:this.context.presentationHint})}async getChildren(){return(await this.variable.getChildren?.()||[]).map(t=>this.context.createVariable(i,{name:t.name,presentationHint:i.presentationHint},t.value,this.scopeRef))}async readMemory(e,t){let r=this.variable.linearMemoryAddress;if(r===void 0)return;let o=await this.context.cdp.Debugger.evaluateOnCallFrame({callFrameId:this.scopeRef.callFrameId,expression:`(${Nf.source}).call(memories[0].buffer, ${+r+e}, ${+t}) ${Pe()}`,returnByValue:!0});if(!o)throw new tn({exceptionId:0,text:"No response from CDP",lineNumber:0,columnNumber:0});return Buffer.from(o.result.value,"hex")}async writeMemory(e,t){let r=this.variable.linearMemoryAddress;return r===void 0?0:(await this.context.cdp.Debugger.evaluateOnCallFrame({callFrameId:this.scopeRef.callFrameId,expression:`(${Bf.source}).call(memories[0].buffer, ${+r+e}, ${JSON.stringify(t.toString("hex"))}) ${Pe()}`,returnByValue:!0}))?.result.value||0}},Gf=class{constructor(e,t,r,o){this.context=e;this.kind=t;this.variables=r;this.scopeRef=o;this.id=_l();this.sortOrder=wS[this.kind]?.sortOrder||0}toDap(){return Promise.resolve({name:wS[this.kind]?.name||this.kind,value:"",variablesReference:this.id})}getChildren(){return Promise.all(this.variables.map(async e=>{let t=await e.evaluate();return this.context.createVariable(cd,{name:e.name,presentationHint:cd.presentationHint},t,this.scopeRef)}))}},la=class{constructor(e,t,r,o,n){this.remoteObject=e;this.context=t;this.ref=r;this.extraProperties=o;this.renameProvider=n;this.id=_l()}async getChildren(e){let t=await this.context.createObjectPropertyVars(this.remoteObject),r=new Set(t.map(o=>o.name));for(let o of this.extraProperties)r.has(o.name)||t.push(this.context.createVariableByType({name:o.name},o.value));return t}async getRename(e){return(await this.renameProvider.provideOnStackframe(this.ref.stackFrame)).getOriginalName(e,this.ref.stackFrame.rawPosition)||e}async setProperty(e,t){let r=await this.context.cdp.Debugger.evaluateOnCallFrame({expression:`${t} ${Pe()}`,callFrameId:this.ref.callFrameId});if(!r)throw new I(ue(_r.t("Invalid expression")));if(r.exceptionDetails)throw new I(kS(r.exceptionDetails));return await this.context.cdp.Debugger.setVariableValue({callFrameId:this.ref.callFrameId,scopeNumber:this.ref.scopeNumber,variableName:e,newValue:Kf(r.result)}),this.context.createVariableByType({name:e},r.result)}},Jf=class{constructor(){this.value=new Map}get(e){return this.value.get(e)}add(e){this.value.set(e.id,e)}clear(){this.value.clear()}},Ii=class{constructor(e,t,r,o,n){this.renameProvider=e;this.cdp=t;this.dap=r;this.launchConfig=o;this.locationProvider=n;this.vars=new Jf;this.contextSettings={customDescriptionGenerator:o.customDescriptionGenerator&&hS(["defaultValue"],o.customDescriptionGenerator,!1),customPropertiesGenerator:o.customPropertiesGenerator&&hS([],o.customPropertiesGenerator,!1)}}createDetached(){return new Ii(this.renameProvider,this.cdp,this.dap,this.launchConfig,this.locationProvider)}clear(){this.vars.clear()}createFloatingVariable(e,t){return this.createFloatingContext().createVariableByType({name:e},t)}createVariableForOutput(e,t,r,o){let n=this.createFloatingContext(),s=t.length===1&&o==="table"?n.createVariable(qf,{name:""},t[0]):t.length===1&&vn(t[0])&&!r?n.createVariableByType({name:""},t[0]):n.createVariable(jf,{name:""},e,t,r),a=new nd(s);return this.vars.add(a),a}createScope(e,t,r){let o=new la(e,new Rl(this.cdp,void 0,{name:""},this.vars,this.locationProvider,()=>o,this.contextSettings),t,r,this.renameProvider);return this.vars.add(o),o}createWasmScope(e,t,r){let o=new Gf(new Rl(this.cdp,void 0,{name:""},this.vars,this.locationProvider,()=>o,this.contextSettings),e,t,r);return this.vars.add(o),o}hasVariable(e){return!!this.vars.get(e)}hasMemory(e){return Of(this.vars.get(Number(e)))}async readMemory(e,t,r){let o=this.vars.get(Number(e));return Of(o)?o.readMemory(t,r):void 0}async writeMemory(e,t,r){let o=this.vars.get(Number(e)),n=Of(o)?await o.writeMemory(t,r):0;return n>0&&this.dap.invalidated({areas:["variables"]}),n}async getVariableNames(e){let t=this.vars.get(e.variablesReference);return t?(await t.getChildren(e)).filter(Yi(fr)).map(o=>o.name):[]}async getVariables(e){let t=this.vars.get(e.variablesReference);if(!t)return[];let r=await t.getChildren(e);return(await Promise.all(r.map(n=>n.toDap(t instanceof la||t instanceof nd?"repl":"propertyValue",e.format).then(s=>({v:n,dap:s}))))).sort((n,s)=>n.v.sortOrder-s.v.sortOrder||+n.dap.name-+s.dap.name||n.dap.name.localeCompare(s.dap.name)).map(n=>n.dap)}async setVariable(e){let t=this.vars.get(e.variablesReference);if(!e.value)throw new I(ue(_r.t("Cannot set an empty value")));if(t instanceof la||t instanceof fr)return await(await t.setProperty(e.name,e.value)).toDap("propertyValue",e.format);throw new I(ce(_r.t("Variable not found")))}createFloatingContext(){return new Rl(this.cdp,void 0,{name:"<unnamed>"},this.vars,this.locationProvider,void 0,this.contextSettings)}};Ii=f([(0,Pn.injectable)(),u(0,(0,Pn.inject)(gi)),u(1,(0,Pn.inject)(xe)),u(2,(0,Pn.inject)(At)),u(3,(0,Pn.inject)(X))],Ii)});var te,RS,ld,Qf,jD,CS,UD,Xf,pa,Yf=m(()=>{"use strict";te=w(require("@vscode/l10n")),RS=require("crypto");A();O();aa();_();M();Co();U();It();ed();Rr();N();N();$();le();oe();Ff();bi();fl();pd();nS();sa();Pl();ju();Dr();Tl();aS();xS();ld=class{constructor(e){this.description=e;this.sourceMapLoads=new Map;this.scripts=[]}get isDefault(){return this.description.auxData&&this.description.auxData.isDefault}async remove(e){await Promise.all(this.scripts.map(async t=>{let r=await t.source;r.filterScripts(o=>o.executionContextId!==this.description.id),r.scripts.length||e.removeSource(r)}))}},Qf=class{constructor(e){this._obj=e;this._dapDeferred=ne()}resolve(){this._dapDeferred.resolve(this._obj)}with(e){return this._dapDeferred.hasSettled()?e(this._obj):this._dapDeferred.promise.then(t=>e(t))}},jD=50,CS=(i,e)=>i.sourceReference===e.sourceReference&&Zp(i.path||"",e.path||""),UD=()=>`
//# sourceURL=eval-${(0,RS.randomBytes)(4).toString("hex")}.repl
`,Xf=class{enqueue(e,t){if(!this.queue||this.queue.operation!==e){let r=this.queue?.result.then(t,t)??t(),o=this.queue={operation:e,result:r.finally(()=>{this.queue===o&&(this.queue=void 0)})}}return this.queue.result}},pa=class i{constructor(e,t,r,o,n,s,a,c,l,p,d,b,y,v){this.target=o;this.logger=s;this.evaluator=a;this.completer=c;this.launchConfig=l;this._breakpointManager=p;this.console=d;this.exceptionPause=b;this._smartStepper=y;this.shutdown=v;this._executionContexts=new Map;this._excludedCallers=[];this.stateQueue=new Xf;this._onPausedEmitter=new S;this.disposed=!1;this.debuggerReady=ne();this.onPaused=this._onPausedEmitter.event;this._dap=new Qf(r),this._sourceContainer=e,this._cdp=t,this.id=i._lastThreadId++,this.replVariables=new Ii(n,this._cdp,r,l,this),e.onSourceMappedSteppingChange(()=>this.refreshStackTrace()),this._initialize()}static{this._lastThreadId=0}static{this._allThreadsByDebuggerId=new Map}setExcludedCallers(e){this._excludedCallers=e}cdp(){return this._cdp}name(){return this.target.name()}pausedDetails(){return this._pausedDetails}pausedVariables(){return this._pausedVariables}defaultExecutionContext(){for(let e of this._executionContexts.values())if(e.isDefault)return e}resume(){return this.stateQueue.enqueue("resume",async()=>(this._sourceContainer.clearDisabledSourceMaps(),!await this._cdp.Debugger.resume({})&&this._pausedDetails!==void 0?ce(te.t("Unable to resume")):{allThreadsContinued:!1}))}pause(){return this.stateQueue.enqueue("pause",async()=>(this._expectedPauseReason={reason:"pause"},await this._cdp.Debugger.pause({})?{}:ce(te.t("Unable to pause"))))}stepOver(){return this.stateQueue.enqueue("stepOver",async()=>{this._expectedPauseReason={reason:"step",direction:1};let e=await this.getCurrentSkipList(1);return await this._cdp.Debugger.stepOver({skipList:e})?{}:ce(te.t("Unable to step next"))})}stepInto(e){return this.stateQueue.enqueue("stepInto",async()=>{this._waitingForStepIn={lastDetails:this._pausedDetails},this._expectedPauseReason={reason:"step",direction:0};let t=this._pausedDetails?.stepInTargets?.[e];if(t){let r=await this._cdp.Debugger.setBreakpoint({location:t.breakLocation});if(this._waitingForStepIn.intoTargetBreakpoint=r?.breakpointId,await this._cdp.Debugger.resume({}))return{}}else{let r=await this.getCurrentSkipList(0);if(await this._cdp.Debugger.stepInto({breakOnAsyncCall:!0,skipList:r}))return{}}return ce(te.t("Unable to step in"))})}stepOut(){return this.stateQueue.enqueue("stepOut",async()=>(this._expectedPauseReason={reason:"step",direction:2},await this._cdp.Debugger.stepOut({})?{}:ce(te.t("Unable to step out"))))}async getCurrentSkipList(e){if(!this._pausedDetails)return;let[t]=await this._pausedDetails.stackTrace.loadFrames(1);if(!t||!DS(t))return;let r=await t.getStepSkipList(e);if(r)return Cr.simplify(r).map(o=>({start:o.begin.base0,end:o.end.base0,scriptId:t.root.scriptId}))}_stackFrameNotFoundError(){return ce(te.t("Stack frame not found"))}_evaluateOnAsyncFrameError(){return ce(te.t("Unable to evaluate on async stack frame"))}async restartFrame(e){let t=this._pausedDetails?.stackTrace.frame(e.frameId)?.root;if(!t)return this._stackFrameNotFoundError();let r=t.callFrameId();return r?await this._cdp.Debugger.restartFrame({callFrameId:r,mode:"StepInto"})?(this._expectedPauseReason={reason:"frame_entry",description:te.t("Paused on frame entry")},t.canExplicitlyBeRestarted||await this._cdp.Debugger.stepInto({}),{}):ue(te.t("Frame could not be restarted")):ue(te.t("Cannot restart asynchronous frame"))}async stackTrace(e){return this._pausedDetails?this._pausedDetails.stackTrace.toDap(e):ce(te.t("Thread is not paused"))}async scopes(e){let t=this._pausedDetails?this._pausedDetails.stackTrace.frame(e.frameId):void 0;return t?t.scopes():this._stackFrameNotFoundError()}async exceptionInfo(){let e=this._pausedDetails&&this._pausedDetails.exception;if(!e)return ce(te.t("Thread is not paused on exception"));let t=In(e);return{exceptionId:t.title,breakMode:"all",details:{stackTrace:t.stackTrace,evaluateName:void 0}}}async revealPage(){return this._cdp.Page.bringToFront({}),{}}async completions(e){let t;if(e.frameId!==void 0){if(t=this._pausedDetails?this._pausedDetails.stackTrace.frame(e.frameId)?.root:void 0,!t)return this._stackFrameNotFoundError();if(!t.callFrameId())return this._evaluateOnAsyncFrameError()}if(e.line===1&&e.text.startsWith("cd "))return{targets:this.getExecutionContextCompletions(e)};let r=await this.completer.completions({executionContextId:this._selectedContext?this._selectedContext.description.id:void 0,stackFrame:t,expression:e.text,position:new je(e.line||1,e.column)});return{targets:[...this.getExecutionContextCompletions(e),...r]}}getExecutionContextCompletions(e){if(e.line&&e.line>1)return[];let t=e.text.slice(0,e.column).trim();return[...this._executionContexts.values()].map(r=>`cd ${this.target.executionContextName(r.description)}`).filter(r=>r.startsWith(t)).map(r=>({label:r,start:0,length:e.text.length}))}async _evaluteWasm(e,t,r){if(!e)return;let o=e.root,n=o.callFrameId(),s=await o.scriptSource?.source;if(!an(s)||!n)return;let a=await s.sourceMap.value.promise;if(!a.evaluate)return;let c=new Re(e instanceof Al?e.inlineFrameIndex:0,o.rawPosition.base0.columnNumber),l=await a.evaluate(n,c,t.expression);if(l)return await r.createFloatingVariable(t.expression,l).toDap(t.context,t.format)}async _evaluteJs(e,t,r){let o=e?.root.callFrameId(),n=t.context==="clipboard"?{expression:Mf.expr(t.expression,"2"),includeCommandLineAPI:!0,returnByValue:!0,objectGroup:"console"}:{expression:t.expression,includeCommandLineAPI:!0,objectGroup:"console",generatePreview:!0,timeout:t.context==="hover"?this.getHoverEvalTimeout():void 0};if(t.context==="repl"){if(n.expression=Yc(n.expression),n.expression.indexOf("await")!==-1){let c=uy(n.expression);c&&(n.expression=c,n.awaitPromise=!0)}n.expression+=UD()}t.evaluationOptions&&this.cdp().DotnetDebugger.setEvaluationOptions({options:t.evaluationOptions,type:"evaluation"});let s=this.evaluator.evaluate(o?{...n,callFrameId:o}:{...n,contextId:this._selectedContext?this._selectedContext.description.id:void 0},{isInternalScript:!1,stackFrame:e?.root});if(t.context==="repl")return await this._evaluateRepl(t,s,t.format);let a=await s;if(!a)throw new I(ce(te.t("Unable to evaluate")));if(a.exceptionDetails){let c=a.exceptionDetails.exception?In(a.exceptionDetails.exception).title:a.exceptionDetails.text;throw c.startsWith("Uncaught")||(c="Uncaught "+c),new I(ce(c))}return r.createFloatingVariable(n.expression,a.result).toDap(t.context,t.format)}async evaluate(e){let t,r;if(e.frameId!==void 0){if(r=this._pausedDetails?this._pausedDetails.stackTrace.frame(e.frameId):void 0,!r)throw new I(this._stackFrameNotFoundError());if(t=r.root.callFrameId(),!t)throw new I(this._evaluateOnAsyncFrameError())}if(e.context==="repl"&&e.expression.startsWith("cd ")){let s=e.expression.substring(3).trim();for(let a of this._executionContexts.values())if(this.target.executionContextName(a.description)===s)return this._selectedContext=a,{result:`[${s}]`,variablesReference:0}}let o=t?this._pausedVariables:this.replVariables;if(!o)throw new I(ce(te.t("Unable to evaluate")));let n=await this._evaluteWasm(r,e,o)??await this._evaluteJs(r,e,o);return{type:n.type,result:n.value,variablesReference:n.variablesReference,namedVariables:n.namedVariables,indexedVariables:n.indexedVariables,memoryReference:n.memoryReference}}getHoverEvalTimeout(){let e=this.launchConfig.timeouts?.hoverEvaluation;if(e===void 0)return 500;if(!(e<=0))return e}async _evaluateRepl(e,t,r){let o=await t;if(!o)return{name:e.expression,value:"",variablesReference:0};if(o.exceptionDetails){let c=await new El(o.exceptionDetails).toDap(this);throw new I(Ey(c.output))}let n=this._selectedContext&&this.defaultExecutionContext()!==this._selectedContext?`\x1B[33m[${this.target.executionContextName(this._selectedContext.description)}] `:"",s=await this.replVariables.createFloatingVariable(e.expression,o.result).toDap("repl",r),a=Ku("repl").budget;return s.variablesReference===0&&s.value.length===a&&setImmediate(()=>this.console.enqueue(this,{toDap:()=>({output:te.t("Output has been truncated to the first {0} characters. Run `{1}` to copy the full output.",a,`copy(${e.expression.trim()})`),category:"stdout"})})),{...s,value:`${n}${s.value}`}}_initialize(){this._cdp.Runtime.on("executionContextCreated",e=>{this._executionContextCreated(e.context)}),this._cdp.Runtime.on("executionContextDestroyed",e=>{this._executionContextDestroyed(e.executionContextId)}),this._cdp.Runtime.on("executionContextsCleared",()=>{this.launchConfig.noDebug||this._ensureDebuggerEnabledAndRefreshDebuggerId(),this.replVariables.clear(),this._executionContextsCleared()}),this._cdp.Inspector.on("targetReloadedAfterCrash",()=>{this._breakpointManager.reapply()}),this.launchConfig.outputCapture==="console"&&(this._cdp.Runtime.on("consoleAPICalled",e=>{this.console.dispatch(this,e)}),this._cdp.Runtime.on("exceptionThrown",e=>{this.console.enqueue(this,new El(e.exceptionDetails))})),this._cdp.Runtime.on("inspectRequested",e=>{e.hints.copyToClipboard?this._copyObjectToClipboard(e.object):e.hints.queryObjects?this.console.enqueue(this,new Zu(e.object,this.cdp())):this._revealObject(e.object)}),this._cdp.Debugger.on("paused",async e=>this._onPaused(e)),this._cdp.Debugger.on("resumed",()=>this.onResumed()),this._cdp.Debugger.on("scriptParsed",e=>this._onScriptParsed(e)),this._cdp.Debugger.on("scriptFailedToParse",e=>this._onScriptParsed(e)),this._cdp.Runtime.enable({}),this._cdp.Profiler.enable({}),this.launchConfig.noDebug?this.logger.info("runtime.launch","Running with noDebug, so debug domains are disabled"):this._ensureDebuggerEnabledAndRefreshDebuggerId(),this.target.initialize(),this._dap.with(e=>e.thread({reason:"started",threadId:this.id}))}dapInitialized(){this._dap.resolve()}async getStepInTargets(e){let t=this._pausedDetails;if(!t)return[];let r=t.stackTrace.frames.find(p=>p.frameId===e);if(!(r instanceof wt))return[];let o=await r.uiLocation();if(!o)return[];let n=t.event.callFrames[0].location,[s,a]=await Promise.all([this._breakpointManager.getBreakpointLocations(this,o.source,new je(o.lineNumber,1),new je(o.lineNumber+1,1)).then(p=>p.filter(d=>d.breakLocation.lineNumber!==n.lineNumber||d.breakLocation.columnNumber!==n.columnNumber)),o.source.content()]),c=t.stepInTargets?.length||0;t.stepInTargets=t.stepInTargets?.concat(s)||s;let l=a&&new ii(a);return s.map((p,d)=>{let b=p.uiLocations.find(v=>v.source===o.source);if(!b)return;if(!l)return{id:c+d,label:`Column ${b}`,line:b.lineNumber,column:b.columnNumber};let y=dy(a.slice(l.getLineOffset(b.lineNumber-1),l.getLineOffset(b.lineNumber)),b.columnNumber-1);if(y)return{id:c+d,label:y.text,line:b.lineNumber,column:y.start+1,endLine:b.lineNumber,endColumn:y.end+1}}).filter(Ae)}async refreshStackTrace(){this._pausedDetails&&(this._pausedDetails=await this._createPausedDetails(this._pausedDetails.event),this._onThreadResumed(),await this._onThreadPaused(this._pausedDetails))}_executionContextCreated(e){let t=new ld(e);this._executionContexts.set(e.id,t)}_executionContextDestroyed(e){let t=this._executionContexts.get(e);t&&(this._executionContexts.delete(e),t.remove(this._sourceContainer))}_executionContextsCleared(){this._removeAllScripts(),this._breakpointManager.executionContextWasCleared(),this._pausedDetails&&this.onResumed(),this._executionContexts.clear()}_ensureDebuggerEnabledAndRefreshDebuggerId(){this._cdp.Debugger.enable({}).then(e=>{this.debuggerReady.resolve(),e&&i._allThreadsByDebuggerId.set(e.debuggerId,this)}),this.exceptionPause.apply(this._cdp)}async _onPaused(e){let t=e.hitBreakpoints??[],r=e.reason==="Break on start"||e.reason==="debugCommand",o=e.callFrames[0]?.location,n=e.data?.scriptId||o?.scriptId,s=n&&(e.reason==="instrumentation"||this._breakpointManager.isEntrypointBreak(t,n)||t.some(p=>this._pauseOnSourceMapBreakpointIds?.includes(p)));if(this.evaluator.setReturnedValue(e.callFrames[0]?.returnValue),s){this.launchConfig.perScriptSourcemaps==="auto"&&this._shouldEnablePerScriptSms(e)&&await this._enablePerScriptSourcemaps(),e.data&&!r&&(e.data.__rewriteAs="breakpoint");let p=this._expectedPauseReason;if(!(n&&await this._handleSourceMapPause(n,o))){if(!r){if(await this.isCrossThreadStep(e))e.data={...e.data,__rewriteAs:"step"};else if(!await this._breakpointManager.shouldPauseAt(e,t,this.target.entryBreakpoint,!0))if(p?.reason==="step"){if(p.direction!==0)return this._cdp.Debugger.resume({})}else return this.resume()}}}else if(!(e.reason==="exception"||e.reason==="promiseRejection"?await this.exceptionPause.shouldPauseAt(e):await this._breakpointManager.shouldPauseAt(e,t,this.target.entryBreakpoint,!1)))return this.resume();let a=this._waitingForStepIn?.intoTargetBreakpoint;if(a){e.hitBreakpoints?.includes(a)?(this._waitingForStepIn.intoTargetBreakpoint=void 0,await this._cdp.Debugger.removeBreakpoint({breakpointId:a}),await this._cdp.Debugger.stepInto({breakOnAsyncCall:!1})):this.resume();return}if(r&&("continueOnAttach"in this.launchConfig&&this.launchConfig.continueOnAttach||this.launchConfig.type==="pwa-extensionHost"||this.target instanceof ca)){this.resume();return}let c=this._pausedDetails=await this._createPausedDetails(e);if(this._excludedCallers.length&&await this._matchesExcludedCaller(this._pausedDetails.stackTrace)){this.logger.info("runtime","Skipping pause due to excluded caller"),this.resume();return}let l=await this._smartStepper.getSmartStepDirection(c,this._expectedPauseReason);if(this._pausedDetails===c){switch(l){case 0:return this.stepInto();case 2:return this.stepOut();case 1:return this.stepOver();default:}this._waitingForStepIn=void 0,this._pausedVariables=this.replVariables.createDetached(),await this._onThreadPaused(c)}}async _matchesExcludedCaller(e){if(!this._excludedCallers.length)return!1;let t=e.frames[0],r=t instanceof wt&&await t.uiLocation();if(!r)return!1;let o,n,s=[];for(let{caller:a,target:c}of this._excludedCallers)if(!(c.line!==r.lineNumber||c.column!==r.columnNumber)&&(o??=await r.source.toDapShallow(),!!CS(o,c.source))){n||(n=await e.loadFrames(jD).then(p=>Promise.all(p.slice(1).filter(Yi(wt)).map(d=>d.uiLocation()))));for(let l=0;l<n.length;l++){let p=n[l];if(!p||p.lineNumber!==a.line||p.columnNumber!==a.column)continue;let d=s[l]??=await p.source.toDapShallow();if(CS(d,a.source))return!0}}return!1}onResumed(){this._pausedDetails=void 0,this._pausedVariables=void 0,this.evaluator.setReturnedValue(void 0),this._onThreadResumed()}async dispose(){this.disposed=!0,await this.shutdown.shutdown();for(let[e,t]of i._allThreadsByDebuggerId)t===this&&i._allThreadsByDebuggerId.delete(e);this._removeAllScripts(!0),this._executionContextsCleared(),await this._dap.with(e=>e.thread({reason:"exited",threadId:this.id}))}rawLocation(e){if("location"in e){let t=e;return{lineNumber:Math.max(0,t.location.lineNumber)+1,columnNumber:Math.max(0,t.location.columnNumber||0)+1,scriptId:t.location.scriptId}}return{lineNumber:Math.max(0,e.lineNumber)+1,columnNumber:Math.max(0,e.columnNumber||0)+1,scriptId:e.scriptId}}rawLocationToUiLocation(e){if(!e.scriptId||this.disposed||this.launchConfig.noDebug)return;let t=this._sourceContainer.getScriptById(e.scriptId);return t?t.resolvedSource?this._sourceContainer.preferredUiLocation({...t.resolvedSource.offsetScriptToSource(e),source:t.resolvedSource}):t.source.then(r=>this._sourceContainer.preferredUiLocation({...r.offsetSourceToScript(e),source:r})):this.rawLocationToUiLocationWithWaiting(e)}async rawLocationToUiLocationWithWaiting(e){let t=e.scriptId?await this.getScriptByIdOrWait(e.scriptId):void 0;if(!t)return;let r=await t.source;return this._sourceContainer.preferredUiLocation({...r.offsetScriptToSource(e),source:r})}getScriptById(e){return this._sourceContainer.getScriptById(e)}getScriptByIdOrWait(e,t=500){return this._sourceContainer.getScriptById(e)||this.waitForScriptId(e,t)}waitForScriptId(e,t){return new Promise(r=>{let o=this._sourceContainer.onScript(s=>{s.scriptId===e&&(r(s),o.dispose(),clearTimeout(n))}),n=setTimeout(()=>{r(void 0),o.dispose()},t)})}async renderDebuggerLocation(e){let t=this.rawLocation(e),r=await this.rawLocationToUiLocation(t);return r?`@ ${await r.source.prettyName()}:${r.lineNumber}`:`@ VM${t.scriptId||"XX"}:${t.lineNumber}`}async updateCustomBreakpoints(e,t){if(!this.target.supportsCustomBreakpoints())return;this._enabledCustomBreakpoints??=new Set;let r=new Set;for(let n of e)r.add("x"+n);for(let n of t)r.add("e"+n);let o=[];for(let n of r)if(!this._enabledCustomBreakpoints.has(n)){let s=n.slice(1);o.push(n.startsWith("x")?this._cdp.DOMDebugger.setXHRBreakpoint({url:s}):id().get(s)?.apply(this._cdp,!0))}for(let n of this._enabledCustomBreakpoints)if(!r.has(n)){let s=n.slice(1);o.push(n.startsWith("x")?this._cdp.DOMDebugger.removeXHRBreakpoint({url:s}):id().get(s)?.apply(this._cdp,!1))}this._enabledCustomBreakpoints=r,await Promise.all(o)}async _createPausedDetails(e){let t=e.reason==="assert"||e.reason==="exception"||e.reason==="promiseRejection"||e.reason==="other"||e.reason==="ambiguous",r=e.hitBreakpoints?.filter(n=>!this._breakpointManager.isEntrypointCdpBreak(n))||[];if((r.length||!t)&&this._sourceContainer.clearDisabledSourceMaps(),e.hitBreakpoints&&this._sourceMapDisabler)for(let n of this._sourceMapDisabler(e.hitBreakpoints))this._sourceContainer.disableSourceMapForSource(n);let o=Bo.fromDebugger(this,e.callFrames,e.asyncStackTrace,e.asyncStackTraceId);if(e.data?.__rewriteAs==="breakpoint")return{thread:this,event:e,stackTrace:o,reason:"breakpoint",description:te.t("Paused on breakpoint")};if(e.data?.__rewriteAs==="step")return{thread:this,event:e,stackTrace:o,reason:"step",description:te.t("Paused")};switch(e.reason){case"assert":return{thread:this,event:e,stackTrace:o,reason:"exception",description:te.t("Paused on assert")};case"debugCommand":return{thread:this,event:e,stackTrace:o,reason:"pause",description:te.t("Paused on debug() call")};case"DOM":return{thread:this,event:e,stackTrace:o,reason:"data breakpoint",description:te.t("Paused on DOM breakpoint")};case"EventListener":return this._resolveEventListenerBreakpointDetails(o,e);case"exception":return{thread:this,event:e,stackTrace:o,reason:"exception",description:te.t("Paused on exception"),exception:e.data};case"promiseRejection":return{thread:this,event:e,stackTrace:o,reason:"exception",description:te.t("Paused on {0}","promise rejection"),exception:e.data};case"instrumentation":return e.data&&e.data.scriptId?{thread:this,event:e,stackTrace:o,reason:"step",description:te.t("Paused")}:{thread:this,event:e,stackTrace:o,reason:"function breakpoint",description:te.t("Paused on instrumentation breakpoint")};case"XHR":return{thread:this,event:e,stackTrace:o,reason:"data breakpoint",description:te.t("Paused on XMLHttpRequest or fetch")};case"OOM":return{thread:this,event:e,stackTrace:o,reason:"exception",description:te.t("Paused before Out Of Memory exception")};default:if(r.length){let n=!1,s=this.target.entryBreakpoint;if(s&&r.includes(s.cdpId)){n=!0;let a=this._sourceContainer.source({path:De(s.path)});a!==void 0&&(n=!(await this._sourceContainer.currentSiblingUiLocations({lineNumber:e.callFrames[0].location.lineNumber+1,columnNumber:(e.callFrames[0].location.columnNumber||0)+1,source:a}))?.some(l=>this._breakpointManager.hasAtLocation(l)))}return n||this._breakpointManager.registerBreakpointsHit(r),{thread:this,event:e,stackTrace:o,hitBreakpoints:e.hitBreakpoints,reason:n?"entry":"breakpoint",description:te.t("Paused on breakpoint")}}return this._expectedPauseReason?{thread:this,event:e,stackTrace:o,description:te.t("Paused"),...this._expectedPauseReason}:{thread:this,event:e,stackTrace:o,reason:"pause",description:te.t("Paused on debugger statement")}}}_resolveEventListenerBreakpointDetails(e,t){let r=t.data,o=r&&r.eventName||"",n=id().get(o);if(n){let s=n.details(r);return{thread:this,event:t,stackTrace:e,reason:"function breakpoint",description:s.short,text:s.long}}return{thread:this,event:t,stackTrace:e,reason:"function breakpoint",description:te.t("Paused on event listener")}}_clearDebuggerConsole(){return{category:"console",output:"\x1B[2J"}}_removeAllScripts(e=!1){this._sourceContainer.clear(e)}_onScriptParsed(e){let t={url:e.url,hasSourceURL:!!e.hasSourceURL,embedderName:e.embedderName,scriptId:e.scriptId,executionContextId:e.executionContextId};if(ht(e.url)&&(e.url=W(e.url)),this._sourceContainer.getScriptById(e.scriptId))return;if(e.url.endsWith(".cdp")){this._sourceContainer.addScriptById(t);return}e.url&&(e.url=this.target.scriptUrlToUrl(e.url));let r=this._executionContexts.get(e.executionContextId);r||(this.logger.info("internal","Creating missing execution context id",e),r=new ld({id:e.executionContextId,name:"<autofilled>",origin:"",uniqueId:String(e.executionContextId)}),this._executionContexts.set(e.executionContextId,r));let n={...t,source:(async()=>{let s=this._sourceContainer.getSourceByOriginalUrl(e.url);if(e.hash&&s?.contentHash===e.hash)return s.addScript({scriptId:e.scriptId,url:e.url,embedderName:e.embedderName,hasSourceURL:!!e.hasSourceURL,executionContextId:e.executionContextId}),s;let a=async()=>{let b=await this._cdp.Debugger.getScriptSource({scriptId:e.scriptId});return b?b.scriptSource:void 0},c=e.startLine||e.startColumn?{lineOffset:e.startLine,columnOffset:e.startColumn}:void 0,l=e.url.endsWith("#vscode-extension")?{lineOffset:2,columnOffset:0}:void 0,p;e.sourceMapURL&&(p=st(e.sourceMapURL)?e.sourceMapURL:e.url&&Tr(e.url,e.sourceMapURL)||e.url,p||this._dap.with(b=>ky(b,`Could not load source map from ${e.sourceMapURL}`)));let d=await this._sourceContainer.addSource(e,a,p,c,l,!e.hasSourceURL&&this.launchConfig.enableContentValidation?e.hash:void 0);return d.addScript({scriptId:e.scriptId,url:e.url,embedderName:e.embedderName,hasSourceURL:!!e.hasSourceURL,executionContextId:e.executionContextId}),d})()};n.source.then(s=>n.resolvedSource=s),r.scripts.push(n),this._sourceContainer.addScriptById(n),(e.sourceMapURL||e.scriptLanguage==="WebAssembly")&&this._getOrStartLoadingSourceMaps(n)}async _handleSourceMapPause(e,t){this._pausedForSourceMapScriptId=e;let r=this._sourceContainer.sourceMapTimeouts().sourceMapMinPause,o=r+this._sourceContainer.sourceMapTimeouts().sourceMapCumulativePause,n=this._sourceContainer.getScriptById(e);if(!n)return this._pausedForSourceMapScriptId=void 0,!1;let s=new gr,a=await Promise.race([this._getOrStartLoadingSourceMaps(n),x(o)]),c=s.elapsed().ms,l=this._sourceContainer.sourceMapTimeouts().sourceMapCumulativePause-Math.max(c-r,0);this._sourceContainer.setSourceMapTimeouts({...this._sourceContainer.sourceMapTimeouts(),sourceMapCumulativePause:l}),this.logger.verbose("internal","Blocked execution waiting for source-map",{timeSpentWallClockInMs:c,sourceMapCumulativePause:l}),a||this._dap.with(b=>b.output({category:"stderr",output:te.t("WARNING: Processing source-maps of {0} took longer than {1} ms so we continued execution without waiting for all the breakpoints for the script to be set.",n.url||n.scriptId,o)})),console.assert(this._pausedForSourceMapScriptId===e),this._pausedForSourceMapScriptId=void 0;let p=t?.lineNumber||0,d=t?.columnNumber;return!!a?.map(Lo).some(b=>b.lineNumber===p&&(d===void 0||d===b.columnNumber))}_getOrStartLoadingSourceMaps(e){let t=this._executionContexts.get(e.executionContextId);if(!t)return Promise.resolve([]);let r=t.sourceMapLoads.get(e.scriptId);if(r)return r;let o=e.source.then(n=>this._sourceContainer.waitForSourceMapSources(n)).then(n=>n.length&&this._scriptWithSourceMapHandler?this._scriptWithSourceMapHandler(e,n):[]);return t.sourceMapLoads.set(e.scriptId,o),o}async _revealObject(e){if(e.type!=="function"||e.objectId===void 0)return;let t=await this._cdp.Runtime.getProperties({objectId:e.objectId,ownProperties:!0});if(t)for(let r of t.internalProperties||[]){if(r.name!=="[[FunctionLocation]]"||!r.value||r.value.subtype!=="internal#location")continue;let o=await this.rawLocationToUiLocation(this.rawLocation(r.value.value));o&&this._sourceContainer.revealUiLocation(o);break}}async _copyObjectToClipboard(e){if(!e.objectId){this._dap.with(t=>t.copyRequested({text:Sn(e,"copy")}));return}try{let t=await sS({cdp:this.cdp(),objectId:e.objectId,args:[2],silent:!0,returnByValue:!0});this._dap.with(r=>r.copyRequested({text:t.value}))}catch{}finally{this.cdp().Runtime.releaseObject({objectId:e.objectId}).catch(()=>{})}}async _onThreadPaused(e){this._expectedPauseReason=void 0,this._onPausedEmitter.fire(e);let t;e.hitBreakpoints&&(t=await Promise.race([x(1e3).then(()=>{}),Promise.all(e.hitBreakpoints.map(r=>this._breakpointManager._resolvedBreakpoints.get(r)).filter(Yi(pr)).map(r=>r.untilSetCompleted().then(()=>r.dapId)))])),await x(0),this._dap.with(r=>r.stopped({reason:e.reason,description:e.description,threadId:this.id,text:e.text,hitBreakpointIds:t,allThreadsStopped:!1}))}_onThreadResumed(){this._dap.with(e=>e.continued({threadId:this.id,allThreadsContinued:!1}))}isCrossThreadStep(e){if(!e.asyncStackTraceId||!e.asyncStackTraceId.debuggerId)return!1;let t=i.threadForDebuggerId(e.asyncStackTraceId.debuggerId);if(!t||!t._waitingForStepIn?.lastDetails)return!1;let r=t._waitingForStepIn.lastDetails.stackTrace;return t._cdp.Debugger.getStackTrace({stackTraceId:e.asyncStackTraceId}).then(o=>!o||!o.stackTrace.callFrames.length||!wt.fromRuntime(t,o.stackTrace.callFrames[0],!1).equivalentTo(r.frames[0])?!1:(t._waitingForStepIn=void 0,!0))}async setScriptSourceMapHandler(e,t){this._scriptWithSourceMapHandler=t;let r=e&&this._sourceContainer.sourceMapTimeouts().sourceMapMinPause&&t;if(r&&!this._pauseOnSourceMapBreakpointIds?.length){await this.debuggerReady.promise;let o=await Promise.all([this._cdp.Debugger.setInstrumentationBreakpoint({instrumentation:"beforeScriptWithSourceMapExecution"}),this._cdp.Debugger.setBreakpointByUrl({lineNumber:0,columnNumber:0,urlRegex:"\\.[wW][aA][sS][mM]"})]);this._pauseOnSourceMapBreakpointIds=o.map(n=>n?.breakpointId).filter(Ae)}else if(!r&&this._pauseOnSourceMapBreakpointIds?.length){let o=this._pauseOnSourceMapBreakpointIds;this._pauseOnSourceMapBreakpointIds=void 0,await Promise.all(o.map(n=>this._cdp.Debugger.removeBreakpoint({breakpointId:n})))}return!!this._pauseOnSourceMapBreakpointIds?.length}async _enablePerScriptSourcemaps(){await this._breakpointManager.updateEntryBreakpointMode(this,1),await this.setScriptSourceMapHandler(!1,this._scriptWithSourceMapHandler)}_shouldEnablePerScriptSms(e){return e.data?.url.includes("@vite/client")?!0:e.reason!=="instrumentation"||!st(e.data?.sourceMapURL)?!1:e.data.url?.startsWith("webpack")||e.data.url?.startsWith("ng:")}setSourceMapDisabler(e){this._sourceMapDisabler=e}static threadForDebuggerId(e){return i._allThreadsByDebuggerId.get(e)}async replacePathsInStackTrace(e){let t=[];for(let o of new vi(e)){if(typeof o=="string"){t.push(o);continue}let n=this._sourceContainer.getSourceByOriginalUrl(W(o.path))||this._sourceContainer.getSourceByOriginalUrl(o.path);if(!n){t.push(o.toString());continue}t.push(this._sourceContainer.preferredUiLocation({columnNumber:o.position.base1.columnNumber,lineNumber:o.position.base1.lineNumber,source:n}).then(({source:s,lineNumber:a,columnNumber:c})=>`${s.absolutePath}:${a}:${c}`))}return(await Promise.all(t)).join("")}}});async function VD(i,e,t){if(!e.functionName)return LS;if(e.functionName.includes("."))return e.functionName;let r;if(e.this.objectId&&t&&(r=(await i.cdp().Runtime.callFunctionOn({functionDeclaration:rd.decl("64","null"),objectId:e.this.objectId,returnByValue:!0}))?.result.value),!r&&e.this.description){r=e.this.description;let s=WD.exec(r);s&&(r=s[1])}if(!r)return e.functionName;let o=r.indexOf(`
`);o!==-1&&(r=r.slice(0,o).trim());let n=e.functionName;return r===n?`${r}.constructor`:r?`${r}.${n}`:n}function $D(i){return i.functionName||LS}var Bt,DS,Bo,eh,ud,LS,WD,wt,Zf,Al,Tl=m(()=>{"use strict";Bt=w(require("@vscode/l10n"));oi();M();Co();It();le();oe();yl();Pl();td();Dr();Af();Yf();DS=i=>typeof i.uiLocation=="function",Bo=class i{constructor(e){this.thread=e;this.frames=[];this._frameById=new Map;this._lastInlineWasmExpanded=Promise.resolve(0);this._lastFrameThread=e}static fromRuntime(e,t){let r=new i(e);for(let o of t.callFrames)o.url.endsWith(".cdp")||r.frames.push(wt.fromRuntime(e,o,!1));return t.parentId?(r._asyncStackTraceId=t.parentId,console.assert(!t.parent)):r._appendStackTrace(e,t.parent),r}static fromDebugger(e,t,r,o){let n=new i(e);for(let s of t)n._appendFrame(wt.fromDebugger(e,s));return o?(n._asyncStackTraceId=o,console.assert(!r)):n._appendStackTrace(e,r),n}async loadFrames(e,t){return await this.expandAsyncStack(e,t),await this.expandWasmFrames(),this.frames}async expandAsyncStack(e,t){for(;this.frames.length<e&&this._asyncStackTraceId;){if(this._asyncStackTraceId.debuggerId&&(this._lastFrameThread=pa.threadForDebuggerId(this._asyncStackTraceId.debuggerId)),!this._lastFrameThread){this._asyncStackTraceId=void 0;break}t&&this._lastFrameThread.cdp().DotnetDebugger.setEvaluationOptions({options:{noFuncEval:t},type:"stackFrame"});let r=await this._lastFrameThread.cdp().Debugger.getStackTrace({stackTraceId:this._asyncStackTraceId});this._asyncStackTraceId=void 0,r&&this._appendStackTrace(this._lastFrameThread,r.stackTrace)}}expandWasmFrames(){return this._lastInlineWasmExpanded=this._lastInlineWasmExpanded.then(async e=>{for(;e<this.frames.length;e++){let t=this.frames[e];if(!(t instanceof wt))continue;let r=t.scriptSource?.resolvedSource;if(!an(r))continue;let o=await r.sourceMap.value.promise;if(!o.getFunctionStack)continue;let n=await o.getFunctionStack(t.rawPosition);if(n.length===0)continue;let s=[];for(let a=0;a<n.length;a++){let c=new Al({source:r,thread:this.thread,inlineFrameIndex:a,name:n[a].name,root:t});this._frameById.set(c.frameId,c),s.push(c)}this._spliceFrames(e,1,...s),e+=n.length-1}return e})}frame(e){return this._frameById.get(e)}_appendStackTrace(e,t){for(console.assert(!t||!this._asyncStackTraceId);t;){if(t.description==="async function"&&t.callFrames.length&&t.callFrames.shift(),t.callFrames.length){this._appendFrame(new ud(t.description||"async"));for(let r of t.callFrames)this._appendFrame(wt.fromRuntime(e,r,!0))}t.parentId&&(this._asyncStackTraceId=t.parentId,console.assert(!t.parent)),t=t.parent}}_spliceFrames(e,t,...r){this.frames.splice(e,t,...r);for(let o of r)o instanceof ud||this._frameById.set(o.frameId,o)}_appendFrame(e){this._spliceFrames(this.frames.length,0,e)}async formatAsNative(){return await this.formatWithMapper(e=>e.formatAsNative())}async format(){return await this.formatWithMapper(e=>e.format())}async formatWithMapper(e){let t=await this.loadFrames(50);for(let o=t.length-1;o>=0;o--){let n=t[o];if(n instanceof wt&&n.isReplEval){t=t.slice(0,o+1);break}}let r=t.map(e);return(await Promise.all(r)).join(`
`)+`
`}async toDap(e){let t=e.startFrame||0,r=(e.levels||50)+t,o=await this.loadFrames(r,e.noFuncEval);r=Math.min(o.length,e.levels?r:o.length);let n=[];for(let s=t;s<r;s++)n.push(o[s].toDap(e.format));return{stackFrames:await Promise.all(n),totalFrames:this._asyncStackTraceId?1e6:o.length}}},eh=_p(),ud=class{constructor(e="async"){this.label=e;this.frameId=eh()}async toDap(){return{name:this.label,id:0,line:0,column:0,presentationHint:"label"}}async formatAsNative(){return`    --- ${this.label} ---`}async format(){return`\u25C0 ${this.label} \u25B6`}},LS="<anonymous>",WD=/^class\s+(.+) {($|\n)/;wt=class i{constructor(e,t,r,o=!1){this.callFrame=t;this.isAsync=o;this.frameId=eh();this.root=this;this.getLocationInfo=F(async()=>{let e=this.uiLocation(),t=await Ef(this),r=this.overrideName||("this"in this.callFrame?await VD(this._thread,this.callFrame,t===0):$D(this.callFrame));return{isSmartStepped:t,name:r,uiLocation:await e}});this.completions=F(async()=>{if(!this._scope)return[];let e=this._thread.pausedVariables();if(!e)return[];let t=[];for(let o=0;o<this._scope.chain.length;o++){let n=this._scopeVariable(o,this._scope);n&&t.push(e.getVariableNames({variablesReference:n.id}).then(s=>s.map(a=>({label:a,type:"property"}))))}let r=await Promise.all(t);return[].concat(...r)});this._rawLocation=r,this.uiLocation=F(()=>e.rawLocationToUiLocation(r)),this._thread=e;let n=r.scriptId?e.getScriptById(r.scriptId):void 0;this.isReplEval=n?n.url.endsWith(".repl"):!1}get rawPosition(){return new je(this._rawLocation.lineNumber,this._rawLocation.columnNumber)}static fromRuntime(e,t,r){return new i(e,t,e.rawLocation(t),r)}static fromDebugger(e,t){let r=new i(e,t,e.rawLocation(t));return r._scope={chain:t.scopeChain,thisObject:t.this,returnValue:t.returnValue,variables:new Array(t.scopeChain.length).fill(void 0),callFrameId:t.callFrameId},r}get scriptId(){return"scriptId"in this.callFrame?this.callFrame.scriptId:this.callFrame.location.scriptId}get scriptSource(){return this._thread._sourceContainer.getScriptById(this.scriptId)}get canExplicitlyBeRestarted(){return!!this.callFrame.canBeRestarted}equivalentTo(e){return e instanceof i&&e._rawLocation.columnNumber===this._rawLocation.columnNumber&&e._rawLocation.lineNumber===this._rawLocation.lineNumber&&e._rawLocation.scriptId===this._rawLocation.scriptId}callFrameId(){return this._scope?this._scope.callFrameId:void 0}async scopes(){let e=this._scope;if(!e)throw new I(Ay());return{scopes:(await Promise.all(e.chain.map(async(r,o)=>{let n="",s;switch(r.type){case"global":n=Bt.t("Global");break;case"local":n=Bt.t("Local"),s="locals";break;case"with":n=Bt.t("With Block"),s="locals";break;case"closure":n=Bt.t("Closure"),s="arguments";break;case"catch":n=Bt.t("Catch Block"),s="locals";break;case"block":n=Bt.t("Block"),s="locals";break;case"script":n=Bt.t("Script");break;case"eval":n=Bt.t("Eval");break;case"module":n=Bt.t("Module");break;default:n=r.type.substr(0,1).toUpperCase()+r.type.substr(1);break}r.name&&r.type==="closure"?n=Bt.t("Closure ({0})",r.name):r.name&&(n=`${n}: ${r.name}`);let a=this._scopeVariable(o,e);if(!a)return;let c={name:n,presentationHint:s,expensive:r.type==="global",variablesReference:a.id};if(r.startLocation){let l=this._thread.rawLocation(r.startLocation),p=await this._thread.rawLocationToUiLocation(l);if(c.line=(p||l).lineNumber,c.column=(p||l).columnNumber,p&&(c.source=await p.source.toDap()),r.endLocation){let d=this._thread.rawLocation(r.endLocation),b=await this._thread.rawLocationToUiLocation(d);c.endLine=(b||d).lineNumber,c.endColumn=(b||d).columnNumber}}return c}))).filter(Ae)}}getStepSkipList(e){return Promise.resolve(void 0)}async toDap(e){let{isSmartStepped:t,name:r,uiLocation:o}=await this.getLocationInfo(),n=o?await o.source.toDap():void 0,s=t?"deemphasize":"normal";t&&n&&(n.origin=t===1?Bt.t("Skipped by smartStep"):Bt.t("Skipped by skipFiles"));let a=(o||this._rawLocation).lineNumber,c=(o||this._rawLocation).columnNumber,l=r;return n&&e&&(e.module&&(l+=` [${n.name}]`),e.line&&(l+=` Line ${a}`)),{id:this.frameId,name:l,line:a,column:c,source:n,presentationHint:s,canRestart:this.callFrame.canBeRestarted??!this.isAsync}}async formatAsNative(){let{name:e,uiLocation:t}=await this.getLocationInfo(),r=await t?.source.existingAbsolutePath()||await t?.source.prettyName()||this.callFrame.url,{lineNumber:o,columnNumber:n}=t||this._rawLocation;return`    at ${e} (${r}:${o}:${n})`}async format(){let{name:e,uiLocation:t}=await this.getLocationInfo(),r=await t?.source.prettyName()||"<unknown>",o=t||this._rawLocation,n=`${e} @ ${r}:${o.lineNumber}`;return o.columnNumber>1&&(n+=`:${o.columnNumber}`),n}_scopeVariable(e,t){let r=t.variables[e];if(r)return r;let o={stackFrame:this,callFrameId:t.callFrameId,scopeNumber:e},n=[];e===0&&(t.thisObject&&n.push({name:"this",value:t.thisObject}),t.returnValue&&n.push({name:Bt.t("Return value"),value:t.returnValue}));let s=this._thread.pausedVariables();if(!s)return;let a=s.createScope(t.chain[e].object,o,n);return t.variables[e]=a}},Zf={scopes:[]},Al=class{constructor(e){this.frameId=eh();this.name=e.name,this.root=e.root,this.thread=e.thread,this.source=e.source,this.inlineFrameIndex=e.inlineFrameIndex,this.wasmPosition=new Re(this.inlineFrameIndex,this.root.rawPosition.base0.columnNumber),this.uiLocation=F(()=>e.thread._sourceContainer.preferredUiLocation({columnNumber:e.root.rawPosition.base1.columnNumber,lineNumber:e.inlineFrameIndex+1,source:e.source}))}async formatAsNative(){let{columnNumber:e,lineNumber:t,source:r}=await this.uiLocation();return`    at ${this.name} (${r.url}:${t}:${e})`}async format(){let{columnNumber:e,lineNumber:t,source:r}=await this.uiLocation(),o=await r.prettyName()||"<unknown>";return`${this.name} @ ${o}:${t}:${e}`}async toDap(){let{columnNumber:e,lineNumber:t,source:r}=await this.uiLocation();return Promise.resolve({id:this.frameId,name:this.name,column:e,line:t,source:await r.toDapShallow()})}async getStepSkipList(e){let t=this.source.sourceMap.value.settledValue;if(!t?.getStepSkipList)return;let r=await this.uiLocation();return r?t.getStepSkipList(e,this.wasmPosition,r.source.compiledToSourceUrl.get(this.source),new je(r.lineNumber,r.columnNumber)):t.getStepSkipList(e,this.root.rawPosition)}async scopes(){let e=this.source.sourceMap.value.settledValue,t=this.root.callFrameId();if(!e||!t)return Zf;let r=await e.getVariablesInScope?.(t,this.wasmPosition);if(!r)return Zf;let o=this.thread.pausedVariables();if(!o)return Zf;let n={stackFrame:this.root,callFrameId:t,scopeNumber:0};return{scopes:await Promise.all([...ey(r,s=>s.scope)].map(([s,a])=>o.createWasmScope(s,a,n).toDap("propertyValue").then(c=>({name:c.name,variablesReference:c.variablesReference,expensive:s!=="LOCAL"}))))}}}});var _S,kn,dd,xn,Pi,md,gd,fd,hd,bd,th=m(()=>{"use strict";_S=w(require("@vscode/l10n"));M();ed();Cf();sa();Tl();kn=class{constructor(e){this.event=e;this.stackTrace=F(e=>this.event.stackTrace?Bo.fromRuntime(e,this.event.stackTrace):void 0);this.getUiLocation=F(async e=>{let t=this.stackTrace(e);if(!t)return;let r;for(let o of t.frames){if(!(o instanceof wt))continue;let n=await o.uiLocation();if(n&&(r||(r=n),!n.source.blackboxed()))return{source:await n.source.toDap(),line:n.lineNumber,column:n.columnNumber}}if(r)return{source:await r.source.toDap(),line:r.lineNumber,column:r.columnNumber}})}formatDefaultString(e,t,r=!1){let n=t.length>1&&t[0].type==="string"?xf(t[0].value,t.slice(1),Lf):xf("",t,Lf),s=n.result+`
`;return n.usedAllSubs&&!t.some(vn)?{output:s}:this.formatComplexStringOutput(e,s,t,r)}async formatComplexStringOutput(e,t,r,o){(r.some(s=>s.subtype==="error")||vi.isStackLike(t))&&(await this.getUiLocation(e),t=await e.replacePathsInStackTrace(t),o=!0);let n=e.replVariables.createVariableForOutput(t,r,o?this.stackTrace(e):void 0);return{output:t,variablesReference:n.id}}},dd=class extends kn{async toDap(e){return this.event.args[0]?.value==="console.assert"&&(this.event.args[0].value=_S.t("Assertion failed")),{category:"stderr",...await this.formatDefaultString(e,this.event.args,!0),...await this.getUiLocation(e)}}},xn=class extends kn{constructor(t,r,o){super(t);this.includeStack=r;this.category=o}async toDap(t){return{category:this.category,...await this.formatDefaultString(t,this.event.args,this.includeStack),...await this.getUiLocation(t)}}},Pi=class extends xn{constructor(e){super(e,!1,"stdout")}},md=class extends xn{constructor(e){super(e,!0,"stdout")}},gd=class extends xn{constructor(e){super(e,!0,"stderr")}},fd=class extends xn{constructor(e){super(e,!0,"stderr")}},hd=class extends kn{async toDap(e){return{category:"stdout",group:this.event.type==="startGroupCollapsed"?"startCollapsed":"start",...await this.formatDefaultString(e,this.event.args),...await this.getUiLocation(e)}}},bd=class extends xn{constructor(e){super(e,!1,"stdout")}async toDap(e){return this.event.args[0]?.preview?{category:"stdout",output:"",variablesReference:e.replVariables.createVariableForOutput("",this.event.args,void 0,this.event.type).id,...await this.getUiLocation(e)}:super.toDap(e)}}});var El,ES=m(()=>{"use strict";M();ed();sa();Tl();th();El=class extends kn{constructor(){super(...arguments);this.stackTrace=F(t=>{if(this.event.stackTrace)return Bo.fromRuntime(t,this.event.stackTrace);if(this.event.scriptId)return Bo.fromRuntime(t,{callFrames:[{functionName:"(program)",lineNumber:this.event.lineNumber,columnNumber:this.event.columnNumber,scriptId:this.event.scriptId,url:this.event.url||""}]})})}async toDap(t){let r=this.event.exception?In(this.event.exception):{title:""},o=r.title;o.startsWith("Uncaught")||(o=`Uncaught ${this.event.exception?.className??"Error"} `+o);let n=this.stackTrace(t),s=this.event.exception&&!r.stackTrace?[this.event.exception]:[];return vi.isStackLike(o)?o=await t.replacePathsInStackTrace(o):n&&(o+=`
`+await n.formatAsNative()),{category:"stderr",output:o,variablesReference:n||s.length?t.replVariables.createVariableForOutput(o,s,n).id:void 0,...await this.getUiLocation(t)}}}});var wd,pd=m(()=>{"use strict";eS();ES();wd=Symbol("IConsole")});var rh,AS,FS,MS=m(()=>{"use strict";rh=require("path"),AS=(0,rh.join)(__dirname,"diagnosticTool.js"),FS=(0,rh.join)(__dirname,"diagnosticTool.css")});var io,ct,ki=m(()=>{"use strict";io=Symbol("ITarget"),ct=Symbol("ILauncher")});var Cn,NS,BS,xi,oh=m(()=>{"use strict";Cn=require("inversify"),NS=require("os"),BS=require("path");M();MS();H();ki();bi();Eu();Dr();Mo();xi=class{constructor(e,t,r,o){this.fs=e;this.sources=t;this.breakpoints=r;this.target=o}async generateObject(){let[e]=await Promise.all([this.dumpSources()]);return{breakpoints:this.dumpBreakpoints(),sources:e,config:this.target.launchConfig}}async generateHtml(e=(0,BS.join)((0,NS.tmpdir)(),"js-debug-diagnostics.html")){return await this.fs.writeFile(e,`<!DOCTYPE html>
      <html lang="en">
      <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Document</title>
        <style>${await this.fs.readFile(FS,"utf-8")}<</style>
      </head>
      <body>
        <script>window.DUMP=${JSON.stringify(await this.generateObject())}</script>
        <script>${await this.fs.readFile(AS,"utf-8")}</script>
      </body>
      </html>`),e}dumpBreakpoints(){let e=[];for(let t of[this.breakpoints.appliedByPath,this.breakpoints.appliedByRef])for(let r of t.values())for(let o of r){let n=o.diagnosticDump();e.push({source:n.source,params:n.params,cdp:n.cdp.map(s=>s.state===1?{...s,uiLocations:s.uiLocations.map(a=>this.dumpUiLocation(a))}:{...s,done:void 0})})}return e}dumpSources(){let e=[],t=0;for(let r of this.sources.sources)e.push((async()=>({uniqueId:t++,url:r.url,sourceReference:r.sourceReference,absolutePath:r.absolutePath,actualAbsolutePath:await r.existingAbsolutePath(),scriptIds:r.scripts.map(o=>o.scriptId),prettyName:await r.prettyName(),compiledSourceRefToUrl:r instanceof Me?[...r.compiledToSourceUrl.entries()].map(([o,n])=>[o.sourceReference,n]):void 0,sourceMap:sn(r)?{url:r.sourceMap.metadata.sourceMapUrl,metadata:r.sourceMap.metadata,sources:Po(Object.fromEntries(r.sourceMap.sourceByUrl),o=>o.sourceReference)}:void 0}))());return Promise.all(e)}dumpUiLocation(e){return{lineNumber:e.lineNumber,columnNumber:e.columnNumber,sourceReference:e.source.sourceReference}}};xi=f([(0,Cn.injectable)(),u(0,(0,Cn.inject)(G)),u(1,(0,Cn.inject)(Ye)),u(2,(0,Cn.inject)(mr)),u(3,(0,Cn.inject)(io))],xi)});var Ci,da,ua,ih=m(()=>{"use strict";Ci=require("inversify");M();U();It();$();Lr();le();oe();cf();bn();vl();Mo();da=Symbol("IExceptionPauseService"),ua=class{constructor(e,t,r,o,n){this.evaluator=e;this.scriptSkipper=t;this.dap=r;this.sourceContainer=n;this.state={cdp:"none"};this.blocker=ne();this.noDebug=!!o.noDebug,this.breakOnError=o.__breakOnConditionalError,this.blocker.resolve()}get launchBlocker(){return this.blocker.promise}async setBreakpoints(e){if(!this.noDebug){try{this.state=this.parseBreakpointRequest(e)}catch(t){if(!(t instanceof I))throw t;this.dap.output({category:"stderr",output:t.message});return}this.cdp?await this.sendToCdp(this.cdp):this.state.cdp!=="none"&&this.blocker.hasSettled()&&(this.blocker=ne())}}async shouldPauseAt(e){if(e.reason!=="exception"&&e.reason!=="promiseRejection"||this.state.cdp==="none"||e.callFrames.some(r=>this.sourceContainer.getSourceScriptById(r.location.scriptId)?.url.endsWith(".cdp"))||this.shouldScriptSkip(e))return!1;let t=this.state.condition;if(e.data?.uncaught){if(t.uncaught&&!await this.evalCondition(e,t.uncaught))return!1}else if(t.caught&&!await this.evalCondition(e,t.caught))return!1;return!0}async apply(e){this.cdp=e,this.state.cdp!=="none"&&await this.sendToCdp(e)}async sendToCdp(e){await e.Debugger.setPauseOnExceptions({state:this.state.cdp}),this.blocker.resolve()}async evalCondition(e,t){return!!(await t({callFrameId:e.callFrames[0].callFrameId},{error:e.data}))?.result.value}shouldScriptSkip(e){if(e.data?.uncaught||!e.callFrames.length)return!1;let t=this.sourceContainer.getScriptById(e.callFrames[0].location.scriptId);return!!t&&this.scriptSkipper.isScriptSkipped(t.url)}parseBreakpointRequest(e){let t=(e.filterOptions??[]).concat(e.filters.map(a=>({filterId:a}))),r="none",o=[],n=[];for(let{filterId:a,condition:c}of t)a==="all"?(r="all",c&&o.push(a)):a==="uncaught"&&(r==="none"&&(r="uncaught"),c&&n.push(a));let s=a=>{if(a.length===0)return;let c="!!("+t.map(d=>d.condition).filter(Ae).join(") || !!(")+")",l=li(c);if(l)throw new I(di({line:0,condition:c},l.message));let p=af(c,this.breakOnError);return this.evaluator.prepare(p,{hoist:["error"]}).invoke};return r==="none"?{cdp:r}:{cdp:r,condition:{caught:s(o),uncaught:s(n)}}}};ua=f([(0,Ci.injectable)(),u(0,(0,Ci.inject)(lr)),u(1,(0,Ci.inject)(wi)),u(2,(0,Ci.inject)(At)),u(3,(0,Ci.inject)(X)),u(4,(0,Ci.inject)(Ye))],ua)});var yd,OS=m(()=>{"use strict";yd=class{constructor(){this.didEnable=new WeakSet}async retrieve(e){this.didEnable.has(e)||(this.didEnable.add(e),await e.Performance.enable({}));let t=await e.Performance.getMetrics({});if(!t)return{error:"Error in CDP"};let r={};for(let o of t.metrics)r[o.name]=o.value;return{metrics:r}}}});var vd,jS=m(()=>{"use strict";Ke();vd=class{async retrieve(e){let t=await e.Runtime.evaluate({expression:`({
        memory: process.memoryUsage(),
        cpu: process.cpuUsage(),
        timestamp: Date.now(),
        resourceUsage: process.resourceUsage && process.resourceUsage(),
      })${Pe()}`,returnByValue:!0});return t?t.exceptionDetails?{error:t.exceptionDetails.text}:{metrics:t.result.value}:{error:"No response from CDP"}}}});var Sd,Id,Tn,nh=m(()=>{"use strict";Sd=require("inversify");ki();OS();jS();Id=Symbol("IPerformanceProvider"),Tn=class{constructor(e){this.target=e}create(){return this.target.type()==="node"?new vd:new yd}};Tn=f([(0,Sd.injectable)(),u(0,(0,Sd.inject)(io))],Tn)});var ma,sh=m(()=>{"use strict";ma=class{constructor(e){this.sources=e;this.locationIdCounter=0;this.locationsByRef=new Map}getLocationIdFor(e){let t=[e.functionName,e.url,e.scriptId,e.lineNumber,e.columnNumber].join(":"),r=this.locationsByRef.get(t);if(r)return r.id;let o=this.locationIdCounter++;return this.locationsByRef.set(t,{id:o,callFrame:e,locations:(async()=>{let n=await this.sources.getScriptById(e.scriptId)?.source;if(!n)return[];let s=await this.sources.currentSiblingUiLocations({lineNumber:e.lineNumber+1,columnNumber:e.columnNumber+1,source:n});return Promise.all(s.map(async a=>({...a,source:await a.source.toDapShallow()})))})()}),o}getLocations(){return Promise.all([...this.locationsByRef.values()].sort((e,t)=>e.id-t.id).map(async e=>({callFrame:e.callFrame,locations:await e.locations})))}}});async function US(i,e,t){let r=new ma(e),o=i.nodes.map(n=>({...n,locationId:r.getLocationIdFor(n.callFrame),positionTicks:n.positionTicks?.map(s=>({...s,startLocationId:r.getLocationIdFor({...n.callFrame,lineNumber:s.line-1,columnNumber:0}),endLocationId:r.getLocationIdFor({...n.callFrame,lineNumber:s.line,columnNumber:0})}))}));return{...i,nodes:o,$vscode:{rootPath:t,locations:await r.getLocations()}}}var ah,Rn,Pd,Ze,ch,Fl=m(()=>{"use strict";ah=w(require("@vscode/l10n")),Rn=require("inversify"),Pd=require("path");We();O();$();le();oe();H();Mo();sh();Ze=class{constructor(e,t,r,o){this.cdp=e;this.fs=t;this.sources=r;this.launchConfig=o}static canApplyTo(){return!0}async start(e,t){if(!await this.cdp.Profiler.start({}))throw new I(Es());return new ch(this.cdp,this.fs,this.sources,this.launchConfig.__workspaceFolder,t)}async save(e,t){let r=await US(e,this.sources,this.launchConfig.__workspaceFolder);(0,Pd.isAbsolute)(t)||(t=(0,Pd.join)(this.launchConfig.__workspaceFolder,t)),await this.fs.writeFile(t,JSON.stringify(r))}};Ze.type="cpu",Ze.extension=".cpuprofile",Ze.label=ah.t("CPU Profile"),Ze.description=ah.t("Generates a .cpuprofile file you can open in VS Code or the Edge/Chrome devtools"),Ze.editable=!0,Ze=f([(0,Rn.injectable)(),u(0,(0,Rn.inject)(xe)),u(1,(0,Rn.inject)(G)),u(2,(0,Rn.inject)(Ye)),u(3,(0,Rn.inject)(X))],Ze);ch=class{constructor(e,t,r,o,n){this.cdp=e;this.fs=t;this.sources=r;this.workspaceFolder=o;this.file=n;this.stopEmitter=new S;this.disposed=!1;this.onUpdate=new S().event;this.onStop=this.stopEmitter.event}async dispose(){this.disposed||(this.disposed=!0,this.stopEmitter.fire())}async stop(){let e=await this.cdp.Profiler.stop({});if(!e)throw new I(Es());await this.dispose();let t=await US(e.profile,this.sources,this.workspaceFolder);await this.fs.writeFile(this.file,JSON.stringify(t))}}});var lh,Dn,Gt,ph,uh=m(()=>{"use strict";lh=w(require("@vscode/l10n")),Dn=require("inversify");We();O();$();le();oe();H();Mo();sh();Gt=class{constructor(e,t,r,o){this.cdp=e;this.fs=t;this.sources=r;this.launchConfig=o}static canApplyTo(){return!0}async start(e,t){if(await this.cdp.HeapProfiler.enable({}),!await this.cdp.HeapProfiler.startSampling({}))throw new I(Es());return new ph(this.cdp,this.fs,this.sources,this.launchConfig.__workspaceFolder,t)}};Gt.type="heap",Gt.extension=".heapprofile",Gt.label=lh.t("Heap Profile"),Gt.description=lh.t("Generates a .heapprofile file you can open in VS Code or the Edge/Chrome devtools"),Gt.editable=!0,Gt=f([(0,Dn.injectable)(),u(0,(0,Dn.inject)(xe)),u(1,(0,Dn.inject)(G)),u(2,(0,Dn.inject)(Ye)),u(3,(0,Dn.inject)(X))],Gt);ph=class{constructor(e,t,r,o,n){this.cdp=e;this.fs=t;this.sources=r;this.workspaceFolder=o;this.file=n;this.stopEmitter=new S;this.disposed=!1;this.onUpdate=new S().event;this.onStop=this.stopEmitter.event}async dispose(){this.disposed||(this.disposed=!0,await this.cdp.HeapProfiler.disable({}),this.stopEmitter.fire())}async stop(){let e=await this.cdp.HeapProfiler.stopSampling({});if(!e)throw new I(Es());await this.dispose();let t=await this.annotateSources(e.profile);await this.fs.writeFile(this.file,JSON.stringify(t))}async annotateSources(e){let t=new ma(this.sources),r=(n,s)=>{s.locationId=t.getLocationIdFor(n.callFrame);for(let a of n.children){let c={...a,children:[]};s.children.push(c),r(a,c)}},o={...e.head,children:[]};return r(e.head,o),{...e,head:o,$vscode:{rootPath:this.workspaceFolder,locations:await t.getLocations()}}}}});var dh,WS,kd,Jt,mh=m(()=>{"use strict";dh=w(require("@vscode/l10n")),WS=require("fs"),kd=require("inversify");We();O();Jt=class{constructor(e){this.cdp=e;this.cdp.HeapProfiler.on("addHeapSnapshotChunk",({chunk:t})=>this.currentWriter?.stream.write(t))}static canApplyTo(){return!0}async start(e,t){return{onStop:new S().event,onUpdate:new S().event,dispose:()=>{},stop:async()=>{await this.cdp.HeapProfiler.enable({}),await this.dumpToFile(t),await this.cdp.HeapProfiler.disable({})}}}async dumpToFile(e){let{stream:t,promise:r}=this.currentWriter={stream:(0,WS.createWriteStream)(e),promise:this.cdp.HeapProfiler.takeHeapSnapshot({})};await r,t.end(),this.currentWriter=void 0}};Jt.type="memory",Jt.extension=".heapsnapshot",Jt.label=dh.t("Heap Snapshot"),Jt.description=dh.t("Generates a .heapsnapshot file you can open in VS Code or the Edge/Chrome devtools"),Jt.instant=!0,Jt=f([(0,kd.injectable)(),u(0,(0,kd.inject)(xe))],Jt)});var xd,Cd,Td,Ot,Rd=m(()=>{"use strict";xd=require("inversify");H();Fl();uh();mh();Cd=Symbol("IProfilerFactory"),Td=()=>{let i=new Date;return["vscode-profile",i.getFullYear(),i.getMonth()+1,i.getDate(),i.getHours(),i.getMinutes(),i.getSeconds()].map(e=>String(e).padStart(2,"0")).join("-")},Ot=class{constructor(e){this.container=e}get(e){let t=Ot.ctors.find(r=>r.type===e);if(!t)throw new Error(`Invalid profilter type ${e}`);return this.container.get(t)}};Ot.ctors=[Ze,Gt,Jt],Ot=f([(0,xd.injectable)(),u(0,(0,xd.inject)(Bs))],Ot)});var gh,VS,Ti,$S,qS,Dd,ga,fh=m(()=>{"use strict";gh=w(require("@vscode/l10n")),VS=require("crypto"),Ti=require("inversify"),$S=require("os"),qS=require("path");We();le();oe();pl();bi();fl();Rd();Fl();Dd=Symbol("IProfileController"),ga=class{constructor(e,t,r,o,n){this.cdp=e;this.factory=t;this.basicCpuProfiler=r;this.breakpoints=o;this.shutdown=n;this.seenConsoleProfileNames=Object.create(null)}connect(e,t){e.on("startProfile",async r=>(await this.start(e,t,r),{})),e.on("stopProfile",()=>this.stopProfiling(e)),this.cdp.Profiler.on("consoleProfileStarted",()=>{e.output({output:gh.t("Console profile started")+`
`,category:"console"})}),this.cdp.Profiler.on("consoleProfileFinished",async r=>{let o=this.saveConsoleProfile(e,r),n=this.shutdown.register(0,()=>o);await o,n.dispose()}),t.onPaused(()=>this.stopProfiling(e))}async start(e,t,r){if(this.profile)throw new I(_y());this.profile=this.startProfileInner(e,t,r).catch(o=>{throw this.profile=void 0,o}),await this.profile}async saveConsoleProfile(e,t){let r;if(t.title){r=t.title.replace(/[\/\\]/g,"-");let o=this.seenConsoleProfileNames[t.title]||0;this.seenConsoleProfileNames[t.title]=o+1,o>0&&(r+=`-${o}`)}else r=Td();r+=Ze.extension,await this.basicCpuProfiler.save(t.profile,r),e.output({output:gh.t('CPU profile saved as "{0}" in your workspace folder',r)+`
`,category:"console"})}async startProfileInner(e,t,r){let o=!1,n;if(r.stopAtBreakpoint?.length){let p=new Set(r.stopAtBreakpoint);o=!0,n=d=>!(d instanceof pr)||p.has(d.dapId)}else n=()=>!1;await this.breakpoints.applyEnabledFilter(n);let s=(0,qS.join)((0,$S.tmpdir)(),`vscode-js-profile-${(0,VS.randomBytes)(4).toString("hex")}`),a=await this.factory.get(r.type).start(r,s),c={file:s,profile:a,enableFilter:n,keptDebuggerOn:o};a.onUpdate(p=>e.profilerStateUpdate({label:p,running:!0})),a.onStop(()=>this.disposeProfile(c));let l=!!t.pausedDetails();return o?await t.resume():l&&(await this.cdp.Debugger.disable({}),l&&t.onResumed()),e.profileStarted({file:c.file,type:r.type}),c}async stopProfiling(e){let t=await this.profile?.catch(()=>{});return!t||!this.profile?{}:(this.profile=void 0,await t?.profile.stop(),e.profilerStateUpdate({label:"",running:!1}),{})}async disposeProfile({profile:e,enableFilter:t,keptDebuggerOn:r}){r||await this.cdp.Debugger.enable({}),await this.breakpoints.applyEnabledFilter(void 0,t),e.dispose()}};ga=f([(0,Ti.injectable)(),u(0,(0,Ti.inject)(xe)),u(1,(0,Ti.inject)(Cd)),u(2,(0,Ti.inject)(Ze)),u(3,(0,Ti.inject)(mr)),u(4,(0,Ti.inject)(fi))],ga)});var hr,Ln,hh=m(()=>{"use strict";hr=w(require("@vscode/l10n"));ze();_();M();Co();U();cl();It();N();le();oe();H();js();pl();bi();If();Gu();pd();oh();bl();bn();ih();nh();fh();Fl();vl();td();Dr();Mo();Yf();Ln=class i{constructor(e,t,r,o){this.asyncStackPolicy=t;this.launchConfig=r;this._services=o;this._disposables=new j;this._customBreakpoints=[];this._xhrBreakpoints=[];this._threadDeferred=ne();this.breakpointIdCounter=_p();this._cdpProxyProvider=this._services.get(zu);this._configurationDoneDeferred=ne(),this.sourceContainer=o.get(Ye),this.breakpointManager=o.get(mr);let n=o.get(Id),s=o.get(at);s.onFlush(()=>{s.report("breakpointStats",this.breakpointManager.statisticsForTelemetry()),s.report("statistics",this.sourceContainer.statistics())}),this.dap=e,this.dap.on("initialize",a=>this.onInitialize(a)),this.dap.on("setBreakpoints",a=>this._onSetBreakpoints(a)),this.dap.on("setExceptionBreakpoints",a=>this.setExceptionBreakpoints(a)),this.dap.on("configurationDone",()=>this.configurationDone()),this.dap.on("loadedSources",()=>this._onLoadedSources()),this.dap.on("disableSourcemap",a=>this._onDisableSourcemap(a)),this.dap.on("source",a=>this._onSource(a)),this.dap.on("threads",()=>this._onThreads()),this.dap.on("stackTrace",a=>this._withThread(c=>c.stackTrace(a))),this.dap.on("variables",a=>this._onVariables(a)),this.dap.on("readMemory",a=>this._onReadMemory(a)),this.dap.on("writeMemory",a=>this._onWriteMemory(a)),this.dap.on("setVariable",a=>this._onSetVariable(a)),this.dap.on("setExpression",a=>this._onSetExpression(a)),this.dap.on("continue",()=>this._withThread(a=>a.resume())),this.dap.on("pause",()=>this._withThread(a=>a.pause())),this.dap.on("next",()=>this._withThread(a=>a.stepOver())),this.dap.on("stepIn",a=>this._withThread(c=>c.stepInto(a.targetId))),this.dap.on("stepOut",()=>this._withThread(a=>a.stepOut())),this.dap.on("restartFrame",a=>this._withThread(c=>c.restartFrame(a))),this.dap.on("scopes",a=>this._withThread(c=>c.scopes(a))),this.dap.on("evaluate",a=>this.onEvaluate(a)),this.dap.on("completions",a=>this._withThread(c=>c.completions(a))),this.dap.on("exceptionInfo",()=>this._withThread(a=>a.exceptionInfo())),this.dap.on("setCustomBreakpoints",a=>this.setCustomBreakpoints(a)),this.dap.on("toggleSkipFileStatus",a=>this._toggleSkipFileStatus(a)),this.dap.on("toggleSkipFileStatus",a=>this._toggleSkipFileStatus(a)),this.dap.on("prettyPrintSource",a=>this._prettyPrintSource(a)),this.dap.on("revealPage",()=>this._withThread(a=>a.revealPage())),this.dap.on("getPerformance",()=>this._withThread(a=>n.retrieve(a.cdp()))),this.dap.on("breakpointLocations",a=>this._breakpointLocations(a)),this.dap.on("createDiagnostics",a=>this._dumpDiagnostics(a)),this.dap.on("requestCDPProxy",()=>this._requestCDPProxy()),this.dap.on("setExcludedCallers",a=>this._onSetExcludedCallers(a)),this.dap.on("saveDiagnosticLogs",({toFile:a})=>this._saveDiagnosticLogs(a)),this.dap.on("setSourceMapStepping",a=>this._setSourceMapStepping(a)),this.dap.on("stepInTargets",a=>this._stepInTargets(a)),this.dap.on("setDebuggerProperty",a=>this._setDebuggerProperty(a)),this.dap.on("setSymbolOptions",a=>this._setSymbolOptions(a))}_setDebuggerProperty(e){return this._thread?.cdp().DotnetDebugger.setDebuggerProperty(e),Promise.resolve({})}_setSymbolOptions(e){return this._thread?.cdp().DotnetDebugger.setSymbolOptions(e),Promise.resolve({})}_breakpointLocations(e){return this._withThread(async t=>{let r=this.sourceContainer.source(e.source);return r?{breakpoints:(await this.breakpointManager.getBreakpointLocations(t,r,new je(e.line,e.column||1),new je(e.endLine||e.line+1,e.endColumn||e.column||1))).map(n=>n.uiLocations.find(s=>s.source===r)).filter(Ae).map(n=>({line:n.lineNumber,column:n.columnNumber}))}:{breakpoints:[]}})}_stepInTargets(e){return this._withThread(async t=>({targets:await t.getStepInTargets(e.frameId)}))}_setSourceMapStepping({enabled:e}){return this.sourceContainer.doSourceMappedStepping=e,Promise.resolve({})}async _saveDiagnosticLogs(e){let t=this._services.get(C).getRecentLogs();return await this._services.get(G).writeFile(e,t.map(r=>JSON.stringify(r)).join(`
`)),{}}async launchBlocker(){await this._configurationDoneDeferred.promise,await this._services.get(da).launchBlocker,await this.breakpointManager.launchBlocker()}async _onSetExcludedCallers({callers:e}){return(await this._threadDeferred.promise).setExcludedCallers(e),{}}async onInitialize(e){console.assert(e.linesStartAt1),console.assert(e.columnsStartAt1);let t=i.capabilities(!0);return setTimeout(()=>this.dap.initialized({}),0),setTimeout(()=>this._thread?.dapInitialized(),0),t}static capabilities(e=!1){return{supportsConfigurationDoneRequest:!0,supportsFunctionBreakpoints:!1,supportsConditionalBreakpoints:!0,supportsHitConditionalBreakpoints:!0,supportsEvaluateForHovers:!0,supportsReadMemoryRequest:!0,supportsWriteMemoryRequest:!0,exceptionBreakpointFilters:[{filter:"all",label:hr.t("Caught Exceptions"),default:!1,supportsCondition:!0,description:hr.t("Breaks on all throw errors, even if they're caught later."),conditionDescription:'error.name == "MyError"'},{filter:"uncaught",label:hr.t("Uncaught Exceptions"),default:!1,supportsCondition:!0,description:hr.t("Breaks only on errors or promise rejections that are not handled."),conditionDescription:'error.name == "MyError"'}],supportsStepBack:!1,supportsSetVariable:!0,supportsRestartFrame:!0,supportsGotoTargetsRequest:!1,supportsStepInTargetsRequest:!0,supportsCompletionsRequest:!0,supportsModulesRequest:!1,additionalModuleColumns:[],supportedChecksumAlgorithms:[],supportsRestartRequest:!0,supportsExceptionOptions:!1,supportsValueFormattingOptions:!0,supportsExceptionInfoRequest:!0,supportTerminateDebuggee:!0,supportsDelayedStackTraceLoading:!0,supportsLoadedSourcesRequest:!0,supportsLogPoints:!0,supportsTerminateThreadsRequest:!1,supportsSetExpression:!0,supportsTerminateRequest:!1,completionTriggerCharacters:[".","[",'"',"'"],supportsBreakpointLocationsRequest:!0,supportsClipboardContext:!0,supportsExceptionFilterOptions:!0,supportsEvaluationOptions:!!e,supportsDebuggerProperties:!!e,supportsSetSymbolOptions:!!e}}async _onSetBreakpoints(e){return this.breakpointManager.setBreakpoints(e,e.breakpoints?.map(()=>this.breakpointIdCounter())??[])}async setExceptionBreakpoints(e){return await this._services.get(da).setBreakpoints(e),{}}async configurationDone(){return this._configurationDoneDeferred.resolve(),{}}async _onLoadedSources(){return{sources:await this.sourceContainer.loadedSources()}}async _onDisableSourcemap(e){let t=this.sourceContainer.source(e.source);if(!t)return ce(hr.t("Source not found"));if(!(t instanceof Me))return ce(hr.t("Source not a source map"));for(let r of t.compiledToSourceUrl.keys())this.sourceContainer.disableSourceMapForSource(r,!0);return await this._thread?.refreshStackTrace(),{}}async _onSource(e){e.source||(e.source={sourceReference:e.sourceReference}),e.source.path=Pt(e.source.path);let t=this.sourceContainer.source(e.source);if(!t)return ce(hr.t("Source not found"));let r=await t.content();return r===void 0?(t instanceof Me&&this.dap.suggestDisableSourcemap({source:e.source}),ce(hr.t("Unable to retrieve source content"))):{content:r,mimeType:t.getSuggestedMimeType}}async _onThreads(){let e=[];return this._thread&&e.push({id:this._thread.id,name:this._thread.name()}),{threads:e}}findVariableStore(e){if(!this._thread)return;let t=this._thread.pausedVariables();if(t&&e(t))return t;if(e(this._thread.replVariables))return this._thread.replVariables}async _onVariables(e){return{variables:await this.findVariableStore(r=>r.hasVariable(e.variablesReference))?.getVariables(e)??[]}}async _onReadMemory(e){let t=e.memoryReference,r=await this.findVariableStore(o=>o.hasMemory(t))?.readMemory(t,e.offset??0,e.count);return r?{address:"0",data:r.toString("base64"),unreadableBytes:e.count-r.length}:{address:"0",unreadableBytes:e.count}}async _onWriteMemory(e){let t=e.memoryReference;return{bytesWritten:await this.findVariableStore(o=>o.hasMemory(t))?.writeMemory(t,e.offset??0,Buffer.from(e.data,"base64"))}}async _onSetExpression(e){if(!this._thread)throw new I(ef());let t=await this._thread.evaluate({expression:`${e.expression} = ${Yc(e.value)}`,context:"repl",frameId:e.frameId});return{value:t.result,variablesReference:t.variablesReference,indexedVariables:t.indexedVariables,namedVariables:t.namedVariables,presentationHint:t.presentationHint,type:t.type}}async _onSetVariable(e){let t=this.findVariableStore(r=>r.hasVariable(e.variablesReference));return t?(e.value=Yc(e.value.trim()),t.setVariable(e)):ce(hr.t("Variable not found"))}_withThread(e){if(!this._thread)throw new I(ef());return e(this._thread)}async _refreshStackTrace(){if(!this._thread)return;this._thread.pausedDetails()&&await this._thread.refreshStackTrace()}createThread(e,t){this._thread=new pa(this.sourceContainer,e,this.dap,t,this._services.get(gi),this._services.get(C),this._services.get(lr),this._services.get(Ju),this.launchConfig,this.breakpointManager,this._services.get(wd),this._services.get(da),this._services.get(Si),this._services.get(fi));let r=this._services.get(Dd);return r.connect(this.dap,this._thread),"profileStartup"in this.launchConfig&&this.launchConfig.profileStartup&&r.start(this.dap,this._thread,{type:Ze.type}),this._thread.updateCustomBreakpoints(this._xhrBreakpoints,this._customBreakpoints),this.asyncStackPolicy.connect(e).then(o=>this._disposables.push(o)).catch(o=>this._services.get(C).error("internal","Error enabling async stacks",o)),this.breakpointManager.setThread(this._thread),this._services.get(Ce).attach(e),this._threadDeferred.resolve(this._thread),this._thread}async setCustomBreakpoints({ids:e,xhr:t}){return await this._thread?.updateCustomBreakpoints(t,e),this._customBreakpoints=e,this._xhrBreakpoints=t,{}}async _toggleSkipFileStatus(e){return await this._services.get(wi).toggleSkippingFile(e),await this._refreshStackTrace(),{}}async _prettyPrintSource(e){if(!e.source||!this._thread)return{canPrettyPrint:!1};e.source.path=Pt(e.source.path);let t=this.sourceContainer.source(e.source);if(!t)return ce(hr.t("Source not found"));let r=await t.prettyPrint();if(!r)return ce(hr.t("Unable to pretty print"));let{map:o,source:n}=r;return await this.breakpointManager.moveBreakpoints(this._thread,t,o,n),this.sourceContainer.clearDisabledSourceMaps(t),await this._refreshStackTrace(),{}}onEvaluate(e){return e.expression===".scripts"?this._dumpDiagnostics({fromSuggestion:!1}).then(this.dap.openDiagnosticTool).then(()=>({result:"Opening diagnostic tool...",variablesReference:0})):this._withThread(t=>t.evaluate(e))}async _dumpDiagnostics(e){let t={file:await this._services.get(xi).generateHtml()};return e.fromSuggestion&&this._services.get(at).report("diagnosticPrompt",{event:"opened"}),t}async _requestCDPProxy(){return await this._cdpProxyProvider.proxy()}dispose(){this._disposables.dispose(),yu(this._services)}}});var HD,zS,zD,HS,GS,JS=m(()=>{"use strict";ze();O();HD={connect:async()=>fs},zS=i=>({async connect(e){return await e.Debugger.setAsyncCallStackDepth({maxDepth:i}),fs}}),zD=i=>{let e=new S,t=!1,r=()=>{t||(t=!0,e.fire())};return{async connect(o){if(t)return await o.Debugger.setAsyncCallStackDepth({maxDepth:i}),fs;let n=new j;return n.push(e.event(()=>{n.dispose(),o.Debugger.setAsyncCallStackDepth({maxDepth:i})}),o.Debugger.on("breakpointResolved",r),o.Debugger.on("paused",s=>{s.reason!=="instrumentation"&&r()})),n}}},HS=zS(32),GS=i=>i===!1?HD:i===!0?HS:"onAttach"in i?zS(i.onAttach):"onceBreakpointResolved"in i?zD(i.onceBreakpointResolved):HS});var KS,QS,Ld,XS=m(()=>{"use strict";KS=require("inspector"),QS=require("fs"),Ld=class{constructor(e){this.file=e;this.session=new KS.Session;this.session.connect()}async start(){try{await this.post("Profiler.enable")}catch{}await this.post("Profiler.start")}async stop(){let{profile:e}=await this.post("Profiler.stop");await QS.promises.writeFile(this.file,JSON.stringify(e))}dispose(){this.session.disconnect()}post(e,t){return new Promise((r,o)=>this.session.post(e,t,(n,s)=>{n?o(n):r(s)}))}}});var Ml,YS,bh=m(()=>{"use strict";O();Ml=Symbol("MutableLaunchConfig"),YS=i=>{let e=new S;return new Proxy({},{ownKeys(){return Object.keys(i)},get(t,r){switch(r){case"update":return o=>{i=o,e.fire()};case"onChange":return e.event;default:return i[r]}}})}});var Nl,_d,ZS=m(()=>{"use strict";Nl=class{toDap(){return{category:"console",output:"\x1B[2J"}}},_d=class{toDap(){return{category:"stdout",output:"",group:"end"}}}});var Ed,eI,tI,rI,wh,oI=m(()=>{"use strict";O();Ed=class{constructor(e){this.sink=e;this.q=[];this.disposed=!1;this.onDrainedEmitter=new S;this.onDrained=this.onDrainedEmitter.event}get length(){return this.q.length}enqueue(e){this.disposed||(this.q.push(new wh(e)),this.q.length===1&&this.process())}dispose(){this.disposed=!0,this.q=[]}async process(){let e=this.q.findIndex(t=>t.value===tI);e===0?await this.q[0].wait:e===-1?(this.sink(eI(this.q)),this.q=[]):(this.sink(eI(this.q.slice(0,e))),this.q=this.q.slice(e)),this.q.length?this.process():this.onDrainedEmitter.fire()}},eI=i=>i.map(e=>e.value).filter(e=>e!==rI),tI=Symbol("unsettled"),rI=Symbol("unsettled"),wh=class{constructor(e){this.value=tI;e instanceof Promise?this.wait=e.then(t=>{this.value=t},()=>{this.value=rI}):(this.value=e,this.wait=Promise.resolve())}}});var Bl,GD,fa,iI=m(()=>{"use strict";Bl=require("inversify");M();Lr();pl();ZS();oI();th();GD=new Set(["group","assert","count"]),fa=class{constructor(e,t){this.dap=e;this.isDirty=!1;this.queue=new Ed(e=>{for(let t of e)this.dap.output(t)});this.onDrained=this.queue.onDrained;t.register(0,async()=>{this.length&&await new Promise(r=>this.onDrained(r)),this.dispose()})}get length(){return this.queue.length}dispose(){this.queue.dispose()}dispatch(e,t){let r=this.parse(t);r&&this.enqueue(e,r)}enqueue(e,t){if(!(t instanceof Nl))this.isDirty=!0;else if(this.isDirty)this.isDirty=!1;else return;this.queue.enqueue(t.toDap(e))}parse(e){if(e.type==="log"){let t=e.stackTrace?.callFrames[0];if(t&&t.url==="internal/console/constructor.js"&&GD.has(t.functionName))return}switch(e.type){case"clear":return new Nl;case"endGroup":return new _d;case"assert":return new dd(e);case"table":return new bd(e);case"startGroup":case"startGroupCollapsed":return new hd(e);case"debug":case"log":case"info":return new Pi(e);case"trace":return new md(e);case"error":return new fd(e);case"warning":return new gd(e);case"dir":case"dirxml":return new Pi(e);case"count":return new Pi(e);case"profile":case"profileEnd":return new Pi(e);case"timeEnd":return new Pi(e);default:try{Dp(e.type,"unknown console message type")}catch{}}}};fa=f([(0,Bl.injectable)(),u(0,(0,Bl.inject)(At)),u(1,(0,Bl.inject)(fi))],fa)});var sI,Ad,nI,ha,aI=m(()=>{"use strict";sI=w(require("@vscode/l10n")),Ad=require("inversify");Lr();nI="@vscode/dwarf-debugging",ha=class{constructor(e){this.dap=e;this.didPrompt=!1}async load(){try{return await import(nI)}catch{return}}prompt(){this.didPrompt||(this.didPrompt=!0,this.dap.output({output:sI.t("You may install the `{}` module via npm for enhanced WebAssembly debugging",nI),category:"console"}))}};ha=f([(0,Ad.injectable)(),u(0,(0,Ad.inject)(At))],ha)});var ba,Fd=m(()=>{"use strict";ba=Symbol("IRequestOptionsProvider")});var cI,lI,Md,_n,jt,Nd=m(()=>{"use strict";cI=require("data-uri-to-buffer"),lI=require("dns"),Md=w(require("got")),_n=require("inversify");il();Ve();ze();N();H();Fd();jt=class{constructor(e,t){this.fs=e;this.options=t;this.autoLocalhostPortFallbacks={}}async fetch(e,t=Ne,r){try{let n=(0,cI.dataUriToBuffer)(e);return{ok:!0,url:e,body:new TextDecoder().decode(n.buffer),statusCode:200}}catch{}let o=ht(e)?e:De(e);if(o)try{return{ok:!0,url:e,body:await this.fs.readFile(o,"utf-8"),statusCode:200}}catch(n){return{ok:!1,url:e,error:n,statusCode:200}}return this.fetchHttp(e,t,r)}async fetchJson(e,t,r){let o=await this.fetch(e,t,{Accept:"application/json",...r});if(!o.ok)return o;try{return{...o,body:JSON.parse(o.body)}}catch(n){return{...o,ok:!1,url:e,error:n}}}async fetchHttp(e,t,r){let o=new URL(e),n=o.protocol!=="http:",s=Number(o.port)??(n?443:80),a={headers:r,followRedirect:!0};n&&await Ps(e)&&(a.rejectUnauthorized=!1),this.options?.provideOptions(a,e);let c=o.hostname==="localhost";if(c&&this.autoLocalhostPortFallbacks[s]){let d=await this.requestHttp(o.toString(),a,t);return d.statusCode!==503?d:(delete this.autoLocalhostPortFallbacks[s],this.requestHttp(e,a,t))}let p=await this.requestHttp(e,a,t);if(p.statusCode===503&&c){let d;try{d=await lI.promises.lookup(o.hostname)}catch{return p}o.hostname=d.family===6?"127.0.0.1":"[::1]",p=await this.requestHttp(o.toString(),a,t),p.statusCode!==503&&(this.autoLocalhostPortFallbacks[s]=o.hostname)}return p}async requestHttp(e,t,r){this.options?.provideOptions(t,e);let o=new j;try{let n=(0,Md.default)(e,t);o.push(r.onCancellationRequested(()=>n.cancel()));let s=await n;return{ok:!0,url:e,body:s.body,statusCode:s.statusCode}}catch(n){if(!(n instanceof Md.RequestError))throw n;let s=n.response?String(n.response?.body):n.message,a=n.response?.statusCode??503;return{ok:!1,body:s,statusCode:a,url:e,error:new mu(a,e,s)}}finally{o.dispose()}}};jt=f([(0,_n.injectable)(),u(0,(0,_n.inject)(G)),u(1,(0,_n.optional)()),u(1,(0,_n.inject)(ba))],jt)});var br,En,pI=m(()=>{"use strict";br=require("inversify");We();ze();_();H();ki();Nd();Fd();En=class extends jt{constructor(t,r,o,n,s){super(t,s);this.logger=r;this.target=o;this.cdp=n;this.disposables=new j}dispose(){this.disposables.dispose()}async fetchHttp(t,r,o={}){let n=await super.fetchHttp(t,r,o);return n.ok?n:(this.logger.info("runtime","Network load failed, falling back to CDP",{url:t,res:n}),this.fetchOverBrowserNetwork(t,n))}async fetchOverBrowserNetwork(t,r){if(!this.cdp)return r;let o=await this.cdp.Network.loadNetworkResource({frameId:this.target?.targetInfo.targetId,url:t,options:{includeCredentials:!0,disableCache:!0}});if(!o||!o.resource.success||!o.resource.httpStatusCode||o.resource.httpStatusCode>=400||!o.resource.stream)return r;let n=Number(o.resource.headers?.["Content-Length"]);isNaN(n)&&(n=1/0);let s=[],a=0;for(;;){let c=await this.cdp.IO.read({handle:o.resource.stream,offset:a});if(!c)return this.logger.info("runtime","Stream error encountered in middle, falling back",{url:t}),r;let l=c.base64Encoded?Buffer.from(c.data,"base64").toString():c.data;if(a+=Buffer.byteLength(l,"utf-8"),s.push(l),a>=n){this.cdp.IO.close({handle:o.resource.stream});break}if(c.eof)break}return{ok:!0,body:s.join(""),statusCode:o.resource.httpStatusCode,url:t}}};En=f([(0,br.injectable)(),u(0,(0,br.inject)(G)),u(1,(0,br.inject)(C)),u(2,(0,br.optional)()),u(2,(0,br.inject)(io)),u(3,(0,br.optional)()),u(3,(0,br.inject)(xe)),u(4,(0,br.optional)()),u(4,(0,br.inject)(ba))],En)});var Ri,yh=m(()=>{"use strict";Ri="node:"});function dI(i){let e=[];for(let t=0;t<i.length;t++){let r=i[t];if(r.startsWith("!")){let o=uI(r.slice(1));for(let n=0;n<e.length;n++)e[n]=`^(?!${o.slice(1)})${e[n].slice(1)}`}else e.push(uI(r))}return e.map(t=>new RegExp(t,"i"))}function uI(i){let e=i.split("/"),t=[];for(let r=0;r<e.length;r++){let o=e[r];if(o==="**")r===0?t.push("(.+/)?"):r===e.length-1||t.push(".*/");else{if(o.includes("*")){let n=o.split("*");t.push(n.map(s=>nt(s)).join("[^\\/]*"))}else t.push(nt(o));t.push(r<e.length-1?"\\/":"$")}}return`^${t.join("")}`}var mI=m(()=>{"use strict";Rr()});function JD(i){let e=/^<node_internals>[\/\\](.*)$/,t=i.map(r=>{r=r.trim();let o=e.exec(r);return o?o[1]:null}).filter(Ae);return t.length>0?t:void 0}function KD(i,e){return e.filter(r=>!r.includes("<node_internals>")).map(r=>ht(r)?Do(i.rebaseLocalToRemote(r)):B(r)).map(Yp)}function fI(i){let e=i.parent();return e?fI(e):i}var Di,gI,no,hI=m(()=>{"use strict";Di=require("inversify"),gI=w(require("micromatch"));We();ys();O();_();yh();M();ee();U();Ft();Rr();N();$();ki();Dr();Ke();mI();no=class{constructor({skipFiles:e},t,r,o,n){this.logger=r;this.cdp=o;this._regexForAuthored=sw(dI);this._scriptsWithSkipping=new Set;this._targetId=n.id(),this._rootTargetId=fI(n).id(),this._isUrlFromSourceMapSkipped=new ft(s=>this._normalizeUrl(s)),this._authoredGlobs=KD(t,e),this._nodeInternalsGlobs=JD(e),this._initNodeInternals(n),this._updateSkippedDebounce=cw(500,()=>this._updateGeneratedSkippedSources()),e.length&&this._updateGeneratedSkippedSources(),no.sharedSkipsEmitter.event(s=>{s.rootTargetId===this._rootTargetId&&s.targetId!==this._targetId&&this._toggleSkippingFile(s.params)})}setSourceContainer(e){this._sourceContainer=e}_testSkipNodeInternal(e){return this._nodeInternalsGlobs?(e.startsWith(Ri)&&(e=e.slice(Ri.length)),(0,gI.default)([e],this._nodeInternalsGlobs).length>0):!1}_testSkipAuthored(e){return this._regexForAuthored(this._authoredGlobs).some(t=>t.test(e))}_isNodeInternal(e,t){return e.startsWith(Ri)?!0:t?.has(e)||/^internal\/.+\.js$/.test(e)}async _updateGeneratedSkippedSources(){let e=this._regexForAuthored(this._authoredGlobs).map(r=>r.source),t=this._allNodeInternals?.settledValue;if(t){e.push(`^(${Ri})?internal\\/`);for(let r of t)this._testSkipNodeInternal(r)&&e.push(`^(${Ri})?${nt(r)}$`)}await this.cdp.Debugger.setBlackboxPatterns({patterns:e})}_normalizeUrl(e){return B(e.toLowerCase())}isScriptSkipped(e){return this._isNodeInternal(e,this._allNodeInternals?.settledValue)?this._testSkipNodeInternal(e):(e=this._normalizeUrl(e),this._isUrlFromSourceMapSkipped.get(e)===!0?!0:this._testSkipAuthored(e))}async _updateSourceWithSkippedSourceMappedSources(e,t){let r=this.isScriptSkipped(e.url),o=[],n=r;for(let a of e.sourceMap.sourceByUrl.values()){let c=this.isScriptSkipped(a.url);if(typeof c>"u"&&(c=r),c!==n){let l=await this._sourceContainer.currentSiblingUiLocations({source:a,lineNumber:1,columnNumber:1},e);l[0]?(o.push({lineNumber:l[0].lineNumber-1,columnNumber:l[0].columnNumber-1}),n=!n):this.logger.error("internal","Could not map script beginning for "+a.sourceReference)}}let s=t;o.length||(s=s.filter(a=>this._scriptsWithSkipping.has(a.scriptId)),s.forEach(a=>this._scriptsWithSkipping.delete(a.scriptId))),await Promise.all(s.map(({scriptId:a})=>this.cdp.Debugger.setBlackboxedRanges({scriptId:a,positions:o})))}initializeSkippingValueForSource(e){this._initializeSkippingValueForSource(e)}_initializeSkippingValueForSource(e,t=e.scripts){let r=e.url,o=this.isScriptSkipped(r);if(!o&&e.absolutePath&&this._testSkipAuthored(W(e.absolutePath))&&(this.setIsUrlBlackboxSkipped(r,!0),o=!0,this._updateSkippedDebounce()),kt(e)){if(o)for(let n of e.sourceMap.sourceByUrl.values())this._isUrlFromSourceMapSkipped.set(n.url,!0);for(let n of e.sourceMap.sourceByUrl.values())this._initializeSkippingValueForSource(n,t);this._updateSourceWithSkippedSourceMappedSources(e,t)}}async _initNodeInternals(e){if(e.type()!=="node"||!this._nodeInternalsGlobs||this._allNodeInternals)return;let t=this._allNodeInternals=ne(),r=await this.cdp.Runtime.evaluate({expression:"require('module').builtinModules"+Pe(),returnByValue:!0,includeCommandLineAPI:!0});r&&!r.exceptionDetails?t.resolve(new Set(r.result.value.map(o=>o+".js"))):t.resolve(new Set),await this._updateGeneratedSkippedSources()}async _toggleSkippingFile(e){let t;e.resource&&ht(e.resource)&&(t=e.resource);let r={path:t,sourceReference:e.sourceReference},o=this._sourceContainer.source(r);if(!o)return{};let n=!this.isScriptSkipped(o.url);if(o instanceof Me){this._isUrlFromSourceMapSkipped.set(o.url,n);let s=Array.from(o.compiledToSourceUrl.keys());await Promise.all(s.map(a=>this._updateSourceWithSkippedSourceMappedSources(a,a.scripts)))}else{if(kt(o))for(let s of o.sourceMap.sourceByUrl.values())this._isUrlFromSourceMapSkipped.set(s.url,n);this.setIsUrlBlackboxSkipped(o.url,n),await this._updateGeneratedSkippedSources()}return{}}setIsUrlBlackboxSkipped(e,t){let r=e,o=`!${r}`,n=this._authoredGlobs.filter(s=>s!==r&&s!==o);this._regexForAuthored(n).some(s=>s.test(e))!==t&&(n.push(t?r:o),this._regexForAuthored.clear()),this._authoredGlobs=n}async toggleSkippingFile(e){let t=await this._toggleSkippingFile(e);return no.sharedSkipsEmitter.fire({params:e,rootTargetId:this._rootTargetId,targetId:this._targetId}),t}};no.sharedSkipsEmitter=new S,no=f([(0,Di.injectable)(),u(0,(0,Di.inject)(X)),u(1,(0,Di.inject)(ge)),u(2,(0,Di.inject)(C)),u(3,(0,Di.inject)(xe)),u(4,(0,Di.inject)(io))],no)});var Ol,wI,bI,QD,wa,Li,jl=m(()=>{"use strict";Ol=require("inversify");dl();Ws();M();wI=require("path"),bI=/^webpack:\/{3}([^/]+?\.vue)(\?[0-9a-z]*)?$/i,QD=/^webpack:\/{3}\.\/.+\.vue\?[0-9a-z]+$/i,wa=Symbol("IVueFileMapper"),Li=class{constructor(e,t){this.files=e;this.search=t;this.getMapping=F(async()=>{let e=new Map;return await this.search.streamAllChildren(this.files,t=>e.set((0,wI.basename)(t),t)),e})}async lookup(e){let t=bI.exec(e);return t?(await this.getMapping()).get(t[1]):void 0}getVueHandling(e){return this.files.empty?0:bI.test(e)?1:QD.test(e)?2:0}};Li=f([(0,Ol.injectable)(),u(0,(0,Ol.inject)(Ao)),u(1,(0,Ol.inject)(Vs))],Li)});var so,Ul=m(()=>{"use strict";O();so=class{constructor(){this.changeEmitter=new S;this.addEmitter=new S;this.removeEmitter=new S;this.targetMap=new Map;this.onChanged=this.changeEmitter.event;this.onAdd=this.addEmitter.event;this.onRemove=this.removeEmitter.event}get size(){return this.targetMap.size}add(e,t){this.targetMap.set(e,t),this.addEmitter.fire([e,t]),this.changeEmitter.fire()}get(e){return this.targetMap.get(e)}remove(e){let t=this.targetMap.get(e);return t===void 0?!1:(this.targetMap.delete(e),this.removeEmitter.fire([e,t]),this.changeEmitter.fire(),!0)}value(){return this.targetMap.values()}}});function Bd(i,e,t){return new Promise((r,o)=>{let n=(0,yI.spawn)(i,e,{...t,stdio:"pipe"}),s=[],a=[];n.stderr.on("data",l=>s.push(l)),n.stdout.on("data",l=>a.push(l));let c=(l,p)=>o(new An(i,Buffer.concat(s).toString(),Buffer.concat(a).toString(),l,p));n.on("error",l=>c(void 0,l)),n.on("close",l=>l?c(l):r({stdout:Buffer.concat(a).toString(),stderr:Buffer.concat(s).toString()}))})}var yI,An,Od=m(()=>{"use strict";yI=require("child_process"),An=class i extends Error{constructor(t,r,o,n,s){super(`${t} exited with code ${n||-1}: ${r}`);this.command=t;this.stderr=r;this.stdout=o;this.code=n;this.innerError=s}static fromExeca(t){return new i(t.command,t.stderr.toString(),t.stdout.toString(),t.exitCode)}}});var SI,jd,XD,vI,ya,_i,Wl=m(()=>{"use strict";SI=w(require("default-browser")),jd=require("inversify");H();Od();M();XD=new Map([["chrome",0],["safari",1],["firefox",2],["msedge",3],["microsoft edge",3],["appxq0fevzme2pys62n3e0fbqa7peapykr8v",4],["ie.http",5]]),vI=i=>{i=i.toLowerCase();for(let[e,t]of XD.entries())if(i.includes(e))return t},ya=Symbol("IDefaultBrowserProvider"),_i=class{constructor(e,t=process.platform){this.execa=e;this.platform=t;this.lookup=F(()=>this.platform==="win32"?this.lookupWindows():this.lookupUnix())}async lookupUnix(){let{name:e}=await(0,SI.default)();return vI(e)}async lookupWindows(){let e=await this.execa("reg",["QUERY"," HKEY_CURRENT_USER\\Software\\Microsoft\\Windows\\Shell\\Associations\\UrlAssociations\\http\\UserChoice","/v","ProgId"]);if(e.failed)throw An.fromExeca(e);let t=/ProgId\s*REG_SZ\s*(\S+)/.exec(e.stdout);if(t)return vI(t[1])}};_i=f([(0,jd.injectable)(),u(0,(0,jd.inject)(ll))],_i)});var Ud,II=m(()=>{"use strict";_();Ud=class{async setup(){}dispose(){}write(e){if(e.level>2)throw new Error(e.message);console.log(JSON.stringify(e))}}});var PI,Wd,Sh,E,YD,Er=m(()=>{"use strict";PI=require("inversify"),Wd=w(require("os"));_();$();II();Sh=class{constructor(e=512){this.size=e;this.items=[];this.i=0}write(e){this.items[this.i]=e,this.i=(this.i+1)%this.size}read(){return this.items.slice(this.i).concat(this.items.slice(0,this.i))}},E=class{constructor(){this.logTarget={queue:[]};this.logBuffer=new Sh}static async test(){let e=new E;return e.setup({sinks:[new Ud],showWelcome:!1}),e}info(e,t,r){this.log({tag:e,timestamp:Date.now(),message:t,metadata:r,level:1})}verbose(e,t,r){this.log({tag:e,timestamp:Date.now(),message:t,metadata:r,level:0})}warn(e,t,r){this.log({tag:e,timestamp:Date.now(),message:t,metadata:r,level:2})}error(e,t,r){this.log({tag:e,timestamp:Date.now(),message:t,metadata:r,level:3})}fatal(e,t,r){this.log({tag:e,timestamp:Date.now(),message:t,metadata:r,level:4})}assert(e,t){if(e===!1||e===void 0||e===null){if(this.error("runtime.assertion",t,{error:new Error("Assertion failed")}),process.env.JS_DEBUG_THROW_ASSERTIONS)throw new Error(t);debugger;return!1}return!0}log(e){if(this.logBuffer.write(e),"queue"in this.logTarget){this.logTarget.queue.push(e);return}for(let t of this.logTarget.sinks)t.write(e)}getRecentLogs(){return this.logBuffer.read()}dispose(){if("sinks"in this.logTarget){for(let e of this.logTarget.sinks)e.dispose();this.logTarget={queue:[]}}}forTarget(){return this}async setup(e){if(await Promise.all(e.sinks.map(r=>r.setup())),e.showWelcome!==!1){let r=YD();for(let o of e.sinks)o.write(r)}let t=this.logTarget;this.logTarget={sinks:e.sinks.slice()},"sinks"in t?t.sinks.forEach(r=>r.dispose()):t.queue.forEach(r=>this.log(r))}};E.null=(()=>{let e=new E;return e.setup({sinks:[]}),e})(),E=f([(0,PI.injectable)()],E);YD=()=>({timestamp:Date.now(),tag:"runtime.welcome",level:1,message:`${uu} v${cn} started`,metadata:{os:`${Wd.platform()} ${Wd.arch()}`,nodeVersion:process.version,adapterVersion:cn}})});var Fn,Ei,Ih=m(()=>{"use strict";Fn=Symbol("touched");(c=>{function i(){return{children:{},[Fn]:1}}c.root=i;function e(l,p){return l[Fn]=1,a(l,s(p),0)}c.getPath=e;function t(l){l[Fn]=1}c.touch=t;function r(l){l[Fn]=2}c.touchAll=r;function o(l,p){let d=l.children[p]??={children:{}};return d[Fn]=1,d}c.getOrMakeChild=o;function n(l){if(l[Fn]){for(let[p,d]of Object.entries(l.children))switch(d[Fn]){case 1:n(d);break;case 2:break;default:delete l.children[p]}return l}}c.prune=n;function s(l){let p=l.split(/\/|\\/);return p[0]===""&&p.unshift(),p}function a(l,p,d){let b=o(l,p[d]);return d===p.length-1?b:a(b,p,d+1)}})(Ei||={})});var Ph,kh,Mn,kI,ZD,Vd,xI=m(()=>{"use strict";Ph=require("fs"),kh=w(require("micromatch")),Mn=require("path"),kI=w(require("to-absolute-glob"));O();M();ee();Ih();ZD=/\//g,Vd=class{constructor(e){this.stat=ko(e=>Ph.promises.lstat(e));this.readdir=ko(e=>Ph.promises.readdir(e,{withFileTypes:!0}));this.alreadyProcessedFiles=new Set;this.fileEmitter=new S;this.onFile=this.fileEmitter.event;this.errorEmitter=new S;this.onError=this.errorEmitter.event;this.processor=e.fileProcessor,this.filter=e.filter,this.ignore=e.ignore.map(o=>kh.default.matcher((0,kI.default)(B(o),{cwd:e.cwd})));let t=(0,Mn.isAbsolute)(e.pattern)?(0,Mn.relative)(e.cwd,e.pattern):e.pattern,r=kh.default.parse(B(t),{ignore:e.ignore,cwd:e.cwd,expand:!0});this.done=Promise.all(r.map(o=>{let n=[];for(let l=1;l<o.tokens.length;){let p=l+1;for(;p<o.tokens.length&&o.tokens[p].type!=="slash";)p++;let d=o.tokens[l];d.type==="globstar"?n.push("**"):p===l+1&&d.type==="text"?n.push(d.value):n.push(new RegExp("^"+o.tokens.slice(l,p).map(b=>b.output||b.value).join("")+"$")),l=p+1}let s=n[0]==="**"?[0,1]:[0],a=Ei.getPath(e.cache,e.cwd),c={elements:n,seen:new Set};return Promise.all(s.map(l=>this.readSomething(c,l,e.cwd,[],a)))})).then(()=>{})}async readSomething(e,t,r,o,n){if(this.alreadyProcessedFiles.has(n))return;let s=`${t}:${r}`;if(e.seen.has(s))return;e.seen.add(s);let a;try{a=await this.stat(r)}catch(l){this.errorEmitter.fire({path:r,error:l});return}if(this.alreadyProcessedFiles.has(n))return;let c=n.data;if(c&&a.mtimeMs===c.mtime){if(c.type===0){let l=[],d=Object.entries(n.children).filter(([,b])=>b.data?.type!==0).map(([b])=>b);for(let[b,y]of Object.entries(n.children))l.push(y.data!==void 0?this.handleDirectoryEntry(e,t,r,{name:b,type:y.data.type},d,n):this.stat(r).then(v=>this.handleDirectoryEntry(e,t,r,{name:b,type:v.isFile()?1:0},d,n),()=>{}));await Promise.all(l)}else c.type===1&&(this.alreadyProcessedFiles.add(n),this.fileEmitter.fire(c.extracted));return}a.isDirectory()?await this.handleDir(e,t,a.mtimeMs,r,n):(this.alreadyProcessedFiles.add(n),await this.handleFile(a.mtimeMs,r,o,n))}applyFilterToFile(e,t,r){let o=r.children[e];if(this.alreadyProcessedFiles.has(o))return!1;if(!this.filter)return!0;let n=o.data?.type===1?o.data.extracted:void 0;return Ei.touch(o),this.filter(t,n)}handleDirectoryEntry(e,t,r,o,n,s){let a=r+"/"+o.name,c=this.getDirectoryReadDescends(e,t,r,o);if(c===void 0)return;let l=Ei.getOrMakeChild(s,o.name);if(!(o.type===1&&!this.applyFilterToFile(o.name,a,s)))return typeof c=="number"?this.readSomething(e,t+c,a,n,l):Promise.all(c.map(p=>this.readSomething(e,t+p,a,n,l)))}getDirectoryReadDescends(e,t,r,o){let n=r+"/"+o.name;if(this.ignore.some(c=>c(n)))return;let s=t===e.elements.length-1,a=e.elements[t];if(a==="**")return o.type===1?s?0:this.getDirectoryReadDescends(e,t+1,r,o):s?0:[0,1];if((a instanceof RegExp&&a.test(o.name)||a===o.name)&&(o.type===0?!s:s))return 1}async handleFile(e,t,r,o){let n=Mn.sep==="/"?t:t.replace(ZD,Mn.sep),s;try{s=await this.processor(n,{siblings:r,mtime:e})}catch(a){this.errorEmitter.fire({path:n,error:a});return}o.data={type:1,mtime:e,extracted:s},this.fileEmitter.fire(s)}async handleDir(e,t,r,o,n){let s;try{s=await this.readdir(o)}catch(l){this.errorEmitter.fire({path:o,error:l});return}let a=[],c=s.filter(l=>l.isFile()).map(l=>l.name);for(let l of s){if(l.name.startsWith("."))continue;let p;if(l.isDirectory())p=0;else if(l.isFile())p=1;else continue;a.push(this.handleDirectoryEntry(e,t,o,{name:l.name,type:p},c,n))}await Promise.all(a),n.data={type:0,mtime:r}}}});var CI,$d,Ai,xh=m(()=>{"use strict";CI=w(require("glob-stream")),$d=require("inversify");_();M();ee();Ih();dl();xI();Ai=class{constructor(e){this.logger=e}async streamAllChildren(e,t){let r=[];return await this.globForFiles(e,n=>r.push(t(K(n.path)))),(await Promise.all(r)).filter(n=>n!==void 0)}async streamChildrenWithSourcemaps(e){let t=[],r=e.lastState||{},o={};return await Promise.all([...e.files.explode()].map(async s=>{let a=JSON.stringify(s),c=r[a]||Ei.root();await this._streamChildrenWithSourcemaps(c,e,t,s);let l=Ei.prune(c);l&&(o[a]=l)})),this.logger.info("sourcemap.parsing",`turboGlobStream search found ${t.length} files`),{values:(await Promise.all(t)).filter(Ae),state:o}}async _streamChildrenWithSourcemaps(e,t,r,o){let n=new Vd({pattern:o.pattern,ignore:o.negations,cwd:o.cwd,cache:e,filter:t.filter,fileProcessor:(s,a)=>zy(s,a).then(c=>c&&t.processMap(c))});n.onError(({path:s,error:a})=>{this.logger.warn("sourcemap.parsing","Error parsing source map",{error:a,path:s})}),n.onFile(s=>s&&r.push(t.onProcessedMap(s))),await n.done}async globForFiles(e,t){await Promise.all([...e.explode()].map(r=>new Promise((o,n)=>(0,CI.default)([r.pattern,"!**/*.asar/**"],{ignore:r.negations,matchBase:!0,cwd:r.cwd}).on("data",t).on("finish",o).on("error",n))))}};Ai=f([(0,$d.injectable)(),u(0,(0,$d.inject)(C))],Ai)});function Ch(i,e){return i.length<=e?i:i.substr(0,e-1)+"\u2026"}function eL(i){let e;try{e=new TI.URL(i)}catch{return Ch(i,20)}if(e.protocol==="data")return Ch(i,20);if(e.protocol==="blob"||i==="about:blank")return i;let t=RI.basename(e.pathname);return t||(t=(e.host||"")+"/"),t==="/"&&(t=Ch(i,20)),t}var TI,RI,qd,Th,DI=m(()=>{"use strict";TI=require("url"),RI=w(require("path"));O();qd=class{constructor(){this._onFrameAddedEmitter=new S;this._onFrameRemovedEmitter=new S;this._onFrameNavigatedEmitter=new S;this.onFrameAdded=this._onFrameAddedEmitter.event;this.onFrameRemoved=this._onFrameRemovedEmitter.event;this.onFrameNavigated=this._onFrameNavigatedEmitter.event;this._frames=new Map}attached(e,t){e.Page.enable({}),e.Page.getResourceTree({}).then(r=>{this._processCachedResources(e,r?r.frameTree:void 0,t)})}mainFrame(){return this._mainFrame}_processCachedResources(e,t,r){t&&this._addFramesRecursively(e,t,t.frame.parentId,r),e.Page.on("frameAttached",o=>{this._frameAttached(e,r,o.frameId,o.parentFrameId)}),e.Page.on("frameNavigated",o=>{this._frameNavigated(e,r,o.frame)}),e.Page.on("frameDetached",o=>{this._frameDetached(e,r,o.frameId)})}_addFrame(e,t,r){let o=new Th(this,e,t,r);return this._frames.set(o.id,o),o.isMainFrame()&&(this._mainFrame=o),this._onFrameAddedEmitter.fire(o),o}_frameAttached(e,t,r,o){let n=this._frames.get(r);return n||(n=this._addFrame(e,r,o)),n._ref(t),n}_frameNavigated(e,t,r){let o=this._frames.get(r.id);o||(o=this._frameAttached(e,t,r.id,r.parentId)),o._navigate(r,t),this._onFrameNavigatedEmitter.fire(o)}_frameDetached(e,t,r){let o=this._frames.get(r);o&&o._unref(t)}frameForId(e){return this._frames.get(e)}frames(){return Array.from(this._frames.values())}_addFramesRecursively(e,t,r,o){let n=t.frame,s=this._frames.get(n.id);s?(s._navigate(n,o),this._onFrameNavigatedEmitter.fire(s)):(s=this._addFrame(e,n.id,r),s._navigate(n,o));for(let a=0;t.childFrames&&a<t.childFrames.length;++a)this._addFramesRecursively(e,t.childFrames[a],s.id,o)}},Th=class{constructor(e,t,r,o){this._targets=new Set;this.cdp=t,this.model=e,this._parentFrameId=o,this.id=r,this._url=""}_ref(e){this._targets.add(e)}_navigate(e,t){this._name=e.name,this._url=e.url,this._securityOrigin=e.securityOrigin,this._unreachableUrl=e.unreachableUrl||"",this._ref(t),this._unrefChildFrames(t)}name(){return this._name||""}url(){return this._url}securityOrigin(){return this._securityOrigin}unreachableUrl(){return this._unreachableUrl}isMainFrame(){return!this._parentFrameId}parentFrame(){return this._parentFrameId?this.model.frameForId(this._parentFrameId):void 0}childFrames(){return this.model.frames().filter(e=>e._parentFrameId===this.id)}_unrefChildFrames(e){for(let t of this.childFrames())t._unref(e)}_unref(e){this._targets.delete(e),!this._targets.size&&(this._unrefChildFrames(e),this.model._frames.delete(this.id),this.model._onFrameRemovedEmitter.fire(this))}displayName(){return this._name?this._name:eL(this._url)||`<iframe ${this.id}>`}}});var LI,Rh,Dh,Hd,_I=m(()=>{"use strict";O();LI=require("url"),Rh=class{constructor(e){this.versions=new Map;this.id=e.registrationId,this.scopeURL=e.scopeURL}},Dh=class{constructor(e,t){this.revisions=[];this.registration=e,this.id=t.versionId,this.scriptURL=t.scriptURL,this._targetId=t.targetId,this._status=t.status,this._runningStatus=t.runningStatus}addRevision(e){this._targetId&&e.targetId&&this._targetId!==e.targetId&&console.error(`${this._targetId} !== ${e.targetId}`),e.targetId&&(this._targetId=e.targetId),this._status=e.status,this._runningStatus=e.runningStatus,this.revisions.unshift(e)}status(){return this._status}runningStatus(){return this._runningStatus}targetId(){return this._targetId}label(){let e=new LI.URL(this.registration.scopeURL),t=e.pathname.substr(1);t.endsWith("/")&&(t=t.substring(0,t.length-1));let r=t||`${e.host}`,o=this._status==="activated"?"":` ${this._status}`,n=this._runningStatus==="running"?"":` ${this._runningStatus}`;return`${r} #${this.id}${o}${n}`}},Hd=class i{constructor(e){this._registrations=new Map;this._versions=new Map;this._onDidChangeUpdater=new S;this.onDidChange=this._onDidChangeUpdater.event;this._targets=new Set;this._frameModel=e,i._instances.add(this)}static{this._instances=new Set}dispose(){i._instances.delete(this)}attached(e){this._targets.add(e),!this._cdp&&(this._cdp=e,e.ServiceWorker.enable({}),e.ServiceWorker.on("workerRegistrationUpdated",t=>this._workerRegistrationsUpdated(t.registrations)),e.ServiceWorker.on("workerVersionUpdated",t=>this._workerVersionsUpdated(t.versions)),i._mode!=="normal"&&this.setMode(i._mode))}async detached(e){this._targets.delete(e)}version(e){return this._versions.get(e)}registrations(){let e=[],t=this._frameModel.frames().map(r=>r.url());for(let r of this._registrations.values())for(let o of t)if(o.startsWith(r.scopeURL)){e.push(r);break}return e}registration(e){return this._registrations.get(e)}_workerVersionsUpdated(e){for(let t of e){let r=this._registrations.get(t.registrationId);if(!r)continue;let o=r.versions.get(t.versionId);o||(o=new Dh(r,t),r.versions.set(t.versionId,o)),t.targetId&&this._versions.set(t.targetId,o),o.addRevision(t),o.status()==="redundant"&&o.runningStatus()==="stopped"&&(t.targetId&&this._versions.delete(t.targetId),r.versions.delete(o.id))}this._onDidChangeUpdater.fire()}_workerRegistrationsUpdated(e){for(let t of e)if(t.isDeleted){if(!this._registrations.has(t.registrationId))debugger;this._registrations.delete(t.registrationId)}else{if(this._registrations.has(t.registrationId))return;this._registrations.set(t.registrationId,new Rh(t))}this._onDidChangeUpdater.fire()}static setModeForAll(e){i._mode=e;for(let t of i._instances)t.setMode(e)}setMode(e){if(this._cdp){this._cdp.ServiceWorker.setForceUpdateOnPageLoad({forceUpdateOnPageLoad:e==="force"});for(let t of this._targets.values())e==="bypass"?(t.Network.enable({}),t.Network.setBypassServiceWorker({bypass:!0})):t.Network.disable({})}}async stopWorker(e){if(!this._cdp)return;let t=this.version(e);t&&await this._cdp.ServiceWorker.stopWorker({versionId:t.id})}}});var Fi,zd=m(()=>{"use strict";O();_();ti();DI();_I();Fi=class{constructor(e,t,r,o,n,s,a,c){this.process=t;this.logger=n;this.telemetry=s;this.launchParams=a;this._targets=new Map;this._detachedTargets=new Set;this.frameModel=new qd;this.serviceWorkerModel=new Hd(this.frameModel);this._lifecycleQueue=Promise.resolve();this._onTargetAddedEmitter=new S;this._onTargetRemovedEmitter=new S;this.onTargetAdded=this._onTargetAddedEmitter.event;this.onTargetRemoved=this._onTargetRemovedEmitter.event;this._connection=e,this._sourcePathResolver=o,this._browser=r,this._targetOrigin=c,this.serviceWorkerModel.onDidChange(()=>{for(let l of this._targets.values())l.type()==="service_worker"&&l._onNameChangedEmitter.fire()})}static async connect(e,t,r,o,n,s,a){let l=await e.rootSession().Target.attachToBrowserTarget({});if(!l)return;let p=e.createSession(l.sessionId);return new this(e,t,p,r,n,s,o,a)}dispose(){this.serviceWorkerModel.dispose()}targetList(){return Array.from(this._targets.values()).filter(e=>Gc.has(e.type()))}async getCandiateInfo(e){let t=await this._browser.Target.getTargets({});return t?e?t.targetInfos.filter(e):t.targetInfos:[]}async closeBrowser(){if(this.launchParams.request==="launch"){if(this.launchParams.cleanUp==="wholeBrowser")await this._browser.Browser.close({}),this.process?.kill();else for(let e of this._targets.values())await this._browser.Target.closeTarget({targetId:e.targetId}),this._connection.close();this.process=void 0}}waitForMainTarget(e){let t,r=new Promise(n=>t=n),o=async n=>{if([...this._targets.values()].some(c=>c.targetId===n.targetId)||this._detachedTargets.has(n.targetId)||e&&!e(n))return;let s=this._browser.Target.on("targetInfoChanged",c=>{c.targetInfo.targetId===n.targetId&&(n=c.targetInfo)}),a;try{a=await this._browser.Target.attachToTarget({targetId:n.targetId,flatten:!0})}finally{s.dispose()}if(!a){t(void 0);return}t(this.attachedToTarget(n,a.sessionId,!0))};return this._browser.Target.setDiscoverTargets({discover:!0}),this._browser.Target.on("targetCreated",this.enqueueLifecycleFn(n=>o(n.targetInfo))),this._browser.Target.on("targetInfoChanged",n=>this._targetInfoChanged(n.targetInfo,this.enqueueLifecycleFn(o))),this._browser.Target.on("detachedFromTarget",this.enqueueLifecycleFn(async n=>{n.targetId&&await this._detachedFromTarget(n.sessionId,!1)})),r}enqueueLifecycleFn(e){return t=>this._lifecycleQueue=this._lifecycleQueue.then(()=>e(t))}attachedToTarget(e,t,r,o,n=!0){let s=this._targets.get(t);if(s)return s;let a=this._connection.createSession(t),c=new ws(this,e,a,o,r,this.launchParams,t,this.logger,()=>{this._connection.disposeSession(t),this._detachedFromTarget(t)});this._targets.set(t,c),o&&o._children.set(e.targetId,c),a.Target.on("attachedToTarget",async p=>{this.attachedToTarget(p.targetInfo,p.sessionId,p.waitingForDebugger,c)}),a.Target.on("detachedFromTarget",async p=>{p.targetId&&this._detachedFromTarget(p.sessionId,!1)}),a.Target.setAutoAttach({autoAttach:!0,waitForDebuggerOnStart:n,flatten:!0}),a.Network.setCacheDisabled({cacheDisabled:this.launchParams.disableNetworkCache}).catch(p=>this.logger.info("runtime.target","Error setting network cache state",p)),o||this.retrieveBrowserTelemetry(a);let l=e.type;return Gp.has(l)&&this.frameModel.attached(a,e.targetId),this.serviceWorkerModel.attached(a),this._onTargetAddedEmitter.fire(c),!Gc.has(l)||l==="service_worker"?c.runIfWaitingForDebugger():l==="page"&&n&&a.Page.waitForDebugger({}),c}async retrieveBrowserTelemetry(e){try{let t=await e.Browser.getVersion({});if(!t)throw new Error("Undefined return from getVersion()");let r={targetCRDPVersion:t.protocolVersion,targetRevision:t.revision,targetUserAgent:t.userAgent,targetV8:t.jsVersion,targetVersion:"",targetProject:"",targetProduct:""};this.logger.verbose("runtime.target","Retrieved browser information",t);let o=(t.product||"").split("/");o.length===2?(r.targetProject=o[0],r.targetVersion=o[1]):r.targetProduct=t.product,this.telemetry.report("browserVersion",r)}catch(t){this.logger.warn("runtime.target","Error getting browser telemetry",t)}}async _detachedFromTarget(e,t=!0){let r=this._targets.get(e);if(r){this._targets.delete(e),r.parentTarget?._children.delete(e);try{await r._detached()}catch{}if(this._onTargetRemovedEmitter.fire(r),t&&(this._detachedTargets.add(r.targetId),await this._browser.Target.detachFromTarget({sessionId:e})),!this._targets.size&&this.launchParams.request==="launch")try{this.launchParams.cleanUp==="wholeBrowser"?await this._browser.Browser.close({}):(await this._browser.Target.closeTarget({targetId:r.id()}),this._connection.close())}catch{}}}async _targetInfoChanged(e,t){let r=[...this._targets.values()].filter(o=>o.targetId===e.targetId);if(!e.attached||!r.length)return r.length&&await Promise.all(r.map(o=>this._detachedFromTarget(o.sessionId,!1))),t(e);for(let o of r)o._updateFromInfo(e);for(let o of this._targets.values())o.targetId!==e.targetId&&o._onNameChangedEmitter.fire()}}});var EI,tL,yt,Nn=m(()=>{"use strict";EI=w(require("ws"));Ve();O();aa();U();N();tL=50,yt=class i{constructor(e){this.messageEmitter=new S;this.endEmitter=new S;this.onMessage=this.messageEmitter.event;this.onEnd=this.endEmitter.event;this._ws=e,this._ws.addEventListener("message",t=>{this.messageEmitter.fire([t.data.toString("utf-8"),new gr])}),this._ws.addEventListener("close",()=>{this.endEmitter.fire(),this._ws=void 0}),this._ws.addEventListener("error",()=>{})}static async create(e,t,r){let o=!e.startsWith("ws://"),n=await Ps(e);for(;;){let s=Date.now()+tL;try{let a={headers:{host:r??"localhost"},perMessageDeflate:!1,maxPayload:268435456,rejectUnauthorized:!(o&&n),followRedirects:!0},c=new EI.default(e,[],a);return await Nt(new Promise((l,p)=>{c.addEventListener("open",()=>l(new i(c))),c.addEventListener("error",d=>{let b=e===c.url?e:c.url.replace(/^http(s?):/,"ws$1:");if(b===e){p(d.error);return}this.create(b,t,r).then(l,p)})}),ie.withTimeout(2e3,t).token,`Could not open ${e}`).catch(l=>{throw c.close(),l})}catch(a){if(t.isCancellationRequested)throw a;let c=s-Date.now();c>0&&await x(c)}}}send(e){this._ws?.send(e)}dispose(){return new Promise(e=>{if(!this._ws)return e();this._ws.addEventListener("close",()=>e()),this._ws.close()})}}});function rL(i){let e=[/^APPLICATION_INSIGHTS_NO_DIAGNOSTIC_CHANNEL$/i,/^ELECTRON_.+$/i,/^GOOGLE_API_KEY$/i,/^VSCODE_.+$/i,/^SNAP(|_.*)$/i,/^GDK_PIXBUF_.+$/i];return new de(i).map((t,r)=>e.some(o=>o.test(t))?void 0:r)}var Gd,de,ao=m(()=>{"use strict";Gd=w(require("path"));M();de=class i{constructor(e){this.defined=F(()=>gs(this.value));this.value=e?rw(e):{}}static{this.platform=process.platform}static{this.empty=new i({})}static{this.processEnv=F(()=>rL(process.env))}lookup(e){return i.platform==="win32"?nw(this.value,e):this.value[e]}addToPath(e,t="append",r=!1){let o=i.platform==="win32"?"Path":"PATH",n=i.platform==="win32"?Gd.win32.delimiter:Gd.posix.delimiter,s=this.lookup(o);return r&&!s&&(s=`\${env:${o}}`),s?t==="append"?s=s+n+e:s=e+n+s:s=e,this.update(o,s)}addNodeOption(e){let t=this.lookup("NODE_OPTIONS");return this.update("NODE_OPTIONS",t?`${t} ${e}`:e)}update(e,t){return i.merge(this,{[e]:t})}merge(...e){return i.merge(this,...e)}map(e){return new i(Po(this.value,(t,r)=>e(r,t)))}static merge(...e){let t=e.map(o=>o instanceof i?o.value:o),r=i.platform==="win32"?iw(...t):Object.assign({},...t);return new i(r)}}});var AI,xt,Bn=m(()=>{"use strict";AI=w(require("split2"));O();aa();_();M();xt=class{constructor(e,t,r){this.logger=e;this.pipeWrite=t;this.pipeRead=r;this.messageEmitter=new S;this.endEmitter=new S;this.onMessage=this.messageEmitter.event;this.onEnd=this.endEmitter.event;this.onceEnded=F(()=>{this.streams&&(this.beforeClose(),this.streams.read.removeAllListeners(),this.pipeRead?.destroy(),this.streams.write.removeListener("end",this.onceEnded),this.streams.write.removeListener("error",this.onWriteError),this.streams.write.on("error",()=>{}),this.streams.write.end(),this.streams=void 0,this.endEmitter.fire())});this.onWriteError=e=>{this.logger.error("internal","pipeWrite error",{error:e})};let o=r||t;this.streams={read:o.on("error",n=>this.logger.error("internal","pipeRead error",{error:n})).pipe((0,AI.default)("\0")).on("data",n=>this.messageEmitter.fire([n,new gr])).on("end",this.onceEnded),write:t.on("end",this.onceEnded).on("error",this.onWriteError)}}send(e){this.streams?.write.write(e+"\0")}dispose(){this.onceEnded()}beforeClose(){}}});function Kt(i,e,t="forceful"){if(t==="none")return!0;if(process.platform==="win32"){let r=process.env.WINDIR||"C:\\Windows",o=(0,Lh.join)(r,"System32","taskkill.exe");try{return(0,Jd.execSync)(`${o} ${t==="forceful"?"/F":""} /T /PID ${i}`,{stdio:"pipe"}),!0}catch(n){return e.error("runtime.exception","Error running taskkill.exe",n),!1}}else try{let r=(0,Lh.join)(__dirname,"./targets/node/terminateProcess.sh"),o=(0,Jd.spawnSync)("sh",[r,i.toString(),t==="forceful"?"9":"15"]);return o.stderr&&o.status?(e.error("runtime.exception","Error running terminateProcess",o),!1):!0}catch(r){return e.error("runtime.exception","Error running terminateProcess",r),!1}}var Jd,Lh,va=m(()=>{"use strict";Jd=require("child_process"),Lh=require("path");_();$()});async function _h(i,e,t,r){let o=new jt(NI.promises),[n,s]=await Promise.all([FI(o,new URL("/json/version",i),e),r?FI(o,new URL("/json/list",i),e):Promise.resolve(void 0)]);if(!n.ok)t.verbose("runtime.launch","Error looking up /json/version",n);else if(n.body.webSocketDebuggerUrl){let a=MI(n.url,n.body.webSocketDebuggerUrl);return t.verbose("runtime.launch","Discovered target URL from /json/version",{url:n.body.webSocketDebuggerUrl,fixed:a}),a}if(s)if(!s.ok)t.verbose("runtime.launch","Error looking up /json/list",s);else{let a=MI(s.url,s.body[0].webSocketDebuggerUrl);return t.verbose("runtime.launch","Discovered target URL from /json/list",{url:s.body[0].webSocketDebuggerUrl,fixed:a}),a}throw new Error("Could not find any debuggable target")}async function FI(i,e,t){if(e.hostname!=="localhost")return i.fetchJson(e.toString(),t,{host:"localhost"});e.hostname="127.0.0.1";let r=e.toString();e.hostname="[::1]";let o=e.toString(),n=new ie(t);try{let s;return await Hr([r,o].map(async c=>(s=await i.fetchJson(c,n.token),s.ok&&s)))||s}finally{n.cancel()}}function MI(i,e){let t=new URL(i),r=new URL(e);return r.host=t.host,r.toString()}var NI,BI,Sa,Kd,On=m(()=>{"use strict";NI=require("fs");Nd();Ve();_();U();BI=i=>async(e,t,r)=>{for(;;)try{return await _h(e,t,r,i)}catch(o){if(t.isCancellationRequested)throw new Error(`Could not connect to debug target at ${e}: ${o.message}`);await x(200)}},Sa=BI(!0),Kd=BI(!1)});function iL(i,e){if(!i.stderr)throw new Error("Cannot wait for a websocket for a target that lacks stderr");return new Promise((t,r)=>{let o=OI.createInterface({input:i.stderr}),n="",s=()=>l();o.on("line",p),o.on("close",s);let a=new j([i.onExit(()=>l()),i.onError(l)]),c=e.onCancellationRequested(()=>{d(),r(new zt(`Timed out after ${c} ms while trying to connect to the browser!`))});function l(b){d(),r(new Error(["Failed to launch browser!"+(b?" "+b.message:""),n,"","TROUBLESHOOTING: https://github.com/GoogleChrome/puppeteer/blob/master/docs/troubleshooting.md",""].join(`
`)))}function p(b){n+=b+`
`;let y=b.match(/^DevTools listening on (ws:\/\/.*)$/);y&&(d(),t(y[1]))}function d(){c.dispose(),o.removeListener("line",p),o.removeListener("close",s),a.dispose()}})}var OI,jI,Qd,Xd,UI=m(()=>{"use strict";OI=w(require("readline"));Bn();Nn();Ve();ze();O();U();va();Fp();On();jI=async(i,e,t,r)=>{let o=t.connection===0?await iL(e,r):await Kd(`http://localhost:${t.connection}`,r,i),n=t.inspectUri?_t(t.inspectUri,t.url,o):o;for(;;)try{return await yt.create(n,r)}catch(s){if(r.isCancellationRequested)throw s;await x(200)}},Qd=class{constructor(e){this.logger=e;this.pid=void 0;this.onExit=new S().event;this.onError=new S().event}async transport(e,t){return jI(this.logger,this,e,t)}kill(){}},Xd=class{constructor(e,t){this.cp=e;this.logger=t;this.pid=void 0;this.exitEmitter=new S;this.onExit=this.exitEmitter.event;this.errorEmitter=new S;this.onError=this.errorEmitter.event;e.on("exit",r=>this.exitEmitter.fire(r||0)),e.on("error",r=>this.errorEmitter.fire(r))}get stderr(){return this.cp.stderr}get stdio(){return this.cp.stdio}async transport(e,t){return e.connection==="pipe"?new xt(this.logger,this.cp.stdio[3],this.cp.stdio[4]):jI(this.logger,this,e,t)}kill(){Kt(this.cp.pid,this.logger)}}});async function WI(i,e,t,r){let o=i.launchUnelevatedRequest({process:e,args:t});await Nt(o,r,"Could not launch browser unelevated")}var VI=m(()=>{"use strict";Ve()});async function zI(i,e,t,r,o,n,s={}){let{onStderr:a=$I,onStdout:c=$I,args:l=[],dumpio:p=!1,cwd:d=process.cwd(),env:b=de.empty,connection:y="pipe",cleanUp:v="wholeBrowser",url:D,inspectUri:Te}=s,pe=new ot(l),ut=pe.getSuggestedConnection();s.includeLaunchArgs!==!1?(pe=Eh(pe,s),ut===void 0&&(pe=pe.setConnection(y),ut=y)):ut===void 0&&(ut="pipe");let Io=["pipe","pipe","pipe"];ut==="pipe"&&(p?Io=["ignore","pipe","pipe","pipe","pipe"]:Io=["ignore","ignore","ignore","pipe","pipe"]);let dt;if(!!(o.supportsLaunchUnelevatedProcessRequest&&s.launchUnelevated)&&typeof ut=="number"&&ut!==0)await WI(i,e,pe.toArray(),n),dt=new Qd(t);else{t.info("runtime.launch",`Launching Chrome from ${e}`);let Lt=qI.spawn(e,pe.toArray(),{detached:!0,env:b.defined(),cwd:await hs(HI.promises,d)?d:process.cwd(),stdio:Io});if(Lt.pid===void 0)throw await Promise.race([x(1e3).then(()=>new Error("Unable to launch the executable (undefined pid)")),new Promise(Rp=>Lt.once("error",Rp))]);dt=new Xd(Lt,t)}p?(dt.stderr?.on("data",Lt=>a(Lt.toString())),dt.stdout?.on("data",Lt=>c(Lt.toString()))):(dt.stderr?.resume(),dt.stdout?.resume());let ms=()=>{v==="wholeBrowser"&&dt.kill()};process.on("exit",ms),dt.onExit(()=>process.removeListener("exit",ms));try{if(s.promisedPort){let Lt;ut=await Promise.race([s.promisedPort,new Promise((Rp,QT)=>{Lt=dt.onExit(XT=>{QT(new I(Oy(XT)))})})]).finally(()=>Lt.dispose())}return{process:dt,canReconnect:typeof ut=="number",createConnection:async Lt=>{let Rp=await dt.transport({connection:ut,inspectUri:Te||void 0,url:D||void 0},Lt);return new Ue(Rp,t,r)}}}catch(Lt){throw dt.kill(),Lt}}function Eh(i,e={}){let{userDataDir:t=null,ignoreDefaultArgs:r=!1}=e,o=r===!0?new ot:ot.default;return r instanceof Array&&(o=o.filter(n=>!r.includes(n))),t&&(o=o.add("--user-data-dir",t)),o=o.merge(i),i.toArray().every(n=>n.startsWith("-"))&&e.hasUserNavigation&&(o=o.add("about:blank")),o}async function GI(i,e,t,r){let{browserWSEndpoint:o,browserURL:n}=i;if(o){let s=await yt.create(o,e);return new Ue(s,t,r)}else if(n){let s=await Kd(n,e,t),a=i.inspectUri?_t(i.inspectUri,i.pageURL,s):s,c=await yt.create(a,e);return new Ue(c,t,r)}throw new Error("Either browserURL or browserWSEndpoint needs to be specified")}var qI,HI,$I,Yd=m(()=>{"use strict";qI=w(require("child_process")),HI=require("fs");We();Nn();ao();ae();_();U();le();oe();Ap();Fp();UI();On();VI();$I=()=>{}});var Zd,Mi,wr,Vl=m(()=>{"use strict";Zd=w(require("@vscode/l10n")),Mi=require("inversify");Ve();A();O();_();U();Ft();N();le();oe();H();zd();ti();Yd();wr=class{constructor(e,t,r){this.logger=e;this.pathResolver=t;this.vscode=r;this._disposables=[];this._onTerminatedEmitter=new S;this.onTerminated=this._onTerminatedEmitter.event;this._onTargetListChangedEmitter=new S;this.onTargetListChanged=this._onTargetListChangedEmitter.event}dispose(){for(let e of this._disposables)e.dispose();this._disposables=[],this._attemptTimer&&clearTimeout(this._attemptTimer),this._targetManager&&this._targetManager.dispose()}resolveParams(e){return e.request==="attach"&&(e.type==="pwa-chrome"||e.type==="pwa-msedge"&&typeof e.useWebView!="object")&&e.browserAttachLocation==="workspace"}async launch(e,t){return this.resolveParams(e)?(this._lastLaunchParams={...e,timeout:1/0},await this.attemptToAttach(this._lastLaunchParams,t),{blockSessionTermination:!0}):{blockSessionTermination:!1}}_scheduleAttach(e,t){this._attemptTimer=setTimeout(()=>{this._attemptTimer=void 0,this.attemptToAttach(e,{...t,cancellationToken:Ne})},1e3)}createTargetManager(e,t,r){return Fi.connect(e,void 0,this.pathResolver,t,this.logger,r.telemetryReporter,r.targetOrigin)}async attemptToAttach(e,t){let r=await this.acquireConnectionForBrowser(t,e);this._connection=r,r.onDisconnected(()=>{this._connection=void 0,this._targetManager&&(this._targetManager.dispose(),this._targetManager=void 0,this._onTargetListChangedEmitter.fire()),this._lastLaunchParams===e&&e.restart?this._scheduleAttach(e,t):this._onTerminatedEmitter.fire({killed:!0,code:0})},void 0,this._disposables);let o=this._targetManager=await this.createTargetManager(r,e,t);if(!o)return;o.serviceWorkerModel.onDidChange(()=>this._onTargetListChangedEmitter.fire()),o.frameModel.onFrameNavigated(()=>this._onTargetListChangedEmitter.fire()),o.onTargetAdded(()=>{this._onTargetListChangedEmitter.fire()}),o.onTargetRemoved(()=>{this._onTargetListChangedEmitter.fire(),o.targetList().length||this._onTerminatedEmitter.fire({killed:!0,code:0})});let n=await Promise.race([o.waitForMainTarget(await this.getTargetFilter(o,e)),x(e.timeout).then(()=>{throw new I(fu())})]);return typeof n=="string"?n:void 0}async getTargetFilter(e,t){let r=si(t),o=ks(r);if(t.targetSelection!=="pick")return o;let n=await e.getCandiateInfo(o);if(n.length===0)return o;if(n.length===1||!this.vscode)return c=>c.targetId===n[0].targetId;let s=Zd.t("Select a tab"),a=await this.vscode.window.showQuickPick(n.map(c=>({label:c.title,detail:c.url,targetId:c.targetId})),{matchOnDescription:!0,matchOnDetail:!0,placeHolder:s});return a?c=>c.targetId===a.targetId:o}async acquireConnectionForBrowser({telemetryReporter:e,cancellationToken:t},r){for(;this._lastLaunchParams===r;)try{return await this.acquireConnectionInner(e,r,t)}catch(o){if(t.isCancellationRequested)throw new I(nl(Zd.t("Cannot connect to the target at {0}: {1}",`${r.address}:${r.port}`,o.message)));await x(1e3)}throw new I(nl(Zd.t("Cannot connect to the target at {0}: {1}",`${r.address}:${r.port}`,"Cancelled")))}async acquireConnectionInner(e,t,r){let o=`http://${t.address}:${t.port}`;return await GI({browserURL:o,inspectUri:t.inspectUri,pageURL:t.url},r,this.logger,e)}async terminate(){this._lastLaunchParams=void 0,this._connection?.close()}async restart(){if(this._targetManager)for(let e of this._targetManager.targetList())e.type()==="page"&&!e.name().startsWith("devtools://")&&e.restart()}targetList(){let e=this._targetManager;return e?e.targetList():[]}};wr=f([(0,Mi.injectable)(),u(0,(0,Mi.inject)(C)),u(1,(0,Mi.inject)(ge)),u(2,(0,Mi.optional)()),u(2,(0,Mi.inject)(ar))],wr)});var KI,QI,$l,Ni,Ia,co,em=m(()=>{"use strict";KI=require("@vscode/js-debug-browsers"),QI=w(require("@vscode/l10n")),$l=w(require("fs")),Ni=require("inversify"),Ia=w(require("path"));Ve();ze();ao();O();ae();_();U();Ft();N();le();oe();H();zd();ti();Yd();co=class{constructor(e,t,r,o,n){this.storagePath=e;this.logger=t;this.pathResolver=r;this.initializeParams=o;this.fs=n;this._disposables=new j;this._onTerminatedEmitter=new S;this.onTerminated=this._onTerminatedEmitter.event;this._onTargetListChangedEmitter=new S;this.onTargetListChanged=this._onTargetListChangedEmitter.event;this._terminatedCts=new ie}dispose(){this._disposables.dispose()}async launchBrowser({runtimeExecutable:e,trace:t,includeDefaultArgs:r,includeLaunchArgs:o,runtimeArgs:n,userDataDir:s,env:a,cwd:c,port:l,url:p,file:d,inspectUri:b,webRoot:y,cleanUp:v,launchUnelevated:D},Te,pe,ut,Io){let dt=await this.findBrowserPath(e||"stable"),Qo;return typeof s=="string"?Qo=Ia.resolve(s):s&&(Qo=Ia.resolve(Ia.join(this.storagePath,n?.includes("--headless")?".headless-profile":".profile"))),$l.mkdirSync(this.storagePath,{recursive:!0}),Qo&&($l.mkdirSync(Qo,{recursive:!0}),Qo=$l.realpathSync(Qo)),await zI(Te,dt,this.logger,ut,this.initializeParams,pe,{onStdout:ms=>Te.output({category:"stdout",output:ms}),onStderr:ms=>Te.output({category:"stderr",output:ms}),dumpio:typeof t=="boolean"?t:t.stdio,cleanUp:v,hasUserNavigation:!!(p||d),cwd:c||y||void 0,env:de.merge(de.processEnv(),a),args:n||[],userDataDir:Qo,connection:l||(b?0:"pipe"),launchUnelevated:D,ignoreDefaultArgs:!r,includeLaunchArgs:o,url:p,inspectUri:b,promisedPort:Io})}getFilterForTarget(e){return ks(si(e,["about:blank"]))}async doLaunch(e,t){let r;try{r=await this.launchBrowser(e,t.dap,t.cancellationToken,t.telemetryReporter)}catch(l){throw new I(Zg(l))}let o=new ie(this._terminatedCts.token);r.process.onExit(()=>this.fireTerminatedEvent());let n=()=>r.canReconnect&&!o.token.isCancellationRequested,s=async l=>{if(this._targetManager?.dispose(),this._targetManager=void 0,this._onTargetListChangedEmitter.fire(),n()&&(await x(1e3),n())){t.dap.output({category:"stderr",output:QI.t("Browser connection failed, will retry: {0}",l?.message||"Connection closed")});try{return await x(2e3),await a()}catch{}}r.process.kill(),this.fireTerminatedEvent()},a=async()=>{if(!o.token.isCancellationRequested)try{let l=await r.createConnection(o.token),p=await this.launchCdp(e,r,l,{...t,cancellationToken:o.token});await this.finishLaunch(p,e),l.onDisconnected(()=>s())}catch(l){if(n())return s(l);throw r.process.kill(),new I(Zg(l))}},c=t.cancellationToken.onCancellationRequested(()=>o.cancel());try{await a()}finally{c.dispose()}}async launchCdp(e,t,r,o){if(this._connectionForTest=r,this._targetManager=await Fi.connect(r,t.process,this.pathResolver,e,this.logger,o.telemetryReporter,o.targetOrigin),!this._targetManager)throw new I(nl());this._targetManager.serviceWorkerModel.onDidChange(()=>this._onTargetListChangedEmitter.fire()),this._targetManager.frameModel.onFrameNavigated(()=>this._onTargetListChangedEmitter.fire()),this._disposables.push(this._targetManager),this._targetManager.onTargetAdded(()=>{this._onTargetListChangedEmitter.fire()}),this._targetManager.onTargetRemoved(()=>{this._onTargetListChangedEmitter.fire()});let n=this.getFilterForTarget(e),s=await Nt(this._targetManager.waitForMainTarget(n),o.cancellationToken,"Could not attach to main target");if(!s)throw new I(fu());return s}async finishLaunch(e,t){if("skipNavigateForTest"in t)return;let r;if(t.file){let o=Ia.resolve(t.webRoot||t.rootPath||"",t.file),n=Math.min(o.includes("#")?o.indexOf("#"):1/0,o.includes("?")?o.indexOf("?"):1/0);isFinite(n)&&!await Vt(this.fs,o)?r=W(o.slice(0,n))+o.slice(n):r=W(o)}else r=t.url;r&&await e.cdp().Page.navigate({url:r})}async launch(e,t){let r=this.resolveParams(e);return r?(await this.doLaunch(r,t),{blockSessionTermination:!0}):{blockSessionTermination:!1}}async terminate(){this._targetManager?await this._targetManager.closeBrowser():this.fireTerminatedEvent()}async restart(){for(let e of this.targetList())e.type()==="page"&&e.restart()}async findBrowserByExe(e,t){return t==="*"?(await e.findWhere(o=>o.quality==="stable")||(await e.findAll())[0])?.path:(0,KI.isQuality)(t)?(await e.findWhere(r=>r.quality===t))?.path:t}targetList(){let e=this._targetManager;return e?e.targetList():[]}connectionForTest(){return this._connectionForTest}fireTerminatedEvent(){this._terminatedCts.token.isCancellationRequested||(this._terminatedCts.cancel(),this._onTerminatedEmitter.fire({code:0,killed:!0}))}};co=f([(0,Ni.injectable)(),u(0,(0,Ni.inject)(Xr)),u(1,(0,Ni.inject)(C)),u(2,(0,Ni.inject)(ge)),u(3,(0,Ni.inject)(Mt)),u(4,(0,Ni.inject)(G))],co)});var Ar,jn,XI=m(()=>{"use strict";Ar=require("inversify");A();ae();_();Ft();le();oe();H();em();jn=class extends co{constructor(t,r,o,n,s,a){super(t,r,s,a,n);this.browserFinder=o}resolveParams(t){return t.type==="pwa-chrome"&&t.request==="launch"&&t.browserLaunchLocation==="workspace"?t:void 0}async findBrowserPath(t){let r=await this.findBrowserByExe(this.browserFinder,t);if(!r||!await hs(this.fs,r))throw new I(gu("Chrome",t,(await this.browserFinder.findAll()).map(o=>o.quality)));return r}};jn=f([(0,Ar.injectable)(),u(0,(0,Ar.inject)(Xr)),u(1,(0,Ar.inject)(C)),u(2,(0,Ar.inject)(un)),u(2,(0,Ar.tagged)("browser","chrome")),u(3,(0,Ar.inject)(G)),u(4,(0,Ar.inject)(ge)),u(5,(0,Ar.inject)(Mt))],jn)});var YI,Fr,ZI,eP,tP,nL,Pa,rP=m(()=>{"use strict";YI=require("crypto"),Fr=require("inversify"),ZI=require("net"),eP=require("os"),tP=require("path");We();Nn();Ve();A();ae();_();U();Ft();N();le();oe();H();em();nL=["--do-not-de-elevate"],Pa=class extends co{constructor(t,r,o,n,s,a){super(t,r,s,a,n);this.browserFinder=o}resolveParams(t){return t.type==="pwa-msedge"&&t.request==="launch"&&t.browserLaunchLocation==="workspace"?t:void 0}launchBrowser(t,r,o,n){return super.launchBrowser({...t,runtimeArgs:t.runtimeArgs??nL},r,o,n,t.useWebView?this.getWebviewPort(t,n):void 0)}getFilterForTarget(t){return t.useWebView&&t.urlFilter?ks(si(t)):super.getFilterForTarget(t)}async getWebviewPort(t,r){let o=ne();if(!t.runtimeExecutable)return o.resolve(t.port),o.promise;let n=t.runtimeExecutable.split(/\\|\//).pop(),s=`VSCode_${(0,YI.randomBytes)(12).toString("base64")}`,a=`\\\\.\\pipe\\WebView2\\Debugger\\${n}\\${s}`,c=(0,ZI.createServer)(l=>{l.on("data",async p=>{let d=JSON.parse(p.toString()),b=d.devtoolsActivePort||"",y=parseInt(b.split(`
`).shift()||""),v=t.port||y;o.resolve(v);let D=`ws://${t.address}:${v}/devtools/${d.type}/${d.id}`,Te=await yt.create(D,Ne),pe=new Ue(Te,this.logger,r);await pe.rootSession().Runtime.runIfWaitingForDebugger({}),pe.close()})});return c.on("error",o.reject),c.on("close",()=>o.resolve(t.port)),c.listen(a),t.userDataDir=t.userDataDir||(0,tP.join)((0,eP.tmpdir)(),`vscode-js-debug-userdatadir_${t.port}`),t.env=t.env||{},t.env.WEBVIEW2_USER_DATA_FOLDER=t.userDataDir.toString(),t.env.WEBVIEW2_ADDITIONAL_BROWSER_ARGUMENTS=`--remote-debugging-port=${t.port}`,t.env.WEBVIEW2_WAIT_FOR_SCRIPT_DEBUGGER="true",t.env.WEBVIEW2_PIPE_FOR_SCRIPT_DEBUGGER=s,o.promise}async findBrowserPath(t){let r=await this.findBrowserByExe(this.browserFinder,t);if(!r||!await hs(this.fs,r))throw new I(gu("Edge",t,(await this.browserFinder.findAll()).map(o=>o.quality)));return r}};Pa=f([(0,Fr.injectable)(),u(0,(0,Fr.inject)(Xr)),u(1,(0,Fr.inject)(C)),u(2,(0,Fr.inject)(un)),u(2,(0,Fr.tagged)("browser","edge")),u(3,(0,Fr.inject)(G)),u(4,(0,Fr.inject)(ge)),u(5,(0,Fr.inject)(Mt))],Pa)});var oP,tm,sL,lo,rm=m(()=>{"use strict";oP=require("crypto"),tm=require("inversify");No();Nn();Ve();sL=0,lo=class{constructor(e){this.portLeaseTracker=e;this.teardown=new WeakMap}async launch(e,t,r){this.server&&this.server.close();let o=`/${(0,oP.randomBytes)(20).toString("hex")}`,n=this.server=await Hu(this.portLeaseTracker,{perMessageDeflate:!0,host:"127.0.0.1",path:o}),s=++sL;e.launchBrowserInCompanion({...r,serverPort:n.address().port,path:o,launchId:s});let a=await Nt(new Promise((l,p)=>{n.once("connection",l),n.once("error",p)}),t,"Timed out waiting for browser connection"),c=new yt(a);return this.teardown.set(c,()=>e.killCompanionBrowser({launchId:s})),c}close(e){this.teardown.get(e)?.()}dispose(){this.server?.close(),this.server=void 0}};lo=f([(0,tm.injectable)(),u(0,(0,tm.inject)(bt))],lo)});var Oo,ka,iP=m(()=>{"use strict";Oo=require("inversify");We();A();_();Ft();H();Vl();rm();ka=class extends wr{constructor(t,r,o,n){super(r,o,n);this.helper=t}resolveParams(t){return t.request==="attach"&&(t.type==="pwa-chrome"||t.type==="pwa-msedge")&&t.browserAttachLocation==="ui"}async acquireConnectionForBrowser(t,r){let o=await this.helper.launch(t.dap,t.cancellationToken,{type:r.type==="pwa-chrome"?"chrome":"edge",params:r,attach:{host:r.address,port:r.port}});return new Ue(o,this.logger,t.telemetryReporter)}};ka=f([(0,Oo.injectable)(),u(0,(0,Oo.inject)(lo)),u(1,(0,Oo.inject)(C)),u(2,(0,Oo.inject)(ge)),u(3,(0,Oo.optional)()),u(3,(0,Oo.inject)(ar))],ka)});var jo,xa,nP=m(()=>{"use strict";jo=require("inversify");We();A();O();_();Ft();H();Ap();em();Yd();rm();xa=class extends co{constructor(t,r,o,n,s,a){super(t,r,o,n,s);this.helper=a}resolveParams(t){return(t.type==="pwa-chrome"||t.type==="pwa-msedge")&&t.request==="launch"&&t.browserLaunchLocation==="ui"?t:void 0}async launchBrowser(t,r,o,n){let s=await this.helper.launch(r,o,{type:t.type==="pwa-chrome"?"chrome":"edge",browserArgs:Eh(new ot(t.runtimeArgs||[]),{hasUserNavigation:!!t.url,ignoreDefaultArgs:!t.includeDefaultArgs}).setConnection(t.port||"pipe").toArray(),params:t});return{canReconnect:!1,createConnection:()=>Promise.resolve(new Ue(s,this.logger,n)),process:{onExit:new S().event,onError:new S().event,transport:()=>Promise.resolve(s),kill:()=>this.helper.close(s)}}}async findBrowserPath(){throw new Error("not implemented")}};xa=f([(0,jo.injectable)(),u(0,(0,jo.inject)(Xr)),u(1,(0,jo.inject)(C)),u(2,(0,jo.inject)(ge)),u(3,(0,jo.inject)(Mt)),u(4,(0,jo.inject)(G)),u(5,(0,jo.inject)(lo))],xa)});var Bi,sP,Ca,aP=m(()=>{"use strict";Bi=require("inversify"),sP=require("net");We();Bn();Ve();A();_();U();Ft();le();oe();H();Vl();Ca=class extends wr{constructor(e,t,r){super(e,t,r)}resolveParams(e){return e.request==="attach"&&e.type==="pwa-msedge"&&typeof e.useWebView=="object"}async acquireConnectionForBrowser(e,t){let{getAppContainerProcessTokens:r}=await import("@vscode/win32-app-container-tokens"),o=r(t.useWebView.pipeName);if(!o)throw new I(Fy());let n=o.map(c=>(0,sP.connect)(c)),s;try{s=await Nt(Hr(n.map(c=>new Promise(l=>c.on("error",()=>l(void 0)).on("connect",()=>l(c))))),e.cancellationToken)}finally{for(let c of n)c!==s&&c.destroy()}if(!s)throw new I(My());let a=new xt(this.logger,s);return new Ue(a,this.logger,e.telemetryReporter)}};Ca=f([(0,Bi.injectable)(),u(0,(0,Bi.inject)(C)),u(1,(0,Bi.inject)(ge)),u(2,(0,Bi.optional)()),u(2,(0,Bi.inject)(ar))],Ca)});var ql,Ah=m(()=>{"use strict";ql=Symbol("ILinkedBreakpointLocation")});function om(i,e){return i?(i.endsWith("/")||(i+="/"),i+e):e}async function Ct(i,e,t,r,o){e=De(e)||e;let n;if(i){if(ir(i))n=De(i);else if(ht(i))n=await r(i,t,o)||i;else if(Uo.isAbsolute(e))n=lL(e,i);else{let s=new Fh.URL(e).pathname,a=await r(s,t,o),c=Uo.dirname(a);n=Yo(c,i)}o.verbose("sourcemap.parsing","resolved sourceRoot",{sourceRoot:i,absSourceRoot:n})}else if(Uo.isAbsolute(e))n=Uo.dirname(e),o.verbose("sourcemap.parsing","no sourceRoot specified, using script dirname",{absSourceRoot:n});else{let s=new Fh.URL(e).pathname||"/placeholder.js",a=await r(s,t,o);n=a?Uo.dirname(a):"",o.verbose("sourcemap.parsing","no sourceRoot specified, using webRoot + script path dirname",{absSourceRoot:n})}return n=ay(n),n=K(n),n}function aL(i,e){return i===e?!0:(i.endsWith("/")||(i+="/"),e.startsWith(i))}function cL(i,e,t){let r=decodeURIComponent(t.substring(i.length));return r?Yo(e,r):e}function lL(i,e){return $t(Uo.dirname(i),e)}var cP,Uo,Fh,vt,lP,im=m(()=>{"use strict";cP=require("fs"),Uo=w(require("path")),Fh=require("url");N();_();M();ee();vt=async(i,e,t)=>{if(!i||!i.startsWith("/"))return"";let r=Object.keys(e).sort((o,n)=>n.length-o.length);for(let o of r){if(!o)continue;let n=e[o];if(o[0]!=="/"&&(t.verbose("sourcemap.parsing",`Keys should be absolute: ${o}`),o="/"+o),aL(o,i))return cL(o,n,i)}return""},lP=(i,e)=>async(t,r,o)=>{if(process.platform==="win32"&&/^[a-z]:/i.test(t))return t;let n=await Is(i,Uo.dirname(e),"package.json");if(!n)return vt(t,r,o);let s=await vt(t,ow(r,a=>a.length>=n.length),o);return process.platform!=="win32"&&t!=="/"&&!s&&(await cP.promises.stat(t).catch(()=>{}))?.isDirectory()?t:s||n}});var am,pP,nm,pL,Mh,uP,sm,dP=m(()=>{"use strict";_();ee();Rr();am="*",pP=new RegExp(nt(am),"g"),nm="?:"+am,pL=new RegExp(nt(nm),"g"),Mh=(i,e)=>{let t=e.match(i);return i.lastIndex=0,t?t.length:0},uP=new RegExp(`${nt(nm)}|${nt(am)}`,"g"),sm=class{constructor(e,t){this.logger=t;this.replacers=[];let r=Object.keys(e).sort((o,n)=>n.replace(nm,"*").length-o.replace(nm,"*").length);for(let o of r){let n=e[o];if(!n.includes("*")&&/\$[0-9'`&]/.test(n)){this.replacers.push([new RegExp(`^${o}$`,"i"),n]);continue}let s=B(o),a=`"${s}": "${n}"`,c=Mh(pP,s)-Mh(pL,s);if(c>1){t.warn("runtime.sourcemap",`Warning: only one asterisk allowed in a sourceMapPathOverrides entry - ${a}`);continue}if(Mh(pP,n)>c){t.warn("runtime.sourcemap",`The right side of a sourceMapPathOverrides entry must have 0 or 1 asterisks - ${a}}`);continue}let l="^",p=0;for(uP.lastIndex=0;;){let d=uP.exec(s);if(l+=nt(s.slice(p,d?.index),"/"),!d)break;d[0]===am?l+="(.*?)":l+=".*?",p=d.index+d[0].length}c===0&&(l+="([\\/\\\\].*)?",n+="*"),this.replacers.push([new RegExp(l+"$","i"),n.replace(/\$/g,"$$$$").replace(/\*/,"$1")])}}apply(e){let t=B(e);for(let[r,o]of this.replacers){let n=t.replace(r,o);if(n!==t)return this.logger.verbose("runtime.sourcemap",`SourceMap: mapping ${e} => ${n}, via sourceMapPathOverrides entry - ${r.toString()}`),Yo(n)}return e}}});var mP,Ra,uL,Ta,Nh=m(()=>{"use strict";mP=w(require("micromatch")),Ra=w(require("path"));_();yh();ee();N();dP();uL=/\x00/,Ta=class{constructor(e,t){this.options=e;this.logger=t;this.sourceMapOverrides=new sm(this.options.sourceMapOverrides,this.logger);this.resolvePatterns=this.options.resolveSourceMapLocations?.map(e=>{let t=e.startsWith("!")?"!":"",r=e.slice(t.length).replace(/(?<!\.)\.[^.]+$/,".*");if(!ht(r))return B(e);r=B($t(r));let o=Cg(this.options.workspaceFolder),n=Cg(r),s=0;for(let a=0;a<o.length&&a<n.length&&n[a].toLowerCase()===o[a].toLowerCase();a++)s+=o[a].length+1;return r=r.slice(0,s).replace(/[\[\]\(\)\{\}\!\*]/g,"\\$&")+r.slice(s),t+r})}shouldResolveSourceMap({sourceMapUrl:e,compiledPath:t}){if(t.startsWith(Ri)||t==="")return!1;if(!this.resolvePatterns||this.resolvePatterns.length===0)return!0;let r=De(e)||st(e)&&t||e;if(r.startsWith("webpack-internal:///"))return!0;let o=Wp(e)?!1:Xc(),n=this.rebaseRemoteToLocal(r);return(0,mP.default)((n!==r?[r,n]:[r]).map(B),this.resolvePatterns,{dot:!0,nocase:!o}).length>0}rebaseRemoteToLocal(e){if(!this.options.remoteRoot||!this.options.localRoot||!this.canMapPath(e))return Ra.resolve(e);let t=qc(this.options.remoteRoot,e);if(t.startsWith(".."))return"";let r=Yo(this.options.localRoot,t);return r=fe(r),this.logger.verbose("runtime.sourcemap",`Mapped remoteToLocal: ${e} -> ${r}`),$t(r)}rebaseLocalToRemote(e){if(!this.options.remoteRoot||!this.options.localRoot||!this.canMapPath(e))return e;let t=qc(this.options.localRoot,e),r=Yo(this.options.remoteRoot,t);return r=K(r,!0),this.logger.verbose("runtime.sourcemap",`Mapped localToRemote: ${e} -> ${r}`),r}normalizeSourceMapUrl(e){e=e.replace(uL,"");let t=e.lastIndexOf("?");return t!==-1&&e.slice(t-4,t)!==".vue"&&(e=e.slice(0,t)),e}canMapPath(e){return Ra.posix.isAbsolute(e)||Ra.win32.isAbsolute(e)||ir(e)}}});var Hl,Oi,gP,Bh,yr,cm=m(()=>{"use strict";Hl=require("inversify"),Oi=w(require("path")),gP=require("url");jl();ae();ee();im();N();N();Nh();Bh="https?:\\/\\/[^\\/]+\\/",yr=class extends Ta{constructor(t,r,o,n){super(o,n);this.vueMapper=t;this.fsUtils=r}absolutePathToUrlPath(t){t=Oi.normalize(t);let{baseUrl:r,pathMapping:o}=this.options,n=["/",o["/"]],s=Object.entries(o).sort(([l,p],[d,b])=>b.length-p.length||d.length-l.length).find(([,l])=>Up(l,t))||n;if(!s)return{url:W(t),needsWildcard:!1};if(r&&ir(r))return{url:Do(t),needsWildcard:!1};let a=ni(Oi.relative(s[1],t)),c=s[0].replace(/\/$|^\//g,"");return c&&(a=c+"/"+a),!r&&!ru(a)?{url:a,needsWildcard:!0}:{url:tu(r,a),needsWildcard:!1}}async urlToAbsolutePath({url:t,map:r}){let o=t.indexOf("?");return o!==-1&&t.slice(o-4,o)!==".vue"&&(t=t.slice(0,o)),r?this.sourceMapSourceToAbsolute(t,r):this.simpleUrlToAbsolute(t)}async simpleUrlToAbsolute(t){if(!t)return;if(ir(t)){let s=De(t);if(await this.fsUtils.exists(s))return s;let a=cy(t);return await this.fsUtils.exists(a)?a:s}let r;try{let s=new gP.URL(t);if(!s.pathname||s.pathname==="/"?r="index.html":r=s.pathname,s.protocol==="webpack-internal:")return}catch{r=t}let o=Oi.extname(r),n=r.replace(/^\//,"").split(/[\/\\]/);for(;n.length>0;){let s="/"+n.join("/"),a=await vt(s,this.options.pathMapping,this.logger);if(a){if(!o&&await this.fsUtils.exists(a+".html"))return a+".html";if(await this.fsUtils.exists(a))return a}n.shift()}}async sourceMapSourceToAbsolute(t,r){if(!this.shouldResolveSourceMap(r.metadata))return;switch(this.vueMapper.getVueHandling(t)){case 2:return;case 1:let a=await this.vueMapper.lookup(t);if(a)return K(a);break;default:}t=this.normalizeSourceMapUrl(t);let{pathMapping:o}=this.options,n=om(r.sourceRoot,t),s=this.sourceMapOverrides.apply(n);if(s!==n){s=K(s);let a=$t(o["/"],"..","ClientApp",qc(o["/"],s));return this.options.clientID==="visualstudio"&&n.startsWith("webpack:///")&&!await this.fsUtils.exists(s)&&await this.fsUtils.exists(a)?a:s}return ir(t)?De(t):Oi.isAbsolute(t)?K(t):$t(await Ct(r.sourceRoot,r.metadata.compiledPath,o,vt,this.logger),t)}absolutePathToUrlRegexp(t){let r=this.absolutePathToUrlPath(t),o=r.url,n=o.length;o.endsWith("index.html")?(n=o.length-10-1,o=o.slice(0,n)+"\\/?($|index(\\.html)?)"):o.endsWith(".html")&&(n=o.length-5,o=o.slice(0,n)+"(\\.html)?");let s=0;r.needsWildcard&&(o=Bh+o,s=Bh.length,n+=Bh.length);let a=Ge(o,[s,n]);return r.needsWildcard?`${Ge(W(t))}|${a}`:a}};yr=f([(0,Hl.injectable)(),u(0,(0,Hl.inject)(wa)),u(1,(0,Hl.inject)(mt))],yr)});var fP,Da,Oh=m(()=>{"use strict";fP=w(require("path"));_();N();cm();Da=class extends yr{constructor(t,r,o,n){super(t,r,o,n);this.blazorInCodespacesRegexpSubstitution="$1:\\$2";if(this.options.remoteFilePrefix){let s=`\\${fP.default.sep}`,a=this.options.remoteFilePrefix.replace(new RegExp(s,"g"),s);this.blazorInCodespacesRegexp=new RegExp(`^${a}${s}([A-z])\\$${s}(.*)$`)}else this.blazorInCodespacesRegexp=new RegExp("")}absolutePathToUrlRegexp(t){if(this.options.remoteFilePrefix){let r=t.replace(this.blazorInCodespacesRegexp,this.blazorInCodespacesRegexpSubstitution),n=ni(r).replace(/^(\w):(.*)$/,"$1$2"),s=Ge(n);if(s){let a=`dotnet://.*\\.dll/${s}`;return this.logger.verbose("runtime.breakpoints","absolutePathToUrlRegexp.blazor.remoteFs",{absolutePath:t,dotnetUrlRegexp:a}),a}}else{let r=W(t),o=Ge(r),n=super.absolutePathToUrlRegexp(t);return o.includes(n)?o:`${o}|${n}`}return super.absolutePathToUrlRegexp(t)}}});function bP(i){if("file"in i&&i.file)return Do(i.file);if(i.url)try{let e=new hP.URL(i.url);return e.pathname="/",e.search="",e.hash="",e.protocol==="data:"?void 0:e.href}catch{}}var hP,wP=m(()=>{"use strict";hP=require("url");N()});var Un,vP,yP,$e,jh=m(()=>{"use strict";Un=w(require("path")),vP=require("url");ee();im();N();Nh();yP="node:",$e=class i extends Ta{constructor(t,r,o,n){super(o,n);this.fsUtils=t;this.linkedBp=r;this.options=o;this.logger=n}static shouldWarnAboutSymlinks(t){return"runtimeArgs"in t&&!t.runtimeArgs?.includes("--preserve-symlinks")}static getOptions(t){return{workspaceFolder:t.__workspaceFolder,resolveSourceMapLocations:t.resolveSourceMapLocations,basePath:t.cwd,sourceMapOverrides:t.sourceMapPathOverrides,remoteRoot:t.remoteRoot,localRoot:t.localRoot}}derive(t){return new i(this.fsUtils,this.linkedBp,{...this.options,...t},this.logger)}get resolutionOptions(){return this.options}async urlToAbsolutePath({url:t,map:r}){if(t=this.normalizeSourceMapUrl(t),t.startsWith(yP)&&this.options.basePath)return t=Un.join(this.options.basePath,"lib",t.slice(yP.length)),t.endsWith(".js")||(t+=".js"),t;if(r)return this.sourceMapSourceToAbsolute(t,r);let o=De(t);if(o)return this.rebaseRemoteToLocal(o);if(ru(t)){let s=this.sourceMapOverrides.apply(t);t=s===t?new vP.URL(t).pathname.slice(1):s}else if(Un.isAbsolute(t))t=this.sourceMapOverrides.apply(t);else return`<node_internals>/${t}`;let n=$t(this.options.basePath??"",t);return this.rebaseRemoteToLocal(n)}absolutePathToUrl(t){return W(this.rebaseLocalToRemote(Un.normalize(t)))}async absolutePathToUrlRegexp(t){let r=t;try{r=await this.fsUtils.realPath(t)}catch{}return Zp(r,t)?Ge(this.absolutePathToUrl(t)):(this.linkedBp?.warn(),Ge(this.absolutePathToUrl(t))+"|"+Ge(this.absolutePathToUrl(r)))}async sourceMapSourceToAbsolute(t,r){if(!this.shouldResolveSourceMap(r.metadata))return;let o=om(r.sourceRoot,t),n=this.sourceMapOverrides.apply(o);return n!==o?K(n):ir(t)?De(t):!Un.isAbsolute(t)&&this.options.basePath?$t(await Ct(this.options.remoteRoot&&ht(r.sourceRoot)&&this.rebaseRemoteToLocal(r.sourceRoot)||r.sourceRoot,r.metadata.compiledPath,{"/":this.options.basePath},lP(this.fsUtils,r.metadata.compiledPath),this.logger),t):this.rebaseRemoteToLocal(t)||t}}});var Qt,Xt,La,_a,Wn=m(()=>{"use strict";Qt=require("inversify");jl();A();ae();H();Ah();Oh();wP();cm();jh();Xt=Symbol("ISourcePathResolverFactory"),La=class{constructor(e,t){this.fsUtils=e;this.linkedBp=t}create(e,t){if(e.type==="pwa-node"||e.type==="node-terminal"||e.type==="pwa-extensionHost")return new $e(this.fsUtils,$e.shouldWarnAboutSymlinks(e)?this.linkedBp:void 0,$e.getOptions(e),t);throw new Error(`Not usable for type ${e.type}`)}};La=f([(0,Qt.injectable)(),u(0,(0,Qt.inject)(mt)),u(1,(0,Qt.optional)()),u(1,(0,Qt.inject)(ql))],La);_a=class{constructor(e,t,r,o){this.initializeParams=e;this.vueMapper=t;this.fsUtils=r;this.linkedBp=o}create(e,t){if(e.type==="pwa-node"||e.type==="node-terminal"||e.type==="pwa-extensionHost")return new $e(this.fsUtils,$e.shouldWarnAboutSymlinks(e)?this.linkedBp:void 0,$e.getOptions(e),t);{let r=!!e.inspectUri;return new(r?Da:yr)(this.vueMapper,this.fsUtils,{workspaceFolder:e.__workspaceFolder,resolveSourceMapLocations:e.resolveSourceMapLocations,baseUrl:bP(e),localRoot:null,remoteRoot:null,pathMapping:{"/":e.webRoot,...e.pathMapping},sourceMapOverrides:e.sourceMapPathOverrides,clientID:this.initializeParams.clientID,remoteFilePrefix:e.__remoteFilePrefix},t)}}};_a=f([(0,Qt.injectable)(),u(0,(0,Qt.inject)(Mt)),u(1,(0,Qt.inject)(wa)),u(2,(0,Qt.inject)(mt)),u(3,(0,Qt.optional)()),u(3,(0,Qt.inject)(ql))],_a)});var SP,lm,mL,IP=m(()=>{"use strict";SP=require("url");N();zd();ti();lm=class extends Fi{constructor(){super(...arguments);this.baseFilter=si(this.launchParams);this.filter=t=>{let{debugWebWorkerExtHost:r,debugWebviews:o}=this.launchParams;return!!(r&&(t.type==="worker"&&t.title==="DebugWorkerExtensionHost"||t.type==="page"&&t.title.includes("[Extension Development Host]"))||o&&t.type==="iframe"&&this.baseFilter(t))}}static async connectRenderer(t,r,o,n,s,a){let l=await t.rootSession().Target.attachToBrowserTarget({});if(!l)return;let p=t.createSession(l.sessionId);return new this(t,void 0,p,r,n,s,o,a)}waitForMainTarget(t){let r=this.launchParams;return r.debugWebWorkerExtHost&&this._browser.Target.on("targetCreated",this.enqueueLifecycleFn(async({targetInfo:o})=>{if(!o.url.includes(r.__sessionId))return;let n=await this._browser.Target.attachToTarget({targetId:o.targetId,flatten:!0});n&&this.attachedToTarget(o,n.sessionId,!1)})),super.waitForMainTarget(t)}attachedToTarget(t,r,o,n){let s=super.attachedToTarget(t,r,o||this.filter(t),n,!1);return t.type==="iframe"&&s.setComputeNameFn(mL),s}},mL=i=>{let e;try{e=new SP.URL(i.targetInfo.url)}catch{return}switch(e.searchParams.get("purpose")){case"customEditor":return`${e.searchParams.get("extensionId")} editor: ${e.host}`;case"notebookRenderer":return`Notebook Renderer: ${e.host}`;default:let t=e.searchParams.get("extensionId");return`Webview: ${t?t+" ":""} ${e.host}`}}});var Ea,PP,Mr,Uh=m(()=>{"use strict";Ea=require("inversify"),PP=require("net");We();Bn();A();ze();_();Ft();$();Wn();Vl();IP();Mr=class extends wr{constructor(t,r,o){super(t,r);this.pathResolverFactory=o}async launch(t,r){if(t.type!=="pwa-extensionHost"||t.request!=="attach")return{blockSessionTermination:!1};let o=Mr.debugIdToRendererDebugPort.get(t.__sessionId);if(!o)return{blockSessionTermination:!1};let n=Ds({name:"Webview",type:"pwa-chrome",request:"attach",port:o,__workspaceFolder:t.__workspaceFolder,urlFilter:"",resolveSourceMapLocations:t.resolveSourceMapLocations,...t.rendererDebugOptions});return n.__sessionId=t.__sessionId,n.debugWebWorkerExtHost=t.debugWebWorkerHost,n.debugWebviews=t.debugWebviews,super.launch(n,r).catch(s=>this.logger.error("runtime.exception","Error in webview attach",{err:s})),{blockSessionTermination:!1}}async acquireConnectionInner(t,r,o){let n=new j,s=await new Promise((a,c)=>{let l=(0,PP.createConnection)({port:r.port},()=>a(l));l.on("error",c),n.push(o.onCancellationRequested(()=>{l.destroy(),c(new Error("connection timed out"))}))}).finally(()=>n.dispose());return new Ue(new xt(this.logger,s),this.logger,t)}async getTargetFilter(t){return t.filter}async createTargetManager(t,r,o){return new lm(t,void 0,t.rootSession(),this.pathResolverFactory.create(r,this.logger),this.logger,o.telemetryReporter,r,o.targetOrigin)}};Mr.debugIdToRendererDebugPort=new Map,Mr=f([(0,Ea.injectable)(),u(0,(0,Ea.inject)(C)),u(1,(0,Ea.inject)(ge)),u(2,(0,Ea.inject)(Xt))],Mr)});var pm,kP=m(()=>{"use strict";_();pm=class i{constructor(){this.target={queue:[]}}connectTo(e){this.target={logger:e}}info(e,t,r){this.log({tag:e,timestamp:Date.now(),message:t,metadata:r,level:1})}verbose(e,t,r){this.log({tag:e,timestamp:Date.now(),message:t,metadata:r,level:0})}warn(e,t,r){this.log({tag:e,timestamp:Date.now(),message:t,metadata:r,level:2})}error(e,t,r){this.log({tag:e,timestamp:Date.now(),message:t,metadata:r,level:3})}fatal(e,t,r){this.log({tag:e,timestamp:Date.now(),message:t,metadata:r,level:4})}log(e){this.target&&("queue"in this.target?this.target.queue.push(e):this.target.logger.log(e))}getRecentLogs(){return this.target?"queue"in this.target?this.target.queue:this.target.logger.getRecentLogs():[]}assert(e,t){if(e===!1||e===void 0||e===null){if(this.error("runtime.assertion",t,{error:new Error("Assertion failed")}),process.env.JS_DEBUG_THROW_ASSERTIONS)throw new Error(t);debugger;return!1}return!0}setup(){throw new Error("A ProxyLogger cannot be setup()")}dispose(){this.target=void 0}forTarget(){return new i}}});var xP,um,dm,mm=m(()=>{"use strict";xP=Symbol("ITargetOrigin"),um=class{constructor(e){this.id=e}},dm=class{constructor(e){this.id=e}}});var gm,CP=m(()=>{"use strict";A();Ul();O();kP();mm();gm=class{constructor(e,t){this.parentList=e;this.logger=t;this.targets=new so;this.onTerminatedEmitter=new S;this.onTerminated=this.onTerminatedEmitter.event;this.onTargetListChanged=this.targets.onChanged;e.onAdd(([,r])=>{r.parent&&this.targets.get(r.parent.id)&&this.targets.add(r.id,r.target)}),e.onRemove(([r])=>{this.targets.remove(r)&&!this.targets.size&&this.onTerminatedEmitter.fire({killed:!0,code:0})})}async launch(e,t){if(e.type!=="node-terminal"||e.request!=="attach")return{blockSessionTermination:!1};let r=this.parentList.get(e.delegateId);if(r===void 0)return setTimeout(()=>this.onTerminatedEmitter.fire({killed:!0,code:0}),1),{blockSessionTermination:!0};let o=r.target.targetOrigin();if(!(o instanceof dm))throw new Error("Expected delegate session to have a mutable target origin");let n=r.target.logger;if(!(n instanceof pm))throw new Error("Expected delegate session to have a proxy logger");return o.id=t.targetOrigin.id,n.connectTo(this.logger),setTimeout(()=>{this.targets.add(e.delegateId,r.target),r.dap.connect(t.dap)},0),{blockSessionTermination:!0}}terminate(){for(let e of this.targets.value())e.stop();return Promise.resolve()}restart(){for(let e of this.targets.value())e.restart();return Promise.resolve()}targetList(){return[...this.targets.value()]}dispose(){this.terminate()}}});var TP,gL,Vn,RP=m(()=>{"use strict";Ul();CP();TP=require("inversify"),gL=0,Vn=class{constructor(){this.delegateSessions=new so;this.refsByTarget=new WeakMap}createLauncher(e){return new gm(this.delegateSessions,e)}addDelegate(e,t,r){let o={id:gL++,target:e,dap:t,parent:r&&this.refsByTarget.get(r)};return this.refsByTarget.set(e,o),this.delegateSessions.add(o.id,o),o.id}removeDelegate(e){let t=this.refsByTarget.get(e);t&&this.delegateSessions.remove(t.id)}};Vn=f([(0,TP.injectable)()],Vn)});var me,Wh=m(()=>{"use strict";me=class i{constructor(e,t,r){this.major=e;this.minor=t;this.patch=r}static parse(e){let t=e.split(".").map(Number);if(t.length!==3||t.some(isNaN))throw new SyntaxError(`Input string '${e}' is not a semver`);return new i(t[0],t[1],t[2])}static min(e,t){return e.lt(t)?e:t}compare(e){return this.major-e.major||this.minor-e.minor||this.patch-e.patch}gt(e){return this.compare(e)>0}gte(e){return this.compare(e)>=0}lt(e){return this.compare(e)<0}lte(e){return this.compare(e)<=0}toString(){return`${this.major}.${this.minor}.${this.patch}`}}});var fm,DP=m(()=>{"use strict";ze();O();aa();fm=class{constructor(e,t){this.sessionId=e;this.sink=t;this.onMessageEmitter=new S;this.onEndEmitter=new S;this.disposables=new j;this.onMessage=this.onMessageEmitter.event;this.onEnd=this.onEndEmitter.event;this.disposables.push(t.NodeWorker.on("detachedFromWorker",r=>{r.sessionId===e&&(this.onEndEmitter.fire(),this.dispose())}),t.NodeWorker.on("receivedMessageFromWorker",r=>{r.sessionId===e&&this.onMessageEmitter.fire([r.message,new gr])}))}send(e){this.sink.NodeWorker.sendMessageToWorker({message:e,sessionId:this.sessionId})}dispose(){this.disposables.isDisposed||(this.disposables.dispose(),this.onEndEmitter.fire())}}});var LP,_P=m(()=>{"use strict";LP=":::"});var Vh,iz,EP,AP=m(()=>{"use strict";Vh=require("path"),iz=(0,Vh.join)(__dirname,"watchdog.js"),EP=(0,Vh.join)(__dirname,"bootloader.js")});var zl,FP,$n,Aa,hm=m(()=>{"use strict";zl=require("inversify"),FP=require("path");A();ae();M();N();$();$n=Symbol("IPackageJsonProvider"),Aa=class{constructor(e,t){this.fs=e;this.config=t;this.getPath=F(async()=>{if(this.config.type!=="pwa-node"||this.config.request!=="launch")return;let e=await Is(this.fs,this.config.cwd,"package.json");return e?(0,FP.join)(e,"package.json"):void 0});this.getContents=F(async()=>{let e=await this.getPath();if(e)try{let t=await this.fs.readFile(e);return JSON.parse(t.toString())}catch{return}})}};Aa=f([(0,zl.injectable)(),u(0,(0,zl.inject)(mt)),u(1,(0,zl.inject)(X))],Aa)});function bm(i,e){return i.has(1)?e.addNodeOption("--inspect-publish-uid=http"):e}var Kl,vr,po,uo,fL,MP,NP,$h,hL,bL,Tt,Jl,wL,yL,Gl,Fa,qn=m(()=>{"use strict";Kl=w(require("@vscode/l10n")),vr=require("inversify"),po=require("path");ao();ae();_();ee();Od();Wh();N();le();oe();H();hm();uo=Symbol("INodeBinaryProvider");fL=new Set(["npm","yarn","pnpm","tnpm","cnpm"]),MP=i=>fL.has((0,po.basename)(i,(0,po.extname)(i))),NP=(i,e)=>{if(!(!i||!MP(i)))return e.find(t=>!t.startsWith("-")&&t!=="run"&&t!=="run-script")},$h=new me(12,0,0),hL=new me(8,0,0),bL=[{inclusiveMin:new me(16,0,0),inclusiveMax:new me(16,3,99),message:Kl.t("Some breakpoints might not work in your version of Node.js. We recommend upgrading for the latest bug, performance, and security fixes. Details: https://aka.ms/AAcsvqm")},{inclusiveMin:new me(7,0,0),inclusiveMax:new me(8,99,99),message:Kl.t("You're running an outdated version of Node.js. We recommend upgrading for the latest bug, performance, and security fixes.")}],Tt=class{constructor(e,t){this.path=e;this.version=t;this.capabilities=new Set;t===void 0&&(t=$h),t.gte(new me(12,0,0))&&this.capabilities.add(0),t.gte(new me(12,6,0))&&this.capabilities.add(1)}get isPreciselyKnown(){return this.version!==void 0}get warning(){if(this.version){for(let e of bL)if(e.inclusiveMax.gte(this.version)&&e.inclusiveMin.lte(this.version))return e}}has(e,t){return!this.isPreciselyKnown&&t!==void 0?t:this.capabilities.has(e)}},Jl=class extends I{constructor(t,r){super(Ly(t.toString(),r));this.version=t;this.location=r}},wL=["node","node64","electron"],yL=new Map([[11,new me(12,0,0)],[10,new me(12,0,0)],[9,new me(12,0,0)],[8,new me(12,0,0)],[7,new me(12,0,0)],[6,new me(12,0,0)],[5,new me(10,0,0)],[4,new me(10,0,0)],[3,new me(10,0,0)],[2,new me(8,0,0)],[1,new me(8,0,0)]]),Gl=class{constructor(e,t,r){this.logger=e;this.fs=t;this.packageJson=r;this.knownGoodMappings=new Map}async resolveAndValidate(e,t="node",r,o){try{return await this.resolveAndValidateInner(e,t,r,o)}catch(n){if(!(n instanceof Jl))throw n;if(await this.shouldTryDebuggingAnyway(n))return new Tt(n.location,n.version instanceof me?n.version:void 0);throw n}}shouldTryDebuggingAnyway(e){return Promise.resolve(!1)}async resolveAndValidateInner(e,t,r,o){let n=await this.resolveBinaryLocation(t,e);if(this.logger.info("runtime.launch","Using binary at",{location:n,executable:t}),!n)throw new I(Xg(t,Kl.t("path does not exist")));if(r)return new Tt(n,new me(r,0,0));let s=eu(n);if(!wL.includes(s)){if(MP(n)){let D=await this.packageJson.getPath();D&&(e=e.addToPath((0,po.resolve)((0,po.dirname)(D),"node_modules/.bin"),"prepend"))}try{let D=await this.resolveAndValidateInner(e,"node",void 0,o);return new Tt(n,D.version)}catch(D){if(By(D,9230))throw D;return new Tt(n,void 0)}}if(n.startsWith("/snap/"))return new Tt(n,void 0);let a=this.knownGoodMappings.get(n);if(a)return a;let c=await this.getVersionText(n,o);if(!c)return new Tt(n,void 0);this.logger.info("runtime.launch","Discovered version",{version:c});let l=/v([0-9]+)\.([0-9]+)\.([0-9]+)/.exec(c);if(!l)throw new Jl(c,n);let[,p,d,b]=l.map(Number),y=new me(p,d,b);if(s==="electron"){let D=await this.resolveAndValidate(e);y=me.min(yL.get(y.major)??$h,D.version??$h)}if(y.lt(hL))throw new Jl(y,n);let v=new Tt(n,y);return this.knownGoodMappings.set(n,v),v}async resolveBinaryLocation(e,t){return e&&(0,po.isAbsolute)(e)?await Fw(this.fs,e,t):await bs(this.fs,e,t.value)}async getVersionText(e,t){try{let{stdout:r}=await Bd(e,["--version"],{env:de.processEnv().defined(),cwd:t});return r.trim()}catch(r){throw t&&!(await Vt(this.fs,t))?.isDirectory()?new I(Dy(t)):new I(Xg(e,r.message))}}};Gl=f([(0,vr.injectable)(),u(0,(0,vr.inject)(C)),u(1,(0,vr.inject)(G)),u(2,(0,vr.inject)($n))],Gl);Fa=class extends Gl{constructor(t,r,o,n){super(t,r,o);this.vscode=n}async shouldTryDebuggingAnyway({message:t}){if(!this.vscode)return!1;let r=Kl.t("Yes");return await this.vscode.window.showErrorMessage(t,r)===r}};Fa=f([u(0,(0,vr.inject)(C)),u(1,(0,vr.inject)(G)),u(2,(0,vr.inject)($n)),u(3,(0,vr.optional)()),u(3,(0,vr.inject)(ar))],Fa)});var BP,wm,OP=m(()=>{"use strict";BP=require("path");O();_();N();wm=class{constructor(e,t,r,o,n,s,a={},c){this.launchConfig=e;this.targetOriginValue=t;this.connection=r;this.targetInfo=n;this.logger=s;this.lifecycle=a;this._parent=c;this._serialize=Promise.resolve(void 0);this._attached=!1;this._onNameChangedEmitter=new S;this._onDisconnectEmitter=new S;this.entryBreakpoint=void 0;this.onDisconnect=this._onDisconnectEmitter.event;this.onNameChanged=this._onNameChangedEmitter.event;this.connection=r,this._cdp=o,o.pause(),this._waitingForDebugger=n.type==="waitingForDebugger",n.title?this._targetName=`${(0,BP.basename)(n.title)} [${n.processId}]`:this._targetName=`[${n.processId}]`,o.Target.on("targetDestroyed",()=>this.connection.close()),r.onDisconnected(()=>this._disconnected())}id(){return this.targetInfo.targetId}processId(){return this.targetInfo.processId}name(){return this._targetName}fileName(){return this.targetInfo.title}type(){return"node"}targetOrigin(){return this.targetOriginValue}parent(){return this._parent}async initialize(){this.lifecycle.initialized&&(this.entryBreakpoint=await this.lifecycle.initialized(this)||void 0)}waitingForDebugger(){return this._waitingForDebugger}scriptUrlToUrl(e){return e[0]==="/"||process.platform==="win32"&&e[1]===":"&&e[2]==="\\"?W(e):e}supportsCustomBreakpoints(){return!1}supportsXHRBreakpoints(){return!1}executionContextName(){return this._targetName}hasParent(){return!!this._parent}async runIfWaitingForDebugger(){await this._cdp.Runtime.runIfWaitingForDebugger({})}async _disconnected(){this._onDisconnectEmitter.fire()}canAttach(){return!this._attached}async attach(){return this._serialize=this._serialize.then(async()=>{if(!this._attached)return this._doAttach()}),this._serialize}async _doAttach(){this._waitingForDebugger=!1,this._attached=!0;let e=await this._cdp.Target.attachToTarget({targetId:this.targetInfo.targetId});if(!e){this.logger.info("runtime.launch","Failed to attach to target",{targetId:this.targetInfo.targetId});return}this._cdp.NodeWorker.enable({waitForDebuggerOnStart:!0}),e&&"__dynamicAttach"in e&&(await this._cdp.Runtime.enable({}),await this._cdp.Debugger.enable({}));let t;return this._cdp.Runtime.on("executionContextCreated",r=>{r.context.auxData&&r.context.auxData.isDefault&&(t=r.context.id)}),this._cdp.Runtime.on("executionContextDestroyed",r=>{r.executionContextId===t&&this.connection.close()}),this._cdp}async afterBind(){this._cdp.resume()}canDetach(){return this._attached}async detach(){this._serialize=this._serialize.then(async()=>{this._waitingForDebugger&&await(await this._doAttach())?.Runtime.runIfWaitingForDebugger({}),this._attached&&this._doDetach()})}async _doDetach(){await Promise.all([this._cdp.Target.detachFromTarget({targetId:this.targetInfo.targetId}),this._cdp.NodeWorker.disable({})]),this.connection.close(),this._attached=!1}canRestart(){return!1}restart(){}canStop(){return!0}stop(){try{this.lifecycle.close&&this.lifecycle.close(this)}finally{this.connection.close()}}}});function vL(i){if(!mo.existsSync(i))return{};let e=SL(mo.readFileSync(i,"utf8"));return jP.parse(Buffer.from(e))}function SL(i){return i&&i[0]==="\uFEFF"&&(i=i.substr(1)),i}var jP,mo,Hn,UP,qh,Hh,Sr,Ql=m(()=>{"use strict";jP=w(require("dotenv")),mo=w(require("fs")),Hn=require("inversify"),UP=w(require("net")),qh=w(require("os")),Hh=w(require("path"));No();Ke();We();Bn();DP();Ve();A();Ul();ze();ao();O();_();M();ee();U();le();oe();Wn();_P();AP();qn();OP();Ff();Sr=class{constructor(e,t,r,o){this.pathProvider=e;this.logger=t;this.portLeaseTracker=r;this.pathResolverFactory=o;this.serverConnections=new Set;this.targets=new so;this.onTerminatedEmitter=new S;this.onTerminated=this.onTerminatedEmitter.event;this.onTargetListChanged=this.targets.onChanged;this.bootloaderFile=F(this.getBootloaderFile.bind(this))}async launch(e,t){let r=this.resolveParams(e);if(!r)return{blockSessionTermination:!1};this._stopServer();let{server:o,pipe:n}=await this._startServer(t.telemetryReporter),s=this.logger.forTarget(),a=this.run={server:o,serverAddress:n,params:r,context:t,logger:s,pathResolver:this.pathResolverFactory.create(r,this.logger)};return await this.launchProgram(a),{blockSessionTermination:!0}}async terminate(){this.program?await this.program.stop():this.onProgramTerminated({code:0,killed:!0})}async restart(e){if(!this.run)return;let t=this.program;t&&(this.program=void 0,await t.stop(),await Promise.race([x(2e3).then(()=>!1),Promise.all([...this.serverConnections].map(o=>new Promise(n=>o.onDisconnected(n))))])||(this.logger.warn("runtime.launch","Timeout waiting for server connections to close"),this.closeAllConnections())),await this.launchProgram({...this.run,params:e?this.resolveParams(e)??this.run.params:this.run.params,context:{...this.run.context,cancellationToken:this.run.params.timeout>0?ie.withTimeout(this.run.params.timeout).token:Ne}})}targetList(){return[...this.targets.value()]}dispose(){this._stopServer()}onProgramTerminated(e){this.onTerminatedEmitter.fire(e),this._stopServer(),this.program=void 0}resolveNodePath(e,t="node"){return this.pathProvider.resolveAndValidate(de.merge(de.processEnv(),this.getConfiguredEnvironment(e)),t,e.nodeVersionHint,e.cwd)}getConfiguredEnvironment(e){let t=de.empty;if(e.envFile)try{t=t.merge(vL(e.envFile))}catch(r){throw new I(Ry(r.message))}return t.merge(e.env)}async resolveEnvironment({params:e,serverAddress:t},r,o){let n=this.getConfiguredEnvironment(e),s=await this.bootloaderFile(e.cwd,r),a={inspectorIpc:t,deferredMode:!1,waitForDebugger:"",execPath:await bs(mo.promises,"node",process.env),onlyEntrypoint:!e.autoAttachChildProcesses,verbose:e.trace===!0||typeof e.trace=="object"&&e.trace.stdio?!0:void 0,autoAttachMode:"always",mandatePortTracking:this.portLeaseTracker.isMandated?!0:void 0,...o},c={NODE_OPTIONS:` --require ${s.interpolatedPath} `,VSCODE_INSPECTOR_OPTIONS:LP+JSON.stringify(a),ELECTRON_RUN_AS_NODE:null},l=n.lookup("NODE_OPTIONS");l&&(c.NODE_OPTIONS+=` ${l}`);let p=de.processEnv().lookup("NODE_OPTIONS");return p&&(c.NODE_OPTIONS+=` ${p}`),n.merge({...c})}createLifecycle(e,t,r){return{}}async _startServer(e){let t=Aw(),r=await new Promise((o,n)=>{let s=UP.createServer(a=>this._startSession(a,e)).on("error",n).listen(t,()=>o(s))});return{pipe:t,server:r}}_stopServer(){this.run?.server.close(),this.run=void 0,this.bootloaderFile.value?.then(e=>e.dispose()),this.bootloaderFile.forget(),this.closeAllConnections()}closeAllConnections(){this.serverConnections.forEach(e=>e.close()),this.serverConnections.clear()}async _startSession(e,t){if(!this.run)return;let{connection:r,cdp:o,targetInfo:n}=await this.acquireTarget(e,t,this.run.logger);if(!this.run){e.destroy();return}n.processId===void 0&&(n.processId=Number(n.targetId));let s=new wm(this.run.params,this.run.context.targetOrigin,r,o,n,this.run.logger,this.createLifecycle(o,this.run,n),n.openerId?this.targets.get(n.openerId):void 0);this.listenToWorkerDomain(o,t,s),this.targets.add(n.targetId,s),s.onDisconnect(()=>this.targets.remove(n.targetId))}async listenToWorkerDomain(e,t,r){e.NodeWorker.on("attachedToWorker",o=>{let n=new fm(o.sessionId,e),s=new ca(r.launchConfig,{attached:!0,canAccessOpener:!1,type:"node-worker",targetId:`${r.id()}-${o.sessionId}`,title:o.workerInfo.title,url:o.workerInfo.url,openerId:r.id()},r,r.targetOrigin(),new Ue(n,r.logger,t).rootSession(),r.logger),a=new j;a.push(n),a.push(r.onDisconnect(()=>a.dispose())),a.push(n.onEnd(()=>a.dispose())),a.callback(()=>this.targets.remove(s.id())),this.targets.add(s.id(),s)})}async acquireTarget(e,t,r){let o=new Ue(new xt(r,e),r,t);this.serverConnections.add(o),o.onDisconnected(()=>this.serverConnections.delete(o));let n=o.rootSession(),{targetInfo:s}=await new Promise(l=>n.Target.on("targetCreated",l)),a=s,c=this.portLeaseTracker.register(a.processInspectorPort);return o.onDisconnected(()=>c.dispose()),{targetInfo:a,cdp:n,connection:o,logger:r}}async getBootloaderFile(e,t){let r=B(EP);if(!r.includes(" "))return{interpolatedPath:r,dispose:()=>{}};if(t.has(0))return{interpolatedPath:`"${r}"`,dispose:()=>{}};let o=`require(${JSON.stringify(r)})`;if(!qh.tmpdir().includes(" ")||!e){let a=Hh.join(qh.tmpdir(),"vscode-js-debug-bootloader.js");return await mo.promises.writeFile(a,o),{interpolatedPath:a,dispose:()=>{}}}let n=".vscode-js-debug-bootloader.js",s=Hh.join(e,n);return await mo.promises.writeFile(s,o),{interpolatedPath:`./${n}`,dispose:()=>mo.unlinkSync(s)}}async gatherTelemetryFromCdp(e,t){for(let r=0;r<8;r++){let o=await e.Runtime.evaluate({contextId:1,returnByValue:!0,expression:"typeof process === 'undefined' || process.pid === undefined ? 'process not defined' : ({ processId: process.pid, nodeVersion: process.version, architecture: process.arch })"+Pe()});if(!this.program)return;if(!o||!o.result.value){this.logger.error("runtime.target","Undefined result getting telemetry");return}if(typeof o.result.value!="object"){this.logger.info("runtime.target","Process not yet defined, will retry"),await x(50*2**r);continue}let n=o.result.value;return t.context.telemetryReporter.report("nodeRuntime",{version:n.nodeVersion,arch:n.architecture}),this.program.gotTelemetery(n),n}}};Sr=f([(0,Hn.injectable)(),u(0,(0,Hn.inject)(uo)),u(1,(0,Hn.inject)(C)),u(2,(0,Hn.inject)(bt)),u(3,(0,Hn.inject)(Xt))],Sr)});var WP,IL,ji,zh=m(()=>{"use strict";WP=require("inversify");Ke();_();U();Ql();IL=["NODE_OPTIONS","VSCODE_INSPECTOR_OPTIONS"],ji=class extends Sr{async appendEnvironmentVariables(e,t){let r="typeof process==='undefined'||process.pid===undefined?'process not defined':(()=>{"+Object.entries(t.defined()).map(([o,n])=>{let s=JSON.stringify(o);return IL.includes(o)?`process.env[${s}]=(process.env[${s}]||'')+${JSON.stringify(n)}`:`process.env[${s}]=${JSON.stringify(n)}`}).join(";")+"})()"+Pe();for(let o=0;o<5;o++){let n=await e.Runtime.evaluate({contextId:1,returnByValue:!0,expression:r});if(!n){this.logger.error("runtime.target","Undefined result setting child environment vars");return}if(!n.exceptionDetails&&n.result.value!=="process not defined")return;this.logger.error("runtime.target","Error setting child environment vars",n),await x(50)}}};ji=f([(0,WP.injectable)()],ji)});function PL(i){try{return process.kill(i,0),!0}catch{return!1}}var ym,vm,zn,Ui,Ma,Gn=m(()=>{"use strict";va();ym=class{constructor(e,t){this.a=e;this.b=t;this.stopped=Promise.race([this.a.stopped.then(async e=>await this.b.stop()&&e),this.b.stopped.then(async e=>await this.a.stop()&&e)])}gotTelemetery(e){this.a.gotTelemetery(e),this.b.gotTelemetery(e)}async stop(){return(await Promise.all([this.a.stop(),this.b.stop()]))[0]}},vm=class{constructor(e,t,r){this.child=e;this.logger=t;this.killBehavior=r;this.killed=!1;this.stopped=new Promise((o,n)=>{e.once("exit",s=>o({killed:this.killed,code:s||0})),e.once("error",s=>n({killed:this.killed,code:1,error:s}))})}gotTelemetery(){}stop(){return this.killed=!0,Kt(this.child.pid,this.logger,this.killBehavior),this.stopped}},zn=class{constructor(){this.stopped=new Promise(e=>this.stopDefer=e)}gotTelemetery(e){this.telemetry=e}stop(){return this.stopDefer({code:0,killed:!0}),this.stopped}},Ui=class extends zn{constructor(t){super();this.wd=t;t.onEnd(r=>{this.stopDefer(r),this.wd.dispose()})}stop(){return this.wd.dispose(),this.stopped}},Ma=class i{constructor(e,t,r){this.terminalResult=e;this.logger=t;this.killBehavior=r;this.didStop=!1;this.stopped=new Promise(e=>this.onStopped=t=>{this.didStop=!0,e({code:0,killed:t})});e.processId&&this.startPollLoop(e.processId)}static{this.terminationPollInterval=1e3}static{this.killConfirmInterval=200}gotTelemetery({processId:e}){if(this.didStop){Kt(e,this.logger,this.killBehavior);return}this.loop||this.startPollLoop(e)}stop(){return this.didStop?this.stopped:(this.didStop=!0,this.loop?(Kt(this.loop.processId,this.logger,this.killBehavior),this.startPollLoop(this.loop.processId,i.killConfirmInterval)):this.terminalResult.shellProcessId?(Kt(this.terminalResult.shellProcessId,this.logger,this.killBehavior),this.startPollLoop(this.terminalResult.shellProcessId,i.killConfirmInterval)):this.onStopped(!0),this.stopped)}startPollLoop(e,t=i.terminationPollInterval){this.loop&&clearInterval(this.loop.timer);let r={processId:e,timer:setInterval(()=>{PL(e)||(clearInterval(r.timer),this.onStopped(!0))},t)};this.loop=r}}});var VP,$P,qP=m(()=>{"use strict";VP=require("crypto"),$P=()=>(0,VP.randomBytes)(12).toString("hex")});var HP,go,Xl=m(()=>{"use strict";HP=w(require("net"));Bn();Nn();Ve();O();Er();qP();go=class i{constructor(e,t){this.info=e;this.server=t;this.onEndEmitter=new S;this.cts=new ie;this.gracefulExit=!1;this.targetAlive=!1;this.targetInfo={targetId:this.info.ownId??$P(),processId:Number(this.info.pid)||0,type:this.info.waitForDebugger?"waitingForDebugger":"",title:this.info.scriptName,url:"file://"+this.info.scriptName,openerId:this.info.openerId,attached:!0,canAccessOpener:!1,processInspectorPort:Number(new URL(this.info.inspectorURL).port)};this.onEnd=this.onEndEmitter.event;this.listenToServer()}get isTargetAlive(){return this.targetAlive}static async attach(e){let t=await new Promise((o,n)=>{let s=HP.createConnection(e.ipcAddress,()=>o(s));s.on("error",n)}),r=new xt(E.null,t);return new i(e,r)}listenToServer(){let{server:e,targetInfo:t}=this;e.send(JSON.stringify({method:"Target.targetCreated",params:{targetInfo:t}})),e.onMessage(async([r])=>{if(this.target&&!r.includes("Target.attachToTarget")&&!r.includes("Target.detachFromTarget")){this.target.send(r);return}let o=await this.execute(r);o&&e.send(JSON.stringify(o))}),e.onEnd(()=>{this.disposeTarget(),this.onEndEmitter.fire({killed:this.gracefulExit,code:this.gracefulExit?0:1})})}dispose(){this.gracefulExit=!0,this.cts.dispose(!0),this.disposeTarget(),this.server.dispose()}async execute(e){let t=JSON.parse(e);switch(t.method){case"Target.attachToTarget":return this.target&&this.disposeTarget(),this.target=await this.createTarget(),{id:t.id,result:{sessionId:this.targetInfo.targetId,__dynamicAttach:this.info.dynamicAttach?!0:void 0}};case"Target.detachFromTarget":return this.gracefulExit=!0,this.disposeTarget(),{id:t.id,result:{}};default:this.target?.send(t);return}}async createTarget(){this.gracefulExit=!1;let e=await yt.create(this.info.inspectorURL,this.cts.token,this.info.remoteHostHeader);return e.onMessage(([t])=>this.server.send(t)),e.onEnd(()=>{e&&this.server.send(JSON.stringify({method:"Target.targetDestroyed",params:{targetId:this.targetInfo.targetId,sessionId:this.targetInfo.targetId}})),this.targetAlive=!1,this.server.dispose()}),e}disposeTarget(){this.target&&(this.target.dispose(),this.target=void 0)}}});var zP,Gh,Na,GP=m(()=>{"use strict";zP=require("inversify");A();Wh();$();On();va();zh();qn();Gn();Xl();Gh=class extends Ui{constructor(t,r){super(t);this.logger=r;this.stopped.then(()=>{this.telemetry&&Kt(this.telemetry.processId,this.logger,"polite")})}},Na=class extends ji{constructor(){super(...arguments);this.restarting=!1}async restart(){this.restarting=!0,this.onProgramTerminated({code:0,killed:!0,restart:!0}),this.program?.stop()}resolveParams(t){return t.type==="pwa-extensionHost"&&t.request==="attach"?t:void 0}async launchProgram(t){let r=await Sa(`http://localhost:${t.params.port}`,t.context.cancellationToken,this.logger),o=await go.attach({ipcAddress:t.serverAddress,scriptName:"Extension Host",inspectorURL:r,waitForDebugger:!0,dynamicAttach:!0}),n=this.program=new Gh(o,this.logger);this.program.stopped.then(s=>{n===this.program&&this.onProgramTerminated(s)})}createLifecycle(t,r,o){return o.openerId?{}:{initialized:()=>this.onFirstInitialize(t,r,o)}}async onFirstInitialize(t,r,o){this.setEnvironmentVariables(t,r,o.targetId);let n=await this.gatherTelemetryFromCdp(t,r),s=this.program;if(n&&s){let a=new Ma({processId:n.processId},this.logger,"forceful");a.stopped.then(()=>s.stop()),s.stopped.then(()=>{this.restarting||a.stop()})}}async setEnvironmentVariables(t,r,o){if(!r.params.autoAttachChildProcesses)return;let n=await this.resolveEnvironment(r,new Tt("node",me.parse(process.versions.node)),{openerId:o});return this.appendEnvironmentVariables(t,n.update("ELECTRON_RUN_AS_NODE",null))}};Na=f([(0,zP.injectable)()],Na)});var Yl,JP,Ba,kL,KP=m(()=>{"use strict";Yl=require("fs"),JP=require("inversify");A();yi();Uh();Ql();Gn();Ba=class extends Sr{resolveParams(e){return e.type==="pwa-extensionHost"&&e.request==="launch"?e:void 0}async launchProgram(e){let t=e.params.port||await Be(),r=await e.context.dap.launchVSCodeRequest({args:kL(e.params,t),env:this.getConfiguredEnvironment(e.params).defined(),debugRenderer:e.params.debugWebviews||e.params.debugWebWorkerHost});r.rendererDebugPort&&Mr.debugIdToRendererDebugPort.set(e.params.__sessionId,r.rendererDebugPort),this.program=new zn,this.program.stop()}};Ba=f([(0,JP.injectable)()],Ba);kL=(i,e)=>{let t=i.args.map(r=>{if(r.startsWith("-")){let o=r.split("=",2);return o.length===2&&((0,Yl.existsSync)(o[1])||(0,Yl.existsSync)(o[1]+".js"))?{prefix:o[0]+"=",path:o[1]}:{prefix:r}}else{try{let o=(0,Yl.lstatSync)(r);if(o.isDirectory())return{prefix:"--folder-uri=",path:r};if(o.isFile())return{prefix:"--file-uri=",path:r}}catch{}return{path:r}}});return i.noDebug||t.unshift({prefix:`--inspect-brk-extensions=${e}`}),t.unshift({prefix:`--debugId=${i.__sessionId}`}),t}});var QP,Zl,XP,YP,Ir,Jh=m(()=>{"use strict";QP=require("crypto"),Zl=require("fs"),XP=require("os"),YP=w(require("path")),Ir=class i{constructor(){this.disposed=!1;this.path=YP.join((0,XP.tmpdir)(),`node-debug-callback-${(0,QP.randomBytes)(8).toString("hex")}`);this.file=Zl.promises.open(this.path,"w")}static{this.updateInterval=1e3}static{this.recencyDeadline=2e3}static isValid(e){try{let t=(0,Zl.readFileSync)(e);return t.length?t.readDoubleBE()>Date.now()-i.recencyDeadline:!1}catch{return!1}}async startTouchLoop(){await this.touch(),this.disposed||(this.updateInterval=setInterval(()=>this.touch(),i.updateInterval))}async touch(e=()=>Date.now()){let t=await this.file,r=Buffer.alloc(8);r.writeDoubleBE(e()),await t.write(r,0,r.length,0)}async dispose(){if(!this.disposed){this.disposed=!0,this.updateInterval&&clearInterval(this.updateInterval);try{await(await this.file).close(),await Zl.promises.unlink(this.path)}catch{}}}}});var ZP,ek,Oa,Kh=m(()=>{"use strict";ZP=require("child_process"),ek=w(require("split2")),Oa=class{constructor(e=ZP.spawn){this.spawn=e}lookup(e,t){return new Promise((r,o)=>{let n=this.createProcess(),s=this.createParser();n.on("error",o),n.stderr.on("error",a=>o(`Error finding processes: ${a.toString()}`)),n.stdout.pipe((0,ek.default)(/\r?\n/)).on("data",a=>{let c=s(a);c&&(t=e(c,t))}),n.on("close",(a,c)=>{a===0?r(t):c?o(new Error(`process terminated with signal: ${c}`)):a&&o(new Error(`process terminated with exit code: ${a}`))})})}}});var tk,Wi,Sm=m(()=>{"use strict";tk=require("path");Od();Kh();Wi=class extends Oa{constructor(t){super();this.fsUtils=t}async getWorkingDirectory(t){try{let{stdout:r}=await Bd("lsof",["-a","-dcwd","-Fn",`-p${t}`]),o=r.trim().split(`
`).pop().slice(1);return o&&(0,tk.isAbsolute)(o)&&await this.fsUtils.exists(o)?o:void 0}catch(r){if(r instanceof An)return;throw r}}createProcess(){return this.spawn("ps",["-xo",`pid=PID,ppid=PPID,comm=${"a".repeat(256)},command=COMMAND`])}createParser(){let t;return r=>{if(!t){t=r.indexOf("COMMAND");return}let o=/^\W*([0-9]+)\W*([0-9]+)\W*/.exec(r);if(o)return{pid:Number(o[1]),ppid:Number(o[2]),command:r.slice(o[0].length,t).trim(),args:r.slice(t).trim()}}}}});var ja,Qh=m(()=>{"use strict";Sm();ja=class extends Wi{createProcess(){return this.spawn("ps",["-axo","pid=PID,ppid=PPID,comm:30,command=COMMAND"])}createParser(){let e=super.createParser();return t=>{let r=e(t);if(!r)return;let o=r.args.indexOf(r.command);if(o===-1)return r;for(o=o+r.command.length;o<r.args.length&&r.args[o]!==" ";)o++;return r.command=r.args.substr(0,o),r.args=r.args.substr(o+1),r}}}});var rk,Ua,Xh=m(()=>{"use strict";rk=require("path");Kh();Ua=class extends Oa{async getWorkingDirectory(){}createProcess(){let e=(0,rk.join)(process.env.WINDIR||"C:\\Windows","System32","wbem","WMIC.exe");return this.spawn(e,["process","get","CommandLine,CreationDate,ParentProcessId,ProcessId"])}createParser(){let e=/^(.*)\s+([0-9]+)\.[0-9]+[+-][0-9]+\s+([0-9]+)\s+([0-9]+)$/;return t=>{let r=e.exec(t.trim());if(!r||r.length!==5)return;let o=Number(r[4]),n=Number(r[3]),s=Number(r[2]),a=r[1].trim();if(!isNaN(o)&&!isNaN(n)&&a){let c=a;if(a[0]==='"'){let l=a.indexOf('"',1);l>0&&(c=a.substr(1,l-1),a=a.substr(l+2))}else{let l=a.indexOf(" ");l>0?(c=a.substr(0,l),a=a.substr(l+1)):a=""}return{pid:o,ppid:n,command:c,args:a,date:s}}}}}});function Yh(i){let e=/--inspect(-brk)?(=((\[[0-9a-fA-F:]*\]|[0-9]+\.[0-9]+\.[0-9]+\.[0-9]+|[a-zA-Z0-9\.]*):)?(\d+))?/,t=/--inspect-port=(\d+)/,r,o,n=e.exec(i);return n&&n.length>=1&&(n.length>=5&&n[4]&&(r=n[4]),n.length>=6&&n[5]&&(o=parseInt(n[5]))),n=t.exec(i),n&&n.length===2&&(o=parseInt(n[1])),{address:r,port:o}}var ik,ok,Jn,Im=m(()=>{"use strict";ik=require("fs");ae();Sm();Qh();Xh();ok=new se(ik.promises),Jn=process.platform==="win32"?new Ua:process.platform==="darwin"?new Wi(ok):new ja(ok)});async function nk(i,e,t,r=Ne){let o=await xL(i.pid,t);if(!o)return[];let n=[],s=o.children.slice();for(;s.length;){let a=s.pop();s=s.concat(a.children);let{port:c}=Yh(a.args);c&&n.push(_h(`http://${i.hostname}:${c}`,r,t,!0).then(l=>go.attach({ipcAddress:i.ipcAddress,scriptName:"Child Process",inspectorURL:l,waitForDebugger:!0,dynamicAttach:!0,pid:String(a.pid),openerId:e})).catch(l=>t.info("internal","Could not spawn WD for child process",{err:l,port:c,child:a})))}return(await Promise.all(n)).filter(a=>!!a)}async function xL(i,e){let t=new Map;t.set(0,{children:[],pid:0,ppid:0,command:"",args:""});try{await Jn.lookup(({pid:o,ppid:n,command:s,args:a})=>(o!==n&&t.set(o,{pid:o,ppid:n,command:s,args:a,children:[]}),t),null)}catch(o){e.warn("internal","Error getting child process tree",o);return}let r=t.values();for(let o of r){let n=t.get(o.ppid);n&&n!==o&&n.children.push(o)}return!isNaN(i)&&i>0?t.get(i):t.get(0)}var sk=m(()=>{"use strict";_();Xl();Ve();Im();On()});var ak,fo,Pm,Zh,km=m(()=>{"use strict";ak=require("inversify"),fo=class{create(e){return e===!1?new Zh:e===!0?new Pm({maxAttempts:1/0,delay:1e3}):new Pm({maxAttempts:e.maxAttempts??1/0,delay:e.delay??1e3})}};fo=f([(0,ak.injectable)()],fo);Pm=class i{constructor(e,t=0){this.options=e;this.attempt=t}get delay(){return this.options.delay}next(){return this.attempt===this.options.maxAttempts?void 0:new i(this.options,this.attempt+1)}reset(){return this.attempt?new i(this.options):this}},Zh=class{constructor(){this.delay=-1}next(){}reset(){return this}}});var ck,Kn,Wa,lk=m(()=>{"use strict";ck=w(require("@vscode/l10n")),Kn=require("inversify");No();Ve();A();_();U();N();On();Wn();va();Jh();zh();sk();qn();Gn();km();Xl();Wa=class extends ji{constructor(t,r,o,n,s=new fo){super(t,r,n,o);this.restarters=s}resolveParams(t){return t.type==="pwa-node"&&t.request==="attach"?t:void 0}async launchProgram(t){let r=async(n,s)=>{let a=this.program,c;try{t.params.websocketAddress?c=t.params.websocketAddress:c=await Sa(`http://${t.params.address}:${t.params.port}`,s&&t.params.timeout>0?ie.withTimeout(t.params.timeout).token:t.context.cancellationToken,this.logger)}catch(d){if(a&&a===s)return o(n,a,{killed:!1,code:1});throw d}let l=await go.attach({ipcAddress:t.serverAddress,scriptName:"Remote Process",inspectorURL:c,remoteHostHeader:t.params.remoteHostHeader,waitForDebugger:!0,dynamicAttach:!0}),p=this.program=new Ui(l);p.stopped.then(d=>o(n.reset(),p,d))},o=async(n,s,a)=>{if(this.program!==s)return;if(a.killed){this.onProgramTerminated(a);return}let c=n.next();if(!c){this.onProgramTerminated(a);return}t.context.dap.output({output:ck.t(`Lost connection to debugee, reconnecting in {0}ms\r
`,c.delay)});let l=new zn;this.program=l;let p=await Promise.race([x(c.delay),l.stopped]);this.program===l&&(p?this.onProgramTerminated(a):r(c,l))};return r(this.restarters.create(t.params.restart))}async terminate(t){await super.terminate(),t&&this.telemetry&&Kt(this.telemetry.processId,this.logger)}createLifecycle(t,r,o){if(o.openerId)return{};let n;return{initialized:async()=>{n=this.onFirstInitialize(t,r,o),await n},close:()=>{this.targetList().length&&this.program?.stop(),n?.then(s=>s.dispose())}}}async onFirstInitialize(t,r,o){let n=new Ir;await n.startTouchLoop();let s=new Tt("node",void 0);try{s=await this.resolveNodePath(r.params)}catch{}let[a]=await Promise.all([this.gatherTelemetryFromCdp(t,r),this.setEnvironmentVariables(t,r,n.path,o.targetId,s)]);return this.telemetry=a,a&&r.params.attachExistingChildren&&nk({pid:a.processId,nodePath:s.path,hostname:r.params.address,ipcAddress:r.serverAddress},o.targetId,this.logger).catch(c=>this.logger.warn("internal","Error watching child processes",{err:c})),n}async setEnvironmentVariables(t,r,o,n,s){if(!r.params.autoAttachChildProcesses)return;if(!await Ps(r.params.address)){this.logger.warn("runtime.target","Cannot attach to children of remote process");return}let a=await this.resolveEnvironment(r,s,{requireLease:o,openerId:n});return this.appendEnvironmentVariables(t,a)}};Wa=f([(0,Kn.injectable)(),u(0,(0,Kn.inject)(uo)),u(1,(0,Kn.inject)(C)),u(2,(0,Kn.inject)(Xt)),u(3,(0,Kn.inject)(bt))],Wa)});function xm(i){if(!i.runtimeArgs||i.attachSimplePort)return;let e=[];for(let t of i.runtimeArgs)/^--inspect-brk(=|$)/.test(t)?i.stopOnEntry=i.stopOnEntry||!0:e.push(t);i.runtimeArgs=e}var eb=m(()=>{"use strict"});var pk,uk,dk,Va,Cm,mk=m(()=>{"use strict";pk=require("os"),uk=w(require("path")),dk=require("crypto"),Va=require("fs"),Cm=class i{constructor(){this.path=uk.join((0,pk.tmpdir)(),`node-debug-callback-${(0,dk.randomBytes)(8).toString("hex")}`);this.disposed=!1}static{this.pollInterval=200}read(e=i.pollInterval){return this.readPromise?this.readPromise:(this.readPromise=new Promise((t,r)=>{let o=setInterval(()=>{if(this.disposed){clearInterval(o),t(void 0);return}if((0,Va.existsSync)(this.path)){try{t(JSON.parse((0,Va.readFileSync)(this.path,"utf-8")))}catch(n){r(n)}finally{this.dispose()}clearInterval(o)}},e)}),this.readPromise)}dispose(){if(!this.disposed){this.disposed=!0;try{(0,Va.unlinkSync)(this.path)}catch{}}}}});var Qn,ep,Tm,tp=m(()=>{"use strict";Qn=w(require("path"));oi();ep=Symbol("IProgramLauncher"),Tm=i=>{let e=i.program;if(e&&Qn.isAbsolute(e)){let t=Qn.relative(i.cwd,e);e=Qn.isAbsolute(t)?t:`.${Qn.sep}${t}`}return e?[...i.runtimeArgs,e,...Jc(i.args)]:[...i.runtimeArgs,...Jc(i.args)]}});var Yt,qa,CL,$a,gk=m(()=>{"use strict";Yt=require("inversify"),qa=require("path");ku();No();oi();A();ae();_();ee();U();N();eb();On();Wn();mk();qn();Ql();hm();tp();Gn();km();Xl();CL=async(i,e)=>{if(typeof e.stopOnEntry=="string")return(0,qa.resolve)(e.cwd,e.stopOnEntry);if(e.program)return(0,qa.resolve)(e.cwd,e.program);for(let t of Jc(e.args)){if(t.startsWith("-"))continue;let r=(0,qa.resolve)(e.cwd,t);if(await i.exists(r))return r}},$a=class extends Sr{constructor(t,r,o,n,s,a,c,l,p){super(t,r,p,l);this.bpPredictor=o;this.launchers=n;this.restarters=s;this.fsUtils=a;this.packageJson=c}resolveParams(t){let r;if(t.type==="pwa-node"&&t.request==="launch"?r={...t}:"server"in t&&t.server&&"program"in t.server&&(r={...t.server}),!!r)return xm(r),r}async launchProgram(t){t.params.program&&(t.params.program=await this.tryGetCompiledFile(t.params.program)),this.attachSimplePort=await this.getSimpleAttachPortIfAny(t.params);let r=async o=>{this.program&&this.program.stop();let n=await this.resolveNodePath(t.params,t.params.runtimeExecutable||void 0),s=n.warning;s&&t.context.dap.output({category:"stderr",output:s.message});let a=new Cm,c=await this.resolveEnvironment(t,n,{fileCallback:a.path});this.attachSimplePort?(t.params.attachSimplePort||t.context.dap.output({category:"stderr",output:"Using legacy attach mode for --inspect-brk in npm scripts. We recommend removing --inspect-brk, and using `stopOnEntry` in your launch.json if you need it."}),c=c.merge({NODE_OPTIONS:null})):c=bm(n,c);let l={...t.params,env:c.value},p=this.launchers.find(b=>b.canLaunch(l));if(!p)throw new Error("Cannot find an appropriate launcher for the given set of options");let d=await p.launchProgram(n.path,l,t.context);if(this.attachSimplePort){let b=await go.attach({ipcAddress:t.serverAddress,scriptName:"Remote Process",inspectorURL:await Sa(`http://127.0.0.1:${this.attachSimplePort}`,t.context.cancellationToken,this.logger),waitForDebugger:!0,dynamicAttach:!0});d=new ym(d,new Ui(b))}else a.read().then(b=>{b&&d.gotTelemetery(b)});this.program=d,d.stopped.then(async b=>{if(a.dispose(),this.program!==d)return;if(b.killed||b.code===0){this.onProgramTerminated(b);return}let y=o.next();if(!y){this.onProgramTerminated(b);return}await x(y.delay),this.program===d&&r(y)})};return r(this.restarters.create(t.params.restart))}async getSimpleAttachPortIfAny(t){if(t.attachSimplePort)return t.attachSimplePort;let r=NP(t.runtimeExecutable,t.runtimeArgs);if(!(!r||!(await this.packageJson.getContents())?.scripts?.[r]?.includes("--inspect-brk")))return t.port??9229}createLifecycle(t,r,{targetId:o}){return{initialized:async()=>{if(this.attachSimplePort&&await this.gatherTelemetryFromCdp(t,r),!r.params.stopOnEntry)return;let n=await CL(this.fsUtils,r.params);if(!n){this.logger.warn("runtime","Could not resolve program entrypointfrom args");return}let s="(?:entryBreakpoint){0}",a=W(n),c=Ge(a)+s,l=await t.Debugger.setBreakpointByUrl({urlRegex:c,lineNumber:0,columnNumber:0});return l?.breakpointId?{cdpId:l?.breakpointId,path:a}:void 0},close:()=>{let n=Number(o);if(n>0)try{process.kill(n)}catch{}}}}async tryGetCompiledFile(t){t=K(t);let r=(0,qa.extname)(t);if(!r||r===".js")return t;let o=await this.bpPredictor.getPredictionForSource(t);if(!o||o.size===0)return t;let n=ri(o.values());return n?(this.logger.info("runtime.launch","Updating entrypoint to compiled file",{from:t,to:n.compiledPath,candidates:o.size}),n.compiledPath):t}};$a=f([(0,Yt.injectable)(),u(0,(0,Yt.inject)(uo)),u(1,(0,Yt.inject)(C)),u(2,(0,Yt.inject)(fn)),u(3,(0,Yt.multiInject)(ep)),u(4,(0,Yt.inject)(fo)),u(5,(0,Yt.inject)(mt)),u(6,(0,Yt.inject)($n)),u(7,(0,Yt.inject)(Xt)),u(8,(0,Yt.inject)(bt))],$a)});function RL(i){switch(i){case"32":case"x86":case"ia32":return"x86";case"64":case"x64":case"amd64":return"x64";case"arm":let e=process.config.variables.arm_version;return e?"armv"+e+"l":"arm";default:return i}}var Ha,fk,Rm,hk,qe,Dm,Rt,TL,Lm=m(()=>{"use strict";Ha=w(require("fs")),fk=require("fs"),Rm=require("inversify"),hk=w(require("os")),qe=w(require("path"));ae();U();le();oe();Dm=Symbol("INvmResolver"),Rt=class{constructor(e=new se(fk.promises),t=process.env,r=process.arch,o=process.platform,n=hk.homedir()){this.fsUtils=e;this.env=t;this.arch=r;this.platform=o;this.homedir=n}async resolveNvmVersionPath(e){let t,r=[],o=this.parseVersionString(e),n=this.env.NVS_HOME;if(!n){let s=this.platform==="win32"?qe.join(this.env.LOCALAPPDATA||"","nvs"):qe.join(this.env.HOME||"",".nvs");Ha.existsSync(s)&&(n=s)}if(o.nvsFormat||n){if(t=await this.resolveNvs(n,o),!t&&o.nvsFormat)throw new I(Qg(e,"nvs"));r.push("nvs")}if(!t)if(this.platform==="win32")this.env.NVM_HOME&&(t=await this.resolveWindowsNvm(e),r.push("nvm-windows"));else{let s=this.env.NVM_DIR||qe.join(this.homedir,".nvm");await this.fsUtils.exists(s)&&(t=await this.resolveUnixNvm(e),r.push("nvm"))}if(!t){let s=this.platform==="win32"?this.env.FNM_DIR||qe.join(this.env.APPDATA||"","fnm"):this.env.FNM_DIR||qe.join(this.homedir,".fnm");await this.fsUtils.exists(s)&&(t=await this.resolveFnm(e,s),r.push("fnm"))}if(!r.length)throw new I(Kg());if(!t||!await this.fsUtils.exists(t))throw new I(Qg(e,r.join("/")));return{directory:t,binary:await this.getBinaryInFolder(t)}}async getBinaryInFolder(e){return await Hr(["node64.exe","node64"].map(t=>this.fsUtils.exists(qe.join(e,t))))?"node64":"node"}async resolveNvs(e,{remoteName:t,semanticVersion:r,arch:o}){if(!e)throw new I(xy());let n=this.findBinFolderForVersion(qe.join(e,t),r,s=>Ha.existsSync(qe.join(s,o)));if(n)return this.platform!=="win32"?qe.join(n,o,"bin"):qe.join(n,o)}async resolveUnixNvm(e){let t=this.env.NVM_DIR;if(!t){let o=qe.join(this.env.HOME||"",".nvm");await this.fsUtils.exists(o)&&(t=o)}if(!t)throw new I(Kg());let r=this.findBinFolderForVersion(qe.join(t,"versions","node"),`v${e}`);return r?qe.join(r,"bin"):void 0}async resolveWindowsNvm(e){let t=this.env.NVM_HOME;if(!t)throw new I(Cy());return this.findBinFolderForVersion(t,`v${e}`)}async resolveFnm(e,t){let r=this.findBinFolderForVersion(qe.join(t,"node-versions"),`v${e}`);if(r)return this.platform==="win32"?qe.join(r,"installation"):qe.join(r,"installation","bin")}findBinFolderForVersion(e,t,r){if(!Ha.existsSync(e))return;let o=Ha.readdirSync(e);if(o.includes(t))return qe.join(e,t);let n=o.filter(s=>s.startsWith(`${t}.`)).sort(TL).filter(s=>r?r(qe.join(e,s)):!0).pop();return n?qe.join(e,n):void 0}parseVersionString(e){let r=/^(([\w-]+)\/)?(v?(\d+(\.\d+(\.\d+)?)?))(\/((x86)|(32)|((x)?64)|(arm\w*)|(ppc\w*)))?$/i.exec(e);if(!r)throw new Error("Invalid version string: "+e);let o=!!(r[2]||r[8]),n=r[2]||"node",s=r[4]||"",a=RL(r[8]||this.arch);return{nvsFormat:o,remoteName:n,semanticVersion:s,arch:a}}};Rt=f([(0,Rm.injectable)(),u(0,(0,Rm.inject)(mt))],Rt);TL=(i,e)=>{let t=/([0-9]+)\.([0-9]+)\.([0-9]+)/.exec(i),r=/([0-9]+)\.([0-9]+)\.([0-9]+)/.exec(e);if(!t||!r)return(r?-1:0)+(t?1:0);let[,o,n,s]=t,[,a,c,l]=r;return Number(o)-Number(a)||Number(n)-Number(c)||Number(s)-Number(l)}});var bk,Em,wk,za,DL,_m,yk=m(()=>{"use strict";bk=require("child_process"),Em=require("inversify"),wk=w(require("split2"));ao();_();N();$();tp();Gn();za=class{constructor(e){this.logger=e}canLaunch(e){return e.console==="internalConsole"}async launchProgram(e,t,r){let{executable:o,args:n,shell:s,cwd:a}=DL(e,Tm(t),t.cwd);r.dap.output({category:"console",output:[o,...n].join(" ")+`
`});let c=(0,bk.spawn)(o,n,{shell:s,cwd:a,env:de.merge(de.processEnv(),t.env).defined()});return t.outputCapture==="console"?this.discardStdio(r.dap,c):this.captureStdio(r.dap,c),new vm(c,this.logger,t.killBehavior)}captureStdio(e,t){t.stdout.pipe(_m.stream()).on("data",r=>e.output({category:"stdout",output:r})).resume(),t.stderr.pipe(_m.stream()).on("data",r=>e.output({category:"stderr",output:r})).resume()}discardStdio(e,t){let r=[],o=()=>{r&&e.output({category:"stderr",output:Buffer.concat(r).toString()})},n=Buffer.from("Debugger attached."),s=a=>{a.includes(n)?(r=void 0,t.stderr.removeListener("data",s)):r&&r.push(a)};t.stderr.on("data",s),t.on("error",a=>{o(),e.output({category:"stderr",output:a.stack||a.message})}),t.on("exit",a=>{a!==null&&a>0&&(o(),e.output({category:"stderr",output:`Process exited with code ${a}\r
`}))}),t.stdout.resume(),t.stderr.resume()}};za=f([(0,Em.injectable)(),u(0,(0,Em.inject)(C))],za);DL=(i,e,t)=>{if(process.platform==="win32"&&(i=Pt(i),t=Pt(t),i.endsWith(".ps1")&&(e=["-File",i,...e],i="powershell.exe")),process.platform!=="win32"||!i.includes(" "))return{executable:i,args:e,shell:!1,cwd:t};let r=!1,o=[];for(let n of e)n.includes(" ")?(o.push(`"${n}"`),r=!0):o.push(n);return r?{executable:`"${i}"`,args:o,shell:!0,cwd:t}:{executable:i,args:e,shell:!1,cwd:t}},_m=class i{constructor(){this.etxSpotted=!1}static stream(){return(0,wk.default)(new i)}[Symbol.split](e){if(this.etxSpotted||=e.includes(""),!this.etxSpotted)return[e,""];let t=e.split("");return t.length>1?t.map((r,o)=>o<t.length-1?`${r}
`:r):t}}});var Am,Vi,tb=m(()=>{"use strict";Am=require("inversify");_();M();le();oe();tp();Gn();Vi=class{constructor(e){this.logger=e}canLaunch(e){return e.internalConsoleOptions,e.console!=="internalConsole"}async launchProgram(e,t,r){let o={kind:t.console==="integratedTerminal"?"integrated":"external",title:t.name,cwd:t.cwd,args:[e,...Tm(t)],env:gs(t.env),argsCanBeInterpretedByShell:!Array.isArray(t.args)},n;try{n=await this.sendLaunchRequest(o,r)}catch(s){throw new I(Ty(s.message))}return new Ma(n,this.logger,t.killBehavior)}sendLaunchRequest(e,t){return t.dap.runInTerminalRequest(e)}};Vi=f([(0,Am.injectable)(),u(0,(0,Am.inject)(C))],Vi)});var vk,Ga,Sk=m(()=>{"use strict";vk=require("inversify"),Ga=class{getTreatment(e,t){return Promise.resolve(t)}};Ga=f([(0,vk.injectable)()],Ga)});var Ik,Xn,Pk=m(()=>{"use strict";O();Ik=require("inversify"),Xn=class{constructor(){this.flushEmitter=new S;this.onFlush=this.flushEmitter.event}report(){}reportOperation(){}attachDap(){}flush(){this.flushEmitter.fire()}dispose(){}};Xn=f([(0,Ik.injectable)()],Xn)});var kk,$i,xk,Ck,rp,rb,Ja,Tk=m(()=>{"use strict";kk=require("crypto"),$i=require("inversify"),xk=require("os"),Ck=w(require("path")),rp=w(require("vscode"));No();A();O();_();U();le();oe();H();Wn();qn();Ql();rb=class{constructor(e){this.terminal=e;this.stopped=new Promise(t=>{let r=rp.window.onDidCloseTerminal(o=>{o===e&&(t({code:0,killed:!0}),r.dispose())})})}gotTelemetery(){}stop(){return this.terminal.sendText(""),setTimeout(()=>this.terminal.dispose(),1),this.stopped}},Ja=class extends Sr{constructor(t,r,o,n,s){super(t,r,s,n);this.fs=o;this.terminalCreatedEmitter=new S;this.callbackFile=Ck.join((0,xk.tmpdir)(),`node-debug-callback-${(0,kk.randomBytes)(8).toString("hex")}`);this.onTerminalCreated=this.terminalCreatedEmitter.event}async getProcessTelemetry(){try{return JSON.parse(await this.fs.readFile(this.callbackFile,"utf-8"))}catch{return}}resolveParams(t){if(t.type==="node-terminal"&&t.request==="launch")return t;if(t.type==="pwa-chrome"&&t.server&&"command"in t.server)return t.server}async launchProgram(t){let r;try{r=await this.resolveNodePath(t.params)}catch(a){if(a instanceof I&&a.cause.id===9230)throw a;r=new Tt("node",void 0)}let o=await this.resolveEnvironment(t,r,{fileCallback:this.callbackFile}),n=await this.createTerminal({name:t.params.name,cwd:t.params.cwd,iconPath:new rp.ThemeIcon("debug"),env:bm(r,o).defined(),isTransient:!0});this.terminalCreatedEmitter.fire(n),n.show();let s=this.program=new rb(n);t.params.command&&(await Promise.race([n.processId,x(1e3)]),n.sendText(t.params.command,!0)),s.stopped.then(a=>{s===this.program&&this.onProgramTerminated(a)})}createTerminal(t){return Promise.resolve(rp.window.createTerminal(t))}dispose(){super.dispose(),this.fs.unlink(this.callbackFile).catch(()=>{})}};Ja=f([(0,$i.injectable)(),u(0,(0,$i.inject)(uo)),u(1,(0,$i.inject)(C)),u(2,(0,$i.inject)(G)),u(3,(0,$i.inject)(Xt)),u(4,(0,$i.inject)(bt))],Ja)});var Yn,op,Ka,Rk=m(()=>{"use strict";Yn=require("inversify"),op=require("vscode-tas-client");$();H();Ou();js();Ka=class{constructor(e,t){t&&e instanceof ur&&(this.service=(0,op.getExperimentationService)("ms-vscode.js-debug",cn,du?op.TargetPopulation.Insiders:op.TargetPopulation.Public,{setSharedProperty(r,o){e.setGlobalMetric(r,o)},postEvent(r,o){e.pushOutput({category:"telemetry",output:r,data:o})}},t.globalState))}async getTreatment(e,t){if(!this.service)return t;try{return await this.service.getTreatmentVariableAsync("vscode",e,!0)}catch{return t}}};Ka=f([(0,Yn.injectable)(),u(0,(0,Yn.inject)(at)),u(1,(0,Yn.optional)()),u(1,(0,Yn.inject)(ke))],Ka)});var Dk,lt,Ie,Wo=m(()=>{"use strict";Dk=require("inversify"),lt=w(require("vscode"));A();Ie=class{constructor(){this._onSessionAddedEmitter=new lt.EventEmitter;this._onSessionEndedEmitter=new lt.EventEmitter;this._disposables=[];this.sessions=new Map;this.onSessionAdded=this._onSessionAddedEmitter.event;this.onSessionEnded=this._onSessionEndedEmitter.event}static isConcreteSession(e){return!!e.configuration.__pendingTargetId}static pickSession(e,t){if(e.length<2)return e[0];let r=lt.window.createQuickPick();return r.title=t,r.items=e.map(o=>({label:o.name,id:o.id})),r.ignoreFocusOut=!0,new Promise(o=>{r.onDidAccept(()=>o(e.find(n=>n.id===r.selectedItems[0]?.id))),r.onDidHide(()=>o(void 0)),r.show()}).finally(()=>r.dispose())}get isDebugging(){return this.sessions.size>0}getById(e){return this.sessions.get(e)}isRunning(e){return[...this.sessions.values()].includes(e)}getByName(e){return[...this.sessions.values()].filter(t=>t.name===e)}getConcreteSessions(){return[...this.sessions.values()].filter(Ie.isConcreteSession)}getChildren(e){return[...this.sessions.values()].filter(t=>t.configuration.__parentId===e.id)}attach(){lt.debug.onDidStartDebugSession(e=>{pi(e.type)&&(this.sessions.set(e.id,e),this._onSessionAddedEmitter.fire(e))},void 0,this._disposables),lt.debug.onDidTerminateDebugSession(e=>{pi(e.type)&&(this.sessions.delete(e.id),this._onSessionEndedEmitter.fire(e))},void 0,this._disposables),lt.debug.onDidReceiveDebugSessionCustomEvent(e=>{if(pi(e.session.type)){if(e.event==="revealLocationRequested"){let t=e.body,r=lt.debug.asDebugSourceUri(e.body.source),o={};if(t.line){let n=new lt.Position((t.line||1)-1,(t.column||1)-1);o.selection=new lt.Range(n,n)}lt.window.showTextDocument(r,o);return}if(e.event==="copyRequested"){let t=e.body;lt.env.clipboard.writeText(t.text);return}}},void 0,this._disposables)}dispose(){for(let e of this._disposables)e.dispose();this._disposables=[]}};Ie=f([(0,Dk.injectable)()],Ie)});var Fm,Lk,Qa,_k=m(()=>{"use strict";Fm=require("inversify"),Lk=w(require("vscode"));Wo();Qa=class{constructor(e){this.tracker=e}register(e){e.subscriptions.push(this.tracker.onSessionEnded(t=>{let r=t.configuration.cascadeTerminateToConfigurations;if(!(!r||!(r instanceof Array)))for(let o of r)for(let n of this.tracker.getByName(o))Lk.debug.stopDebugging(n)}))}};Qa=f([(0,Fm.injectable)(),u(0,(0,Fm.inject)(Ie))],Qa)});var Ek,Ak,Fk=m(()=>{"use strict";Ek=Symbol("IDebugConfigurationResolver"),Ak=Symbol("IDebugConfigurationProvider")});var Mk,Nk,Vo,ob=m(()=>{"use strict";Mk=require("inversify"),Nk=w(require("vscode"));A();Vo=class{get type(){return this.getType()}get triggerKind(){return this.getTriggerKind()}async provideDebugConfigurations(e,t){try{let r=await this.provide(e,t);if(!r)return[];let o=r instanceof Array?r:[r],n=jg.get(this.type);if(n)for(let s of o)s.type===this.type&&(s.type=n);return o}catch(r){return Nk.window.showErrorMessage(r.message,{modal:!0}),[]}}};Vo=f([(0,Mk.injectable)()],Vo)});var Bk,Xa,ib=m(()=>{"use strict";Bk=w(require("vscode")),Xa=class{constructor(e){this.key=e}set value(e){e!==this._value&&(this._value=e,Bk.commands.executeCommand("setContext",this.key,e))}get value(){return this._value}}});var Ok,Mm,jk=m(()=>{"use strict";Ok=Symbol("Uninitialized"),Mm=class{constructor(e,t){this.key=e;this.defaultValue=t;this._value=Ok}write(e,t){t!==this.read(e)&&(this._value=t,e.update(this.key,t))}read(e){return this._value===Ok&&(this._value=e.get(this.key)??this.defaultValue),this._value}}});var ip,nb,Nm,Ya,ab=m(()=>{"use strict";ip=require("inversify"),nb=w(require("vscode"));A();H();Wo();ib();jk();Nm=new Mm("sourceSteppingEnabled",!0),Ya=class{constructor(e,t){this.context=e;this.tracker=t}register(e){let t=new Xa("jsDebugIsMapSteppingDisabled");Nm.read(this.context.workspaceState)===!1&&(t.value=!0);let r=o=>{t.value=!o,Nm.write(this.context.workspaceState,o);for(let n of this.tracker.getConcreteSessions())n.customRequest("setSourceMapStepping",{enabled:o})};e.subscriptions.push(Qe(nb.commands,"extension.js-debug.enableSourceMapStepping",async()=>{r(!0)}),Qe(nb.commands,"extension.js-debug.disableSourceMapStepping",async()=>{r(!1)}))}};Ya=f([(0,ip.injectable)(),u(0,(0,ip.inject)(ke)),u(1,(0,ip.inject)(Ie))],Ya)});var Bm,Uk,$o,Pr,sp=m(()=>{"use strict";Bm=require("inversify"),Uk=require("path"),$o=w(require("vscode"));A();_();M();$();H();ab();Pr=class{constructor(e){this.extensionContext=e}get type(){return this.getType()}async resolveDebugConfiguration(e,t,r){if(t.type&&(t.type=this.getType()),"__pendingTargetId"in t)return t;let o=t;o.sourceMaps??=Nm.read(this.extensionContext.workspaceState);try{let n=await this.resolveDebugConfigurationAsync(e,o,r);return n&&this.commonResolution(n,e)}catch(n){$o.window.showErrorMessage(n.message,{modal:!0})}}applyDefaultRuntimeExecutable(e){if(e.runtimeExecutable)return;let t=nr($o.workspace,"debug.javascript.defaultRuntimeExecutable"),r=t?t[e.type]:void 0;r&&(e.runtimeExecutable=r)}commonResolution(e,t){return e.trace=Ig(e.trace,this.extensionContext.logPath),e.__workspaceCachePath=this.extensionContext.storagePath,e.__breakOnConditionalError=nr($o.workspace,"debug.javascript.breakOnConditionalError",t)??!1,t?e.__workspaceFolder=t.uri.fsPath:(e.__workspaceFolder||=this.getSuggestedWorkspaceFolders(e).filter(Ae).filter(r=>!r.includes("${workspaceFolder}")).map(r=>(0,Uk.isAbsolute)(r)?$o.workspace.getWorkspaceFolder($o.Uri.file(r))?.uri.fsPath:r).find(Ae)||$o.workspace.workspaceFolders?.[0]?.uri.fsPath||"",e.__workspaceFolder?e=Gg(e):e=zg(e)),e}getSuggestedWorkspaceFolders(e){return[]}};Pr=f([(0,Bm.injectable)(),u(0,(0,Bm.inject)(ke))],Pr)});function Om(i){Wk.debug.activeDebugConsole.appendLine(i)}var Wk,Vk=m(()=>{"use strict";Wk=w(require("vscode"))});async function Za(i,e,t=!1){let r=e.processId?.trim(),o=r&&EL(r);if(!o||isNaN(o.pid))throw new Error(cb.t("Attach to process: '{0}' doesn't look like a process id.",r||"<unknown>"));if(o.port||AL(o.pid),e.port=o.port||LL,delete e.processId,t){let n=await _L(i,o.pid);n&&(e.cwd=n)}}async function _L(i,e){let t=e&&await Jn.getWorkingDirectory(e);if(!t)return Zn.workspace.workspaceFolders?.[0].uri.fsPath;let r=await Is(i,t,"package.json");if(!r)return t;let o=Zn.workspace.getWorkspaceFolder(Zn.Uri.file(t));return!o||jp(o.uri.fsPath,r)?r:o.uri.fsPath}function AL(i){try{if(process.platform==="win32"){let e=`node -e process._debugProcess(${i})`;(0,$k.execSync)(e)}else process.kill(i,"SIGUSR1")}catch(e){throw new Error(cb.t("Attach to process: cannot enable debug mode for process '{0}' ({1}).",i,e))}}var cb,$k,Zn,LL,EL,lb=m(()=>{"use strict";cb=w(require("@vscode/l10n")),$k=require("child_process"),Zn=w(require("vscode"));A();ae();ee();N();$();Im();LL=9229;EL=i=>{let[e,t]=i.split(":");return{pid:Number(e),port:t?Number(t):void 0}}});function pb(i,e){if(e)return e.uri.fsPath;if(Zt.workspace.workspaceFolders&&Zt.workspace.workspaceFolders.length>0)return Zt.workspace.workspaceFolders[0].uri.fsPath;if(i){if(i==="${file}")return"${fileDirname}";if(Le.isAbsolute(i))return Le.dirname(i)}return"${workspaceFolder}"}function qk(i,e){if(i&&(e=Jr(e,"workspaceFolder",i.uri.fsPath)),Zt.workspace.workspaceFolders?.length&&(e=Jr(e,"workspaceRoot",Zt.workspace.workspaceFolders[0].uri.fsPath)),Le.isAbsolute(e))return e;if(i)return Le.join(i.uri.fsPath,e)}async function FL(i,e,t){if(t.outFiles||!e)return;let r;if(t.program?(r=qk(e,t.program),r&&(r=Le.dirname(r))):t.cwd&&(r=qk(e,t.cwd)),!r||Up(e.uri.fsPath,r))return;let o=await Ag(r,async n=>!n.includes("node_modules")&&await i.exists(Le.join(n,"package.json")));if(o){let n=B(Le.relative(e.uri.fsPath,o));n.length&&(t.outFiles=[...cu.outFiles,`\${workspaceFolder}/${n}/**/*.js`,`!\${workspaceFolder}/${n}/**/node_modules/**`])}}async function ub(i,e,t){let r={type:"pwa-node",request:"launch",name:qi.t("Launch Program"),skipFiles:["<node_internals>/**"]};t&&t.noDebug&&(r.noDebug=!0);let o=await Hk(i,"package.json"),n,s=!1;if(o&&o.name==="mern-starter")return e&&Om(qi.t("Launch configuration for '{0}' project created.","Mern Starter")),BL(r),r;if(o&&(n=await jL(i,o,e),n&&e&&Om(qi.t("Launch configuration created based on 'package.json'."))),!n){let a=Zt.window.activeTextEditor;a&&pu.includes(a.document.languageId)&&(s=a.document.languageId!=="javascript",n=i?Le.relative(i.uri.fsPath,a.document.uri.fsPath):a.document.uri.fsPath,Le.isAbsolute(n)||(n="${workspaceFolder}"+Le.sep+n))}if(!n&&i){let a=i.uri.fsPath;n=await Hr(ML.map(async c=>await Vt(tc.promises,Le.join(a,c))&&"${workspaceFolder}"+Le.sep+c))}if(n||(n="${file}"),n&&(r.program=n,i||(r.__workspaceFolder=Le.dirname(n))),s||Zt.workspace.textDocuments.some(a=>OL(a.languageId))){e&&Om(qi.t("Adjust glob pattern(s) in the 'outFiles' attribute so that they cover the generated JavaScript."));let a="",c=await Hk(i,"tsconfig.json");if(c?.compilerOptions?.outDir&&NL()){let l=c.compilerOptions.outDir;Le.isAbsolute(l)||(a=l,a.indexOf("./")===0&&(a=a.substr(2)),a[a.length-1]!=="/"&&(a+="/")),r.preLaunchTask="tsc: build - tsconfig.json"}r.outFiles=["${workspaceFolder}/"+a+"**/*.js"]}return r}function NL(){let i=Zt.workspace.getConfiguration().get("typescript.tsc.autoDetect");return i!=="off"&&i!=="watch"}function BL(i){i.request==="launch"&&(i.runtimeExecutable="nodemon",i.program="${workspaceFolder}/index.js",i.restart=!0,i.env={BABEL_DISABLE_CACHE:"1",NODE_ENV:"development"},i.console="integratedTerminal",i.internalConsoleOptions="neverOpen")}function OL(i){return i==="typescript"||i==="coffeescript"}async function Hk(i,e){if(i)try{let t=await tc.promises.readFile(Le.join(i.uri.fsPath,e),"utf8");return JSON.parse(t)}catch{}}async function jL(i,e,t){let r;try{if(e.main?r=e.main:e.scripts&&typeof e.scripts.start=="string"&&(r=e.scripts.start.split(" ").pop()),r){let o;if(Le.isAbsolute(r)?o=r:(o=i?Le.join(i.uri.fsPath,r):void 0,r=Le.join("${workspaceFolder}",r)),t&&o&&!await Vt(tc.promises,o)&&!await Vt(tc.promises,o+".js"))return}}catch{}return r}var qi,tc,ec,Le,Zt,ho,ML,rc=m(()=>{"use strict";qi=w(require("@vscode/l10n")),tc=require("fs"),ec=require("inversify"),Le=w(require("path")),Zt=w(require("vscode"));Vk();A();ao();yi();ae();ee();U();N();$();H();Lm();eb();lb();sp();ho=class extends Pr{constructor(t,r,o){super(t);this.nvmResolver=r;this.fsUtils=o}async resolveDebugConfigurationWithSubstitutedVariables(t,r){let o=r;if(o.type==="pwa-node"&&o.request==="attach"&&typeof o.processId=="string"&&await Za(this.fsUtils,o),"port"in o&&typeof o.port=="string"&&(o.port=Number(o.port)),"attachSimplePort"in o&&typeof o.attachSimplePort=="string"&&(o.attachSimplePort=Number(o.attachSimplePort)),o.cwd){let n=await Vt(tc.promises,o.cwd);if(!n){Zt.window.showErrorMessage(qi.t("The configured `cwd` {0} does not exist.",o.cwd),{modal:!0});return}if(!n.isDirectory()){Zt.window.showErrorMessage(qi.t("The configured `cwd` {0} is not a folder.",o.cwd),{modal:!0});return}}return o}async resolveDebugConfigurationAsync(t,r,o){if(!r.name&&!r.type&&!r.request&&(r=await ub(t,!0,r),r.request==="launch"&&!r.program)){Zt.window.showErrorMessage(qi.t("Cannot find a program to debug"),{modal:!0});return}if(r.cwd||(r.cwd=r.localRoot||pb(r.request==="launch"?r.program:void 0,t)),r.remoteRoot&&!r.localRoot&&(r.localRoot="${workspaceFolder}"),r.request==="launch"){if(this.applyDefaultRuntimeExecutable(r),r.runtimeExecutable&&eu(r.runtimeExecutable)==="deno"&&!r.attachSimplePort){let s=await Be();r.attachSimplePort=s,r.continueOnAttach??=!0;let a=[`--inspect-brk=127.0.0.1:${s}`,"--allow-all"];r.runtimeArgs?r.runtimeArgs.includes("run")?r.runtimeArgs=[...r.runtimeArgs,...a]:r.runtimeArgs=["run",...a,...r.runtimeArgs]:r.runtimeArgs=["run",...a]}let n=r.runtimeVersion;if(typeof n=="string"&&n!=="default"){let{directory:s,binary:a}=await this.nvmResolver.resolveNvmVersionPath(n);r.env=new de(r.env).addToPath(s,"prepend",!0).value,r.runtimeExecutable=!r.runtimeExecutable||r.runtimeExecutable==="node"?a:r.runtimeExecutable}if(r.console==="integratedTerminal"&&!r.internalConsoleOptions&&(r.internalConsoleOptions="neverOpen"),r.attachSimplePort===null||r.attachSimplePort===void 0)xm(r);else{if(r.attachSimplePort===0){r.attachSimplePort=await Be(void 0,o);let s=`--inspect-brk=${r.attachSimplePort}`;r.runtimeArgs=r.runtimeArgs?[...r.runtimeArgs,s]:[s]}r.continueOnAttach=!r.stopOnEntry,r.stopOnEntry=!1}await FL(this.fsUtils,t,r)}return qg(r)}getType(){return"pwa-node"}getSuggestedWorkspaceFolders(t){return[t.rootPath,t.cwd]}};ho=f([(0,ec.injectable)(),u(0,(0,ec.inject)(ke)),u(1,(0,ec.inject)(Dm)),u(2,(0,ec.inject)(mt))],ho);ML=["index.js","main.js"]});var zk,oc,db=m(()=>{"use strict";zk=w(require("vscode"));A();$();sp();rc();oc=class extends Pr{async resolveDebugConfigurationAsync(e,t){if(t.cwd||(t.cwd=pb(void 0,e)),t.request==="launch"&&!t.command){await Et(zk.commands,"extension.js-debug.createDebuggerTerminal",void 0,e);return}return t.remoteRoot&&!t.localRoot&&(t.localRoot="${workspaceFolder}"),Hg(t)}getType(){return"node-terminal"}}});var ic,qo,Gk,nc,ap,UL,WL,Hi,zi,mb=m(()=>{"use strict";ic=w(require("@vscode/l10n")),qo=require("inversify"),Gk=require("os"),nc=require("path"),ap=w(require("vscode"));A();yi();ae();U();H();ob();sp();rc();db();UL=i=>i.request==="launch",WL=i=>i.request==="attach",Hi=class extends Pr{constructor(t,r,o,n,s){super(t);this.nodeProvider=r;this.terminalProvider=o;this.location=n;this.fs=s}async resolveBrowserCommon(t,r){if(r.request,r.server&&"program"in r.server){let n={...r.server,type:"pwa-node",request:"launch",name:`${r.name}: Server`};r.server=await this.nodeProvider.resolveDebugConfiguration(t,n)}else r.server&&"command"in r.server&&(r.server=await this.terminalProvider.resolveDebugConfiguration(t,{...r.server,type:"node-terminal",request:"launch",name:`${r.name}: Server`}));let o=this.location==="remote"?"ui":"workspace";if(UL(r)&&!r.browserLaunchLocation&&(r.browserLaunchLocation=o),WL(r)&&!r.browserAttachLocation&&(r.browserAttachLocation=o),r.request==="launch"){let n=r;this.applyDefaultRuntimeExecutable(n)}}getSuggestedWorkspaceFolders(t){return[t.rootPath,t.webRoot]}async resolveDebugConfigurationWithSubstitutedVariables(t,r){if("__pendingTargetId"in r)return r;let o=r;if("port"in o&&typeof o.port=="string"&&(o.port=Number(o.port)),o.request==="launch"){let n=await this.ensureNoLockfile(o);if(n===void 0)return;o=n}return o}async ensureNoLockfile(t){if(t.request!=="launch")return t;let r=t;if(r.userDataDir===!1||r.port&&!await Lv(r.port))return t;let o=typeof r.userDataDir=="string"?r.userDataDir:(0,nc.join)(this.extensionContext.storagePath??(0,Gk.tmpdir)(),r.runtimeArgs?.includes("--headless")?".headless-profile":".profile"),n=(0,nc.join)(o,process.platform==="win32"?"lockfile":"SingletonLock");if(await Hr([Rw(this.fs,n),this.isVsCodeLocked((0,nc.join)(o,"code.lock"))])){let a=ic.t("Debug Anyway");if(await ap.window.showErrorMessage(ic.t("It looks like a browser is already running from {0}. Please close it before trying to debug, otherwise VS Code may not be able to connect to it.",r.userDataDir===!0?ic.t("an old debug session"):ic.t("the configured userDataDir")),{modal:!0},a)!==a)return}return{...t,userDataDir:o}}async isVsCodeLocked(t){try{let r=Number(await this.fs.readFile(t,"utf-8"));return process.kill(r,0),!0}catch{return!1}}};Hi=f([(0,qo.injectable)(),u(0,(0,qo.inject)(ke)),u(1,(0,qo.inject)(ho)),u(2,(0,qo.inject)(oc)),u(3,(0,qo.inject)(Eo)),u(4,(0,qo.inject)(G))],Hi);zi=class extends Vo{provide(){return this.createLaunchConfigFromContext()||this.getDefaultLaunch()}getTriggerKind(){return ap.DebugConfigurationProviderTriggerKind.Initial}createLaunchConfigFromContext(){let e=ap.window.activeTextEditor;if(e&&e.document.languageId==="html")return{type:this.getType(),request:"launch",name:`Open ${(0,nc.basename)(e.document.uri.fsPath)}`,file:e.document.uri.fsPath}}getDefaultLaunch(){return{type:this.getType(),request:"launch",name:ic.t("Launch Chrome against localhost"),url:"http://localhost:8080",webRoot:"${workspaceFolder}"}}};zi=f([(0,qo.injectable)()],zi)});var gb,sc,es,Jk=m(()=>{"use strict";$();A();mb();gb=require("inversify"),sc=class extends Hi{async resolveDebugConfigurationAsync(e,t){if(!t.name&&!t.type&&!t.request){let r=new es().createLaunchConfigFromContext();if(!r)return null;t=r}return await this.resolveBrowserCommon(e,t),t.request==="attach"?{...ol,...t}:{...Rs,...t}}getType(){return"pwa-chrome"}};sc=f([(0,gb.injectable)()],sc);es=class extends zi{getType(){return"pwa-chrome"}};es=f([(0,gb.injectable)()],es)});var Kk,fb,ac,ts,Qk=m(()=>{"use strict";Kk=w(require("@vscode/l10n")),fb=require("inversify");A();$();mb();ac=class extends Hi{async resolveDebugConfigurationAsync(e,t){if(!t.name&&!t.type&&!t.request){let r=new ts().createLaunchConfigFromContext();if(!r)return;t=r}return await this.resolveBrowserCommon(e,t),t.useWebView&&(t.timeout=t.timeout??0),t.request==="attach"?{...Vg,...t}:{...$g,...t}}getType(){return"pwa-msedge"}};ac=f([(0,fb.injectable)()],ac);ts=class extends zi{getType(){return"pwa-msedge"}getDefaultLaunch(){return{...super.getDefaultLaunch(),name:Kk.t("Launch Edge against localhost")}}};ts=f([(0,fb.injectable)()],ts)});var Yk,Zk,ex,Gi,Xk,VL,hb=m(()=>{"use strict";Yk=require("fs"),Zk=require("inversify"),ex=require("path");A();$();sp();Gi=class extends Pr{async resolveDebugConfigurationAsync(e,t){if(t.debugWebWorkerHost===void 0){let r=await VL(e,t);t={...t,debugWebWorkerHost:r.length===1&&r[0]==="web"}}return lu(t),t.debugWebWorkerHost&&(t.outFiles=[]),Promise.resolve({...Wg,...t})}getType(){return"pwa-extensionHost"}};Gi=f([(0,Zk.injectable)()],Gi);Xk="--extensionDevelopmentPath=",VL=async(i,e)=>{let t=e.args?.find(n=>n.startsWith(Xk));if(!t)return["workspace"];let r=Jr(t.slice(Xk.length),"workspaceFolder",i?.uri.fsPath??e.__workspaceFolder??""),o;try{let n=await Yk.promises.readFile((0,ex.join)(r,"package.json"),"utf-8");o=JSON.parse(n).extensionKind??"workspace"}catch{return["workspace"]}return o instanceof Array?o:[o]}});var tx,rx,bb=m(()=>{"use strict";tx=require("vscode"),rx=async i=>{try{return await tx.commands.executeCommand("npm.packageManager",i?.uri)}catch{return"npm"}}});async function nx(i,e=!1){let t=i??Fe.workspace.workspaceFolders??[];if(!t||t.length===0){e||Fe.window.showErrorMessage(cc.t("You need to open a workspace folder to debug npm scripts."));return}let r=(await Promise.all(t.map(s=>Fe.workspace.findFiles(new Fe.RelativePattern(s,"**/package.json"),"**/{node_modules,.vscode-test}/**")))).flat();if(r.length===0){e||Fe.window.showErrorMessage(cc.t("No package.json files found in your workspace."));return}let o=[],n={path:r[0].fsPath,score:0};for(let{fsPath:s}of new Set(r)){n=wb(n,{path:s,score:1});let a;try{a=JSON.parse(await or(s))}catch(c){e||ox("showWarningMessage",cc.t("Could not read {0}: {1}",s,c.message),s),n=wb(n,{path:void 0,score:3});continue}if(n=wb(n,{path:void 0,score:2}),!!a.scripts)for(let c of Object.keys(a.scripts))o.push({directory:yb.dirname(s),name:c,command:a.scripts[c]})}if(o.length===0){n.path&&!e&&ox("showErrorMessage",cc.t("No npm scripts found in your package.json"),n.path);return}return o.sort((s,a)=>(s.name==="start"?-1:0)+(a.name==="start"?1:0)),o}async function ox(i,e,t){let r=cc.t("Edit package.json");if(await Fe.window[i](e,r)!==r)return;if(ix.existsSync(t)){let a=await Fe.workspace.openTextDocument(t);await Fe.window.showTextDocument(a);return}let o=await Fe.workspace.openTextDocument(Fe.Uri.file(t).with({scheme:"untitled"})),n=await Fe.window.showTextDocument(o);await n.edit(a=>a.insert(new Fe.Position(0,0),$L));let s=new Fe.Position(2,5);n.selection=new Fe.Selection(s,s)}var cc,ix,yb,Fe,wb,$L,sx=m(()=>{"use strict";cc=w(require("@vscode/l10n")),ix=w(require("fs")),yb=w(require("path")),Fe=w(require("vscode"));A();ae();bb();wb=(i,e)=>i.score>e.score?i:e;$L=`{
  "scripts": {
    
  }
}
`});var jm,vb,uc,cp,lc,qL,pc,ax=m(()=>{"use strict";jm=w(require("@vscode/l10n")),vb=require("inversify"),uc=w(require("path")),cp=w(require("vscode"));A();M();$();sx();bb();ob();rc();lc=class extends Vo{provide(e){return ub(e,!0)}getType(){return"pwa-node"}getTriggerKind(){return cp.DebugConfigurationProviderTriggerKind.Initial}};lc=f([(0,vb.injectable)()],lc);qL=["cwd","program"],pc=class extends Vo{async provide(e){let t=xo(await Promise.all([this.getFromNpmScripts(e),this.getFromActiveFile()]));if(e)for(let r of t){let o=r;for(let n of qL){let s=o[n];s&&uc.isAbsolute(s)&&(o[n]=uc.join("${workspaceFolder}",uc.relative(e.uri.fsPath,s)))}}return t}getType(){return"pwa-node"}getTriggerKind(){return cp.DebugConfigurationProviderTriggerKind.Dynamic}async getFromNpmScripts(e){let t={type:Ts("node-terminal"),name:jm.t("JavaScript Debug Terminal"),request:"launch",cwd:e?.uri.fsPath};if(!e)return[t];let r=await nx([e],!0);if(!r)return[t];let o=await rx(e);return r.map(n=>({type:Ts("node-terminal"),name:jm.t("Run Script: {0}",n.name),request:"launch",command:`${o} run ${n.name}`,cwd:n.directory})).concat(t)}getFromActiveFile(){let e=cp.window.activeTextEditor;return!e||!pu.includes(e.document.languageId)||e.document.uri.scheme!=="file"?[]:[{type:Ts("pwa-node"),name:jm.t("Run Current File"),request:"launch",program:e.document.uri.fsPath}]}};pc=f([(0,vb.injectable)()],pc)});var cx,lx,px=m(()=>{"use strict";Fk();Jk();Qk();hb();ax();rc();db();cx=[sc,ac,Gi,ho,oc],lx=[es,ts,lc,pc]});function Sb(i,e){if(i){try{if(new Ib.URL(i).hostname)return i}catch{}try{let t=`http://${i}`,r=new Ib.URL(t);if(!e||r.port)return t}catch{}}}var dc,lp,Ib,Ut,mc,dx=m(()=>{"use strict";dc=w(require("@vscode/l10n")),lp=require("inversify"),Ib=require("url"),Ut=w(require("vscode"));A();Wl();H();mc=class{constructor(e,t){this.defaultBrowser=e;this.context=t}register(e){e.subscriptions.push(Ut.commands.registerCommand("extension.js-debug.debugLink",t=>this.handle(t)))}async handle(e){if(e=e??await this.getLinkFromTextEditor()??await this.getLinkFromQuickInput(),!e)return;let t="pwa-chrome";try{await this.defaultBrowser.lookup()===3&&(t="pwa-msedge")}catch{}let r=nr(Ut.workspace,"debug.javascript.debugByLinkOptions")??{},o={...typeof r=="string"?{}:r,type:Ts(t),name:e,request:"launch",url:e};Ut.debug.startDebugging(Ut.workspace.workspaceFolders?.[0],o),this.persistConfig(o)}getLinkFromTextEditor(){let e=Ut.window.activeTextEditor;if(e)return Sb(e.document.getText(e.selection),!0)}async getLinkFromQuickInput(){let e=await Ut.env.clipboard.readText(),t=await Ut.window.showInputBox({value:Sb(e,!1)||this.mostRecentLink,placeHolder:"https://localhost:8080",validateInput:r=>{if(r&&!Sb(r,!1))return dc.t("The URL provided is invalid")}});if(t)return this.mostRecentLink=t,t}async persistConfig(e){if(this.context.globalState.get("saveDebugLinks")===!1)return;let t=Ut.workspace.getConfiguration("launch"),r=t.get("configurations")??[];if(r.some(a=>a.url===e.url))return;let o=dc.t("Yes"),n=dc.t("Never"),s=await Ut.window.showInformationMessage(dc.t("Would you like to save a configuration in your launch.json for easy access later?"),o,dc.t("No"),n);s===n&&this.context.globalState.update("saveDebugLinks",!1),s===o&&await t.update("configurations",[...r,e])}};mc=f([(0,lp.injectable)(),u(0,(0,lp.inject)(ya)),u(1,(0,lp.inject)(ke))],mc)});var gc,hc,er,mx,fc,gx=m(()=>{"use strict";gc=w(require("@vscode/l10n")),hc=require("inversify"),er=w(require("vscode"));A();H();Wo();mx="neverRemind",fc=class{constructor(e,t,r){this.fs=e;this.context=t;this.tracker=r;this.dismissedForSession=!1;this.isPrompting=!1}register(e){e.subscriptions.push(Qe(er.commands,"extension.js-debug.getDiagnosticLogs",async()=>{let t=await this.getTargetSession();if(!t)return;let r=await er.window.showSaveDialog({filters:{JSON:["json"]}});r&&t.customRequest("saveDiagnosticLogs",{toFile:r.fsPath})}),Qe(er.commands,"extension.js-debug.createDiagnostics",async()=>this.getDiagnosticInfo(await this.getTargetSession())),er.debug.onDidReceiveDebugSessionCustomEvent(async t=>{if(t.event==="openDiagnosticTool")return this.openDiagnosticTool(t.body.file);if(t.event!=="suggestDiagnosticTool"||this.dismissedForSession||this.context.workspaceState.get(mx)||this.isPrompting)return;this.isPrompting=!0;let r=gc.t("Yes"),o=gc.t("Not Now"),n=gc.t("Never"),s=await er.window.showInformationMessage("It looks like you might be having trouble with breakpoints. Would you like to open our diagnostic tool?",r,o,n);switch(this.isPrompting=!1,s){case r:this.getDiagnosticInfo(await this.getTargetSession(),!0);break;case n:e.workspaceState.update(mx,!0);break;case o:this.dismissedForSession=!0;break}}))}getTargetSession(){let e=er.debug.activeDebugSession;if(!e||!pi(e?.type))return this.pickSession();if(Ie.isConcreteSession(e))return e;let t=this.tracker.getChildren(e);return t.length===1?t[0]:this.pickSession()}pickSession(){return Ie.pickSession(this.tracker.getConcreteSessions(),gc.t("Select the session you want to inspect:"))}async getDiagnosticInfo(e,t=!1){if(!e||!this.tracker.isRunning(e)){er.window.showErrorMessage(gc.t('It looks like your debug session has already ended. Try debugging again, then run the "Debug: Diagnose Breakpoint Problems" command.'));return}let{file:r}=await e.customRequest("createDiagnostics",{fromSuggestion:t});await this.openDiagnosticTool(r)}async openDiagnosticTool(e){let t=er.window.createWebviewPanel("jsDebugDiagnostics","Debug Diagnostics",er.ViewColumn.Active,{enableScripts:!0});t.webview.html=await this.fs.readFile(e,"utf-8")}};fc=f([(0,hc.injectable)(),u(0,(0,hc.inject)(G)),u(1,(0,hc.inject)(ke)),u(2,(0,hc.inject)(Ie))],fc)});var bc,fx,kr,rs,hx=m(()=>{"use strict";bc=w(require("@vscode/l10n")),fx=require("inversify"),kr=w(require("vscode"));A();rs=class{register(e){e.subscriptions.push(kr.debug.onDidReceiveDebugSessionCustomEvent(t=>{if(t.event!=="suggestDisableSourcemap"||!pi(t.session.type))return;let r=t.body;this.unmap(t.session,r.source).catch(o=>kr.window.showErrorMessage(o.message))}))}async unmap(e,t){(nr(kr.workspace,"debug.javascript.unmapMissingSources")||await this.prompt())&&await e.customRequest("disableSourcemap",{source:t})}async prompt(){let e=bc.t("Always"),t=bc.t("Always in this Workspace"),r=bc.t("Yes");switch(await kr.window.showInformationMessage(bc.t("This is a missing file path referenced by a sourcemap. Would you like to debug the compiled version instead?"),e,t,bc.t("No"),r)){case e:return Ug(kr.workspace,"debug.javascript.unmapMissingSources",!0,kr.ConfigurationTarget.Global),!0;case t:return Ug(kr.workspace,"debug.javascript.unmapMissingSources",!0,kr.ConfigurationTarget.Workspace),!0;case r:return!0;default:return!1}}};rs=f([(0,fx.injectable)()],rs)});var os,Um,Br,bx,wx,wc,yx=m(()=>{"use strict";os=w(require("@vscode/l10n")),Um=require("inversify"),Br=w(require("vscode"));H();bx="ms-vscode.wasm-dwarf-debugging",wx="dwarf.neverRemind",wc=class{constructor(e){this.context=e;this.didPromptForSession=this.context.workspaceState.get(wx,!1)}async load(){try{return await import("@vscode/dwarf-debugging")}catch{}let e=Br.extensions.getExtension(bx);if(e)return e.isActive||await e.activate(),e.exports}async prompt(){if(this.didPromptForSession)return;this.didPromptForSession=!0;let e=os.t("Yes"),t=os.t("Never"),r=await Br.window.showInformationMessage(os.t({message:'VS Code can provide better debugging experience for WebAssembly via "DWARF Debugging" extension. Would you like to install it?',comment:'"DWARF Debugging" is the extension name and should not be localized.'}),e,os.t("Not Now"),t);r===e?this.install():r===t&&this.context.workspaceState.update(wx,!0)}async install(){await Br.window.withProgress({location:Br.ProgressLocation.Notification,title:os.t("Installing the DWARF debugger...")},async()=>{try{await Br.commands.executeCommand("workbench.extensions.installExtension",bx),Br.window.showInformationMessage(os.t("Installation complete! The extension will be used after you restart your debug session."))}catch(e){Br.window.showErrorMessage(e.message||String(e))}})}};wc=f([(0,Um.injectable)(),u(0,(0,Um.inject)(ke))],wc)});function GL(i){let e=i;for(;e.parentSession;)e=e.parentSession;return e}var Sx,Wm,Ji,vx,HL,zL,yc,Ix=m(()=>{"use strict";Sx=w(require("@vscode/l10n")),Wm=require("inversify"),Ji=w(require("vscode"));A();ti();Wo();vx=i=>{if(i?.type!=="pwa-msedge")return!1;let e=i.configuration.__browserTargetType;return e==="iframe"||e==="page"},HL="ms-edgedevtools.vscode-edge-devtools",zL="vscode-edge-devtools.attachToCurrentDebugTarget";yc=class{constructor(e){this.tracker=e}register(e){e.subscriptions.push(Qe(Ji.commands,"extension.js-debug.openEdgeDevTools",async()=>{let t=Ji.debug.activeDebugSession&&vx(Ji.debug.activeDebugSession)?Ji.debug.activeDebugSession:await Ie.pickSession(this.tracker.getConcreteSessions().filter(vx),Sx.t("Select the page where you want to open the devtools"));if(!t)return;let r=GL(t);try{return await Ji.commands.executeCommand(zL,t.id,r.configuration)}catch(o){if(o instanceof Error&&/command .+ not found/.test(o.message))return Ji.commands.executeCommand("workbench.extensions.action.showExtensionsWithIds",[HL]);throw o}}))}};yc=f([(0,Wm.injectable)(),u(0,(0,Wm.inject)(Ie))],yc)});var Cx,Vm,Tx,be,Px,kx,xx,Pb,vc,Rx=m(()=>{"use strict";Cx=require("crypto"),Vm=require("inversify"),Tx=require("path"),be=w(require("vscode"));A();Wo();Px=({name:i,line:e,column:t,source:r})=>`${i} (${(0,Tx.basename)(String(r.path))}:${e}:${t})`,kx=({name:i,line:e,column:t,source:r})=>`${i} (${r.path}:${e}:${t})`,xx=async({line:i,column:e,source:t})=>{if(t.sourceReference!==0||!t.path)return;let r=be.Uri.file(t.path),o=await be.workspace.openTextDocument(r),n=await be.window.showTextDocument(o),s=new be.Position(i-1,e-1);n.revealRange(new be.Range(s,s)),n.selection=new be.Selection(s,s)},Pb=class{constructor(e,t){this.caller=e;this.target=t;this.treeItem=new be.TreeItem(`${Px(e)} \u2192 ${Px(t)}`,be.TreeItemCollapsibleState.None),this.treeItem.tooltip=`Breaks at ${kx(t)} containing ${kx(e)} will be skipped`,this.id=this.treeItem.id=(0,Cx.createHash)("sha1").update(JSON.stringify([e,t])).digest("base64")}toDap(){return{caller:this.caller,target:this.target}}},vc=class{constructor(e){this.sessionTracker=e;this._onDidChangeTreeData=new be.EventEmitter;this.allCallers=new Map;this.lastHadCallers=!1;this.onDidChangeTreeData=this._onDidChangeTreeData.event}register(e){e.subscriptions.push(be.window.createTreeView("jsExcludedCallers",{treeDataProvider:this}),Qe(be.commands,"extension.js-debug.callers.add",async(t,r)=>{let o=await this.sessionTracker.getById(r.sessionId)?.customRequest("stackTrace",{threadId:0,startFrame:0,levels:1});if(!o?.stackFrames.length)return;let n=o.stackFrames[0],s=new Pb({name:r.frameName,column:r.frameLocation.range.startColumn,line:r.frameLocation.range.startLineNumber,source:r.frameLocation.source},{name:n.name,column:n.column,line:n.line,source:n.source});this.allCallers.set(s.id,s),this.triggerUpdate()}),Qe(be.commands,"extension.js-debug.callers.goToCaller",t=>xx(t.caller)),Qe(be.commands,"extension.js-debug.callers.gotToTarget",t=>xx(t.target)),Qe(be.commands,"extension.js-debug.callers.remove",async t=>{this.allCallers.delete(t.id),this.triggerUpdate()}),Qe(be.commands,"extension.js-debug.callers.removeAll",async()=>{this.allCallers.clear(),this.triggerUpdate()}),this.sessionTracker.onSessionAdded(t=>{this.allCallers.size>0&&this.sendCallersToSession(t)}))}getTreeItem(e){return e.treeItem}getChildren(e){return e?[]:[...this.allCallers.values()]}sendCallersToSession(e){e.customRequest("setExcludedCallers",{callers:[...this.allCallers.values()].map(t=>t.toDap())})}triggerUpdate(){this._onDidChangeTreeData.fire(void 0);for(let t of this.sessionTracker.getConcreteSessions())this.sendCallersToSession(t);let e=this.allCallers.size>0;e!==this.lastHadCallers&&(el(be.commands,"jsDebugHasExcludedCallers",e),this.lastHadCallers=e)}};vc=f([(0,Vm.injectable)(),u(0,(0,Vm.inject)(Ie))],vc)});var kb,pp,Dx,JL,Sc,Lx=m(()=>{"use strict";kb=w(require("@vscode/l10n")),pp=require("inversify");H();Dx="linkBpWarnIgnored",JL="https://code.visualstudio.com/docs/nodejs/nodejs-debugging#_can-i-debug-if-im-using-symlinks",Sc=class{constructor(e,t){this.vscode=e;this.context=t;this.didWarn=this.context.workspaceState.get(Dx,!1)}async warn(){if(this.didWarn)return;this.didWarn=!0;let e=kb.t("Read More"),t=kb.t("Ignore"),r=await this.vscode.window.showWarningMessage("It looks like you have symlinked files. You might need to update your configuration to make this work as expected.",t,e);r===t?this.context.workspaceState.update(Dx,!0):r===e&&this.vscode.env.openExternal(this.vscode.Uri.parse(JL))}};Sc=f([(0,pp.injectable)(),u(0,(0,pp.inject)(ar)),u(1,(0,pp.inject)(ke))],Sc)});var up,$m,Ex,Ho,_x,Ic,Ax=m(()=>{"use strict";up=w(require("@vscode/l10n")),$m=require("inversify"),Ex=require("path"),Ho=w(require("vscode"));H();_x="omitLongPredictions",Ic=class{constructor(e){this.context=e}register(e){e.subscriptions.push(Ho.debug.onDidReceiveDebugSessionCustomEvent(t=>{t.event==="longPrediction"&&this.promptLongBreakpoint(t.session.workspaceFolder)}))}async promptLongBreakpoint(e){if(this.context.workspaceState.get(_x))return;let t=up.t("It's taking a while to configure your breakpoints. You can speed this up by updating the 'outFiles' in your launch.json."),r=up.t("Open launch.json"),o=up.t("Don't show again"),n=await Ho.window.showWarningMessage(t,o,r);if(n===o){this.context.workspaceState.update(_x,!0);return}if(n!==r)return;if(e||(e=await Ho.window.showWorkspaceFolderPick()),!e){await Ho.window.showWarningMessage(up.t("No workspace folder open."));return}let s=await Ho.workspace.openTextDocument((0,Ex.join)(e.uri.fsPath,".vscode","launch.json"));await Ho.window.showTextDocument(s)}};Ic=f([(0,$m.injectable)(),u(0,(0,$m.inject)(ke))],Ic)});var qm,kc,Pc,Fx=m(()=>{"use strict";qm=require("inversify"),kc=require("vscode");No();yi();Pc=class{constructor(e){this.leaseTracker=e;this.cachedResolutions=new Array(16).fill("");this.cachedResolutionIndex=0}register(e){typeof kc.workspace.registerPortAttributesProvider=="function"&&e.subscriptions.push(kc.workspace.registerPortAttributesProvider({portRange:[53e3,54e3]},this))}async providePortAttributes({port:e,pid:t}){if(t&&this.cachedResolutions.includes(`${e}:${t}`))return{port:e,autoForwardAction:kc.PortAutoForwardAction.Ignore};if(await this.leaseTracker.isRegistered(e)){if(t){let r=this.cachedResolutionIndex++%this.cachedResolutions.length;this.cachedResolutions[r]=`${e}:${t}`}return{port:e,autoForwardAction:kc.PortAutoForwardAction.Ignore}}}};Pc=f([(0,qm.injectable)(),u(0,(0,qm.inject)(bt))],Pc)});var Hm,Nx,is,xc,Mx,KL,Bx=m(()=>{"use strict";Hm=require("inversify"),Nx=w(require("querystring")),is=w(require("vscode"));A();Wo();ib();xc=class{constructor(e){this.tracker=e;this.canPrettyPrintKey=new Xa("jsDebugCanPrettyPrint")}register(e){e.subscriptions.push(Qe(is.commands,"extension.js-debug.prettyPrint",()=>this.prettifyActive()),is.window.onDidChangeActiveTextEditor(t=>this.updateEditorState(t)),this.tracker.onSessionAdded(()=>this.updateEditorState(is.window.activeTextEditor)),this.tracker.onSessionEnded(()=>this.updateEditorState(is.window.activeTextEditor)))}async prettifyActive(){let e=is.window.activeTextEditor;if(!e||!this.canPrettyPrint(e))return;let{sessionId:t,source:r}=KL(e.document.uri),o=t&&this.tracker.getById(t);if(o)Mx(o,r,e.selection.start);else for(let n of this.tracker.getConcreteSessions())Mx(n,r,e.selection.start)}canPrettyPrint(e){return this.tracker.isDebugging&&e.document.languageId==="javascript"&&!e.document.fileName.endsWith("-pretty.js")}updateEditorState(e){if(!this.tracker.isDebugging){this.canPrettyPrintKey.value=void 0;return}e&&this.canPrettyPrint(e)&&e.document.uri.toString()!==this.canPrettyPrintKey.value?.[0]&&(this.canPrettyPrintKey.value=[e.document.uri.toString()])}};xc=f([(0,Hm.injectable)(),u(0,(0,Hm.inject)(Ie))],xc);Mx=(i,e,t)=>i.customRequest("prettyPrintSource",{source:e,line:t.line,column:t.character}),KL=i=>{let e=Nx.parse(i.query),t=e.session,r={path:i.fsPath,sourceReference:Number(e.ref)||0};return{sessionId:t,source:r}}});var dp,mp,jx,Or,Ox,Cc,zm,Ux=m(()=>{"use strict";dp=w(require("@vscode/l10n")),mp=require("inversify"),jx=w(require("path")),Or=w(require("vscode"));M();H();Ox="breakpointTerminationWarnedSlow",Cc=class{constructor(e,t){this.fs=e;this.context=t;this.sortOrder=2;this.id="breakpoint";this.label=dp.t("Pick Breakpoint");this.description=dp.t("Run until a specific breakpoint is hit")}async onPick(e,t){if(t)return new zm(t);let r=Or.window.createQuickPick();r.canSelectMany=!0,r.matchOnDescription=!0,r.busy=!0;let o=await new Promise(n=>{r.onDidAccept(()=>n(r.selectedItems)),r.onDidHide(()=>n(void 0)),r.onDidChangeActive(async s=>{if(!s.length)return;let a=s[0].location,c=await Or.workspace.openTextDocument(a.uri);Or.window.showTextDocument(c,{selection:a.range,preview:!0,preserveFocus:!0})}),r.show(),(async()=>{let s=Or.debug.breakpoints.filter(l=>l.enabled&&l instanceof Or.SourceBreakpoint),a=await Promise.all(s.map(l=>e.getDebugProtocolBreakpoint(l))),c=await this.getCandidates(a,s);r.items=c,r.selectedItems=c,r.busy=!1})()});if(r.dispose(),!!o)return await this.warnSlowCode(),new zm(o.map(n=>Number(n.id)))}async warnSlowCode(){this.context.workspaceState.get(Ox)||(Or.window.showWarningMessage(dp.t('Profiling with breakpoints enabled can change the performance of your code. It can be useful to validate your findings with the "duration" or "manual" termination conditions.'),dp.t("Got it!")),await this.context.workspaceState.update(Ox,!0))}async getCandidates(e,t){if(e.length!==t.length)throw new Error("Mismatched breakpoint array lengths");let r=ko(n=>this.getFileLines(n));return(await Promise.all(t.map(async(n,s)=>{let a=e[s];if(!a||!a.id)return;let c=n.location,l=Or.workspace.getWorkspaceFolder(c.uri),p=l?jx.relative(l.uri.fsPath,c.uri.fsPath):c.uri.fsPath,d=await r(c.uri.fsPath);return{id:a.id,label:`${p}:${c.range.start.line}:${c.range.start.character}`,location:c,description:d?.[c.range.start.line]?.trim()}}))).filter(Ae)}async getFileLines(e){try{return(await this.fs.readFile(e,"utf-8")).split(`
`)}catch{return}}};Cc=f([(0,mp.injectable)(),u(0,(0,mp.inject)(G)),u(1,(0,mp.inject)(ke))],Cc);zm=class{constructor(e){this.breakpointIds=e}get customData(){return{stopAtBreakpoint:this.breakpointIds.slice()}}dispose(){}}});var Gm,bo,gp,xb=m(()=>{"use strict";Gm=w(require("@vscode/l10n")),bo=w(require("vscode"));ze();O();gp=class{constructor(e,t,r){this.session=e;this.impl=t;this.termination=r;this.statusChangeEmitter=new S;this.stopEmitter=new S;this._innerStatus=[];this.disposables=new j;this.state=0;this.onStatusChange=this.statusChangeEmitter.event;this.onStop=this.stopEmitter.event;this.disposables.push(bo.debug.onDidReceiveDebugSessionCustomEvent(o=>{o.session===e&&o.event==="profilerStateUpdate"&&this.onStateUpdate(o.body)}),bo.debug.onDidTerminateDebugSession(o=>{o===e&&this.stopEmitter.fire(void 0)})),r&&(this.disposables.push(r),r.attachTo?.(this))}get status(){return this._innerStatus.filter(e=>!!e).join(", ")||void 0}async start(){try{await bo.window.withProgress({location:bo.ProgressLocation.Window,title:Gm.t("Starting profile...")},()=>this.session.customRequest("startProfile",{type:this.impl.type,...this.termination?.customData}))}catch(e){bo.window.showErrorMessage(e.message),this.stopEmitter.fire(void 0)}}dispose(){this.state=2,this.disposables.dispose()}setFile(e){this.file=e}async stop(){this.state===0&&(this.setStatus(-1,Gm.t("Saving")),this.state=1,await bo.window.withProgress({location:bo.ProgressLocation.Window,title:Gm.t("Stopping profile...")},()=>this.session.customRequest("stopProfile",{})))}onStateUpdate(e){if(e.running){this.setStatus(0,e.label);return}this.state=2,this.stopEmitter.fire(this.file),this.dispose()}setStatus(e,t){this.state===0&&(e===-1?this._innerStatus=[t]:this._innerStatus[e]=t,this.statusChangeEmitter.fire(this.status))}}});var ns,Wx,Vx,Tc,Jm,$x=m(()=>{"use strict";ns=w(require("@vscode/l10n")),Wx=require("inversify"),Vx=w(require("vscode"));ze();xb();Tc=class{constructor(){this.sortOrder=1;this.id="duration";this.label=ns.t("Duration");this.description=ns.t("Run for a specific amount of time")}async onPick(e,t){if(t)return new Jm(t*1e3);let r=Vx.window.createInputBox();r.title=ns.t("Duration of Profile"),r.placeholder=ns.t('Profile duration in seconds, e.g "5"'),this.lastDuration&&(r.value=String(this.lastDuration)),r.onDidChangeValue(n=>{/^[0-9]+$/.test(n)?Number(n)<1?r.validationMessage=ns.t("Please enter a number greater than 1"):r.validationMessage=void 0:r.validationMessage=ns.t("Please enter a number")});let o=await new Promise(n=>{r.onDidAccept(()=>{if(r.validationMessage)return n(void 0);this.lastDuration=Number(r.value),n(new Jm(this.lastDuration*1e3))}),r.onDidHide(()=>n(void 0)),r.show()});return r.dispose(),o}};Tc=f([(0,Wx.injectable)()],Tc);Jm=class{constructor(e){this.duration=e;this.disposable=new j}attachTo(e){let t=Date.now()+this.duration,r=()=>e.setStatus(1,`${Math.round((t-Date.now())/1e3)}s`),o=setTimeout(()=>e.stop(),this.duration),n=setInterval(r,1e3);r(),this.disposable.callback(()=>{clearTimeout(o),clearInterval(n)})}dispose(){this.disposable.dispose()}}});var Cb,qx,Rc,fp,Tb=m(()=>{"use strict";Cb=w(require("@vscode/l10n")),qx=require("inversify"),Rc=class{constructor(){this.sortOrder=0;this.id="manual";this.label=Cb.t("Manual");this.description=Cb.t("Run until manually stopped")}async onPick(){return new fp}};Rc=f([(0,qx.injectable)()],Rc);fp=class{dispose(){}}});var Dc,Rb=m(()=>{"use strict";Dc=Symbol("ITerminationConditionFactory")});var wo,Ki,Hx,Km,et,QL,Lc,zx=m(()=>{"use strict";wo=w(require("@vscode/l10n")),Ki=require("inversify"),Hx=require("os"),Km=require("path"),et=w(require("vscode"));Rd();oi();A();ze();ae();H();Wo();Tb();Rb();xb();QL=i=>"__pendingTargetId"in i.configuration,Lc=class{constructor(e,t,r,o){this.tracker=e;this.fs=t;this.sessionStates=r;this.terminationConditions=o;this.activeSessions=new Map;this.disposables=new j;this.disposables.push(et.debug.onDidReceiveDebugSessionCustomEvent(n=>{if(n.event!=="profileStarted")return;let s=n.body,a=this.activeSessions.get(n.session.id);a||(a=new gp(n.session,Ot.ctors.find(c=>c.type===s.type)||Ot.ctors[0],new fp),this.registerSession(a)),a.setFile(s.file)}))}async start(e){let t,r=[...this.tracker.getConcreteSessions()].filter(QL);if(e.sessionId?t=r.find(l=>l.id===e.sessionId):t=await this.pickSession(r),!t)return;let o=t,n=this.activeSessions.get(o.id);if(n&&!await this.alreadyRunningSession(n))return;let s=await this.pickType(o,e.type);if(!s)return;let a;if(!s.instant&&(a=await this.pickTermination(o,e.termination),!a))return;let c=new gp(o,s,a);c&&(this.registerSession(c,e.onCompleteCommand),await c.start(),s.instant&&await c.stop())}async stop(e){let t;if(e)t=this.activeSessions.get(e);else{let r=await this.pickSession([...this.activeSessions.values()].map(o=>o.session));t=r&&this.activeSessions.get(r.id)}t&&(this.sessionStates.remove(t.session.id),await t.stop())}dispose(){for(let e of this.activeSessions.values())e.dispose();this.activeSessions.clear(),this.disposables.dispose()}registerSession(e,t){this.activeSessions.set(e.session.id,e),this.sessionStates.add(e.session.id,wo.t("Profiling")),e.onStatusChange(()=>this.updateStatusBar()),e.onStop(r=>{r&&this.openProfileFile(e,t,e.session,r),this.activeSessions.delete(e.session.id),e.dispose(),this.updateStatusBar()}),this.updateStatusBar()}async openProfileFile(e,t,r,o){if(t)return Promise.all([et.commands.executeCommand(t,{contents:await this.fs.readFile(o,"utf-8"),basename:(0,Km.basename)(o)+e.impl.extension}),this.fs.unlink(o)]);let n=r.workspaceFolder?.uri.fsPath??et.workspace.workspaceFolders?.[0].uri.fsPath??(0,Hx.homedir)(),s=Td()+e.impl.extension,a=et.Uri.file((0,Km.join)(n,s));await Dw(this.fs,o,a.fsPath),await et.commands.executeCommand(e.impl.editable?"vscode.open":"revealInExplorer",a)}updateStatusBar(){if(this.activeSessions.size===0){this.statusBarItem?.hide(),el(et.commands,"jsDebugIsProfiling",!1);return}this.statusBarItem||(this.statusBarItem=et.window.createStatusBarItem(et.StatusBarAlignment.Right,500),this.statusBarItem.command="extension.js-debug.stopProfile"),el(et.commands,"jsDebugIsProfiling",!0);let e=ri(this.activeSessions.values());e&&this.activeSessions.size===1?this.statusBarItem.text=e.status?wo.t("{0} Click to Stop Profiling ({1})","$(loading~spin)",e.status):wo.t("{0} Click to Stop Profiling","$(loading~spin)"):this.statusBarItem.text=wo.t("{0} Click to Stop Profiling ({1} sessions)","$(loading~spin)",this.activeSessions.size),this.statusBarItem.show()}async alreadyRunningSession(e){let t=wo.t("Yes"),r=wo.t("No");return await et.window.showErrorMessage(wo.t("A profiling session is already running, would you like to stop it and start a new session?"),t,r)!==t?!1:(await this.stop(e.session.id),!0)}async pickSession(e){if(e.length===0)return;if(e.length===1)return e[0];let t=await et.window.showQuickPick(e.map(r=>({label:r.name,id:r.id})));return t&&e.find(r=>r.id===t.id)}async pickType(e,t){let r=e.configuration;if(t)return Ot.ctors.find(n=>n.type===t&&n.canApplyTo(r));let o=await this.pickWithLastDefault(wo.t("Type of profile"),Ot.ctors.filter(n=>n.canApplyTo(r)),this.lastChosenType);return o&&(this.lastChosenType=o.label),o}async pickTermination(e,t){if(t){let o=typeof t=="string"?{type:t}:t;return this.terminationConditions.find(n=>n.id===o.type)?.onPick(e,...o.args??[])}let r=await this.pickWithLastDefault(wo.t("How long to run the profile"),this.terminationConditions,this.lastChosenTermination);return r&&(this.lastChosenTermination=r.label),r?.onPick(e)}async pickWithLastDefault(e,t,r){if(t.length<=1)return t[0];let o=et.window.createQuickPick();o.title=e,o.items=t.slice().sort((s,a)=>s.label===r||a.label===r?s.label===r?-1:1:(s.sortOrder??0)-(a.sortOrder??0)).map(s=>({label:s.label,description:s.description,alwaysShow:!0}));let n=await new Promise(s=>{o.onDidAccept(()=>s(o.selectedItems[0]?.label)),o.onDidHide(()=>s(void 0)),o.show()});if(o.dispose(),!!n)return t.find(s=>s.label===n)}};Lc=f([(0,Ki.injectable)(),u(0,(0,Ki.inject)(Ie)),u(1,(0,Ki.inject)(G)),u(2,(0,Ki.inject)(wu)),u(3,(0,Ki.multiInject)(Dc))],Lc)});var Gx,Jx=m(()=>{"use strict";Gx=(i,e)=>{let t=i;for(let[r,o]of Object.entries(e))typeof o=="object"&&o?t[r]=Object.assign(t[r]||{},o):t[r]=o}});var Kx,Qx,_c,Xx=m(()=>{"use strict";Kx=require("inversify"),Qx=require("vscode");Jx();A();M();_c=class{constructor(){this.read=F(()=>nr(Qx.workspace,"debug.javascript.resourceRequestOptions"))}provideOptions(e){Gx(e,this.read()||{})}};_c=f([(0,Kx.injectable)()],_c)});var Yx,Db,Ec,Zx=m(()=>{"use strict";Yx=require("inversify"),Db=require("vscode");A();Ec=class{register(e){e.subscriptions.push(Qe(Db.commands,"extension.node-debug.startWithStopOnEntry",()=>Db.commands.executeCommand("workbench.action.debug.start",{config:{stopOnEntry:!0}})))}};Ec=f([(0,Yx.injectable)()],Ec)});var Lb,Qm,eC,tC,tt,Ac,rC=m(()=>{"use strict";Lb=w(require("@vscode/l10n")),Qm=require("inversify"),eC=require("linkifyjs"),tC=require("url"),tt=w(require("vscode"));A();Wl();ze();M();N();Ac=class{constructor(e){this.defaultBrowser=e;this.enabledTerminals=new WeakSet;this.disposable=new j;this.notifiedCantOpenOnWeb=!1;this.baseConfiguration=this.readConfig();this.disposable.push(tt.workspace.onDidChangeConfiguration(t=>{t.affectsConfiguration("debug.javascript.debugByLinkOptions")&&(this.baseConfiguration=this.readConfig())}))}enableHandlingInTerminal(e){this.enabledTerminals.add(e)}dispose(){this.disposable.dispose()}provideTerminalLinks(e){switch(this.baseConfiguration.enabled){case"off":return[];case"always":break;case"on":default:if(!this.enabledTerminals.has(e.terminal))return[]}let t=[],r=F(()=>{if("cwd"in e.terminal.creationOptions&&e.terminal.creationOptions.cwd){let o=tt.workspace.getWorkspaceFolder(typeof e.terminal.creationOptions.cwd=="string"?tt.Uri.file(e.terminal.creationOptions.cwd):e.terminal.creationOptions.cwd);if(o)return o}return tt.workspace.workspaceFolders?.[0]});for(let o of(0,eC.find)(e.line,"url")){let n=-1;for(;(n=e.line.indexOf(o.value,n+1))!==-1;){let s;try{s=new tC.URL(o.href)}catch{continue}s.protocol==="http:"&&!o.value.startsWith("http:")&&!Kp(s.hostname)&&(s.protocol="https:"),!(s.protocol!=="http:"&&s.protocol!=="https:")&&t.push({startIndex:n,length:o.value.length,tooltip:Lb.t("Debug URL"),target:s,workspaceFolder:r()?.index})}}return t}async handleTerminalLink(e){await this.handleTerminalLinkInner(e)||tt.env.openExternal(tt.Uri.parse(e.target.toString()))}async handleTerminalLinkInner(e){if(!e.target)return!1;let t=e.target;if(tt.env.uiKind===tt.UIKind.Web)return this.notifiedCantOpenOnWeb||(tt.window.showInformationMessage(Lb.t("We can't launch a browser in debug mode from here. If you want to debug this webpage, open this workspace from VS Code on your desktop.")),this.notifiedCantOpenOnWeb=!0),!1;sy(t.hostname)&&(t.hostname="localhost");let r="pwa-chrome";try{await this.defaultBrowser.lookup()===3&&(r="pwa-msedge")}catch{}let o=e.workspaceFolder!==void 0?tt.workspace.workspaceFolders?.[e.workspaceFolder]:void 0;return tt.debug.startDebugging(o,{...this.baseConfiguration,type:r,name:t.toString(),request:"launch",url:t.toString()}),!0}readConfig(){let e=nr(tt.workspace,"debug.javascript.debugByLinkOptions");return typeof e=="boolean"&&(e=e?"on":"off"),typeof e=="string"?{enabled:e}:{enabled:"on",...e}}};Ac=f([(0,Qm.injectable)(),u(0,(0,Qm.inject)(ya))],Ac)});var oC,iC,nC=m(()=>{"use strict";Uu();Fd();H();Tk();ki();Mu();Rk();_k();px();dx();Wo();gx();hx();yx();Ix();Rx();Ah();Lx();Ax();Fx();Bx();Ux();$x();Tb();Rb();zx();Xx();ab();Zx();rC();oC=i=>{i.bind(ar).toConstantValue(require("vscode")),cx.forEach(e=>{i.bind(e).toSelf().inSingletonScope(),i.bind(Ek).to(e)}),lx.forEach(e=>i.bind(Ak).to(e).inSingletonScope()),i.bind(cr).to(Ic).inSingletonScope(),i.bind(cr).to(mc).inSingletonScope(),i.bind(cr).to(Qa).inSingletonScope(),i.bind(cr).to(rs).inSingletonScope(),i.bind(cr).to(fc).inSingletonScope(),i.bind(cr).to(Ec).inSingletonScope(),i.bind(cr).to(Pc).inSingletonScope(),i.bind(cr).to(yc).inSingletonScope(),i.bind(cr).to(vc).inSingletonScope(),i.bind(cr).to(xc).inSingletonScope(),i.bind(cr).to(Ya).inSingletonScope(),i.bind(ql).to(Sc).inSingletonScope(),i.bind(Ie).toSelf().inSingletonScope().onActivation(ve),i.bind(Lc).toSelf().inSingletonScope().onActivation(ve),i.bind(Ac).toSelf().inSingletonScope(),i.bind(rs).toSelf().inSingletonScope(),i.bind(yn).to(wc).inSingletonScope(),i.bind(Dc).to(Tc).inSingletonScope(),i.bind(Dc).to(Rc).inSingletonScope(),i.bind(Dc).to(Cc).inSingletonScope()},iC=i=>{i.bind(ct).to(Ja).onActivation(ve),i.bind(ba).to(_c).inSingletonScope(),i.bind(Qs).to(Ka).inSingletonScope()}});var Ym,sC,Xm,Zm,s7,aC,cC,lC,pC,_b=m(()=>{"use strict";Ym=require("@vscode/js-debug-browsers"),sC=w(require("execa")),Xm=require("fs"),Zm=require("inversify"),s7=require("reflect-metadata");ku();bi();df();uf();If();Gu();pd();iI();oh();bl();Uu();aI();yl();bn();ih();nh();No();fh();Rd();Fl();uh();mh();il();pI();hI();vl();td();Mo();jl();We();Ul();Wl();Ws();ae();_();Er();bh();cl();al();dl();xh();Ft();$();Lr();H();Vl();XI();rP();iP();rm();nP();aP();Uh();RP();GP();KP();lk();qn();gk();Lm();hm();tp();km();yk();tb();Wn();mm();ki();Ou();Mu();Sk();Pk();js();pl();nC();aC=(i,e,t,r)=>{let o=new Zm.Container;return o.parent=i,o.bind(X).toConstantValue(e.launchConfig),o.bind(Bs).toConstantValue(o),o.bind(At).toConstantValue(t),o.bind(xe).toConstantValue(r),o.bind(io).toConstantValue(e),o.bind(xP).toConstantValue(e.targetOrigin()),o.bind(ln).to(En).inSingletonScope(),o.bind(Qr).to(pn).inSingletonScope(),o.bind(Du).to(Gs).inSingletonScope(),o.bind(hi).toSelf().inSingletonScope(),e.sourcePathResolver&&o.bind(ge).toConstantValue(e.sourcePathResolver),o.bind(Tn).toSelf(),o.bind(Id).toDynamicValue(n=>n.container.get(Tn).create()).inSingletonScope(),e.parent()&&(o.bind(fn).to(gn).inSingletonScope(),o.bind(Zr).to(qs).inSingletonScope()),o.bind(at).to(process.env.DA_TEST_DISABLE_TELEMETRY?Xn:ur).inSingletonScope().onActivation(ve),o.bind(mr).toSelf().inSingletonScope(),o.bind(Ye).toSelf().inSingletonScope(),o.bind(xi).toSelf().inSingletonScope(),o.bind(wi).to(no).inSingletonScope(),o.bind(Si).toSelf().inSingletonScope(),o.bind(da).to(ua).inSingletonScope(),o.bind(Ju).to(ia).inSingletonScope(),o.bind(lr).to(Hs).inSingletonScope(),o.bind(wd).to(fa).inSingletonScope(),o.bind(fi).to(Us).inSingletonScope(),o.bind(Vu).to(Zs).inSingletonScope().onActivation(ve),o.bind(Ze).toSelf(),o.bind(Gt).toSelf(),o.bind(Jt).toSelf(),o.bind(Cd).to(Ot).inSingletonScope(),o.bind(Dd).to(ga).inSingletonScope(),o.bind(zu).to(ra).inSingletonScope().onActivation(ve),o},cC=i=>{let e=new Zm.Container;e.parent=i,e.bind(Bs).toConstantValue(e),e.bind(C).to(E).inSingletonScope().onActivation(ve),e.bind(ln).to(En).inSingletonScope(),e.bind(at).to(process.env.DA_TEST_DISABLE_TELEMETRY?Xn:ur).inSingletonScope().onActivation(ve),e.bind(Yr).to(Yr).inSingletonScope(),e.bind(Ao).to(Ao).inSingletonScope(),e.bind(wa).to(Li).inSingletonScope(),e.bind(Vs).to(Ai).inSingletonScope(),e.bind(uo).to(Fa),e.bind(lo).toSelf().inSingletonScope().onActivation(ve),e.bind(fo).toSelf(),e.bind(ct).to(Mr).onActivation(ve),e.bind(ct).to(Na).onActivation(ve),e.bind(ct).to(Ba).onActivation(ve),e.bind(ct).to($a).onActivation(ve),e.bind(ep).to(za),e.bind(ep).to(Vi),e.bind($n).to(Aa).inSingletonScope(),iC(e),e.bind(ct).to(Wa).onActivation(ve),e.bind(jn).toSelf().inSingletonScope().onActivation(ve),e.bind(ct).toService(jn),e.bind(ct).to(Pa).inSingletonScope().onActivation(ve),e.bind(ct).to(xa).inSingletonScope().onActivation(ve),e.bind(ct).to(ka).inSingletonScope().onActivation(ve),e.bind(ct).to(Ca).inSingletonScope().onActivation(ve),e.bind(ct).to(wr).onActivation(ve),e.bind(ct).toDynamicValue(()=>i.get(Vn).createLauncher(e.get(C))).inSingletonScope(),e.isBound(yn)||e.bind(yn).to(ha).inSingletonScope(),e.bind(wf).to(Ys).inSingletonScope().onActivation(ve);let t=r=>o=>new r(o.container.get(of),o.container.get(G),o.container.get(ll));return e.bind(un).toDynamicValue(t(Ym.ChromeBrowserFinder)).inSingletonScope().whenTargetTagged("browser","chrome"),e.bind(un).toDynamicValue(t(Ym.EdgeBrowserFinder)).inSingletonScope().whenTargetTagged("browser","edge"),e},lC=i=>{let e=new Zm.Container;return e.bind(Bs).toConstantValue(e),e.bind(Vn).toSelf().inSingletonScope(),e.bind(La).toSelf().inSingletonScope(),e.bind(Qs).to(Ga).inSingletonScope(),e.bind(wu).toConstantValue(new so),e.bind(ya).to(_i).inSingletonScope(),e.bind(Xr).toConstantValue(i.storagePath),e.bind(Os).toConstantValue(i.isVsCode),e.bind(Dm).to(Rt),e.bind(bt).to(ta).inSingletonScope(),e.bind(of).toConstantValue(process.env),e.bind(ll).toConstantValue(sC.default),e.bind(G).toConstantValue(Xm.promises),e.bind(mt).toConstantValue(new se(Xm.promises)),e.bind(Eo).toConstantValue(i.isRemote?"remote":"local"),i.context&&e.bind(ke).toConstantValue(i.context),oC(e),e},pC=(i,e,t)=>{i.bind(Ml).toConstantValue(YS(e)),i.bind(X).toService(Ml),i.bind(Xt).to(_a).inSingletonScope(),i.bind(Fs).toConstantValue(t),i.bind(ge).toDynamicValue(r=>r.container.get(Xt).create(e,r.container.get(C))).inSingletonScope(),i.bind(mt).toConstantValue(Op.create(e.__remoteFilePrefix,Xm.promises,t)),i.bind(tf).to(mi).inSingletonScope().onActivation(ve),i.bind(gi).to(Ms).inSingletonScope(),i.bind(Ce).toSelf().inSingletonScope().onActivation(ve),i.bind(Qr).to(pn).inSingletonScope(),i.bind(mn).toSelf().inSingletonScope(),i.bind(fn).to(gn).inSingletonScope(),i.bind(Zr).to($s).inSingletonScope()}});function dC(i,e,t){let r=uC(i,e,"uncaughtException",t),o=uC(i,e,"unhandledRejection",t);return process.addListener("uncaughtException",r),process.addListener("unhandledRejection",o),{dispose:()=>{process.removeListener("uncaughtException",r),process.removeListener("unhandledRejection",o)}}}function ZL(i){return!mC||XL(i)&&!!i.stack?.includes(YL)}function gC(){mC=!0}var eg,uC,XL,YL,mC,fC=m(()=>{"use strict";eg=w(require("path"));_();uC=(i,e,t,r=!0)=>o=>{ZL(o)&&(e.report("error",{"!error":o,error:r?void 0:o,exceptionType:t}),i.error("runtime.exception","Unhandled error in debug adapter",o))},XL=i=>typeof i=="object"&&!!i&&"stack"in i,YL=eg.dirname(eg.dirname(eg.dirname(__dirname)));mC=!1});function e_(i){du&&i.output({category:"console",output:`Note: Using the "preview" debug extension
`})}var hC,rg,tg,bC,ss,wC=m(()=>{"use strict";hC=w(require("@vscode/l10n")),rg=w(require("os"));JS();hh();bl();XS();Ve();ze();O();_();bh();M();U();N();$();_b();H();ki();js();fC();tg=class{constructor(e,t,r,o){this._delegate=e;this._rootServices=r;this._disposables=new j;this._serviceTree=new WeakMap;this._root=new ss(void 0);this.getLaunchers=F(()=>{let e=new Set(this._rootServices.getAll(ct));for(let t of e)this._disposables.push(t.onTargetListChanged(()=>{let r=this.targetList();this._attachToNewTargets(r,t),this._terminateOrphanThreads(r)}));return e});this._dap=t.dap(),this._targetOrigin=o,this._disposables.callback(()=>yu(r)),this._disposables.push(dC(r.get(C),r.get(at),r.get(Os))),t.attachTelemetry(r.get(at));let n=this._dap,s=0,a;n.on("initialize",async c=>{this._rootServices.bind(Mt).toConstantValue(c);let l=Ln.capabilities();return c.clientID==="vscode"&&gC(),setTimeout(()=>n.initialized({}),0),l}),n.on("setExceptionBreakpoints",async()=>({})),n.on("setBreakpoints",async c=>(c.breakpoints?.length&&r.get(Ce).notifyHadBreakpoint(),{breakpoints:c.breakpoints?.map(()=>({id:++s,verified:!1,message:hC.t("Unbound breakpoint")}))??[]})),n.on("configurationDone",async()=>({})),n.on("threads",async()=>({threads:[]})),n.on("loadedSources",async()=>({sources:[]})),n.on("breakpointLocations",()=>Promise.resolve({breakpoints:[]})),n.on("attach",async c=>(await this.boot(c,n),{})),n.on("launch",async c=>(await this.boot(c,n),{})),n.on("pause",async()=>({})),n.on("terminate",()=>this._terminateRoot(!0)),n.on("disconnect",c=>this._disconnectRoot(c)),n.on("restart",async({arguments:c})=>(await this._restart(c),{})),n.on("startSelfProfile",async({file:c})=>(a?.dispose(),a=new Ld(c),await a.start(),{})),n.on("stopSelfProfile",async()=>(a&&(await a.stop(),a.dispose(),a=void 0),{}))}async _terminateRoot(e){return this._root.state=1,await Promise.all([...this.getLaunchers()].map(t=>t.terminate(e))),await this._root.waitUntilChildrenAre(2),this._root.state=2,{}}async _disconnectRoot(e){return this._root.state<1&&await this._terminateRoot(e.terminateDebuggee),this._rootServices.get(at).flush(),await this._root.waitUntilChildrenAre(3),this._root.state=3,{}}async boot(e,t){return this._boot(Ds(e,this._rootServices.get(Eo)),t)}async _boot(e,t){e_(t),this.reportBootTelemetry(e),pC(this._rootServices,e,t),this._rootServices.get(C).setup(yw(t,e.trace));let r=e.timeout>0?ie.withTimeout(e.timeout):new ie;e.rootPath&&(e.rootPath=Pt(e.rootPath)),this._launchParams=e;let o=await Promise.all([...this.getLaunchers()].map(n=>this._launch(n,e,r.token)));return Promise.all(o.map(n=>n.terminated)).then(n=>{let s=n.find(Ae);this._markTargetAsTerminated(this._root,{restart:!!s?.restart})}),{}}reportBootTelemetry(e){let t=Ds({type:e.type,request:e.request,name:"<string>",__workspaceFolder:"<workspace>"}),r=(o,n)=>typeof o=="string"?n&&t[n]===o?o:"<string>":o instanceof Array?o.map(s=>r(s)):o&&typeof o=="object"?Po(o,s=>r(s)):o;this._rootServices.get(at).report("launch",{type:e.type,request:e.request,os:`${rg.platform()} ${rg.arch()}`,nodeVersion:process.version,adapterVersion:cn,parameters:Po(e,r)})}async _restart(e){let t;if(e){let r=this._rootServices.get(Ml);t=Ds({__workspaceFolder:r.__workspaceFolder,...e},this._rootServices.get(Eo)),r.update(t)}await Promise.all([...this.getLaunchers()].map(r=>r.restart(t)))}async _launch(e,t,r){return(await this.captureLaunch(e,t,r)).blockSessionTermination?{terminated:new Promise(n=>{let s=this._disposables.push(e.onTerminated(a=>{s.dispose(),n(a)}))})}:{terminated:Promise.resolve(void 0)}}async captureLaunch(e,t,r){let o=e.constructor.name,n;try{n=await e.launch(t,{telemetryReporter:this._rootServices.get(at),cancellationToken:r,targetOrigin:this._targetOrigin,dap:this._dap})}catch(s){throw this._rootServices.get(C).warn("runtime.launch","Launch returned error",{error:s,wasCancelled:r.isCancellationRequested,name:o}),s}return n.blockSessionTermination&&this._rootServices.get(C).info("runtime.launch","Launched successfully",{name:o}),n}dispose(){this._disposables.dispose(),this._terminateOrphanThreads([])}targetList(){let e=[];for(let t of this.getLaunchers())e.push(...t.targetList());return e}async attach(e,t){if(!this._launchParams)throw new Error("Cannot launch before params have been set");let r=e.value;if(!r.canAttach())return;let o=await r.attach();if(!o)return;let n=await this._delegate.acquireDap(r),s=n.dap(),a=this._launchParams;this._asyncStackPolicy||(this._asyncStackPolicy=GS(a.showAsyncStacks));let c=r.parent(),l=c&&this._serviceTree.get(c)||this._rootServices,p=aC(l,r,s,o);n.attachTelemetry(p.get(at)),this._serviceTree.set(r,l);let d=new Ln(s,this._asyncStackPolicy,a,p),b=d.createThread(o,r),y=async()=>(await d.launchBlocker(),r.runIfWaitingForDebugger(),e.threadData.resolve({thread:b,debugAdapter:d}),{});s.on("disconnect",v=>this._disconnectTarget(e,v)),s.on("terminate",()=>this._terminateTarget(e)),s.on("restart",async()=>(r.canRestart()?r.restart():await this._restart(),Promise.resolve({}))),await this._delegate.initAdapter(d,r,t)?y():(s.on("attach",y),s.on("launch",y)),await r.afterBind()}_attachToNewTargets(e,t){for(let r of e.values()){if(!r.waitingForDebugger()||ss.targetNodes.has(r))continue;let o=r.parent(),n=o?ss.targetNodes.get(o):this._root;if(!n)throw new Error(`Got target with unknown parent: ${r.name()}`);let s=new ss(r);n.add(s),this.attach(s,t)}}async _terminateOrphanThreads(e,t){let r=[...this._root.all()].filter(o=>!e.includes(o.value));return Promise.all(r.map(o=>this._markTargetAsTerminated(o,t)))}async _markTargetAsTerminated(e,t={}){if(e.state>=1)return await e.waitUntil(2),{};if(e.state=1,bC(e)){let r=await e.threadData.promise;await r.thread.dispose(),r.debugAdapter.dap.terminated(t),r.debugAdapter.dispose()}else this._dap.terminated(t);return await e.waitUntilChildrenAre(2),e.state=2,{}}async _terminateTarget(e){return e.state>=3?{}:(e.value.canStop()?e.value.stop():this._terminateRoot(!0),await e.waitUntil(2),{})}async _disconnectTarget(e,t){if(e.state>=3)return{};e.state<1&&(t.terminateDebuggee!==!0&&e.value.canDetach()?await e.value.detach():e.value.canStop()?e.value.stop():this._terminateRoot(t.terminateDebuggee)),await e.waitUntil(2),await e.waitUntilChildrenAre(3),e.state=3,queueMicrotask(()=>this._delegate.releaseDap(e.value));let r=e.value.parent();return(r?ss.targetNodes.get(r):this._root)?.remove(e),{}}};bC=i=>!!i.value,ss=class i{constructor(e){this.value=e;this.threadData=ne();this._state=0;this._children=new Set;this._stateChangeEmitter=new S;e&&i.targetNodes.set(e,this)}static{this.targetNodes=new WeakMap}get state(){return this._state}set state(e){e>this._state&&(this._state=e,this._stateChangeEmitter.fire(e))}add(e){this._children.add(e)}remove(e){this._children.delete(e)}async waitUntil(e){return this._state>=e?Promise.resolve():new Promise(t=>{let r=this._stateChangeEmitter.event(o=>{o>=e&&(r.dispose(),t())})})}async waitUntilChildrenAre(e){await Promise.all([...this._children].map(t=>t.waitUntil(e)))}*all(){bC(this)&&(yield this);for(let e of this._children)yield*e.all()}}});var yC,t_,hp,vC=m(()=>{"use strict";O();aa();_();yC=`\r
\r
`,t_=0,hp=class{constructor(e,t,r){this.inputStream=e;this.outputStream=t;this._contentLength=-1;this._connectionId=t_++;this.msgEmitter=new S;this.messageReceived=this.msgEmitter.event;this.endedEmitter=new S;this.closed=this.endedEmitter.event;this._handleData=e=>{let t=new gr;for(this._rawData=Buffer.concat([this._rawData,e]);;){if(this._contentLength>=0){if(this._rawData.length>=this._contentLength){let r=this._rawData.toString("utf8",0,this._contentLength);if(this._rawData=this._rawData.slice(this._contentLength),this._contentLength=-1,r.length>0)try{let o=JSON.parse(r);this.logger?.verbose("dap.receive",void 0,{connectionId:this._connectionId,message:o}),this.msgEmitter.fire({message:o,receivedTime:t})}catch(o){console.error("Error handling data: "+(o&&o.message))}continue}}else{let r=this._rawData.indexOf(yC);if(r!==-1){let n=this._rawData.toString("utf8",0,r).split(`\r
`);for(let s=0;s<n.length;s++){let a=n[s].split(/: +/);a[0]==="Content-Length"&&(this._contentLength=+a[1])}this._rawData=this._rawData.slice(r+yC.length);continue}}break}};this.logger=r,this._rawData=Buffer.alloc(0),e.on("end",()=>this.endedEmitter.fire()),e.on("data",this._handleData)}send(e,t=!0,r){let o=JSON.stringify(e);if(t){let s=e;e.type==="response"&&e.command==="source"&&(s={...e,body:{...e.body,content:"<script source>"}}),this.logger?.verbose("dap.send",void 0,{connectionId:this._connectionId,message:s})}let n=`Content-Length: ${Buffer.byteLength(o,"utf8")}\r
\r
${o}`;if(this.outputStream.destroyed){this.logger?.warn("dap.send","Message not sent. Connection was closed."),r?.();return}this.outputStream.write(n,"utf8",s=>{r?.(),s&&(console.log(e),this.logger?.error("dap.send","Error while writing to output stream",s),this.close())})}close(){this.inputStream.destroy(),this.outputStream.destroy()}setLogger(e){return this.logger=e,this}}});var r_,as,bp,Eb=m(()=>{"use strict";r_=["[[ArrayBufferData]]"],as=async(i,e,t,r=0,o)=>{if(!await t(e,r)||e.variablesReference===void 0)return;if(typeof e.namedVariables=="number"||typeof e.indexedVariables=="number"){if(e.namedVariables){let s=await i.variables({variablesReference:e.variablesReference,filter:"named",format:o});for(let a of s.variables)await as(i,a,t,r+1,o)}if(e.indexedVariables){let s=await i.variables({variablesReference:e.variablesReference,filter:"indexed",start:0,count:e.indexedVariables,format:o});for(let a of s.variables)await as(i,a,t,r+1)}}else{let s=await i.variables({variablesReference:e.variablesReference,format:o});for(let a of s.variables)await as(i,a,t,r+1,o)}},bp=class{constructor(e,t){this._dap=e,this._log=t}logAsConsole(e){e&&(e.endsWith(`
`)&&(e=e.substring(0,e.length-1)),this._log(e))}logVariable(e,t={},r=""){return as(this._dap,e,(o,n)=>{if(r_.includes(o.name))return n<(t.depth??1);let s=o.name?`${o.name}: `:"",a=(o.presentationHint?.lazy?"(...)":o.value)||"";a.endsWith(`
`)&&(a=a.substring(0,a.length-1));let c=o.type?`type=${o.type}`:"",l=o.namedVariables?` named=${o.namedVariables}`:"",p=o.indexedVariables?` indexed=${o.indexedVariables}`:"",d=r+"    ".repeat(n),b=o.variablesReference?"> ":"",y=t.logInternalInfo?`${c}${l}${p}`:"";y&&(y="  // "+y);let v=`${b}${s}${a}`;return v&&(v.includes(`
`)&&(v=`
`+v),this.logAsConsole(`${d}${v}${y}`)),n<(t.depth??1)},void 0,t.format)}async logOutput(e,t){e.group&&this.logAsConsole(`# group: ${e.group}`);let r=`${e.category}> `;if(e.output&&this.logAsConsole(`${r}${e.output}`),e.variablesReference){let o=await this._dap.variables({variablesReference:e.variablesReference});for(let n of o.variables)await this.logVariable(n,t,r)}}async logEvaluateResult(e,t){let r={...e,name:"result",value:e.result};return await this.logVariable(r,t),r}async logStackTrace(e,t=0){let r=await this._dap.stackTrace({threadId:e}),o=r.stackFrames,n=r.totalFrames||o.length;for(;o.length<n;){let a=await this._dap.stackTrace({threadId:e,startFrame:o.length,levels:Math.min(20,n-o.length)});o.push(...a.stackFrames),a.totalFrames&&(n=Math.min(n,a.totalFrames))}let s=t>0;for(let a of o){if(s&&this._log(""),a.presentationHint==="label"){this._log(`----${a.name}----`),s=!1;continue}let c=a.source&&a.source.presentationHint==="deemphasize"?` <hidden: ${a.source.origin||""}>`:"";if(this._log(`${a.name} @ ${a.source?a.source.path:"unknown"}:${a.line}:${a.column}${c}`),t--<=0)continue;let l=await this._dap.scopes({frameId:a.id});if(typeof l=="string")this._log(`  scope error: ${l}`);else for(let p=0;p<l.scopes.length;p++){let d=l.scopes[p];if(d.expensive){this._log(`  scope #${p}: ${d.name} [expensive]`);continue}await this.logVariable({name:"scope #"+p,value:d.name,variablesReference:d.variablesReference,namedVariables:d.namedVariables,indexedVariables:d.indexedVariables},{},"  ")}}return o}async evaluateAndLog(e,t={},r){if(typeof e=="string"){let o=await this._dap.evaluate({expression:e,context:r,...t.params,format:t.format});return typeof o=="string"?(this._log(`<error>: ${o}`),{name:"result",value:o,variablesReference:0}):await this.logEvaluateResult(o,t)}for(let o of e){this._log(`Evaluating: '${o}'`);let n=this._dap.evaluate({expression:o,context:r});await this.logOutput(await this._dap.once("output"),t),await n,this._log("")}}}});function cs(i){return IC.default.join(SC.default.tmpdir(),`${i.replace(/[^a-z0-9]/gi,"-")}.json`)}var SC,IC,Ab=m(()=>{"use strict";SC=w(require("os")),IC=w(require("path"))});var PC,ng,kC,we,xC,CC,ls,L,RX,sg,h,ag,og,wp,Fb,Mb,ig,rt=m(()=>{"use strict";PC=w(require("del")),ng=w(require("gulp")),kC=require("os"),we=w(require("path")),xC=w(require("playwright")),CC=w(require("stream"));hh();wC();A();O();_();M();ee();N();$();Lr();vC();_b();ti();mm();Eb();Ab();ls=we.join("/home/benjamin/code/hobby/my-nixvim/config/dap/vscode-js-debug/src/test","..",".."),L=we.join(ls,"testWorkspace"),RX=we.join(ls,"src"),sg=".dynamic-testWorkspace",h=we.join(ls,sg),ag=i=>process.platform==="darwin"?i.replace(/^\/private/,""):i,og=class extends CC.Duplex{_write(e,t,r){Promise.resolve().then().then().then().then().then().then().then().then().then().then().then(()=>{this.push(e,t),r()})}_read(e){}},wp=class{constructor(e){let t=new og,r=new og;this.adapterConnection=new As(new hp(t,r,e),e);let o=new As(new hp(r,t,e),e);this.dap=o.createTestApi()}async _init(){let[e]=await Promise.all([this.dap.initialize({clientID:"pwa-test",adapterID:"pwa",linesStartAt1:!0,columnsStartAt1:!0,pathFormat:"path",supportsVariablePaging:!0}),this.dap.once("initialized")]);return e}},Fb=class{constructor(e,t){this._evaluateCounter=0;this._root=e,this._target=t,this.log=e.log,this.assertLog=e.assertLog,this._session=new wp(e.logger),this.dap=this._session.dap,this.logger=new bp(this.dap,this.log)}get cdp(){return this._cdp}get adapter(){return this._adapter}async evaluate(e,t){return++this._evaluateCounter,this.log(`Evaluating#${this._evaluateCounter}: ${e}`),t===void 0?t=`//# sourceURL=eval${this._evaluateCounter}.js`:t&&(t=`//# sourceURL=${this.completeUrl(t)}`),this._cdp.Runtime.evaluate({expression:e+`
${t}`}).then(r=>{if(r){if(r.exceptionDetails){this.log(r.exceptionDetails,"Error evaluating");debugger;throw new Error('Error evaluating "'+e+'"')}}else{this.log(e,"Error evaluating");debugger;throw new Error('Error evaluating "'+e+'"')}return r})}async addScriptTag(e){await this._cdp.Runtime.evaluate({expression:`
      new Promise(f => {
        var script = document.createElement('script');
        script.src = '${this._root.completeUrl(e)}';
        script.onload = () => f(undefined);
        document.head.appendChild(script);
      })
    `,awaitPromise:!0})}waitForSource(e){return this.dap.once("loadedSource",t=>e===void 0||(t.source.path||"").indexOf(e)!==-1)}completeUrl(e){return this._root.completeUrl(e)}workspacePath(e){return this._root.workspacePath(e)}async _init(e,t,r){e.breakpointManager.setPredictorDisabledForTest(!0),e.sourceContainer.setSourceMapTimeouts({load:0,resolveLocation:2e3,sourceMapMinPause:1e3,output:3e3,sourceMapCumulativePause:1e4}),this._adapter=e,this._root._browserLauncher=r,this._connection=this._root._browserLauncher?.connectionForTest();let o=await this._connection.rootSession().Target.attachToBrowserTarget({}),n=this._connection.createSession(o.sessionId),{sessionId:s}=await n.Target.attachToTarget({targetId:this._target instanceof ws?this._target.targetId:this._target.id(),flatten:!0});return this._cdp=this._connection.createSession(s),await this._session._init(),this._target.parent()&&(this.dap.configurationDone({}),this.dap.attach({})),!1}async load(){await this.dap.configurationDone({}),await this.dap.attach({}),this._cdp.Page.enable({}),this._cdp.Page.navigate({url:this._root._launchUrl}),await new Promise(e=>this._cdp.Page.on("loadEventFired",e)),await this._cdp.Page.disable({})}},Mb=class{constructor(e,t){this._root=e,this._target=t,this.log=e.log,this.assertLog=e.assertLog,this._session=new wp(e.logger),this.dap=this._session.dap,this.logger=new bp(this.dap,this.log)}get cdp(){return this._cdp}get adapter(){return this._adapter}waitForSource(e){return this.dap.once("loadedSource",t=>e===void 0||B(t.source.path||"").includes(e))}workspacePath(e){return this._root.workspacePath(e)}async _init(e,t){return this._adapter=e,await this._session._init(),this._target.parent()&&(this.dap.configurationDone({}),this.dap.attach({})),!0}async load(){await this.dap.configurationDone({})}},ig=class{constructor(e,t){this._testTitlePath=t;this._targetToP=new Map;this._onSessionCreatedEmitter=new S;this.onSessionCreated=this._onSessionCreatedEmitter.event;this._args=["--headless"],this.log=e.log.bind(e),this.assertLog=e.assertLog.bind(e),this._workspaceRoot=Pt(L),this._webRoot=we.join(this._workspaceRoot,"web");let r=we.join("/home/benjamin/code/hobby/my-nixvim/config/dap/vscode-js-debug/src/test","..",".."),o=new Map,n=cC(lC({storagePath:r,isVsCode:!0,context:Xo({workspaceState:{keys:()=>[],get(a,c){return o.get(a)??c},update(a,c){return o.set(a,c),Promise.resolve()}}})}));this.logger=n.get(C),this._root=new wp(this.logger);let s=this._root.adapterConnection.dap();s.on("initialize",async()=>(s.initialized({}),Ln.capabilities())),s.on("configurationDone",async()=>({})),this.binder=new tg(this,this._root.adapterConnection,n,new um("0")),this.initialize=this._root._init(),this._launchCallback=()=>{},this._workerCallback=()=>{},this._worker=new Promise(a=>this._workerCallback=a)}async acquireDap(e){let t=e.type()==="page"?new Fb(this,e):new Mb(this,e);return this._targetToP.set(e,t),t._session.adapterConnection}async initAdapter(e,t,r){let o=this._targetToP.get(t);if(!o)return!0;let n=await o._init(e,t,r);return t.parent()?this._workerCallback(o):this._launchCallback(o),this._onSessionCreatedEmitter.fire(o),n}releaseDap(e){this._targetToP.delete(e)}setArgs(e){this._args=e}worker(){return this._worker}rootDap(){return this._root.dap}async waitForTopLevel(){return await new Promise(t=>this._launchCallback=t)}async _launch(e,t={}){await this.initialize,this._launchUrl=e;let r=cs(this._testTitlePath);return this._root.dap.launch({...Rs,url:e,runtimeArgs:this._args,webRoot:this._webRoot,rootPath:this._workspaceRoot,skipNavigateForTest:!0,trace:{logFile:r},runtimeExecutable:xC.default.chromium.executablePath(),outFiles:[`${this._workspaceRoot}/**/*.js`,"!**/node_modules/**"],__workspaceFolder:this._workspaceRoot,cleanUp:"wholeBrowser",...t}),await new Promise(n=>this._launchCallback=n)}async runScript(e,t={}){await this.initialize,this._launchUrl=we.isAbsolute(e)?e:we.join(h,e);let r=cs(this._testTitlePath);return this._root.dap.launch({type:"pwa-node",request:"launch",name:"Test Case",cwd:we.dirname(h),program:this._launchUrl,rootPath:this._workspaceRoot,trace:{logFile:r},runtimeVersion:process.env.JSDBG_USE_NODE_VERSION,outFiles:[`${this._workspaceRoot}/**/*.js`,"!**/node_modules/**"],resolveSourceMapLocations:["**","!**/node_modules/**"],__workspaceFolder:this._workspaceRoot,...t}),await new Promise(n=>this._launchCallback=n)}async runScriptAsRemote(e,t={}){await this.initialize,e=we.isAbsolute(e)?e:we.join(h,e);let r=we.join((0,kC.tmpdir)(),"js-debug-test");return process.platform==="darwin"&&r.startsWith("/var/folders")&&(r=`/private/${r}`),after(()=>(0,PC.default)(`${B(r)}/**`,{force:!0})),await new Promise((n,s)=>ng.src("**/*.*",{cwd:we.dirname(e)}).pipe(ng.dest(r)).on("end",n).on("error",s)),this._root.dap.launch({...rl,cwd:we.dirname(h),program:we.join(r,we.basename(e)),localRoot:we.dirname(e),remoteRoot:r,trace:{logFile:cs(this._testTitlePath)},outFiles:[],resolveSourceMapLocations:["**","!**/node_modules/**"],env:{NODE_PATH:[process.env.NODE_PATH,we.resolve(we.dirname(e),"node_modules"),we.resolve(ls,"node_modules")].filter(Boolean).join(process.platform==="win32"?";":":")},__workspaceFolder:this._workspaceRoot,...t}),await new Promise(n=>this._launchCallback=n)}async attachNode(e,t={}){await this.initialize,this._launchUrl=`process${e}`,this._root.dap.launch({...ui,trace:{logFile:cs(this._testTitlePath)},processId:`inspector${e}`,__workspaceFolder:this._workspaceRoot,...t});let r=await new Promise(o=>this._launchCallback=o);return await r.load(),r}async launch(e,t={}){let r="data:text/html;base64,"+Buffer.from(e).toString("base64");return this._launch(r,t)}async launchAndLoad(e,t={}){let r="data:text/html;base64,"+Buffer.from(e).toString("base64"),o=await this._launch(r,t);return await o.load(),o}buildUrl(e){return Tr("http://localhost:8001/",e)||e}async launchUrl(e,t={}){return await this._launch(this.buildUrl(e),t)}async launchUrlAndLoad(e,t={}){let r=await this._launch(this.buildUrl(e),t);return await r.load(),r}async disconnect(){return new Promise(e=>{this.initialize.then(()=>{let t=this._browserLauncher?.connectionForTest();if(t){let r=t.onDisconnected(()=>{e(),r.dispose()})}else e();this._root.dap.disconnect({}),this.binder.dispose()})})}completeUrl(e){return Tr(this._launchUrl,e)||""}workspacePath(e){return we.join(this._workspaceRoot,e)}}});var Nb,zo,lg,o_,i_,TC,RC,cg,Bb=m(()=>{"use strict";Nb=require("chai"),zo=w(require("fs")),lg=w(require("path"));ee();Rr();N();rt();o_=["id","threadId","sourceReference","variablesReference"],i_=new Set(["hitBreakpointIds"]),TC=i=>i.split(`
`).map(e=>e.trimRight()).join(`
`).replace(/\\r\\n/g,"\\n"),RC=i=>i.replace(/^.*<node_internals>.*\r?\n/gm,"").replace(/^.*@ internal\/.*\r?\n/gm,""),cg=class{constructor(e,t,r){this.testFile=t;this._results=[],this._testName=e,this._hasNonAssertedLogs=!1,this._workspaceFolder=Pt(r)}hasNonAssertedLogs(){return this._hasNonAssertedLogs}getOutput(){return TC(this._results.join(`
`)+`
`)}assertLog(e={}){let t=this.getOutput();if(this._hasNonAssertedLogs=!1,e.customAssert){e.customAssert(t);return}e.process&&(t=e.process(t));let r=this.findGoldenFilePath();if(!zo.existsSync(r))console.log("----- Missing expectations file, writing a new one"),zo.writeFileSync(r,t,{encoding:"utf-8"});else if(process.env.RESET_RESULTS)zo.writeFileSync(r,t,{encoding:"utf-8"});else{let o=TC(zo.readFileSync(r).toString("utf-8"));try{e.substring?(0,Nb.expect)(t).to.contain(o):(0,Nb.expect)(t).to.equal(o)}catch(n){throw zo.writeFileSync(r+".actual",t,{encoding:"utf-8"}),n}}}findGoldenFilePath(){let e=this.testFile;if(!e)throw new Error("GoldenText failed to get filename!");let t=this._testName.trim().toLowerCase().replace(/\s/g,"-").replace(/[^-0-9a-zа-яё]/gi,""),r=lg.resolve(lg.dirname(e),t),o=r+`.${process.platform}.txt`;return zo.existsSync(o)?o:r+".txt"}_sanitize(e){let t=(r,o)=>{let n=nt(B(r),"/"),s=new RegExp(n.replace(/\//g,"[\\\\/]")+"(.*)","gi");e=e.replace(s,(a,c)=>o+B(c))};return e=String(e),t(this._workspaceFolder,"${workspaceFolder}"),t(h,"${fixturesDir}"),e=e.replace(/testWorkspace/g,"${workspaceFolder}"),e=e.replace("/private${fixturesDir}","${fixturesDir}"),e=e.split(`
`).filter(r=>!r.includes("hidden: blackboxed")).join(`
`),e.replace(/VM\d+/g,"VM<xx>").replace(/\r\n/g,`
`).replace(/@\ .*vscode-pwa(\/|\\)/g,"@ ").replace(/data:text\/html;base64,[a-zA-Z0-9+/]*=?/g,"<data-url>")}log(e,t,r){return this._hasNonAssertedLogs=!0,typeof e=="object"?this._logObject(e,t,r):(this._results.push((t||"")+this._sanitize(e)),e)}_logObject(e,t,r){r=r||o_;let o=[],n=(c,l,p)=>{typeof c=="object"&&c!==null?c instanceof Array?a(c,l,p):s(c,l,p):o.push(p+this._sanitize(c).replace(/\n/g," "))};function s(c,l,p){l=l||"",p=p||l,o.push(p+"{");let d=Object.keys(c);d.sort();for(let b=0;b<d.length;++b){let y=d[b];if(!c.hasOwnProperty(y)||i_.has(y))continue;let v="    "+l+y+" : ",D=c[y];r&&r.includes(y)&&(D=`<${typeof D}>`),n(D,"    "+l,v)}o.push(l+"}")}function a(c,l,p){l=l||"",p=p||l,o.push(p+"[");for(let d=0;d<c.length;++d)n(c[d],"    "+l,"    "+l+"["+d+"] : ");o.push(l+"]")}return n(e,"",t||""),this._results.push(...o),e}}});var LC={};ew(LC,{eventuallyOk:()=>J,itIntegrates:()=>g,waitForPause:()=>P});async function P(i,e){let{threadId:t}=i.log(await i.dap.once("stopped"));return await i.logger.logStackTrace(t),await e?.(t),i.dap.continue({threadId:t})}var Ob,DC,jb,pg,yp,g,J,_e=m(()=>{"use strict";Ob=w(require("child_process")),DC=require("fs"),jb=w(require("path"));U();Bb();rt();process.env.DA_TEST_DISABLE_TELEMETRY="true";before(async()=>{pg=[Ob.fork(jb.join("/home/benjamin/code/hobby/my-nixvim/config/dap/vscode-js-debug/src/test","testServer.js"),["8001"],{stdio:"pipe"}),Ob.fork(jb.join("/home/benjamin/code/hobby/my-nixvim/config/dap/vscode-js-debug/src/test","testServer.js"),["8002"],{stdio:"pipe"})],await Promise.all(pg.map(i=>new Promise((e,t)=>{let r="";i.stderr?.on("data",o=>r+=o.toString()),i.stdout?.on("data",o=>r+=o.toString()),i.once("error",t),i.once("close",o=>t(new Error(`Exited with ${o}, stderr=${r}`))),i.once("message",e)})))});after(async()=>{pg.forEach(i=>i.kill()),pg=[]});yp=(i,e,t=it)=>t(i,async function(){if(!this.test?.file)throw new Error("Could not find file for test");let r=new cg(this.test.titlePath().join(" "),this.test?.file,L),o=new ig(r,this.test.fullTitle());await o.initialize;try{this.test.goldenText=r,await e({golden:r,r:o,context:this})}finally{try{await o.disconnect()}catch(n){console.warn("Error disconnecting test root:",n)}}if(r.hasNonAssertedLogs())throw new Error(`Whoa, test "${i}" has some logs that it did not assert!

${r.getOutput()}`)});yp.only=(i,e)=>yp(i,e,it.only);yp.skip=(i,e)=>yp(i,e,it.skip);g=yp,J=async(i,e=1e3,t=10)=>{let r=Date.now()+e;for(;;)try{return await i()}catch(o){if(Date.now()+t>r)throw o;await x(t)}};afterEach(async()=>{for(let i=10;i>=0;i--)try{await DC.promises.rm(h,{recursive:!0,force:!0});return}catch(e){if(i===0)throw e;await x(100)}})});var n_={};var tr,vp,_C,EC=m(()=>{"use strict";tr=require("chai"),vp=require("fs"),_C=w(require("ws"));Fp();rt();_e();describe("browser launch",()=>{g("environment variables",async({r:i})=>{if(process.platform==="win32")return;await(await i.launchUrlAndLoad("index.html",{env:{TZ:"GMT"}})).logger.evaluateAndLog("new Date().getTimezoneOffset()"),i.assertLog()}),g("runtime args",async({r:i})=>{await(await i.launchUrlAndLoad("index.html",{runtimeArgs:["--window-size=678,456"]})).logger.evaluateAndLog("[window.outerWidth, window.outerHeight]"),i.assertLog()}),g.skip("user data dir",async({r:i})=>{(0,vp.mkdirSync)(h,{recursive:!0}),(0,tr.expect)((0,vp.readdirSync)(h)).to.be.empty,await i.launchUrlAndLoad("index.html",{userDataDir:h}),(0,tr.expect)((0,vp.readdirSync)(h)).to.not.be.empty}),g("connects to rewritten websocket when using inspectUri parameter",async({r:i})=>{let t=new _C.default.WebSocketServer({port:5935,path:"/_framework/debug/ws-proxy"});try{let r=new Promise(o=>{t.on("connection",n=>{n.on("message",s=>{let a=JSON.parse(s.toString());n.send(JSON.stringify({id:a.id,error:{message:"Fake websocket"}})),o(s.toString()),n.close()})})});i.launchUrl("index.html",{inspectUri:"{wsProtocol}://{url.hostname}:5935/_framework/debug/ws-proxy?browser={browserInspectUri}"}),(0,tr.expect)(await r).to.be.eq('{"id":1001,"method":"Target.attachToBrowserTarget","params":{}}')}finally{await new Promise(r=>t.close(r))}})});describe("constructInspectorWSUri",()=>{let i="{wsProtocol}://{url.hostname}:{url.port}/_framework/debug/ws-proxy?browser={browserInspectUri}",e="http://localhost:5001/",t="ws://127.0.0.1:36775/devtools/browser/a292f96c-7332-4ce8-82a9-7411f3bd280a",r=encodeURIComponent(t),o="https://localhost:5001/";it("interpolates arguments to construct inspectUri",()=>{(0,tr.expect)(_t(i,e,t)).to.be.eq(`ws://localhost:5001/_framework/debug/ws-proxy?browser=${r}`),(0,tr.expect)(_t(i,o,t)).to.be.eq(`wss://localhost:5001/_framework/debug/ws-proxy?browser=${r}`)}),it("does not do anything with arguments that does not exist",()=>{(0,tr.expect)(_t(i+"&{iDoNotExist}{meEither}",e,t)).to.be.eq(`ws://localhost:5001/_framework/debug/ws-proxy?browser=${r}&{iDoNotExist}{meEither}`)}),it("fails with an useful error for invalid urls",()=>{(0,tr.expect)(()=>_t(i,".not_an_url",t)).to.throw(/Invalid URL/),(0,tr.expect)(()=>_t(i,null,t)).to.throw("A valid url wasn't supplied: <null>"),(0,tr.expect)(()=>_t(i,void 0,t)).to.throw("A valid url wasn't supplied: <undefined>"),(0,tr.expect)(()=>_t(i,"",t)).to.throw("A valid url wasn't supplied: <>")});let n="ws://localhost:1234/_framework/debug/ws-proxy?browser={browserInspectUri}";it("does not fail for an invalid url if it isnt used",()=>{(0,tr.expect)(_t(n,".not_an_url",t)).to.be.eq(`ws://localhost:1234/_framework/debug/ws-proxy?browser=${r}`),(0,tr.expect)(_t(n,void 0,t)).to.be.eq(`ws://localhost:1234/_framework/debug/ws-proxy?browser=${r}`)})})});var s_={};var Ub,AC=m(()=>{"use strict";Ub=require("chai");_e();describe("performance",()=>{g("gets performance information",async({r:i})=>{let t=await(await i.launchUrlAndLoad("index.html")).dap.getPerformance({});(0,Ub.expect)(t.error).to.be.undefined,(0,Ub.expect)(t.metrics).to.not.be.empty})})});var a_={};var Fc,St,FC=m(()=>{"use strict";Fc=w(require("assert")),St=require("chai");Ve();U();describe("CancellationToken",()=>{it("None",()=>{(0,St.expect)(Ne.isCancellationRequested).to.equal(!1),(0,St.expect)(typeof Ne.onCancellationRequested).to.equal("function")}),it("cancel before token",function(i){let e=new ie;(0,St.expect)(e.token.isCancellationRequested).to.equal(!1),e.cancel(),(0,St.expect)(e.token.isCancellationRequested).to.equal(!0),e.token.onCancellationRequested(()=>{Fc.ok(!0),i()})}),it("cancel happens only once",()=>{let i=new ie;(0,St.expect)(i.token.isCancellationRequested).to.equal(!1);let e=0;function t(){e+=1}i.token.onCancellationRequested(t),i.cancel(),i.cancel(),(0,St.expect)(e).to.equal(1)}),it("cancel calls all listeners",()=>{let i=0,e=new ie;e.token.onCancellationRequested(()=>{i+=1}),e.token.onCancellationRequested(()=>{i+=1}),e.token.onCancellationRequested(()=>{i+=1}),e.cancel(),(0,St.expect)(i).to.equal(3)}),it("token stays the same",()=>{let i=new ie,e=i.token;Fc.ok(e===i.token),i.cancel(),Fc.ok(e===i.token),i.cancel(),Fc.ok(e===i.token),i=new ie,i.cancel(),e=i.token,Fc.ok(e===i.token)}),it("dispose calls no listeners",()=>{let i=0,e=new ie;e.token.onCancellationRequested(()=>{i+=1}),e.dispose(),e.cancel(),(0,St.expect)(i).to.equal(0)}),it("dispose calls no listeners (unless told to cancel)",()=>{let i=0,e=new ie;e.token.onCancellationRequested(()=>{i+=1}),e.dispose(!0),(0,St.expect)(i).to.equal(1)}),it("parent cancels child",()=>{let i=new ie,e=new ie(i.token),t=0;e.token.onCancellationRequested(()=>t+=1),i.cancel(),(0,St.expect)(t).to.equal(1),(0,St.expect)(e.token.isCancellationRequested).to.equal(!0),(0,St.expect)(i.token.isCancellationRequested).to.equal(!0)}),describe("cancellableRace",()=>{it("returns the value when no cancellation is requested",async()=>{let i=await Nt(Promise.resolve(42),Ne);(0,St.expect)(i).to.equal(42)}),it("throws if cancellation is requested",async()=>{try{throw await Nt(Promise.resolve(42),yf),new Error("expected to throw")}catch(i){if(i instanceof zt)(0,St.expect)(i.message).to.equal("Task cancelled");else throw i}}),it("throws if lazy cancellation is requested",async()=>{try{throw await Nt(x(1e3),ie.withTimeout(3).token,"Could not do the thing"),new Error("expected to throw")}catch(i){if(i instanceof zt)(0,St.expect)(i.message).to.equal("Could not do the thing");else throw i}})})})});var c_={};var ug,MC,Wb,Vb,NC,BC=m(()=>{"use strict";ug=require("chai"),MC=require("crypto"),Wb=require("sinon"),Vb=require("stream"),NC=require("ws");Bn();Nn();Ve();Er();_e();describe("cdp transport",()=>{let i=[["raw pipe",async()=>{let e=new Vb.PassThrough,t=new Vb.PassThrough,r=new xt(E.null,e,t),o=new xt(E.null,t,e);return{a:r,b:o,dispose:()=>{}}}],["websocket",async()=>{let e=new NC.Server({host:"127.0.0.1",port:0});await new Promise((n,s)=>{e.on("listening",n),e.on("error",s)});let t=e.address(),r=yt.create(`ws://127.0.0.1:${t.port}`,Ne),o=new Promise((n,s)=>{e.on("connection",a=>n(new yt(a))),e.on("error",s)});return{a:await r,b:await o,dispose:()=>e.close()}}]];for(let[e,t]of i)describe(e,()=>{it("round-trips",async()=>{let r=(0,MC.randomBytes)(100),{a:o,b:n,dispose:s}=await t(),a=[],c=[];n.onMessage(([l])=>a.push(l));for(let l=0;l<r.length;){let p=Math.floor(Math.random()*20),d=r.slice(l,l+p).toString("base64");c.push(d),o.send(d),l+=p}await J(()=>(0,ug.expect)(a).to.deep.equal(c)),await o.dispose(),s()}),it("bubbles closure",async()=>{let{a:r,b:o,dispose:n}=await t(),s=(0,Wb.stub)(),a=(0,Wb.stub)();r.onEnd(s),o.onEnd(a),await r.dispose(),await J(()=>(0,ug.expect)(s.called).to.be.true),await J(()=>(0,ug.expect)(a.called).to.be.true),n()})})})});var l_={};var OC,jC,UC=m(()=>{"use strict";Wl();OC=require("sinon"),jC=require("chai");describe("defaultBrowserProvider",()=>{describe("win32",()=>{let i=[{output:`\r
HKEY_CURRENT_USER\\Software\\Microsoft\\Windows\\Shell\\Associations\\UrlAssociations\\http\\UserChoice\r
    ProgId    REG_SZ    AppXq0fevzme2pys62n3e0fbqa7peapykr8v\r
\r
`,expected:4},{output:`\r
HKEY_CURRENT_USER\\Software\\Microsoft\\Windows\\Shell\\Associations\\UrlAssociations\\http\\UserChoice\r
    ProgId    REG_SZ    MSEdgeDHTML\r
\r
`,expected:3},{output:`\r
HKEY_CURRENT_USER\\Software\\Microsoft\\Windows\\Shell\\Associations\\UrlAssociations\\http\\UserChoice\r
    ProgId    REG_SZ    ChromeHTML\r
\r
`,expected:0},{output:`\r
HKEY_CURRENT_USER\\Software\\Microsoft\\Windows\\Shell\\Associations\\UrlAssociations\\http\\UserChoice\r
    ProgId    REG_SZ    IE.HTTP\r
\r
`,expected:5},{output:`\r
HKEY_CURRENT_USER\\Software\\Microsoft\\Windows\\Shell\\Associations\\UrlAssociations\\http\\UserChoice\r
    ProgId    REG_SZ    FirefoxURL\r
\r
`,expected:2},{output:`\r
HKEY_CURRENT_USER\\Software\\Microsoft\\Windows\\Shell\\Associations\\UrlAssociations\\http\\UserChoice\r
    ProgId    REG_SZ    Potato\r
\r
`,expected:void 0}];for(let{output:e,expected:t}of i)it(`gets browser ${t}`,async()=>{let r=(0,OC.stub)().resolves({stdout:e}),o=new _i(r,"win32");(0,jC.expect)(await o.lookup()).to.equal(t)})})})});var p_={};var WC,dg,VC=m(()=>{"use strict";WC=require("chai"),dg=require("sinon");_();Er();describe("Logger",()=>{let i,e;beforeEach(()=>{i={write:(0,dg.stub)(),setup:(0,dg.stub)().resolves(),dispose:(0,dg.stub)()},e=new E}),it("buffers and logs messages once sinks are attached",async()=>{e.verbose("runtime","Hello world!"),await e.setup({sinks:[i],showWelcome:!1}),(0,WC.expect)(i.write.args[0][0]).to.containSubset({tag:"runtime",message:"Hello world!",level:0})})})});var u_={};var Go,$C=m(()=>{"use strict";Go=require("chai");ys();describe("mapUsingProjection",()=>{it("gets values",()=>{let i=new ft(e=>e.toLowerCase());i.set("bar",1),(0,Go.expect)(i.get("foo")).to.be.undefined,(0,Go.expect)(i.get("bar")).to.equal(1),(0,Go.expect)(i.get("bAr")).to.equal(1)}),it("sets values",()=>{let i=new ft(e=>e.toLowerCase());i.set("bar",1),(0,Go.expect)(i.get("bar")).to.equal(1),i.set("BAR",2),(0,Go.expect)(i.get("bar")).to.equal(2)}),it("deletes values",()=>{let i=new ft(e=>e.toLowerCase());i.set("bar",1),i.delete("bAr"),(0,Go.expect)(i.get("bar")).to.be.undefined}),it("gets keys",()=>{let i=new ft(e=>e.toLowerCase());i.set("FOO",1),i.set("bar",1),(0,Go.expect)([...i.keys()].sort()).to.deep.equal(["FOO","bar"])}),it("gets values",()=>{let i=new ft(e=>e.toLowerCase());i.set("FOO",1),i.set("bar",2),(0,Go.expect)([...i.values()].sort()).to.deep.equal([1,2])})})});var d_={};var pt,qC=m(()=>{"use strict";pt=require("chai");ee();describe("pathUtils",()=>{describe("forceForwardSlashes",()=>{it("works for c:/... cases",()=>{(0,pt.expect)(B("C:\\foo\\bar")).to.equal("C:/foo/bar"),(0,pt.expect)(B("C:\\")).to.equal("C:/"),(0,pt.expect)(B("C:/foo\\bar")).to.equal("C:/foo/bar")}),it("works for relative paths",()=>{(0,pt.expect)(B("foo\\bar")).to.equal("foo/bar"),(0,pt.expect)(B("foo\\bar/baz")).to.equal("foo/bar/baz")}),it("fixes escaped forward slashes",()=>{(0,pt.expect)(B("foo\\/bar")).to.equal("foo/bar")})}),describe("fixDriveLetterAndSlashes",()=>{it("works for c:/... cases",()=>{(0,pt.expect)(K("C:/path/stuff")).to.equal("c:\\path\\stuff"),(0,pt.expect)(K("c:/path\\stuff")).to.equal("c:\\path\\stuff"),(0,pt.expect)(K("C:\\path")).to.equal("c:\\path"),(0,pt.expect)(K("C:\\")).to.equal("c:\\")}),it("works for file:/// cases",()=>{(0,pt.expect)(K("file:///C:/path/stuff")).to.equal("file:///c:\\path\\stuff"),(0,pt.expect)(K("file:///c:/path\\stuff")).to.equal("file:///c:\\path\\stuff"),(0,pt.expect)(K("file:///C:\\path")).to.equal("file:///c:\\path"),(0,pt.expect)(K("file:///C:\\")).to.equal("file:///c:\\")}),it("does not impact posix cases",()=>{(0,pt.expect)(K("file:///a/b")).to.equal("file:///a/b"),(0,pt.expect)(K("/a/b")).to.equal("/a/b")})})})});var m_={};var jr,HC,zC=m(()=>{"use strict";jr=require("chai"),HC=w(require("path"));Er();ee();im();describe("SourceMapOverrides",()=>{describe("getComputedSourceRoot()",()=>{let i=(...s)=>fe(HC.resolve(...s)),e=i("/project/webroot/code/script.js"),t="http://localhost:8080/code/script.js",r=i("/project/src"),o=i("/project/webroot"),n={"/":o};it("handles file:/// sourceRoot",async()=>{(0,jr.expect)(await Ct("file:///"+r,e,n,vt,E.null)).to.equal(r)}),it("handles /src style sourceRoot",async()=>{(0,jr.expect)(await Ct("/src",e,n,vt,E.null)).to.equal(i("/project/webroot/src"))}),it("handles /src style without matching pathMapping",async()=>{(0,jr.expect)(await Ct("/foo/bar",e,{},vt,E.null)).to.equal("/foo/bar")}),it("handles c:/src style without matching pathMapping",async()=>{(0,jr.expect)(await Ct("c:\\foo\\bar",e,{},vt,E.null)).to.equal("c:\\foo\\bar")}),it("handles ../../src style sourceRoot",async()=>{(0,jr.expect)(await Ct("../../src",e,n,vt,E.null)).to.equal(r)}),it("handles src style sourceRoot",async()=>{(0,jr.expect)(await Ct("src",e,n,vt,E.null)).to.equal(i("/project/webroot/code/src"))}),it("handles runtime script not on disk",async()=>{(0,jr.expect)(await Ct("../src",t,n,vt,E.null)).to.equal(i("/project/webroot/src"))}),it("when no sourceRoot specified and runtime script is on disk, uses the runtime script dirname",async()=>{(0,jr.expect)(await Ct("",e,n,vt,E.null)).to.equal(i("/project/webroot/code"))}),it("when no sourceRoot specified and runtime script is not on disk, uses the runtime script dirname",async()=>{(0,jr.expect)(await Ct("",t,n,vt,E.null)).to.equal(i("/project/webroot/code"))}),it("no crash on debugadapter:// urls",async()=>{(0,jr.expect)(await Ct("","eval://123",n,vt,E.null)).to.equal(i(o))})})})});function T(i,e){Sp.mkdirSync(i,{recursive:!0});for(let t of Object.keys(e)){let r=e[t],o=mg.join(i,t),n;if(typeof r=="string")n=Buffer.from(r);else if(r instanceof Buffer)n=r;else if(r instanceof Array)n=Buffer.from(r.join($b.EOL));else{T(o,r);continue}Sp.mkdirSync(mg.dirname(o),{recursive:!0}),Sp.writeFileSync(o,n)}}var Sp,$b,mg,Ur=m(()=>{"use strict";Sp=w(require("fs")),$b=require("os"),mg=w(require("path"))});var g_={};var Jo,He,GC=m(()=>{"use strict";Jo=require("chai"),He=require("path");Ws();Er();ee();xh();N();Ur();rt();describe("ISourceMapRepository",()=>{[{name:"TurboSearchStrategy",create:()=>new Ai(E.null)}].forEach(i=>describe(i.name,()=>{let e;beforeEach(()=>{e=i.create(),T(h,{"a.js":"//# sourceMappingURL=a.js.map","a.js.map":"content1","c.js":"no.sourcemap.here",nested:{"d.js":"//# sourceMappingURL=d.js.map","d.js.map":"content2"},node_modules:{"e.js":"//# sourceMappingURL=e.js.map","e.js.map":"content3"},defaultSearchExcluded:{"f.js":"//# sourceMappingURL=f.js.map","f.js.map":"content3"}})});let t=(s,a)=>new Ht({rootPath:s,patterns:[`${a}/**/*.js`,"!**/node_modules/**"]}),r=async s=>(await e.streamChildrenWithSourcemaps({files:s,processMap:async c=>{let{cacheKey:l,...p}=c;return(0,Jo.expect)(l).to.be.within(Date.now()-6e4,Date.now()+1e3),p.compiledPath=K(p.compiledPath),p},onProcessedMap:c=>c})).values.sort((c,l)=>c.compiledPath.length-l.compiledPath.length),o=async s=>(await r(s)).map(c=>K(c.compiledPath)),n=s=>e.streamAllChildren(s,a=>a).then(a=>a.sort());it("no-ops for non-existent directories",async()=>{(0,Jo.expect)(await r(t("/home/benjamin/code/hobby/my-nixvim/config/dap/vscode-js-debug/src/test/common","does-not-exist"))).to.be.empty}),it("discovers source maps and applies negated globs",async()=>{(0,Jo.expect)(await r(t(ls,sg))).to.deep.equal([{compiledPath:fe((0,He.join)(h,"a.js")),sourceMapUrl:W((0,He.join)(h,"a.js.map"))},{compiledPath:fe((0,He.join)(h,"nested","d.js")),sourceMapUrl:W((0,He.join)(h,"nested","d.js.map"))},{compiledPath:fe((0,He.join)(h,"defaultSearchExcluded","f.js")),sourceMapUrl:W((0,He.join)(h,"defaultSearchExcluded","f.js.map"))}])}),it("applies second patterns (vscode#168635)",async()=>{T(h,{rootPath:{"d.js":"//# sourceMappingURL=d.js.map","d.js.map":"content2"},otherFolder:{"f.js":"//# sourceMappingURL=f.js.map","f.js.map":"content3"}}),(0,Jo.expect)(await o(new Ht({patterns:["rootPath/*.js","otherFolder/*.js"],rootPath:h}))).to.deep.equal([fe((0,He.join)(h,"rootPath","d.js")),fe((0,He.join)(h,"otherFolder","f.js"))])}),it("globs for a single file",async()=>{(0,Jo.expect)(await o(new Ht({patterns:["nested/d.js"],rootPath:h}))).to.deep.equal([fe((0,He.join)(h,"nested","d.js"))])}),it("applies negated globs outside rootPath (#1479)",async()=>{let s={"e.js":"//# sourceMappingURL=e.js.map","e.js.map":"content3"};T(h,{rootPath:{"d.js":"//# sourceMappingURL=d.js.map","d.js.map":"content2",node_modules:s},otherFolder:{"f.js":"//# sourceMappingURL=f.js.map","f.js.map":"content3",node_modules:s}}),(0,Jo.expect)(await o(new Ht({patterns:["**/*.js","../otherFolder/**/*.js","!**/node_modules/**"],rootPath:(0,He.join)(h,"rootPath")}))).to.deep.equal([fe((0,He.join)(h,"rootPath","d.js")),fe((0,He.join)(h,"otherFolder","f.js"))])}),it("streams all children",async()=>{(0,Jo.expect)(await n(t(ls,sg))).to.deep.equal([fe((0,He.join)(h,"a.js")),fe((0,He.join)(h,"c.js")),fe((0,He.join)(h,"defaultSearchExcluded","f.js")),fe((0,He.join)(h,"nested","d.js"))])}),it("greps inside node_modules explicitly",async()=>{(0,Jo.expect)(await r(t((0,He.join)(h,"node_modules"),"."))).to.deep.equal([{compiledPath:fe((0,He.join)(h,"node_modules","e.js")),sourceMapUrl:W((0,He.join)(h,"node_modules","e.js.map"))}])})}))})});var f_={};var Mc,JC=m(()=>{"use strict";Mc=require("chai");_e();describe("completion",()=>{let i=[["ar|",[{label:"arr",sortText:"~~arr",type:"variable",detail:"Array"}]],["ar|.length",[{label:"arr",sortText:"~~arr",type:"variable",detail:"Array"}]],["arr.|",[{label:"[index]",text:"[index]",type:"property",sortText:"~~[",length:1,selectionLength:5,selectionStart:1,start:3},{label:"length",detail:"3",sortText:"~~length",type:"property"},{label:"at",detail:"fn(?)",sortText:"~~~at",type:"method"}]],["arr.len|",[{label:"[index]",text:"[index]",type:"property",sortText:"~~[",length:1,selectionLength:5,selectionStart:1,start:3},{label:"length",detail:"3",sortText:"~~length",type:"property"}]],["arr[|",[]],["arr[0].|",[{label:"length",detail:"0",sortText:"~~length",type:"property"},{label:"anchor",detail:"fn(?)",sortText:"~~~anchor",type:"method"},{label:"at",detail:"fn(?)",sortText:"~~~at",type:"method"}]],["arr[2].|",[]],["obj.|",[{label:"bar",detail:"42",sortText:"~~bar",type:"property"},{label:"baz",detail:"fn()",sortText:"~~baz",type:"method"},{label:"foo",detail:"string",sortText:"~~foo",type:"property"}]],["ob|",[{label:"obj",sortText:"~~obj",type:"variable",detail:"Object"}]],["arr[myStr|",[{label:"myString",sortText:"~~myString",type:"variable",detail:"string"}]],["const replVar = 42; replV|",[{label:"replVar",sortText:"replVar",type:"variable"}]],["MyCoolCl|",[{label:"MyCoolClass",sortText:"~~MyCoolClass",type:"class",detail:"fn()"}]],["Strin|",[{label:"String",sortText:"~~String",type:"class",detail:"fn(?)"}]],["myNeatFun|",[{label:"myNeatFunction",sortText:"~~myNeatFunction",type:"function",detail:"fn()"}]],["new Array(42).|",[{label:"[index]",text:"[index]",type:"property",sortText:"~~[",length:1,selectionLength:5,selectionStart:1,start:13},{label:"length",detail:"42",sortText:"~~length",type:"property"},{label:"at",detail:"fn(?)",sortText:"~~~at",type:"method"}]],["poison.|",[{label:"bar",sortText:"~~bar",type:"property",detail:"true"},{label:"foo",sortText:"~~foo",type:"property"},{label:"constructor",sortText:"~~~constructor",type:"class",detail:"fn(?)"}]],["hasPrivate.|",[{label:"c",sortText:"~~c",type:"property",detail:"3"},{label:"_a",sortText:"~~{a",type:"property",detail:"1"},{label:"__b",sortText:"~~{{b",type:"property",detail:"2"}]],["complexProp.|",[{label:"complex prop",text:'["complex prop"]',start:11,length:1,type:"property",sortText:"~~complex prop",detail:"true"},{label:"constructor",sortText:"~~~constructor",type:"class",detail:"fn(?)"},{label:"hasOwnProperty",sortText:"~~~hasOwnProperty",type:"method",detail:"fn(?)"}]],["$returnV|",[]]];g("completion",async({r:e})=>{let t=await e.launchAndLoad(`
      <script>
        var arr = ['', {}, null];
        var obj = { foo: '', bar: 42, baz() {} };
        var myString = '';
        var MyCoolClass = class MyCoolClass {} // need to be hoisted manually
        function myNeatFunction() {}
        var hasPrivate = { _a: 1, __b: 2, c: 3 };
        var poison = { get foo() { throw new Error('oh no!') }, bar: true };
        var complexProp = { 'complex prop': true };
      </script>
    `);for(let[r,o]of i){let n=r.indexOf("|"),s=await t.dap.completions({text:r.slice(0,n)+r.slice(n+1),column:n+1});(0,Mc.expect)(s.targets.slice(0,3)).to.deep.equal(o,`bad result evaluating ${r}`)}}),g("completes in scope (vscode#153651)",async({r:e})=>{let t=await e.launch(`
      <script>
        function foo() {
          const helloWorld = '';
          debugger;
        }

        foo();
      </script>
    `),r=t.dap.once("stopped");t.load();let o=(await t.dap.stackTrace({threadId:(await r).threadId})).stackFrames[0],n=await t.dap.completions({text:"helloW",column:7,frameId:o.id});(0,Mc.expect)(n.targets).to.deep.equal([{label:"helloWorld",type:"property"}])}),g("$returnValue",async({r:e})=>{let t=async()=>(await r.dap.stackTrace({threadId:o})).stackFrames[0].id,r=await e.launchAndLoad(`
      <script>
        function foo() {
          debugger;
          return { a: { b: 2 }};
        }
      </script>
    `);r.dap.evaluate({expression:"foo() "});let{threadId:o}=await r.dap.once("stopped");await r.dap.next({threadId:o}),await r.dap.once("stopped");let n=await r.dap.completions({text:"$returnValu",column:11,frameId:await t()});(0,Mc.expect)(n.targets).to.not.containSubset([{sortText:"~$returnValue"}]),await r.dap.next({threadId:o}),await r.dap.once("stopped");let s=await t(),a=await r.dap.completions({text:"$returnValu",column:11,frameId:s});(0,Mc.expect)(a.targets).to.containSubset([{label:"$returnValue",type:"variable",sortText:"~$returnValue"}]);let c=await r.dap.completions({text:"$returnValue.",column:14,frameId:s});(0,Mc.expect)(c.targets).to.containSubset([{label:"a",sortText:"~~a",type:"property"}])})})});var Nc,qb=m(()=>{"use strict";Nc=class{constructor(){this.data=new Map}keys(){return[...this.data.keys()]}get(e,t){return this.data.has(e)?this.data.get(e):t}update(e,t){return this.data.set(e,t),Promise.resolve()}}});var h_={};var Bc,KC,QC,XC=m(()=>{"use strict";Bc=require("chai"),KC=require("path"),QC=w(require("vscode"));A();ao();M();hb();Ur();rt();qb();describe("ExtensionHostConfigurationProvider",()=>{let i,e=r=>({uri:QC.Uri.file((0,KC.join)(h,r)),name:"test-dir",index:0}),t={type:"pwa-extensionHost",name:"",request:"",args:["--extensionDevelopmentPath=${workspaceFolder}"]};beforeEach(()=>{i=new Gi(Xo({logPath:h,workspaceState:new Nc})),de.platform="linux"}),describe("web worker debugging",()=>{beforeEach(()=>T(h,{"withWeb/package.json":JSON.stringify({extensionKind:["web"]}),"withoutWeb/package.json":JSON.stringify({})})),it("does not enable if no args",async()=>{let r=await i.resolveDebugConfiguration(e("withWeb"),{...t,args:[]});(0,Bc.expect)(r?.debugWebWorkerHost).to.be.false}),it("does not enable if wrong type",async()=>{let r=await i.resolveDebugConfiguration(e("withoutWeb"),t);(0,Bc.expect)(r?.debugWebWorkerHost).to.be.false}),it("does not enable if enoent folder",async()=>{let r=await i.resolveDebugConfiguration(e("doesNotExist"),t);(0,Bc.expect)(r?.debugWebWorkerHost).to.be.false}),it("does not override existing option",async()=>{let r=await i.resolveDebugConfiguration(e("doesNotExist"),{...t,debugWebWorkerHost:!0});(0,Bc.expect)(r?.debugWebWorkerHost).to.be.true}),it("enables if all good",async()=>{let r=await i.resolveDebugConfiguration(e("withWeb"),t);(0,Bc.expect)(r?.debugWebWorkerHost).to.be.true})})})});var b_={};var z,YC,Wr,ZC,Wt,eT=m(()=>{"use strict";z=require("chai"),YC=require("fs"),Wr=require("path"),ZC=require("sinon"),Wt=w(require("vscode"));A();ao();ae();M();rc();Ur();rt();qb();describe("NodeDebugConfigurationProvider",()=>{let i,e,t={uri:Wt.Uri.file(h),name:"test-dir",index:0};beforeEach(()=>{e={resolveNvmVersionPath:(0,ZC.stub)()},i=new ho(Xo({logPath:h,workspaceState:new Nc}),e,new se(YC.promises)),de.platform="linux"}),afterEach(()=>{de.platform=process.platform}),describe("logging resolution",()=>{let r={type:"node",name:"",request:""};beforeEach(()=>{T(h,{"hello.js":"","package.json":JSON.stringify({main:"hello.js"})})}),it("does not log by default",async()=>{let o=await i.resolveDebugConfiguration(t,r);(0,z.expect)(o.trace).to.deep.equal({stdio:!1,logFile:null})}),it("applies defaults with trace=true",async()=>{let o=await i.resolveDebugConfiguration(t,{...r,trace:!0});(0,z.expect)(o.trace).to.containSubset({stdio:!0})})}),describe("launch config from context",()=>{let r={type:"",name:"",request:""};it("loads the program from a package.json main if available",async()=>{T(h,{"hello.js":"","package.json":JSON.stringify({main:"hello.js"})});let o=await i.resolveDebugConfiguration(t,r);o.cwd=o.cwd.toLowerCase(),(0,z.expect)(o).to.containSubset({type:"pwa-node",cwd:h.toLowerCase(),name:"Launch Program",program:(0,Wr.join)("${workspaceFolder}","hello.js"),request:"launch"})}),it("loads the program from a package.json start script if available",async()=>{T(h,{"hello.js":"","package.json":JSON.stringify({scripts:{start:"node hello.js"}})});let o=await i.resolveDebugConfiguration(t,r);o.cwd=o.cwd.toLowerCase(),(0,z.expect)(o).to.containSubset({type:"pwa-node",cwd:h.toLowerCase(),name:"Launch Program",program:(0,Wr.join)("${workspaceFolder}","hello.js"),request:"launch"})}),it("configures mern starters",async()=>{T(h,{"hello.js":"","package.json":JSON.stringify({name:"mern-starter"})});let o=await i.resolveDebugConfiguration(t,r);(0,z.expect)(o).to.containSubset({runtimeExecutable:"nodemon",program:"${workspaceFolder}/index.js",restart:!0,env:{BABEL_DISABLE_CACHE:"1",NODE_ENV:"development"}})}),it("loads a common entrypoint if available",async()=>{T(h,{"main.js":""});let o=await i.resolveDebugConfiguration(t,r);o.cwd=o.cwd.toLowerCase(),(0,z.expect)(o).to.containSubset({type:"pwa-node",cwd:h.toLowerCase(),name:"Launch Program",program:(0,Wr.join)("${workspaceFolder}","main.js"),request:"launch"})}),it("attempts to load the active text editor",async()=>{T(h,{"hello.js":""});let o=await Wt.workspace.openTextDocument((0,Wr.join)(h,"hello.js"));await Wt.window.showTextDocument(o);try{let n=await i.resolveDebugConfiguration(t,r);(0,z.expect)(n).to.containSubset({program:(0,Wr.join)("${workspaceFolder}","hello.js")})}finally{await Wt.commands.executeCommand("workbench.action.closeActiveEditor")}}),it("applies tsconfig settings automatically",async()=>{T(h,{out:{"hello.js":""},src:{"hello.ts":""},"package.json":JSON.stringify({main:"out/hello.js"}),"tsconfig.json":JSON.stringify({compilerOptions:{outDir:"out"}})});let o=await Wt.workspace.openTextDocument((0,Wr.join)(h,"src","hello.ts"));await Wt.window.showTextDocument(o);try{let n=await i.resolveDebugConfiguration(t,r);(0,z.expect)(n).to.containSubset({program:(0,Wr.join)("${workspaceFolder}","out","hello.js"),preLaunchTask:"tsc: build - tsconfig.json",outFiles:["${workspaceFolder}/out/**/*.js"]})}finally{await Wt.commands.executeCommand("workbench.action.closeActiveEditor")}})}),it("attempts to resolve nvm",async()=>{T(h,{"my.env":`A=bar
B="quoted"
"C"="more quoted"

D=overridden
`,"hello.js":""}),e.resolveNvmVersionPath.resolves({directory:"/my/node/location",binary:"node64"});let r=await i.resolveDebugConfiguration(t,{type:"pwa-node",name:"",request:"launch",program:"hello.js",runtimeVersion:"3.1.4",env:{hello:"world",PATH:"/usr/bin"}});(0,z.expect)(r).to.containSubset({runtimeExecutable:"node64",env:{hello:"world",PATH:"/my/node/location:/usr/bin"}})}),describe("inspect flags",()=>{it("demaps",async()=>{let r=await i.resolveDebugConfiguration(t,{type:"pwa-node",name:"",request:"launch",program:"hello.js",runtimeArgs:["-a","--inspect-brk","--b"]});(0,z.expect)(r.runtimeArgs).to.deep.equal(["-a","--b"]),(0,z.expect)(r.stopOnEntry).to.be.true}),it("does not overwrite existing stop on entry",async()=>{let r=await i.resolveDebugConfiguration(t,{type:"pwa-node",name:"",request:"launch",program:"hello.js",stopOnEntry:"hello.js",runtimeArgs:["-a","--inspect-brk","--b"]});(0,z.expect)(r.runtimeArgs).to.deep.equal(["-a","--b"]),(0,z.expect)(r.stopOnEntry).to.equal("hello.js")}),it("assigns a random simple attach port",async()=>{let r=await i.resolveDebugConfiguration(t,{type:"pwa-node",name:"",request:"launch",program:"hello.js",attachSimplePort:0});(0,z.expect)(r.continueOnAttach).to.be.true,(0,z.expect)(r.attachSimplePort).to.be.greaterThan(0),(0,z.expect)(r.runtimeArgs).to.deep.equal([`--inspect-brk=${r.attachSimplePort}`]),(0,z.expect)(r.continueOnAttach).to.equal(!0)}),it("merged picked port with existing runtime args",async()=>{let r=await i.resolveDebugConfiguration(t,{type:"pwa-node",name:"",request:"launch",program:"hello.js",attachSimplePort:0,runtimeArgs:["--nolazy"]});(0,z.expect)(r.runtimeArgs).to.deep.equal(["--nolazy",`--inspect-brk=${r.attachSimplePort}`])}),it("keeps a static attach port",async()=>{let r=await i.resolveDebugConfiguration(t,{type:"pwa-node",name:"",request:"launch",program:"hello.js",attachSimplePort:9229,runtimeArgs:["--inspect-brk"]});(0,z.expect)(r.continueOnAttach).to.be.true,(0,z.expect)(r.attachSimplePort).to.be.greaterThan(0),(0,z.expect)(r.runtimeArgs).to.deep.equal(["--inspect-brk"]),(0,z.expect)(r.continueOnAttach).to.equal(!0)}),it("adjusts stopOnEntry to continueOnArray",async()=>{let r=await i.resolveDebugConfiguration(t,{type:"pwa-node",name:"",request:"launch",program:"hello.js",attachSimplePort:0,stopOnEntry:!0});(0,z.expect)(r.continueOnAttach).to.be.false,(0,z.expect)(r.stopOnEntry).to.be.false})}),describe("outFiles",()=>{it("does not modify outfiles with no package.json",async()=>{T(h,{"hello.js":""});let r=await i.resolveDebugConfiguration(t,{type:"pwa-node",name:"",request:"launch",program:"hello.js"});(0,z.expect)(r?.outFiles).to.deep.equal(["${workspaceFolder}/**/*.(m|c|)js","!**/node_modules/**"])}),it("preserves outFiles if package.json is in the same folder",async()=>{T(h,{"hello.js":"","package.json":"{}"});let r=await i.resolveDebugConfiguration(t,{type:"pwa-node",name:"",request:"launch",program:"hello.js"});(0,z.expect)(r?.outFiles).to.deep.equal(["${workspaceFolder}/**/*.(m|c|)js","!**/node_modules/**"])}),it("gets the nearest nested package.json",async()=>{T(h,{"a/b/c/hello.js":"","a/b/package.json":"{}","a/package.json":"{}"});let r=await i.resolveDebugConfiguration({uri:Wt.Uri.file((0,Wr.join)(h,"b")),name:"test-dir",index:0},{type:"pwa-node",name:"",request:"launch",program:"../a/b/c/hello.js"});(0,z.expect)(r?.outFiles).to.deep.equal(["${workspaceFolder}/**/*.(m|c|)js","!**/node_modules/**","${workspaceFolder}/../a/b/**/*.js","!${workspaceFolder}/../a/b/**/node_modules/**"])}),it("does not resolve in node_modules",async()=>{T(h,{"a/node_modules/c/hello.js":"","a/node_modules/c/package.json":"{}","a/package.json":"{}"});let r=await i.resolveDebugConfiguration({uri:Wt.Uri.file((0,Wr.join)(h,"b")),name:"test-dir",index:0},{type:"pwa-node",name:"",request:"launch",program:"../a/node_modules/c/hello.js"});(0,z.expect)(r?.outFiles).to.deep.equal(["${workspaceFolder}/**/*.(m|c|)js","!**/node_modules/**","${workspaceFolder}/../a/**/*.js","!${workspaceFolder}/../a/**/node_modules/**"])}),it("does not resolve outside the workspace folder",async()=>{T(h,{"a/b/c/hello.js":"","package.json":"{}"});let r=await i.resolveDebugConfiguration({uri:Wt.Uri.file((0,Wr.join)(h,"a")),name:"test-dir",index:0},{type:"pwa-node",name:"",request:"launch",program:"b/c/hello.js"});(0,z.expect)(r?.outFiles).to.deep.equal(["${workspaceFolder}/**/*.(m|c|)js","!**/node_modules/**"])})}),describe("deno",()=>{it("fills in default deno options",async()=>{let r=await i.resolveDebugConfiguration(t,{type:"pwa-node",name:"",request:"launch",program:"hello.js",runtimeExecutable:"deno"}),o=r.attachSimplePort;(0,z.expect)(o).to.be.a("number"),(0,z.expect)(r.runtimeArgs).to.deep.equal(["run",`--inspect-brk=127.0.0.1:${o}`,"--allow-all"]),(0,z.expect)(r.continueOnAttach).to.be.true}),it("allows manual application",async()=>{let r=await i.resolveDebugConfiguration(t,{type:"pwa-node",name:"",request:"launch",program:"hello.js",runtimeExecutable:"deno",runtimeArgs:["run","--inspect-brk=9229"],attachSimplePort:9229});(0,z.expect)(r.attachSimplePort).to.equal(9229),(0,z.expect)(r.runtimeArgs).to.deep.equal(["run","--inspect-brk=9229"])}),it("allows partial run args",async()=>{let r=await i.resolveDebugConfiguration(t,{type:"pwa-node",name:"",request:"launch",program:"hello.js",runtimeExecutable:"deno",runtimeArgs:["--some-arg"]}),o=r.attachSimplePort;(0,z.expect)(o).to.be.a("number"),(0,z.expect)(r.runtimeArgs).to.deep.equal(["run",`--inspect-brk=127.0.0.1:${o}`,"--allow-all","--some-arg"])})})})});var w_={};var ps,Ip,tT,gg,rT,Oc,oT,iT,Vr,nT=m(()=>{"use strict";ps=require("chai"),Ip=require("child_process"),tT=w(require("del")),gg=require("fs"),rT=require("os"),Oc=w(require("path")),oT=require("sinon"),iT=w(require("split2")),Vr=w(require("vscode"));A();yi();ae();ee();U();$();lb();Ur();rt();_e();describe("pick and attach",()=>{let i=Oc.join((0,rT.tmpdir)(),"js-debug-pick-and-attach"),e,t,r,o=!1;beforeEach(()=>t=(0,oT.createSandbox)()),afterEach(async()=>{t?.restore(),e?.kill(),await(0,tT.default)([`${B(i)}/**`],{force:!0})}),process.platform!=="win32"&&(it("infers the working directory",async()=>{T(i,{"foo.js":"setInterval(() => {}, 1000)"}),e=(0,Ip.spawn)("node",["foo.js"],{cwd:i});let n={...ui,processId:`${e.pid}:1234`};await Za(new se(gg.promises),n,!0),(0,ps.expect)(ag(n.cwd)).to.equal(i)}),it("adjusts to the package root",async()=>{T(i,{"package.json":"{}","nested/foo.js":"setInterval(() => {}, 1000)"}),e=(0,Ip.spawn)("node",["foo.js"],{cwd:Oc.join(i,"nested")});let n={...ui,processId:`${e.pid}:1234`};await Za(new se(gg.promises),n,!0),(0,ps.expect)(ag(n.cwd)).to.equal(i)}),it("limits inference to workspace root",async()=>{T(i,{"package.json":"{}","nested/foo.js":"setInterval(() => {}, 1000)"}),t.stub(Vr.workspace,"getWorkspaceFolder").returns({name:"nested",index:1,uri:Vr.Uri.file(Oc.join(i,"nested"))}),e=(0,Ip.spawn)("node",["foo.js"],{cwd:Oc.join(i,"nested")});let s={...ui,processId:`${e.pid}:1234`};await Za(new se(gg.promises),s,!0),(0,ps.expect)(ag(s.cwd)).to.equal(Oc.join(i,"nested"))})),describe("",()=>{beforeEach(async()=>{r=await Be(),e=(0,Ip.spawn)("node",["--inspect-brk",`--inspect-port=${r}`],{stdio:"pipe"}),e.on("error",console.error),e.stderr.pipe((0,iT.default)()).on("data",n=>o=o||n.includes("Debugger attached"))}),it("end to end",async function(){this.timeout(30*1e3);let n=t.spy(Vr.window,"createQuickPick");Vr.commands.executeCommand("extension.pwa-node-debug.attachNodeProcess"),await x(2e3);let s=await J(()=>((0,ps.expect)(n.called).to.be.true,n.getCall(0).returnValue),10*1e3);await x(2e3);let a=await J(()=>{let c=s.items.find(l=>l.pidAndPort===`${e.pid}:${r}`);if(!c)throw new Error("expected quickpick to have item");return c},10*1e3);s.selectedItems=[a],await x(2e3),await Vr.commands.executeCommand("workbench.action.acceptSelectedQuickOpenItem"),await x(2e3),await J(()=>(0,ps.expect)(o).to.equal(!0,"expected to have attached"),10*1e3)}),it("works without a defined workspace",async()=>{Vr.debug.startDebugging(void 0,{type:"pwa-node",request:"attach",name:"attach",processId:`${e.pid}:${r}`}),await J(()=>(0,ps.expect)(o).to.equal(!0,"expected to have attached"),10*1e3)})})})});var y_={};var q,sT,fg,Ko,k,aT=m(()=>{"use strict";q=require("chai"),sT=require("fs"),fg=require("path"),Ko=require("sinon"),k=w(require("vscode"));A();ze();O();U();Ur();rt();_e();describe("profiling",()=>{let i=(0,fg.join)(L,"simpleNode"),e=(0,fg.join)(i,"profilePlayground.js"),t,r,o=async s=>{let a=await sT.promises.readFile(s,"utf-8");(0,q.expect)(()=>JSON.parse(a)).to.not.throw(void 0,"expected to be valid JSON: "+a)},n=async(s,a)=>(await a.dap.stackTrace({threadId:s})).stackFrames[0].id;beforeEach(()=>{let s=k.window.createQuickPick;t=(0,Ko.stub)(k.window,"createQuickPick").callsFake(()=>{let a=s();return r=new S,(0,Ko.stub)(a,"onDidAccept").callsFake(r.event),a})}),afterEach(()=>{t.restore()}),describe("console",()=>{g("works",async({r:s})=>{T(h,{"test.js":['console.profile("some-profile");','console.profileEnd("some-profile");']});let a=await s.runScript("test.js",{__workspaceFolder:h});a.load(),await a.dap.once("terminated"),await J(()=>o((0,fg.join)(h,"some-profile.cpuprofile")))})}),describe("cpu-profiling",()=>{g("cpu sanity test",async({r:s})=>{await s.initialize;let a=await s.runScript(e);a.load();let c=a.dap.once("profileStarted");await a.dap.startProfile({type:"cpu"}),await x(300),await a.dap.stopProfile({}),await o((await c).file)}),describe("breakpoints",()=>{g("continues if was paused on start",async({r:s})=>{await s.initialize;let a=await s.runScript(e);await a.load(),a.log(await a.dap.setBreakpoints({source:{path:e},breakpoints:[{line:21,column:1}]})),a.log(await a.dap.once("stopped"));let c=a.dap.once("continued"),l=a.dap.once("output");await a.dap.startProfile({type:"cpu"}),a.log(await c),a.log(await l),a.assertLog()}),g("continues if was paused on start with debugger domain",async({r:s})=>{await s.initialize;let a=await s.runScript(e);await a.load(),a.log(await a.dap.setBreakpoints({source:{path:e},breakpoints:[{line:21,column:1}]})),a.log(await a.dap.once("stopped"));let c=a.dap.once("continued"),l=a.dap.once("output");await a.dap.startProfile({type:"cpu",stopAtBreakpoint:[-1]}),a.log(await c),a.log(await l),a.assertLog()}),g("unverifies and reverifies",async({r:s})=>{await s.initialize;let a=await s.runScript(e);await a.load(),a.log(await a.dap.setBreakpoints({source:{path:e},breakpoints:[{line:6,column:1}]}),void 0,[]),await x(0);let c=(0,Ko.stub)().callsFake(l=>a.log(l,void 0,[]));a.dap.on("breakpoint",c),await a.dap.startProfile({type:"cpu"}),await J(()=>(0,q.expect)(c.callCount).to.gte(1),2e3),await a.dap.stopProfile({}),await J(()=>(0,q.expect)(c.callCount).to.gte(2),2e3),a.assertLog()}),g("does not unverify target breakpoint",async({r:s})=>{await s.initialize;let a=await s.runScript(e);await a.load();let{breakpoints:c}=a.log(await a.dap.setBreakpoints({source:{path:e},breakpoints:[{line:6,column:1},{line:17,column:1}]}),void 0,[]);await x(0);let l=(0,Ko.stub)().callsFake(p=>a.log(p,void 0,[]));a.dap.on("breakpoint",l),await a.dap.startProfile({type:"cpu",stopAtBreakpoint:[c[1].id]}),await J(()=>(0,q.expect)(l.callCount).to.gte(1)),await a.dap.stopProfile({}),await J(()=>(0,q.expect)(l.callCount).to.gte(2)),a.assertLog()}),g("runs until a breakpoint is hit",async({r:s})=>{await s.initialize;let a=await s.runScript(e),{breakpoints:c}=await a.dap.setBreakpoints({source:{path:e},breakpoints:[{line:20,column:1},{line:17,column:1}]});await a.load();let l=a.dap.once("profileStarted"),p=await a.dap.once("stopped");await a.dap.evaluate({expression:"setTimeout(noop, 1000)",context:"repl",frameId:await n(p.threadId,a)}),await a.dap.startProfile({type:"cpu",stopAtBreakpoint:[c[1].id]});let d=a.dap.once("stopped"),b=a.dap.once("profilerStateUpdate"),y=a.dap.once("breakpoint",v=>v.breakpoint.id===c[0].id&&v.breakpoint.verified);a.log(await d,"paused event"),a.log(await b,"finished profile"),a.log(await y,"reenabled breakpoint",[]),await o((await l).file),a.assertLog()})}),describe("ui",()=>{afterEach(async()=>{await k.debug.stopDebugging()});let s=async(a,c)=>{k.commands.executeCommand("extension.js-debug.startProfile",a.id);let l=await J(()=>{(0,q.expect)(t.callCount).to.equal(1);let d=t.getCall(0).returnValue;return(0,q.expect)(d.items).to.not.be.empty,d},2e3);l.selectedItems=l.items.filter(d=>/CPU/i.test(d.label)),r.fire();let p=await J(()=>{(0,q.expect)(t.callCount).to.equal(2);let d=t.getCall(0).returnValue;return(0,q.expect)(d.items).to.not.be.empty,d},2e3);p.selectedItems=p.items.filter(d=>c.test(d.label)),r.fire()};it.skip("allows picking breakpoints",async()=>{k.debug.addBreakpoints([new k.SourceBreakpoint(new k.Location(k.Uri.file(e),new k.Position(19,0))),new k.SourceBreakpoint(new k.Location(k.Uri.file(e),new k.Position(5,0))),new k.SourceBreakpoint(new k.Location(k.Uri.file(e+".foo"),new k.Position(0,0)))]),after(()=>{k.debug.removeBreakpoints(k.debug.breakpoints)}),k.debug.startDebugging(void 0,{type:"pwa-node",request:"launch",name:"test",program:e});let a=await new Promise(l=>k.debug.onDidStartDebugSession(p=>"__pendingTargetId"in p.configuration?l(p):void 0));await s(a,/breakpoint/i);let c=await J(()=>{(0,q.expect)(t.callCount).to.equal(2);let l=t.getCall(1).returnValue;return(0,q.expect)(l.items.length).to.be.greaterThan(0,"expected to have picker items"),l},5e3);(0,q.expect)(c.items).to.containSubset([{description:"for (let i = 0; i < 10; i++) {",label:"testWorkspace/simpleNode/profilePlayground.js:6:16"},{description:"setInterval(() => {",label:"testWorkspace/simpleNode/profilePlayground.js:20:1"}]),c.dispose()}),it("sets substate correctly",async()=>{let a=new j;a.push(k.commands.registerCommand("js-debug.test.callback",()=>{})),k.debug.startDebugging(void 0,{type:"pwa-node",request:"launch",name:"test",program:e});let c=await new Promise(l=>k.debug.onDidStartDebugSession(p=>"__pendingTargetId"in p.configuration?l(p):void 0));await Et(k.commands,"extension.js-debug.startProfile",{sessionId:c.id,type:"cpu",termination:{type:"manual"}}),await J(()=>(0,q.expect)(c.name).to.contain("Profiling"),2e3),await Et(k.commands,"extension.js-debug.stopProfile",c.id),await J(()=>(0,q.expect)(c.name).to.not.contain("Profiling"),2e3),a.dispose()}),it("works with pure command API",async()=>{let a=(0,Ko.stub)(),c=new j;c.push(k.commands.registerCommand("js-debug.test.callback",a)),k.debug.startDebugging(void 0,{type:"pwa-node",request:"launch",name:"test",program:e});let l=await new Promise(d=>k.debug.onDidStartDebugSession(b=>"__pendingTargetId"in b.configuration?d(b):void 0));await Et(k.commands,"extension.js-debug.startProfile",{sessionId:l.id,type:"cpu",termination:{type:"manual"},onCompleteCommand:"js-debug.test.callback"}),await x(1e3),await Et(k.commands,"extension.js-debug.stopProfile",l.id);let p=await J(()=>((0,q.expect)(a.called).to.be.true,a.getCall(0).args[0]),2e3);(0,q.expect)(()=>JSON.parse(p.contents)).to.not.throw,(0,q.expect)(p.basename).to.match(/\.cpuprofile$/),c.dispose()}),it("profiles from launch",async function(){this.timeout(20*1e3),k.debug.startDebugging(void 0,{type:"pwa-node",request:"launch",name:"test",program:e,profileStartup:!0});let a=await new Promise(c=>k.debug.onDidStartDebugSession(l=>"__pendingTargetId"in l.configuration?c(l):void 0));await J(()=>(0,q.expect)(a.name).to.contain("Profiling"),2e3),await Et(k.commands,"extension.js-debug.stopProfile",a.id),await J(()=>(0,q.expect)(a.name).to.not.contain("Profiling"),2e3)})})}),describe("heap-profiling",()=>{g("heap sanity test",async({r:s})=>{await s.initialize;let a=await s.runScript(e);a.load();let c=a.dap.once("profileStarted");await a.dap.startProfile({type:"heap"}),await x(300),await a.dap.stopProfile({}),await o((await c).file)}),describe("breakpoints",()=>{g("continues if was paused on start",async({r:s})=>{await s.initialize;let a=await s.runScript(e);await a.load(),a.log(await a.dap.setBreakpoints({source:{path:e},breakpoints:[{line:21,column:1}]})),a.log(await a.dap.once("stopped"));let c=a.dap.once("continued"),l=a.dap.once("output");await a.dap.startProfile({type:"heap"}),a.log(await c),a.log(await l),a.assertLog()}),g("continues if was paused on start with debugger domain",async({r:s})=>{await s.initialize;let a=await s.runScript(e);await a.load(),a.log(await a.dap.setBreakpoints({source:{path:e},breakpoints:[{line:21,column:1}]})),a.log(await a.dap.once("stopped"));let c=a.dap.once("continued"),l=a.dap.once("output");await a.dap.startProfile({type:"heap",stopAtBreakpoint:[-1]}),a.log(await c),a.log(await l),a.assertLog()}),g("unverifies and reverifies",async({r:s})=>{await s.initialize;let a=await s.runScript(e);await a.load(),a.log(await a.dap.setBreakpoints({source:{path:e},breakpoints:[{line:6,column:1}]}),void 0,[]),await x(0);let c=(0,Ko.stub)().callsFake(l=>a.log(l,void 0,[]));a.dap.on("breakpoint",c),await a.dap.startProfile({type:"heap"}),await J(()=>(0,q.expect)(c.callCount).to.gte(1),2e3),await a.dap.stopProfile({}),await J(()=>(0,q.expect)(c.callCount).to.gte(2),2e3),a.assertLog()}),g("does not unverify target breakpoint",async({r:s})=>{await s.initialize;let a=await s.runScript(e);await a.load();let{breakpoints:c}=a.log(await a.dap.setBreakpoints({source:{path:e},breakpoints:[{line:6,column:1},{line:17,column:1}]}),void 0,[]);await x(0);let l=(0,Ko.stub)().callsFake(p=>a.log(p,void 0,[]));a.dap.on("breakpoint",l),await a.dap.startProfile({type:"heap",stopAtBreakpoint:[c[1].id]}),await J(()=>(0,q.expect)(l.callCount).to.gte(1)),await a.dap.stopProfile({}),await J(()=>(0,q.expect)(l.callCount).to.gte(2)),a.assertLog()}),g("runs until a breakpoint is hit",async({r:s})=>{await s.initialize;let a=await s.runScript(e),{breakpoints:c}=await a.dap.setBreakpoints({source:{path:e},breakpoints:[{line:20,column:1},{line:17,column:1}]});await a.load();let l=a.dap.once("profileStarted"),p=await a.dap.once("stopped");await a.dap.evaluate({expression:"setTimeout(noop, 1000)",context:"repl",frameId:await n(p.threadId,a)}),await a.dap.startProfile({type:"heap",stopAtBreakpoint:[c[1].id]});let d=a.dap.once("stopped"),b=a.dap.once("profilerStateUpdate"),y=a.dap.once("breakpoint",v=>v.breakpoint.id===c[0].id&&v.breakpoint.verified);a.log(await d,"paused event"),a.log(await b,"finished profile"),a.log(await y,"reenabled breakpoint",[]),await o((await l).file),a.assertLog()})}),describe("ui",()=>{afterEach(async()=>{await k.debug.stopDebugging()});let s=async(a,c)=>{k.commands.executeCommand("extension.js-debug.startProfile",a.id);let l=await J(()=>{(0,q.expect)(t.callCount).to.equal(1);let d=t.getCall(0).returnValue;return(0,q.expect)(d.items).to.not.be.empty,d},2e3);l.selectedItems=l.items.filter(d=>/heap/i.test(d.label)),r.fire();let p=await J(()=>{(0,q.expect)(t.callCount).to.equal(2);let d=t.getCall(0).returnValue;return(0,q.expect)(d.items).to.not.be.empty,d},2e3);p.selectedItems=p.items.filter(d=>c.test(d.label)),r.fire()};it.skip("allows picking breakpoints",async()=>{k.debug.addBreakpoints([new k.SourceBreakpoint(new k.Location(k.Uri.file(e),new k.Position(19,0))),new k.SourceBreakpoint(new k.Location(k.Uri.file(e),new k.Position(5,0))),new k.SourceBreakpoint(new k.Location(k.Uri.file(e+".foo"),new k.Position(0,0)))]),after(()=>{k.debug.removeBreakpoints(k.debug.breakpoints)}),k.debug.startDebugging(void 0,{type:"pwa-node",request:"launch",name:"test",program:e});let a=await new Promise(l=>k.debug.onDidStartDebugSession(p=>"__pendingTargetId"in p.configuration?l(p):void 0));await s(a,/breakpoint/i);let c=await J(()=>{(0,q.expect)(t.callCount).to.equal(2);let l=t.getCall(1).returnValue;return(0,q.expect)(l.items.length).to.be.greaterThan(0,"expected to have picker items"),l},5e3);(0,q.expect)(c.items).to.containSubset([{description:"for (let i = 0; i < 10; i++) {",label:"testWorkspace/simpleNode/profilePlayground.js:6:16"},{description:"setInterval(() => {",label:"testWorkspace/simpleNode/profilePlayground.js:20:1"}]),c.dispose()}),it("sets substate correctly",async()=>{let a=new j;a.push(k.commands.registerCommand("js-debug.test.callback",()=>{})),k.debug.startDebugging(void 0,{type:"pwa-node",request:"launch",name:"test",program:e});let c=await new Promise(l=>k.debug.onDidStartDebugSession(p=>"__pendingTargetId"in p.configuration?l(p):void 0));await Et(k.commands,"extension.js-debug.startProfile",{sessionId:c.id,type:"cpu",termination:{type:"manual"}}),await J(()=>(0,q.expect)(c.name).to.contain("Profiling"),2e3),await Et(k.commands,"extension.js-debug.stopProfile",c.id),await J(()=>(0,q.expect)(c.name).to.not.contain("Profiling"),2e3),a.dispose()}),it("works with pure command API",async()=>{let a=(0,Ko.stub)(),c=new j;c.push(k.commands.registerCommand("js-debug.test.callback",a)),k.debug.startDebugging(void 0,{type:"pwa-node",request:"launch",name:"test",program:e});let l=await new Promise(d=>k.debug.onDidStartDebugSession(b=>"__pendingTargetId"in b.configuration?d(b):void 0));await Et(k.commands,"extension.js-debug.startProfile",{sessionId:l.id,type:"heap",termination:{type:"manual"},onCompleteCommand:"js-debug.test.callback"}),await x(1e3),await Et(k.commands,"extension.js-debug.stopProfile",l.id);let p=await J(()=>((0,q.expect)(a.called).to.be.true,a.getCall(0).args[0]),2e3);(0,q.expect)(()=>JSON.parse(p.contents)).to.not.throw,(0,q.expect)(p.basename).to.match(/\.heapprofile$/),c.dispose()}),it("profiles from launch",async function(){this.timeout(20*1e3),k.debug.startDebugging(void 0,{type:"pwa-node",request:"launch",name:"test",program:e,profileStartup:!0});let a=await new Promise(c=>k.debug.onDidStartDebugSession(l=>"__pendingTargetId"in l.configuration?c(l):void 0));await J(()=>(0,q.expect)(a.name).to.contain("Profiling"),2e3),await Et(k.commands,"extension.js-debug.stopProfile",a.id),await J(()=>(0,q.expect)(a.name).to.not.contain("Profiling"),2e3)})})})})});var v_={};var us,cT=m(()=>{"use strict";us=require("chai");U();Jh();describe("node lease file",()=>{let i;beforeEach(()=>i=new Ir),afterEach(()=>i.dispose()),it("says the lease is not valid for missing files",async()=>{(0,us.expect)(Ir.isValid("does-not-exist.txt")).to.be.false}),it("says the lease is not valid if too far in the past",async()=>{await i.touch(()=>Date.now()-5e3),(0,us.expect)(Ir.isValid(i.path)).to.be.false}),it("says the lease is valid if recent",async()=>{await i.touch(()=>Date.now()),(0,us.expect)(Ir.isValid(i.path)).to.be.true}),it("truncates and updates on touches",async()=>{await i.touch(()=>Date.now()-5e3),await i.touch(()=>Date.now()),(0,us.expect)(Ir.isValid(i.path)).to.be.true}),it("disposes the file",async()=>{await i.touch(()=>Date.now()),await i.dispose(),(0,us.expect)(Ir.isValid(i.path)).to.be.false}),it("disposes the touch loop",async()=>{await i.startTouchLoop(),await i.dispose(),await x(1200),(0,us.expect)(Ir.isValid(i.path)).to.be.false})})});var S_={};var $r,yo,lT,Q,pT,uT,dT=m(()=>{"use strict";$r=require("chai"),yo=require("child_process"),lT=require("fs"),Q=require("path"),pT=require("sinon"),uT=w(require("split2"));ao();yi();M();ee();U();$();tb();Ur();rt();_e();describe("node runtime",()=>{async function i(r){let{threadId:o}=r.log(await r.dap.once("stopped"));return await r.logger.logStackTrace(o),r.dap.continue({threadId:o})}async function e(r,o){r.load();let{threadId:n}=r.log(await r.dap.once("stopped")),s=await r.dap.stackTrace({threadId:n});await r.logger.evaluateAndLog(o,{params:{frameId:s.stackFrames[0].id}}),r.assertLog()}function t(r){let o=r.trim().split(`
`);(0,$r.expect)(o.length).to.be.greaterThan(0),(0,$r.expect)(o[0]).to.not.contain("<hidden: Skipped by skipFiles>");for(let n=1;n<o.length;n++)(0,$r.expect)(o[n]).to.contain("<hidden: Skipped by skipFiles>")}describe("skipFiles",()=>{console.log("described skipFiles"),g("skipFiles skip node internals",async({r})=>{await r.initialize;let o=(0,Q.join)(L,"simpleNode"),n=await r.runScript((0,Q.join)(o,"index.js"),{skipFiles:["<node_internals>/**"]});await n.dap.setBreakpoints({source:{path:(0,Q.join)(o,"index.js")},breakpoints:[{line:1,column:1}]}),n.load();let s=await n.dap.once("stopped");await x(200),await n.logger.logStackTrace(s.threadId),n.assertLog({customAssert:t})});for(let[r,o]of[["with delay",!0],["without delay",!1]])describe(r,()=>{for(let n of["caughtInUserCode","uncaught","caught","rethrown"])g(n,async({r:s})=>{await s.initialize;let a=(0,Q.join)(L,"simpleNode"),c=await s.runScript((0,Q.join)(a,"skipFiles.js"),{args:[o?"1000":"0",n],skipFiles:["**/skippedScript.js"]});await c.dap.setExceptionBreakpoints({filters:["all","uncaught"]}),c.dap.on("output",l=>c.logger.logOutput(l)),c.dap.on("stopped",async l=>{await c.logger.logStackTrace(l.threadId),await c.dap.continue({threadId:l.threadId})}),c.load(),await c.dap.once("terminated"),c.assertLog({substring:!0})})})}),g("simple script",async({r})=>{T(h,{"test.js":['console.log("hello world");',"debugger;"]});let o=await r.runScript("test.js");o.load(),await i(o),o.assertLog({substring:!0})}),g("chakracore string value",async({r})=>{if(process.platform!=="win32")return;T(h,{"test.js":['const message = "hello world!";',"console.log(message);","debugger;"]});let o=(0,Q.join)(L,"chakracore","ChakraCore.Debugger.Sample.exe"),n=await Be(),s=await r.runScript("test.js",{runtimeExecutable:o,runtimeArgs:["--inspect-brk","--port",`${n}`],attachSimplePort:n,continueOnAttach:!0});s.load();let{threadId:a}=s.log(await s.dap.once("stopped"));s.dap.continue({threadId:a}),await s.dap.once("stopped");let c=await s.dap.stackTrace({threadId:a});await s.logger.evaluateAndLog("message",{params:{frameId:c.stackFrames[0].id}}),s.assertLog({substring:!0})}),g("exits with child process launcher",async({r})=>{T(h,{"test.js":""});let o=await r.runScript("test.js",{console:"internalConsole"});o.load(),await o.dap.once("terminated")}),process.env.ONLY_MINSPEC!=="true"&&g("debugs worker threads",async({r})=>{T(h,{"test.js":['const { Worker, isMainThread, workerData } = require("worker_threads");',"if (isMainThread) {",'  new Worker(__filename, { workerData: { greet: "world" } });',"} else {","  setInterval(() => {",'    console.log("hello " + workerData.greet);',"   }, 100);","}"]});let o=await r.runScript("test.js");o.load();let n=await r.worker();await n.dap.setBreakpoints({source:{path:(0,Q.join)(h,"test.js")},breakpoints:[{line:6,column:1}]}),n.load(),await i(n),o.assertLog({substring:!0})}),g("exits with integrated terminal launcher",async({r})=>{let o=(0,pT.stub)(Vi.prototype,"sendLaunchRequest");after(()=>o.restore());let n;o.callsFake(a=>(n=a,(0,yo.spawn)(a.args[0],a.args.slice(1),{cwd:a.cwd,env:{...process.env,...a.env}}),Promise.resolve({}))),T(h,{"test.js":""});let s=await r.runScript("test.js",{console:"integratedTerminal",cwd:h,env:{myEnv:"foo"}});s.load(),await s.dap.once("terminated"),(0,$r.expect)(n).to.containSubset({title:"Test Case",kind:"integrated",cwd:h,env:{myEnv:"foo"}})}),g("adjusts to compiles file if it exists",async({r})=>{await r.initialize;let o=await r.runScript((0,Q.join)(L,"web/basic.ts"));await o.dap.setBreakpoints({source:{path:o.workspacePath("web/basic.ts")},breakpoints:[{line:21,column:0}]}),o.load(),await i(o),o.assertLog({substring:!0})}),describe("inspect flag handling",()=>{g("does not break with inspect flag",async({r})=>{T(h,{"test.js":['console.log("hello world");',"debugger;"]});let o=await r.runScript("test.js",{runtimeArgs:["--inspect"]});o.load(),await i(o),o.assertLog({substring:!0})}),g("treats inspect-brk as stopOnEntry",async({r})=>{T(h,{"test.js":['console.log("hello world");']});let o=await r.runScript("test.js",{cwd:h,runtimeArgs:["--inspect-brk"]});o.load(),await i(o),o.assertLog({substring:!0})})}),describe("stopOnEntry",()=>{beforeEach(()=>T(h,{"test.js":["let i = 0;","i++;","i++;"],"bar.js":'require("./test")'})),g("stops with a breakpoint elsewhere (#515)",async({r})=>{let o=await r.runScript("test.js",{cwd:h,stopOnEntry:!0});await o.dap.setBreakpoints({source:{path:(0,Q.join)(h,"test.js")},breakpoints:[{line:3,column:1}]}),o.load(),await i(o),r.assertLog({substring:!0})}),g("stops with a program provided",async({r})=>{let o=await r.runScript("test.js",{cwd:h,stopOnEntry:!0});o.load(),await i(o),r.assertLog({substring:!0})}),g("launches and infers entry from args",async({r})=>{let o=await r.runScript("test.js",{cwd:h,args:["--max-old-space-size=1024","test.js","--not-a-file"],program:void 0,stopOnEntry:!0});o.load(),await i(o),r.assertLog({substring:!0})}),g("sets an explicit stop on entry point",async({r})=>{let o=await r.runScript("bar.js",{cwd:h,stopOnEntry:(0,Q.join)(h,"test.js")});o.load(),await i(o),r.assertLog({substring:!0})})}),describe("attaching",()=>{let r;afterEach(()=>{r&&r.kill()}),g("attaches to existing processes",async({r:o})=>{T(h,{"test.js":["setInterval(() => { debugger; }, 500)"]});let n=await Be();r=(0,yo.spawn)("node",[`--inspect=${n}`,(0,Q.join)(h,"test")]),await x(500);let s=await o.attachNode(r.pid,{port:n});await i(s),s.assertLog({substring:!0})}),g.skip("continueOnAttach",async({r:o})=>{T(h,{"test.js":['console.log("");',"debugger;"]});let n=await Be();r=(0,yo.spawn)("node",[`--inspect-brk=${n}`,(0,Q.join)(h,"test")]);let s=await o.attachNode(r.pid,{continueOnAttach:!0,port:n});await i(s),s.assertLog({substring:!0})}),g("retries attachment",async({r:o})=>{T(h,{"test.js":["setInterval(() => { debugger; }, 500)"]});let n=await Be(),s=o.attachNode(0,{port:n});await x(500),r=(0,yo.spawn)("node",[`--inspect=${n}`,(0,Q.join)(h,"test")]);let a=await s;await i(a),a.assertLog({substring:!0})}),g("attaches children of child processes",async({r:o})=>{T(h,{"test.js":`
          const { spawn } = require('child_process');
          setInterval(() => spawn('node', ['child'], { cwd: __dirname }), 500);
        `,"child.js":"(function foo() { debugger; })();"});let n=await Be();r=(0,yo.spawn)("node",[`--inspect=${n}`,(0,Q.join)(h,"test")]),await x(500),(await o.attachNode(r.pid,{port:n})).load();let a=await o.worker();a.load(),await i(a),a.assertLog({substring:!0})}),g("attaches to cluster processes",async({r:o})=>{T(h,{"test.js":`
          const cluster = require('cluster');
          if (cluster.isMaster) {
            cluster.fork();
          } else {
            setInterval(() => { debugger; }, 500);
          }
        `});let n=await Be();r=(0,yo.spawn)("node",[`--inspect=${n}`,(0,Q.join)(h,"test")]),await x(500),(await o.attachNode(r.pid,{port:n})).load();let a=await o.worker();a.load(),await i(a),a.assertLog({substring:!0})}),g("restarts if requested",async({r:o})=>{T(h,{"test.js":["setInterval(() => { debugger; }, 100)"]});let n=await Be();r=(0,yo.spawn)("node",[`--inspect=${n}`,(0,Q.join)(h,"test")]);let s=await o.attachNode(0,{port:n,restart:!0});s.log(await s.dap.once("stopped")),await s.dap.evaluate({expression:"process.exit(0)"}),r=(0,yo.spawn)("node",[`--inspect=${n}`,(0,Q.join)(h,"test")]);let a=await o.waitForTopLevel();a.load(),await i(a),s.assertLog({substring:!0})}),g("does not restart if killed",async({r:o})=>{T(h,{"test.js":["setInterval(() => { debugger; }, 100)"]});let n=await Be();r=(0,yo.spawn)("node",[`--inspect=${n}`,(0,Q.join)(h,"test")],{stdio:"pipe"});let s=[];r.stderr?.pipe((0,uT.default)()).on("data",c=>s.push(c));let a=await o.attachNode(0,{port:n,restart:!0});await a.dap.once("stopped"),await a.dap.disconnect({}),await o.rootDap().disconnect({}),await x(1e3),(0,$r.expect)(s.filter(c=>c.includes("Debugger attached"))).to.have.lengthOf(1)})}),describe("child processes",()=>{beforeEach(()=>T(h,{"test.js":`
        const cp = require('child_process');
        const path = require('path');
        cp.fork(path.join(__dirname, 'child.js'));
      `,"child.js":`
        const foo = 'It works!';
        debugger;
      `})),g("debugs",async({r})=>{(await r.runScript("test.js")).load();let n=await r.worker();n.load();let{threadId:s}=n.log(await n.dap.once("stopped")),a=await n.dap.stackTrace({threadId:s});await n.logger.evaluateAndLog("foo",{params:{frameId:a.stackFrames[0].id}}),n.assertLog()}),g("does not debug if auto attach off",async({r})=>{(await r.runScript("test.js",{autoAttachChildProcesses:!1})).load();let n=await Promise.race([r.worker(),new Promise(s=>setTimeout(()=>s("ok"),1e3))]);(0,$r.expect)(n).to.equal("ok")})}),g("sets arguments",async({r})=>{T(h,{"test.js":"debugger"});let o=await r.runScript("test.js",{args:["--some","very fancy","--arguments"]});await e(o,"process.argv.slice(2)")}),g("sets the cwd",async({r})=>{T(h,{"test.js":"debugger"});let o=await r.runScript("test.js",{cwd:L});await e(o,"process.cwd()")}),g("sets sourceMapOverrides from the cwd",async({r})=>{let o=await r.runScript((0,Q.join)(L,"simpleNode","simpleWebpack.js"),{cwd:(0,Q.join)(L,"simpleNode")});o.load(),await i(o),o.assertLog({substring:!0})}),g("sets environment variables",async({r})=>{T(h,{"test.js":"debugger"});let o=await r.runScript("test.js",{env:{HELLO:"world"}});await e(o,"process.env.HELLO")}),g("sets environment variables",async({r})=>{T(h,{"test.js":"debugger"});let o=await r.runScript("test.js",{env:{HELLO:"world"}});await e(o,"process.env.HELLO")}),g("reads the envfile",async({r})=>{T(h,{"test.js":"debugger;",vars:["A=foo","B=bar"]}),de.processEnv.forget();let o=process.env.C;process.env.C="inherited";let n=await r.runScript("test.js",{envFile:(0,Q.join)(h,"vars"),env:{B:"overwritten"}});await e(n,"JSON.stringify({ a: process.env.A, b: process.env.B, c: process.env.C })"),process.env.C=o,de.processEnv.forget()}),g("writes errors if runtime executable not found",async({r})=>{await r.initialize;let o=await r.rootDap().launch({...rl,cwd:(0,Q.dirname)(h),program:(0,Q.join)(h,"test.js"),rootPath:L,runtimeExecutable:"does-not-exist",__workspaceFolder:h});(0,$r.expect)(o).to.include(`Can't find Node.js binary "does-not-exist"`)}),g("scripts with http urls",async({r})=>{await r.initialize;let o=(0,Q.join)(L,"web","urlSourcemap"),n=await r.runScript((0,Q.join)(o,"index.js"),{cwd:L,skipFiles:["<node_internals>/**"],sourceMapPathOverrides:{"http://localhost:8001/*":`${L}/web/*`}});n.load(),await i(n),n.assertLog({substring:!0})}),g("gets performance information",async({r})=>{T(h,{"test.js":"setInterval(() => {}, 1000)"});let o=await r.runScript("test.js");await o.load();let n=await o.dap.getPerformance({});(0,$r.expect)(n.error).to.be.undefined,(0,$r.expect)(n.metrics).to.not.be.empty}),describe("simplePortAttach",()=>{let r=F(async()=>{let o=await bs(lT.promises,"npm",process.env);if(!o)throw new Error("npm not on path");return o});g("allows inspect-brk in npm scripts",async({r:o})=>{await o.initialize;let n=(0,Q.join)(L,"simpleNode"),s=await o.runScript("",{program:void 0,cwd:n,runtimeExecutable:await r(),runtimeArgs:["run","startWithBrk"],port:29204}),a=s.dap.once("output",l=>l.output.includes("NODE_OPTIONS"));s.load();let{threadId:c}=s.log(await s.dap.once("stopped"));s.dap.continue({threadId:c}),s.logger.logOutput(await a),s.assertLog({substring:!0})}),g("uses bootloader for normal npm scripts",async({r:o})=>{await o.initialize;let n=(0,Q.join)(L,"simpleNode");o.onSessionCreated(l=>l.load());let s=await o.runScript("",{program:void 0,cwd:n,runtimeExecutable:await r(),runtimeArgs:["run","startWithoutBrk"],port:29204});s.load();let c=(await o.worker()).dap.once("output",l=>l.output.includes("NODE_OPTIONS"));s.logger.logOutput(await c),s.assertLog({customAssert:l=>(0,$r.expect)(l).to.contain("NODE_OPTIONS=  --require")})}),g("allows simple port attachment",async({r:o})=>{await o.initialize;let n=(0,Q.join)(L,"simpleNode"),s=await Be(),a=await o.runScript((0,Q.join)(n,"logNodeOptions"),{runtimeArgs:[`--inspect-brk=${s}`],attachSimplePort:s});a.load();let c=a.dap.once("output",p=>p.output.includes("NODE_OPTIONS")),{threadId:l}=a.log(await a.dap.once("stopped"));a.dap.continue({threadId:l}),a.logger.logOutput(await c),a.assertLog({substring:!0})}),g("terminates when inspector closed",async({r:o})=>{await o.initialize;let n=(0,Q.join)(L,"simpleNode"),s=await Be(),a=await o.runScript((0,Q.join)(n,"debuggerStmt"),{runtimeArgs:[`--inspect-brk=${s}`],attachSimplePort:s});a.load();let{threadId:c}=a.log(await a.dap.once("stopped")),l=await a.dap.stackTrace({threadId:c});a.dap.evaluate({expression:'require("inspector").close()',frameId:l.stackFrames[0].id}),a.log(await a.dap.once("terminated")),a.assertLog({substring:!0})}),g("terminates when process killed",async({r:o})=>{await o.initialize;let n=(0,Q.join)(L,"simpleNode"),s=await Be(),a=await o.runScript((0,Q.join)(n,"debuggerStmt"),{runtimeArgs:[`--inspect-brk=${s}`],attachSimplePort:s});a.load(),a.log(await a.dap.once("stopped")),a.dap.evaluate({expression:"process.exit(1)"}),a.log(await a.dap.once("terminated")),a.assertLog({substring:!0})})})})});var I_={};var rr,mT,Qi,vo,gT=m(()=>{"use strict";rr=require("chai"),mT=require("fs"),Qi=require("path");ae();Er();ee();N();jh();vo=new se(mT.promises);describe("node source path resolver",()=>{describe("url to path",()=>{let i={workspaceFolder:"file:///",resolveSourceMapLocations:null,basePath:"/home/benjamin/code/hobby/my-nixvim/config/dap/vscode-js-debug/src/test/node",remoteRoot:null,localRoot:null,sourceMapOverrides:{"webpack:///*":"/home/benjamin/code/hobby/my-nixvim/config/dap/vscode-js-debug/src/test/node/*"}};it("resolves absolute",async()=>{let e=new $e(vo,void 0,i,await E.test());(0,rr.expect)(await e.urlToAbsolutePath({url:"file:///src/index.js"})).to.equal((0,Qi.resolve)("/src/index.js"))}),it("escapes regex parts segments",async()=>{if(process.platform==="win32"){let e=new $e(vo,void 0,{...i,workspaceFolder:"C:\\some\\workspa*ce\\folder",basePath:"C:\\some\\workspa*ce\\folder",resolveSourceMapLocations:["C:\\some\\workspa*ce\\folder/**","C:\\some\\workspa*ce\\folder/../**","C:\\some\\workspa*ce\\folder/../foo/**"]},await E.test());(0,rr.expect)(e.resolvePatterns).to.deep.equal(["C:/some/workspa\\*ce/folder/**","C:/some/workspa\\*ce/**","C:/some/workspa\\*ce/foo/**"])}}),it("fixes regex escape issue #1554",async()=>{if(process.platform==="win32"){let e=new $e(vo,void 0,{...i,workspaceFolder:"C:\\Users\\Segev\\prj\\swimm\\ide\\extensions\\vscode",basePath:"C:\\Users\\Segev\\prj\\swimm\\ide\\extensions\\vscode",resolveSourceMapLocations:["C:\\Users\\Segev\\prj\\swimm\\ide\\extensions\\vscode/**","C:\\Users\\Segev\\prj\\swimm\\ide\\extensions\\vscode/../../../packages/shared/dist/**","C:\\Users\\Segev\\prj\\swimm\\ide\\extensions\\vscode/../../../packages/swimmagic/dist/**","C:\\Users\\Segev\\prj\\swimm\\ide\\extensions\\vscode/../../../packages/editor/dist/**","C:\\Users\\Segev\\prj\\swimm\\ide\\extensions\\vscode/../../server/dist/**","!**/node_modules/**"]},await E.test());(0,rr.expect)(e.shouldResolveSourceMap({compiledPath:"c:\\Users\\Segev\\prj\\swimm\\ide\\server\\dist\\app.js",sourceMapUrl:"file:///c:/Users/Segev/prj/swimm/ide/server/dist/app.js.map"})).to.be.true}}),it("resolves unc paths",async()=>{if(process.platform!=="win32")return;let e=new $e(vo,void 0,i,await E.test());(0,rr.expect)(await e.urlToAbsolutePath({url:"file:////mac/Home/Github/js-debug-demos/node/main.js"})).to.equal((0,Qi.resolve)("\\\\mac\\Home\\Github\\js-debug-demos\\node\\main.js"))}),it("normalizes roots (win -> posix) ",async()=>{let e=new $e(vo,void 0,{...i,remoteRoot:"C:\\Source",localRoot:"/dev/src"},await E.test());(0,rr.expect)(await e.urlToAbsolutePath({url:"file:///c:/source/foo/bar.js"})).to.equal("/dev/src/foo/bar.js")}),it("normalizes roots (posix -> win) ",async()=>{let e=new $e(vo,void 0,{...i,remoteRoot:"/dev/src",localRoot:"C:\\Source"},await E.test());(0,rr.expect)(await e.urlToAbsolutePath({url:"file:///dev/src/foo/bar.js"})).to.equal("c:\\Source\\foo\\bar.js")}),it("places relative paths in node_internals",async()=>{let e=new $e(vo,void 0,i,await E.test());(0,rr.expect)(await e.urlToAbsolutePath({url:"internal.js"})).to.equal("<node_internals>/internal.js")}),it("applies source map overrides",async()=>{let e=new $e(vo,void 0,i,await E.test());(0,rr.expect)(await e.urlToAbsolutePath({url:"webpack:///hello.js",map:{sourceRoot:"",metadata:{compiledPath:"hello.js"}}})).to.equal(fe((0,Qi.join)("/home/benjamin/code/hobby/my-nixvim/config/dap/vscode-js-debug/src/test/node","hello.js")))}),it("loads local node internals (#823)",async()=>{let e=new $e(vo,void 0,i,E.null);(0,rr.expect)(await e.urlToAbsolutePath({url:"node:url"})).to.equal((0,Qi.join)("/home/benjamin/code/hobby/my-nixvim/config/dap/vscode-js-debug/src/test/node","lib/url.js")),(0,rr.expect)(await e.urlToAbsolutePath({url:"node:internal/url.js"})).to.equal((0,Qi.join)("/home/benjamin/code/hobby/my-nixvim/config/dap/vscode-js-debug/src/test/node","lib/internal/url.js"))}),describe("source map filtering",()=>{let e={"matches paths":{locs:["/foo/bar/**","!**/node_modules/**"],map:"file:///foo/bar/baz/my.map.js",ok:!0},"is case sensitive on unix":{locs:["/foo/BAR/**","!**/node_modules/**"],map:"file:////bar/my.map.js",ok:!1,caseSensitive:!0},"does not match paths outside of locations":{locs:["/foo/bar/**","!**/node_modules/**"],map:"file:////bar/my.map.js",ok:!1},"applies negations":{locs:["/foo/bar/**","!**/node_modules/**"],map:"file:///foo/bar/node_modules/my.map.js",ok:!1},"matches win32 paths, case insensitive":{locs:["c:\\foo\\BAR\\**","!**\\node_modules\\**"],map:"file:///c:/foo/bar/BAZ/my.map.js",ok:!0,caseSensitive:!1},"applies win32 negations":{locs:["c:\\foo\\bar\\**","!**\\node_modules\\**"],map:"file:///c:/foo/bar/node_modules/my.map.js",ok:!1},"works for http urls, case insensitive":{locs:["https://EXAMPLE.com/**"],map:"https://example.COM/my.map.js",ok:!0}};afterEach(()=>Qp());for(let t of Object.keys(e)){let r=e[t],{locs:o,map:n,ok:s}=r,a="caseSensitive"in r&&r.caseSensitive;it(t,async()=>{Xp(a);let l=await new $e(vo,void 0,{...i,resolveSourceMapLocations:o},await E.test()).urlToAbsolutePath({url:"webpack:///hello.js",map:{metadata:{sourceMapUrl:n,compiledPath:n},sourceRoot:""}});s?(0,rr.expect)(l&&fe(l)).to.equal(fe((0,Qi.join)("/home/benjamin/code/hobby/my-nixvim/config/dap/vscode-js-debug/src/test/node","hello.js"))):(0,rr.expect)(l).to.be.undefined})}})})})});var k_={};var ds,fT,hT,zb,Gb,P_,Hb,bT=m(()=>{"use strict";ds=require("chai"),fT=require("sinon");Qh();hT=require("events");Im();zb=require("stream-buffers");Sm();Xh();ae();Gb=require("fs"),P_=i=>{let e=new hT.EventEmitter;return e.stderr=new zb.ReadableStreamBuffer,e.stderr.stop(),e.stdout=new zb.ReadableStreamBuffer({frequency:2,chunkSize:32}),e.stdout.put(i),e.stdout.stop(),e.stdout.once("end",()=>setTimeout(()=>e.emit("close",0),1)),e},Hb=async(i,e,t)=>{let r=(0,fT.stub)(i,"createProcess").returns(P_(e));try{let o=await i.lookup((n,s)=>[...s,n],[]);(0,ds.expect)(o).to.deep.equal(t)}finally{r.restore()}};describe("process tree",()=>{it("gives some output for the current platform",async()=>{let i=await Jn.lookup((e,t)=>[...t,e],[]);(0,ds.expect)(i.length).to.be.greaterThan(0),(0,ds.expect)(i[0].pid).to.be.a("number"),(0,ds.expect)(i[0].ppid).to.be.a("number"),(0,ds.expect)(i[0].command).to.match(/./)}),process.platform!=="win32"&&it("gets the working directory",async()=>{let i=await Jn.getWorkingDirectory(process.pid);(0,ds.expect)(i).to.equal(process.cwd())}),it("works for darwin",async()=>{await Hb(new Wi(new se(Gb.promises)),`  PID  PPID BINARY           COMMAND
  380     1 /usr/sbin/cfpref /usr/sbin/cfprefsd agent
  381     1 /usr/libexec/Use /usr/libexec/UserEventAgent (Aqua)
  383     1 /usr/sbin/distno /usr/sbin/distnoted agent
  384     1 /usr/libexec/USB /usr/libexec/USBAgent
  387     1 /System/Library/ /System/Library/Frameworks/CoreTelephony.framework/Support/CommCenter -L
  389     1 /usr/libexec/lsd /usr/libexec/lsd
  390     1 /usr/libexec/tru /usr/libexec/trustd --agent
  391     1 /usr/libexec/sec /usr/libexec/secd
  392     2 /System/Library/ /System/Library/PrivateFrameworks/CloudKitDaemon.framework/Support/cloudd`,[{pid:380,ppid:1,command:"usr/sbin/cfpref",args:"/usr/sbin/cfprefsd agent"},{pid:381,ppid:1,command:"usr/libexec/Use",args:"/usr/libexec/UserEventAgent (Aqua)"},{pid:383,ppid:1,command:"usr/sbin/distno",args:"/usr/sbin/distnoted agent"},{pid:384,ppid:1,command:"usr/libexec/USB",args:"/usr/libexec/USBAgent"},{pid:387,ppid:1,command:"System/Library/",args:"/System/Library/Frameworks/CoreTelephony.framework/Support/CommCenter -L"},{pid:389,ppid:1,command:"usr/libexec/lsd",args:"/usr/libexec/lsd"},{pid:390,ppid:1,command:"usr/libexec/tru",args:"/usr/libexec/trustd --agent"},{pid:391,ppid:1,command:"usr/libexec/sec",args:"/usr/libexec/secd"},{pid:392,ppid:2,command:"System/Library/",args:"/System/Library/PrivateFrameworks/CloudKitDaemon.framework/Support/cloudd"}])}),it("works for posix",async()=>{await Hb(new ja(new se(Gb.promises)),`   PID   PPID BINARY          COMMAND
   351      1 systemd         /lib/systemd/systemd --user
   352    351 (sd-pam)        (sd-pam)
   540      1 sh              sh /home/connor/.vscode-server-insiders/bin/bbf00d8ea6aa7e825ca3393364d746fe401d3299/server.sh --host=127.0.0.1 --enable-remote-auto-shutdown --port=0
   548    540 node            /home/connor/.vscode-server-insiders/bin/bbf00d8ea6aa7e825ca3393364d746fe401d3299/node /home/connor/.vscode-server-insiders/bin/bbf00d8ea6aa7e825ca3393364d746fe401d3299/out/vs/server/main.js --host=127.0.0.1 --enable-remote-auto-shutdown --port=0
  6557   6434 sshd            sshd: connor@notty
  6558   6557 bash            bash
  7281   7199 sshd            sshd: connor@pts/0
  7282   7281 bash            -bash
  9880  99219 bash            /bin/bash`,[{pid:351,ppid:1,command:"/lib/systemd/systemd",args:"--user"},{pid:352,ppid:351,command:"(sd-pam)",args:""},{pid:540,ppid:1,command:"sh",args:"/home/connor/.vscode-server-insiders/bin/bbf00d8ea6aa7e825ca3393364d746fe401d3299/server.sh --host=127.0.0.1 --enable-remote-auto-shutdown --port=0"},{pid:548,ppid:540,command:"/home/connor/.vscode-server-insiders/bin/bbf00d8ea6aa7e825ca3393364d746fe401d3299/node",args:"/home/connor/.vscode-server-insiders/bin/bbf00d8ea6aa7e825ca3393364d746fe401d3299/out/vs/server/main.js --host=127.0.0.1 --enable-remote-auto-shutdown --port=0"},{pid:6557,ppid:6434,command:"sshd:",args:"connor@notty"},{pid:6558,ppid:6557,command:"bash",args:""},{pid:7281,ppid:7199,command:"sshd:",args:"connor@pts/0"},{pid:7282,ppid:7281,command:"-bash",args:""},{pid:9880,ppid:99219,command:"/bin/bash",args:""}])}),it("works for windows",async()=>{await Hb(new Ua,`"C:\\Windows\\SystemApps\\Microsoft.Windows.Cortana_cw5n1h2txyewy\\SearchUI.exe" -ServerName:CortanaUI.AppXa50dqqa5gqv4a428c9y1jjw7m3btvepj.mca                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        20191205115356.768712-480  876              5620       \r
C:\\Windows\\System32\\RuntimeBroker.exe -Embedding                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   20191205115357.036237-480  876              2420       \r
C:\\Windows\\system32\\ApplicationFrameHost.exe -Embedding                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            20191205115357.561985-480  876              6400       \r
"C:\\Windows\\SystemApps\\Microsoft.MicrosoftEdge_8wekyb3d8bbwe\\MicrosoftEdge.exe" -ServerName:MicrosoftEdge.AppXdnhjhccw3zf0j06tkg3jtqr00qdm0khc.mca                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 20191205115357.575393-480  876              6436       \r
"C:\\Program Files\\WindowsApps\\Microsoft.SkypeApp_14.54.91.0_x64__kzf8qxf38zg5c\\SkypeApp.exe" -ServerName:App.AppXffn3yxqvgawq9fpmnhy90fr3y01d1t5b.mca                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              20191205115357.658285-480  876              6524       \r
"C:\\Program Files\\WindowsApps\\Microsoft.YourPhone_1.19111.85.0_x64__8wekyb3d8bbwe\\YourPhone.exe" -ServerName:App.AppX9yct9q388jvt4h7y0gn06smzkxcsnt8m.mca                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          20191205115357.756888-480  876              6596       \r
C:\\Windows\\system32\\browser_broker.exe -Embedding                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  20191205115358.037182-480  876              6808       \r
C:\\Windows\\System32\\RuntimeBroker.exe -Embedding                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   20191205115358.290892-480  876              6972       \r
"C:\\Windows\\System32\\MicrosoftEdgeCP.exe" -ServerName:Windows.Internal.WebRuntime.ContentProcessServer                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             20191205115358.344618-480  876              7036       \r
C:\\Windows\\system32\\MicrosoftEdgeSH.exe SCODEF:6436 CREDAT:9730 APH:1000000000000006 JITHOST /prefetch:2                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           20191205115358.405124-480  6972             7088       \r
`,[{pid:5620,ppid:876,command:"C:\\Windows\\SystemApps\\Microsoft.Windows.Cortana_cw5n1h2txyewy\\SearchUI.exe",args:"-ServerName:CortanaUI.AppXa50dqqa5gqv4a428c9y1jjw7m3btvepj.mca",date:20191205115356},{pid:2420,ppid:876,command:"C:\\Windows\\System32\\RuntimeBroker.exe",args:"-Embedding",date:20191205115357},{pid:6400,ppid:876,command:"C:\\Windows\\system32\\ApplicationFrameHost.exe",args:"-Embedding",date:20191205115357},{pid:6436,ppid:876,command:"C:\\Windows\\SystemApps\\Microsoft.MicrosoftEdge_8wekyb3d8bbwe\\MicrosoftEdge.exe",args:"-ServerName:MicrosoftEdge.AppXdnhjhccw3zf0j06tkg3jtqr00qdm0khc.mca",date:20191205115357},{pid:6524,ppid:876,command:"C:\\Program Files\\WindowsApps\\Microsoft.SkypeApp_14.54.91.0_x64__kzf8qxf38zg5c\\SkypeApp.exe",args:"-ServerName:App.AppXffn3yxqvgawq9fpmnhy90fr3y01d1t5b.mca",date:20191205115357},{pid:6596,ppid:876,command:"C:\\Program Files\\WindowsApps\\Microsoft.YourPhone_1.19111.85.0_x64__8wekyb3d8bbwe\\YourPhone.exe",args:"-ServerName:App.AppX9yct9q388jvt4h7y0gn06smzkxcsnt8m.mca",date:20191205115357},{pid:6808,ppid:876,command:"C:\\Windows\\system32\\browser_broker.exe",args:"-Embedding",date:20191205115358},{pid:6972,ppid:876,command:"C:\\Windows\\System32\\RuntimeBroker.exe",args:"-Embedding",date:20191205115358},{pid:7036,ppid:876,command:"C:\\Windows\\System32\\MicrosoftEdgeCP.exe",args:"-ServerName:Windows.Internal.WebRuntime.ContentProcessServer",date:20191205115358},{pid:7088,ppid:6972,command:"C:\\Windows\\system32\\MicrosoftEdgeSH.exe",args:"SCODEF:6436 CREDAT:9730 APH:1000000000000006 JITHOST /prefetch:2",date:20191205115358}])})})});var x_={};var Y,wT,Oe,Xi,yT=m(()=>{"use strict";Y=require("chai"),wT=require("fs"),Oe=w(require("path"));ae();oe();Lm();Ur();rt();Xi=new se(wT.promises);describe("runtimeVersion",()=>{let i;it("fails if no nvm/s present",async()=>{i=new Rt(Xi,{},"x64","linux",L),await(0,Y.expect)(i.resolveNvmVersionPath("13")).to.eventually.be.rejectedWith(I,/requires Node.js version manager/)}),describe("fall throughs",()=>{beforeEach(()=>{T(h,{"nvs/node/13.12.0/x64/bin/node":"","nvs/node/13.11.0/x86/bin/node":"","nvm/versions/node/v13.11.0/bin/node":"","fnm/node-versions/v13.10.0/installation/bin/node":""}),i=new Rt(Xi,{NVS_HOME:Oe.join(h,"nvs"),NVM_DIR:Oe.join(h,"nvm"),FNM_DIR:Oe.join(h,"fnm")},"x64","linux",L)}),it("attempts multiple lookup to get the right version",async()=>{let{directory:e}=await i.resolveNvmVersionPath("13.12");(0,Y.expect)(e).to.equal(Oe.join(h,"nvs/node/13.12.0/x64/bin"));let{directory:t}=await i.resolveNvmVersionPath("13.11");(0,Y.expect)(t).to.equal(Oe.join(h,"nvm/versions/node/v13.11.0/bin"));let{directory:r}=await i.resolveNvmVersionPath("13.10");(0,Y.expect)(r).to.equal(Oe.join(h,"fnm/node-versions/v13.10.0/installation/bin")),await(0,Y.expect)(i.resolveNvmVersionPath("14")).to.eventually.be.rejectedWith(I,/not installed using version manager nvs\/nvm\/fnm/)}),it("requires nvs for a specific architecture",async()=>{i=new Rt(Xi,{NVM_DIR:Oe.join(h,"nvm")},"x64","linux",L),await(0,Y.expect)(i.resolveNvmVersionPath("13.11/x64")).to.eventually.be.rejectedWith(I,/architecture requires 'nvs' to be installed/)}),it("does not fall through if requesting a specific nvs architecture",async()=>{await(0,Y.expect)(i.resolveNvmVersionPath("13.11/x64")).to.eventually.be.rejectedWith(I,/not installed/)})}),describe("nvs support",()=>{beforeEach(()=>{T(h,{"node/13.12.0/x64/bin/node":"","node/13.4.0/x86/bin/node":"","node/13.3.0/x64/bin/node":"","node/13.3.1/x64/bin/node64.exe":"","node/13.invalid/x64/bin/node":""}),i=new Rt(Xi,{NVS_HOME:h},"x64","linux",L)}),it("gets an exact match",async()=>{let{directory:e,binary:t}=await i.resolveNvmVersionPath("13.3.0");(0,Y.expect)(e).to.equal(Oe.join(h,"node/13.3.0/x64/bin")),(0,Y.expect)(t).to.equal("node")}),it("resolves node64",async()=>{let{directory:e,binary:t}=await i.resolveNvmVersionPath("13.3.1");(0,Y.expect)(e).to.equal(Oe.join(h,"node/13.3.1/x64/bin")),(0,Y.expect)(t).to.equal("node64")}),it("gets the best matching version",async()=>{let{directory:e}=await i.resolveNvmVersionPath("13");(0,Y.expect)(e).to.equal(Oe.join(h,"node/13.12.0/x64/bin"))}),it("throws if no version match",async()=>{await(0,Y.expect)(i.resolveNvmVersionPath("14")).to.eventually.be.rejectedWith(I,/not installed/)}),it("throws on none for specific architecture",async()=>{await(0,Y.expect)(i.resolveNvmVersionPath("13.4.0")).to.eventually.be.rejectedWith(I,/not installed/)}),it("gets a specific architecture",async()=>{let{directory:e}=await i.resolveNvmVersionPath("13/x86");(0,Y.expect)(e).to.equal(Oe.join(h,"node/13.4.0/x86/bin"))}),it("omits the bin directory on windows",async()=>{i=new Rt(Xi,{NVS_HOME:h},"x64","win32",L);let{directory:e}=await i.resolveNvmVersionPath("13.3.0");(0,Y.expect)(e).to.equal(Oe.join(h,"node/13.3.0/x64"))})}),describe("nvm windows",()=>{beforeEach(()=>{T(h,{"v13.12.0/node.exe":"","v13.3.0/node.exe":"","v13.3.1/node64.exe":"","v13.invalid/node.exe":""}),i=new Rt(Xi,{NVM_HOME:h},"x64","win32",L)}),it("gets an exact match",async()=>{let{directory:e,binary:t}=await i.resolveNvmVersionPath("13.3.0");(0,Y.expect)(e).to.equal(Oe.join(h,"v13.3.0")),(0,Y.expect)(t).to.equal("node")}),it("resolves node64",async()=>{let{directory:e,binary:t}=await i.resolveNvmVersionPath("13.3.1");(0,Y.expect)(e).to.equal(Oe.join(h,"v13.3.1")),(0,Y.expect)(t).to.equal("node64")}),it("gets the best matching version",async()=>{let{directory:e}=await i.resolveNvmVersionPath("13");(0,Y.expect)(e).to.equal(Oe.join(h,"v13.12.0"))}),it("throws if no version match",async()=>{await(0,Y.expect)(i.resolveNvmVersionPath("14")).to.eventually.be.rejectedWith(I,/not installed/)})}),describe("nvm osx",()=>{beforeEach(()=>{T(h,{"versions/node/v13.12.0/bin/node":"","versions/node/v13.3.0/bin/node":"","versions/node/v13.3.1/bin/node64":"","versions/node/v13.invalid/bin/node":""}),i=new Rt(Xi,{NVM_DIR:h},"x64","linux",L)}),it("gets an exact match",async()=>{let{directory:e,binary:t}=await i.resolveNvmVersionPath("13.3.0");(0,Y.expect)(e).to.equal(Oe.join(h,"versions/node/v13.3.0/bin")),(0,Y.expect)(t).to.equal("node")}),it("resolves node64",async()=>{let{directory:e,binary:t}=await i.resolveNvmVersionPath("13.3.1");(0,Y.expect)(e).to.equal(Oe.join(h,"versions/node/v13.3.1/bin")),(0,Y.expect)(t).to.equal("node64")}),it("gets the best matching version",async()=>{let{directory:e}=await i.resolveNvmVersionPath("13");(0,Y.expect)(e).to.equal(Oe.join(h,"versions/node/v13.12.0/bin"))}),it("throws if no version match",async()=>{await(0,Y.expect)(i.resolveNvmVersionPath("14")).to.eventually.be.rejectedWith(I,/not installed/)})}),describe("fnm",()=>{beforeEach(()=>{T(h,{"node-versions/v13.12.0/installation/bin/node":"","node-versions/v13.3.0/installation/bin/node":"","node-versions/v13.invalid/installation/bin/node":""}),i=new Rt(Xi,{FNM_DIR:h},"x64","linux",L)}),it("gets an exact match",async()=>{let{directory:e,binary:t}=await i.resolveNvmVersionPath("13.3.0");(0,Y.expect)(e).to.equal(Oe.join(h,"node-versions/v13.3.0/installation/bin")),(0,Y.expect)(t).to.equal("node")}),it("gets the best matching version",async()=>{let{directory:e}=await i.resolveNvmVersionPath("13");(0,Y.expect)(e).to.equal(Oe.join(h,"node-versions/v13.12.0/installation/bin"))}),it("throws if no version match",async()=>{await(0,Y.expect)(i.resolveNvmVersionPath("14")).to.eventually.be.rejectedWith(I,/not installed/)})})})});var C_={};var jc,Uc,vT=m(()=>{"use strict";jc=require("chai"),Uc=require("fs");Nd();_e();describe("resourceProvider",()=>{async function i(e,t){let{threadId:r}=e.log(await e.dap.once("stopped"));return await e.logger.logStackTrace(r),t&&await t(r),e.dap.continue({threadId:r})}g("applies cookies",async({r:e})=>{let t=await e.launchUrl("cookies/home");t.load(),await i(t),t.assertLog()}),g("follows redirects",async({r:e})=>{let t=await e.launchUrl("redirect-test/home");t.load(),t.log(await t.waitForSource("module1.ts")),t.assertLog()}),it("decodes base64 data uris",async()=>{let e=new jt(Uc.promises);(0,jc.expect)(await e.fetch("data:text/plain;base64,SGVsbG8gd29ybGQh")).to.deep.equal({ok:!0,statusCode:200,body:"Hello world!",url:"data:text/plain;base64,SGVsbG8gd29ybGQh"})}),it("decodes utf8 data uris (#662)",async()=>{let e=new jt(Uc.promises);(0,jc.expect)(await e.fetch("data:text/plain;utf-8,Hello%20world!")).to.deep.equal({ok:!0,statusCode:200,body:"Hello world!",url:"data:text/plain;utf-8,Hello%20world!"})}),it("fetches remote url",async()=>{let e=new jt(Uc.promises);(0,jc.expect)(await e.fetch("http://localhost:8001/greet")).to.deep.equal({ok:!0,statusCode:200,body:"Hello world!",url:"http://localhost:8001/greet"})}),it("follows redirects (unit)",async()=>{let e=new jt(Uc.promises);(0,jc.expect)(await e.fetch("http://localhost:8001/redirect-to-greet")).to.deep.equal({ok:!0,statusCode:200,body:"Hello world!",url:"http://localhost:8001/redirect-to-greet"})}),it("applies request options",async()=>{let t=await new jt(Uc.promises,{provideOptions:r=>{r.headers={cool:"true"}}}).fetch("http://localhost:8001/view-headers");(0,jc.expect)(JSON.parse(t.body||"no content")).to.containSubset({cool:"true"})})})});var T_={};var ST=m(()=>{"use strict";_e();describe("pretty print sources",()=>{async function i(t){let{threadId:r}=t.log(await t.dap.once("stopped"));return await t.logger.logStackTrace(r),()=>t.dap.continue({threadId:r})}let e=async(t,r)=>{let o=t.dap.prettyPrintSource({source:r}),n=t.dap.once("loadedSource"),s=t.dap.once("continued"),a=await i(t);t.log(await s),t.log(await n),await o,a()};g("base",async function({r:t}){let r=await t.launchUrl("pretty/pretty.html"),o={path:r.workspacePath("web/pretty/ugly.js")};await r.dap.setBreakpoints({source:o,breakpoints:[{line:5,column:1}]}),r.load(),await i(r),await e(r,o),r.assertLog()}),g("steps in pretty",async({r:t})=>{let r=await t.launchUrl("pretty/pretty.html"),o={path:r.workspacePath("web/pretty/ugly.js")};await r.dap.setBreakpoints({source:o,breakpoints:[{line:5,column:1}]}),r.load(),await r.dap.once("stopped"),r.dap.prettyPrintSource({source:o});let{threadId:n}=r.log(await r.dap.once("stopped"));for(let s=0;s<4;s++)r.log(`
step`),r.dap.next({threadId:n}),r.log(await Promise.all([r.dap.once("continued"),r.dap.once("stopped")])),await r.logger.logStackTrace(n);r.assertLog()}),g("bps",async({r:t})=>{let r=await t.launchUrl("pretty/pretty.html"),o={path:r.workspacePath("web/pretty/ugly.js")};await r.dap.setBreakpoints({source:o,breakpoints:[{line:5,column:1},{line:9,column:1}]}),r.load();let n=r.dap.once("stopped");for(let p=0;p<2;p++)r.log(await r.dap.once("breakpoint"));let{threadId:s}=r.log(await n);r.dap.prettyPrintSource({source:o});let a=r.dap.once("loadedSource"),c=r.log(await r.dap.once("breakpoint")).breakpoint,l=r.log(await r.dap.once("breakpoint")).breakpoint;r.log(await r.dap.setBreakpoints({source:(await a).source,breakpoints:[{line:17,column:1},{line:c.line,column:c.column},{line:l.line,column:l.column}]}));for(let p=0;p<2;p++)r.log(`
continue`),r.dap.continue({threadId:s}),r.log(await Promise.all([r.dap.once("continued"),r.dap.once("stopped")])),await r.logger.logStackTrace(s);r.assertLog()}),g("eval sources (#929)",async function({r:t}){let r=await t.launchUrlAndLoad("index.html");await r.load();let o=r.waitForSource(),n=r.evaluate('let n=1;for(let l=0;l<n;l++){console.log("hi");debugger}',"");await i(r),await e(r,(await o).source),await n,r.assertLog()})})});var R_={};var IT=m(()=>{"use strict";_e();describe("webassembly",()=>{g("basic stepping and breakpoints",async({r:i})=>{let e=await i.launchUrl("wasm/hello.html");await e.dap.setBreakpoints({source:{path:e.workspacePath("web/wasm/hello.html")},breakpoints:[{line:14}]}),e.load();{let{threadId:t}=e.log(await e.dap.once("stopped"));await e.dap.stepIn({threadId:t})}{let{threadId:t}=e.log(await e.dap.once("stopped"),"stopped event"),r=await e.logger.logStackTrace(t),o=await e.dap.source({sourceReference:r[0].source.sourceReference,source:r[0].source});e.log(o.mimeType,"source mime type"),e.log(o.content,"source content"),await e.dap.setBreakpoints({source:r[0].source,breakpoints:[{line:10}]}),await e.dap.continue({threadId:t})}{let{threadId:t}=e.log(await e.dap.once("stopped"),"breakpoint stopped event");await e.logger.logStackTrace(t)}e.assertLog()}),describe("dwarf",()=>{let i=async(e,t,r,o)=>{let n=await e.launchUrlAndLoad(`dwarf/${r}.html`);return o.source.path=n.workspacePath(o.source.path),await n.dap.setBreakpoints(o),await n.dap.once("breakpoint",s=>s.breakpoint.verified),await n.cdp.Page.reload({}),n};g("scopes and variables",async({r:e,context:t})=>{let r=await i(e,t,"fibonacci",{source:{path:"web/dwarf/fibonacci.c"},breakpoints:[{line:6}]}),{threadId:o}=r.log(await r.dap.once("stopped"));await r.logger.logStackTrace(o,2),e.assertLog()}),g("basic stepping",async({r:e,context:t})=>{let r=await i(e,t,"fibonacci",{source:{path:"web/dwarf/fibonacci.c"},breakpoints:[{line:6}]});{let{threadId:o}=r.log(await r.dap.once("stopped"));await r.dap.setBreakpoints({source:{path:r.workspacePath("web/dwarf/fibonacci.c")},breakpoints:[]}),r.dap.next({threadId:o})}{let{threadId:o}=r.log(await r.dap.once("stopped"));await r.logger.logStackTrace(o),r.dap.stepOut({threadId:o})}{let{threadId:o}=r.log(await r.dap.once("stopped"));await r.logger.logStackTrace(o)}e.assertLog()}),g("inline breakpoints set at all call sites",async({r:e,context:t})=>{let r=await i(e,t,"diverse-inlining",{source:{path:"web/dwarf/diverse-inlining.h"},breakpoints:[{line:2}]});{let{threadId:o}=r.log(await r.dap.once("stopped"));await r.logger.logStackTrace(o),r.dap.continue({threadId:o})}{let{threadId:o}=r.log(await r.dap.once("stopped"));await r.logger.logStackTrace(o,2),r.dap.continue({threadId:o})}e.assertLog()}),g("inline function stepping 1",async({r:e,context:t})=>{let r=await i(e,t,"diverse-inlining",{source:{path:"web/dwarf/diverse-inlining-main.c"},breakpoints:[{line:7}]}),o=["stepIn","stepOut","next","stepIn","stepIn","stepIn"];for(let s of o){let{threadId:a}=r.log(await r.dap.once("stopped"));await r.logger.logStackTrace(a),r.dap[s]({threadId:a}),r.log(`---- ${s} ----`)}let{threadId:n}=r.log(await r.dap.once("stopped"));await r.logger.logStackTrace(n),e.assertLog()}),g("inline function stepping 2",async({r:e,context:t})=>{let r=await i(e,t,"diverse-inlining",{source:{path:"web/dwarf/diverse-inlining-extern.c"},breakpoints:[{line:5}]});{let{threadId:o}=r.log(await r.dap.once("stopped"));await r.logger.logStackTrace(o),r.dap.next({threadId:o})}{let{threadId:o}=r.log(await r.dap.once("stopped"));await r.logger.logStackTrace(o)}e.assertLog()}),g("does lldb evaluation",async({r:e,context:t})=>{let r=await i(e,t,"fibonacci",{source:{path:"web/dwarf/fibonacci.c"},breakpoints:[{line:6}]}),{threadId:o}=r.log(await r.dap.once("stopped")),{id:n}=(await r.dap.stackTrace({threadId:o})).stackFrames[0];await r.logger.evaluateAndLog("n",{params:{frameId:n}}),await r.logger.evaluateAndLog("a",{params:{frameId:n}}),await r.logger.evaluateAndLog("a + n * 2",{params:{frameId:n}}),e.assertLog()})})})});var xT=rR((jZ,kT)=>{"use strict";var hg=w(require("mocha"));Ab();var Jb=class i extends hg.reporters.Spec{static{this.alwaysDumpLogs=process.env.DUMP_LOGS}constructor(e){super(e),e.on("pass",t=>{if(i.alwaysDumpLogs)return this.dumpLogs(t)}),e.on("fail",t=>this.dumpLogs(t))}async dumpLogs(e){if(!(e instanceof hg.Test))return;let t=cs(e.fullTitle());console.log(`##vso[build.uploadlog]${t}`)}};kT.exports=Jb});var L_={};async function CT(i,e,t=[]){console.log("Setting up CRA in "+e),RT.mkdirSync(e,{recursive:!0});let r=Qb.spawn("npx",["create-react-app",...t,i],{cwd:e,stdio:"pipe",env:process.env});r.stdout.on("data",n=>console.log(n.toString().replace(/\r?\n$/,""))),r.stderr.on("data",n=>console.error(n.toString().replace(/\r?\n$/,"")));let o=ne();r.once("exit",()=>{o.resolve(void 0)}),await o.promise}async function TT(i){let e=ne(),t=Qb.spawn("npm",["run-script","start"],{env:{...process.env,BROWSER:"none",SKIP_PREFLIGHT_CHECK:"true"},cwd:i,stdio:"pipe"}),r=setTimeout(()=>{console.log("Did not get recognized dev server output, continuing"),e.resolve(void 0)},1e4);return t.stdout.on("data",o=>{o=o.toString(),o.includes("You can now view")?(console.log("Detected CRA dev server started"),e.resolve(void 0)):o.includes("Something is already")&&e.reject(new Error("Failed to start the dev server: "+o)),console.log(o.toString().replace(/\r?\n$/,""))}),t.stderr.on("data",o=>console.error(o.toString().replace(/\r?\n$/,""))),await e.promise,clearTimeout(r),t}var Qb,RT,Pp,DT=m(()=>{"use strict";Qb=w(require("child_process")),RT=w(require("fs")),Pp=require("path");Er();U();va();rt();_e();describe("react",()=>{async function i(o,n){let{threadId:s}=o.log(await o.dap.once("stopped"));return await o.logger.logStackTrace(s),n&&await n(s),o.dap.continue({threadId:s})}let e="react-test",t,r;afterEach(()=>{r&&(console.log("Killing "+r.pid),Kt(r.pid,E.null))}),describe("TS",()=>{beforeEach(async function(){this.timeout(6e4*4),t=(0,Pp.join)(h,e),await CT(e,h,["--template","cra-template-typescript"]),r=await TT(t)}),g("hit breakpoint",async({r:o})=>{let n=await o._launch("http://localhost:3000",{webRoot:t,__workspaceFolder:t,rootPath:t}),s={path:(0,Pp.join)(t,"src/App.tsx")};await n.dap.setBreakpoints({source:s,breakpoints:[{line:6,column:0}]}),n.load(),await i(n),n.assertLog({substring:!0})})}),describe("JS",()=>{beforeEach(async function(){this.timeout(6e4*4),t=(0,Pp.join)(h,e),await CT(e,h),r=await TT(t)}),g("hit breakpoint",async({r:o})=>{let n=await o._launch("http://localhost:3000",{webRoot:t,__workspaceFolder:t,rootPath:t}),s={path:(0,Pp.join)(t,"src/App.js")};await n.dap.setBreakpoints({source:s,breakpoints:[{line:6,column:0}]}),n.load(),await i(n),n.assertLog({substring:!0})})})})});var __={};var LT=m(()=>{"use strict";_e();describe("infra",()=>{g("initialize",async({r:i})=>{i.log(await i.initialize),i.assertLog()}),it("imports win32 app container tokens",async()=>{process.platform==="win32"&&await import("@vscode/win32-app-container-tokens")})})});var E_={};var Xb,Yb,R,_T=m(()=>{"use strict";Xb=require("chai"),Yb=w(require("del")),R=require("path");ae();ee();N();Ur();Bb();rt();_e();describe("breakpoints",()=>{describe("configure",()=>{g("inline",async({r:i})=>{let e=await i.launchUrl("inlinescript.html"),t={path:e.workspacePath("web/inlinescript.html")};await e.dap.setBreakpoints({source:t,breakpoints:[{line:3,column:2}]}),e.load(),await P(e),e.assertLog()}),g("script",async({r:i})=>{let e=await i.launchUrl("script.html"),t={path:e.workspacePath("web/script.js")};await e.dap.setBreakpoints({source:t,breakpoints:[{line:9,column:0}]}),e.load(),await P(e),await P(e),e.assertLog()}),g("query params",async({r:i})=>{let e=await i.launchUrl("script-with-query-param.html"),t={path:e.workspacePath("web/script.js")};await e.dap.setBreakpoints({source:t,breakpoints:[{line:9,column:0}]}),e.load(),await P(e),await P(e),e.assertLog()}),g("remove",async({r:i})=>{let e=await i.launchUrl("script.html"),t={path:e.workspacePath("web/script.js")};await e.dap.setBreakpoints({source:t,breakpoints:[{line:2,column:0}]}),e.load();let r;await P(e,async()=>{e.dap.once("breakpoint").then(o=>r=o),await e.dap.setBreakpoints({source:t})}),await P(e),e.cdp.Runtime.evaluate({expression:`foo();
debugger;
//# sourceURL=test.js`}),await P(e),(0,Xb.expect)(r).to.be.undefined,e.assertLog()}),g("source map",async({r:i})=>{let e=await i.launchUrl("browserify/pause.html"),t={path:e.workspacePath("web/browserify/module2.ts")};await e.dap.setBreakpoints({source:t,breakpoints:[{line:3}]}),e.load(),await P(e),await P(e),e.assertLog()}),g("absolute paths in source maps",async({r:i})=>{let e=i.workspacePath("web/tmp");after(()=>(0,Yb.default)([`${B(e)}/**`],{force:!0})),T(e,{"pause.js":await or(i.workspacePath("web/browserify/pause.js")),"pause.html":await or(i.workspacePath("web/browserify/pause.html")),"pause.js.map":(await or(i.workspacePath("web/browserify/pause.js.map"))).replace(/"([a-z0-9]+.ts)"/g,`"${B(i.workspacePath("web/browserify"))}/$1"`)});let t=await i.launchUrl("tmp/pause.html"),r={path:t.workspacePath("web/browserify/module2.ts")};await t.dap.setBreakpoints({source:r,breakpoints:[{line:3}]}),t.load(),await P(t),await P(t),t.assertLog()}),g("source map predicted",async({r:i})=>{let e=await i.launchUrl("browserify/pause.html");e.adapter.breakpointManager.setPredictorDisabledForTest(!1);let t={path:e.workspacePath("web/browserify/module2.ts")};await e.dap.setBreakpoints({source:t,breakpoints:[{line:3}]}),e.load(),await P(e),await P(e),e.assertLog()}),g("source map that's path mapped",async({r:i})=>{let e=i.workspacePath("web/tmp");after(()=>(0,Yb.default)([`${B(e)}/**`],{force:!0})),T(e,{"app.ts":await or(i.workspacePath("web/pathMapped/app.ts")),"app.js":(await or(i.workspacePath("web/pathMapped/app.js"))).replace("app.js.map","mappedPath/app.js.map"),"index.html":await or(i.workspacePath("web/pathMapped/index.html")),mappedDir:{"app.js.map":await or(i.workspacePath("web/pathMapped/app.js.map"))}});let t=await i.launchUrl("tmp/index.html",{pathMapping:{"/mappedPath/":"${workspaceFolder}/web/tmp/mappedDir/"}}),r={path:t.workspacePath("web/tmp/app.ts")};await t.dap.setBreakpoints({source:r,breakpoints:[{line:2}]}),t.load(),await P(t),t.assertLog()})}),describe("launched",()=>{g("inline",async({r:i})=>{let e=await i.launchUrl("inlinescriptpause.html");e.load(),await P(e,async()=>{let t={path:e.workspacePath("web/inlinescriptpause.html")};await e.dap.setBreakpoints({source:t,breakpoints:[{line:6}]})}),await P(e),e.assertLog()}),g("script",async({r:i})=>{let e=await i.launchUrl("script.html");e.load(),await P(e,async()=>{let t={path:e.workspacePath("web/script.js")};await e.dap.setBreakpoints({source:t,breakpoints:[{line:6}]})}),await P(e),e.assertLog()}),g("ref",async({r:i})=>{let e=await i.launchUrlAndLoad("index.html");e.cdp.Runtime.evaluate({expression:`
        function foo() {
          return 2;
        }
      `});let{source:t}=await e.waitForSource("eval");t.path=void 0,await e.dap.setBreakpoints({source:t,breakpoints:[{line:3}]});let r=e.evaluate("foo();");await P(e),await r,e.assertLog()}),g("remove",async({r:i})=>{let e=await i.launchUrlAndLoad("index.html");e.cdp.Runtime.evaluate({expression:`
        function foo() {
          return 2;
        }
      `});let{source:t}=await e.waitForSource("eval");t.path=void 0,await e.dap.setBreakpoints({source:t,breakpoints:[{line:3}]}),await e.dap.setBreakpoints({source:t}),e.cdp.Runtime.evaluate({expression:`foo();
debugger;
//# sourceURL=test.js`}),await P(e),e.assertLog()}),g("overwrite",async({r:i})=>{let e=await i.launchUrlAndLoad("index.html");e.cdp.Runtime.evaluate({expression:`
        function foo() {
          var x = 3;
          return 2;
        }
      `});let{source:t}=await e.waitForSource("eval");t.path=void 0,await e.dap.setBreakpoints({source:t,breakpoints:[{line:4}]}),await e.dap.setBreakpoints({source:t,breakpoints:[{line:3}]}),e.cdp.Runtime.evaluate({expression:`foo();
debugger;
//# sourceURL=test.js`}),await P(e),await P(e),e.assertLog()}),g("source map",async({r:i})=>{let e=await i.launchUrl("browserify/browserify.html"),t=e.waitForSource("module2.ts");await e.load(),await t;let r={path:e.workspacePath("web/browserify/module2.ts")},o=await e.dap.setBreakpoints({source:r,breakpoints:[{line:3}]});(0,Xb.expect)(o.breakpoints[0].verified).to.be.true,e.cdp.Runtime.evaluate({expression:`window.callBack(window.pause);
//# sourceURL=test.js`}),await P(e),await P(e),e.assertLog()}),g("source map remove",async({r:i})=>{let e=await i.launchUrlAndLoad("browserify/browserify.html"),t={path:e.workspacePath("web/browserify/module2.ts")};await e.dap.setBreakpoints({source:t,breakpoints:[{line:3}]}),await e.dap.setBreakpoints({source:t,breakpoints:[]}),e.cdp.Runtime.evaluate({expression:`window.callBack(window.pause);
//# sourceURL=test.js`}),await P(e),e.assertLog()}),g("source map set compiled",async({r:i})=>{let e=await i.launchUrl("browserify/browserify.html");e.load(),await e.waitForSource("bundle.js");let t=await e.dap.setBreakpoints({source:{path:e.workspacePath("web/browserify/bundle.js")},breakpoints:[{line:36}]});delete t.breakpoints[0].source.sources,e.log(t.breakpoints[0],"Breakpoint resolved: "),e.cdp.Runtime.evaluate({expression:`window.callBack(window.pause);
//# sourceURL=test.js`});let{threadId:r}=e.log(await e.dap.once("stopped"));await e.logger.logStackTrace(r),e.dap.stepIn({threadId:r}),await P(e),e.assertLog()}),g("source map set compiled 2",async({r:i})=>{let e=await i.launchUrl("browserify/browserify.html");e.load(),await e.waitForSource("bundle.js");let t=await e.dap.setBreakpoints({source:{path:e.workspacePath("web/browserify/bundle.js")},breakpoints:[{line:36}]});delete t.breakpoints[0].source.sources,e.log(t.breakpoints[0],"Breakpoint resolved: "),e.cdp.Runtime.evaluate({expression:`window.callBack(window.pause);
//# sourceURL=test.js`}),await P(e),await P(e),e.assertLog()}),g("sets breakpoints in sourcemapped node_modules",async({r:i})=>{await i.initialize;let e=(0,R.join)(L,"nodeModuleBreakpoint"),t=await i.runScript((0,R.join)(e,"index.js"),{outFiles:[`${e}/**/*.js`],env:{MODULE:"@c4312/foo"},resolveSourceMapLocations:null});await t.dap.setBreakpoints({source:{path:(0,R.join)(e,"node_modules","@c4312","foo","src","index.ts")},breakpoints:[{line:2,column:1}]}),t.load(),await P(t),t.assertLog({substring:!0})}),g("sets breakpoints in sourcemapped node_modules with absolute root",async({r:i})=>{await i.initialize;let e=(0,R.join)(L,"nodeModuleBreakpoint"),t=await i.runScript((0,R.join)(e,"index.js"),{outFiles:[`${e}/**/*.js`],env:{MODULE:"@c4312/absolute-sourceroot"},resolveSourceMapLocations:null});await t.dap.setBreakpoints({source:{path:(0,R.join)(e,"node_modules","@c4312","absolute-sourceroot","src","index.ts")},breakpoints:[{line:2,column:1}]}),t.load(),await P(t),t.assertLog({substring:!0})}),g("absolute path in nested module",async({r:i})=>{await i.initialize;let e=(0,R.join)(L,"nestedAbsRoot"),t=await i.runScript((0,R.join)(e,"index.js"));await t.dap.setBreakpoints({source:{path:(0,R.join)(e,"test.js")},breakpoints:[{line:1,column:1}]}),t.load(),await P(t),t.assertLog({substring:!0})})}),describe("logpoints",()=>{g("basic",async({r:i})=>{let e=await i.launchUrl("logging.html"),t={path:e.workspacePath("web/logging.js")},r=[{line:6,column:0,logMessage:"123"},{line:7,column:0,logMessage:"{({foo: 'bar'})}"},{line:8,column:0,logMessage:"{foo}"},{line:9,column:0,logMessage:"foo {foo} bar"},{line:10,column:0,logMessage:"foo {bar + baz}"},{line:11,column:0,logMessage:"{const a = bar + baz; a}"},{line:12,column:0,logMessage:"{(x=>x+baz)(bar)}"},{line:13,column:0,logMessage:'{throw new Error("oof")}'},{line:14,column:0,logMessage:"{'hi'}"}];await e.dap.setBreakpoints({source:t,breakpoints:r}),e.load();let o=[];for(let n=0;n<r.length;n++)o.push(await e.dap.once("output"));for(let n of o)await e.logger.logOutput(n);e.assertLog()}),g("callstack",async({r:i})=>{let e=await i.launchUrl("logging.html");await e.dap.setBreakpoints({source:{path:e.workspacePath("web/logging.js")},breakpoints:[{line:6,column:0,logMessage:"123"}]}),e.load(),e.log(await e.dap.once("output")),e.assertLog()}),g("returnValue",async({r:i})=>{let e=await i.launchUrl("logging.html");await e.dap.setBreakpoints({source:{path:e.workspacePath("web/logging.js")},breakpoints:[{line:32,column:100,logMessage:"doubled: {$returnValue * 2}"}]}),e.load(),await e.logger.logOutput(await e.dap.once("output")),e.assertLog()}),g("no double log",async({r:i})=>{let e=await i.launchUrlAndLoad("logging.html"),t={path:e.workspacePath("web/logging.js")};await e.dap.setBreakpoints({source:t,breakpoints:[{line:28,column:0,logMessage:"{'LOG' + (window.logValue = (window.logValue || 0) + 1)}"}]}),e.cdp.Runtime.evaluate({expression:"g(); console.log('DONE' + window.logValue)"});let r=[];for(let o=0;o<2;o++)r.push(await e.dap.once("output"));for(let o of r)await e.logger.logOutput(o);e.assertLog()})}),describe("hit condition",()=>{async function i(e){await P(e,async()=>{await e.logger.evaluateAndLog("i")})}g("exact",async({r:e})=>{let t=await e.launchUrl("condition.html"),r={path:t.workspacePath("web/condition.js")};await t.dap.setBreakpoints({source:r,breakpoints:[{line:2,column:0,hitCondition:"==2"}]}),t.load(),await i(t),await P(t),t.assertLog()}),g("less than",async({r:e})=>{let t=await e.launchUrl("condition.html"),r={path:t.workspacePath("web/condition.js")};await t.dap.setBreakpoints({source:r,breakpoints:[{line:2,column:0,hitCondition:"<3"}]}),t.load(),await i(t),await i(t),await P(t),t.assertLog()}),g("greater than",async({r:e})=>{let t=await e.launchUrl("condition.html"),r={path:t.workspacePath("web/condition.js")};await t.dap.setBreakpoints({source:r,breakpoints:[{line:2,column:0,hitCondition:">3"}]}),t.load(),await i(t),await i(t),t.assertLog()}),g("invalid",async({r:e})=>{let t=await e.launchUrl("condition.html"),r={path:t.workspacePath("web/condition.js")};t.dap.on("output",o=>{o.category==="stderr"&&t.logger.logOutput(o)}),await t.dap.setBreakpoints({source:r,breakpoints:[{line:2,column:0,hitCondition:"abc"}]}),t.load(),await P(t),t.assertLog()})}),describe("condition",()=>{async function i(e){await P(e,async()=>{await e.logger.evaluateAndLog("i")})}g("basic",async({r:e})=>{let t=await e.launchUrl("condition.html"),r={path:t.workspacePath("web/condition.js")};await t.dap.setBreakpoints({source:r,breakpoints:[{line:2,column:0,condition:"i==2"}]}),t.load(),await i(t),await P(t),t.assertLog()}),g("ignores error by default",async({r:e})=>{let t=await e.launchUrl("condition.html");await t.dap.setBreakpoints({source:{path:t.workspacePath("web/condition.js")},breakpoints:[{line:2,column:0,condition:'(() => { throw "oh no" })()'}]});let r=t.dap.once("output");t.load(),await P(t),await e.log(await r),t.assertLog()}),g("pauses on error",async({r:e})=>{let t=await e.launchUrl("condition.html",{__breakOnConditionalError:!0});await t.dap.setBreakpoints({source:{path:t.workspacePath("web/condition.js")},breakpoints:[{line:2,column:0,condition:'(() => { throw "oh no" })()'}]}),t.load();let r=t.dap.once("output");await P(t),t.logger.logOutput(await r),t.assertLog()}),g("ignores bp with invalid condition",async({r:e})=>{let t=await e.launchUrl("condition.html"),r=t.dap.once("output"),o={path:t.workspacePath("web/condition.js")};await t.dap.setBreakpoints({source:o,breakpoints:[{line:2,column:0,condition:")(}{][.&"}]}),t.load(),await e.log(await r),await P(t),t.assertLog()})}),describe("custom",()=>{g("inner html",async({r:i})=>{let e=await i.launchAndLoad("<div>text</div>");e.log("Not pausing on innerHTML"),await e.evaluate("document.querySelector('div').innerHTML = 'foo';"),e.log("Pausing on innerHTML"),await e.dap.setCustomBreakpoints({ids:["instrumentation:Element.setInnerHTML"],xhr:[]}),e.evaluate("document.querySelector('div').innerHTML = 'bar';");let t=e.log(await e.dap.once("stopped"));e.log(await e.dap.continue({threadId:t.threadId})),e.assertLog()})}),describe("first line",()=>{g("breaks if requested",async({r:i})=>{await i.initialize;let e=(0,R.join)(L,"simpleNode"),t=await i.runScript((0,R.join)(e,"index.js"));await t.dap.setBreakpoints({source:{path:(0,R.join)(e,"index.js")},breakpoints:[{line:1,column:1}]}),t.load(),await P(t),t.assertLog({substring:!0})}),g("does not break if not requested",async({r:i})=>{await i.initialize;let e=(0,R.join)(L,"simpleNode"),t=await i.runScript((0,R.join)(e,"index.js"));await t.dap.setBreakpoints({source:{path:(0,R.join)(e,"index.js")},breakpoints:[{line:2,column:1}]}),t.load(),await P(t),t.assertLog({substring:!0})})}),describe("hot-transpiled",()=>{g("breaks on first line",async({r:i})=>{await i.initialize;let e=(0,R.join)(L,"tsNode"),t=await i.runScript((0,R.join)(e,"index.js"));await t.dap.setBreakpoints({source:{path:(0,R.join)(e,"double.ts")},breakpoints:[{line:1,column:1}]}),t.load(),await P(t),t.assertLog({substring:!0})}),g("user defined bp on first line",async({r:i})=>{await i.initialize;let e=(0,R.join)(L,"tsNode"),t=await i.runScript((0,R.join)(e,"index.js"));await t.dap.setBreakpoints({source:{path:(0,R.join)(e,"log.ts")},breakpoints:[{line:2,column:1}]}),t.load(),await P(t),t.assertLog({substring:!0})}),g("adjusts breakpoints",async({r:i})=>{await i.initialize;let e=(0,R.join)(L,"tsNode"),t=await i.runScript((0,R.join)(e,"index.js"));await t.dap.setBreakpoints({source:{path:(0,R.join)(e,"double.ts")},breakpoints:[{line:7,column:1}]}),t.load(),await P(t),t.assertLog({substring:!0})}),g("adjusts breakpoints after already running (#524)",async({r:i})=>{await i.initialize;let e=(0,R.join)(L,"tsNode"),t=await i.runScript((0,R.join)(e,"index.js"));await t.dap.setBreakpoints({source:{path:(0,R.join)(e,"double.ts")},breakpoints:[{line:7,column:1}]}),t.load();let{threadId:r}=await t.dap.once("stopped");t.log(await t.dap.setBreakpoints({source:{path:(0,R.join)(e,"double.ts")},breakpoints:[{line:17,column:1}]})),t.dap.continue({threadId:r}),await P(t),t.assertLog({substring:!0})}),g("works in remote workspaces",async({r:i})=>{await i.initialize;let e=(0,R.join)(L,"tsNode"),t=await i.runScriptAsRemote((0,R.join)(e,"index.js"));await t.dap.setBreakpoints({source:{path:(0,R.join)(e,"double.ts")},breakpoints:[{line:7,column:1}]}),t.load(),await P(t),t.assertLog({substring:!0})}),g("avoids double pathmapping (#1617)",async({r:i})=>{T(h,{src:{"double.js":"console.log('hello world');"},"double.js":["/*'Object.<anonymous>':function(module,exports,require,__dzrname,__fzlename,jest*/console.log('hello world');","//# sourceMappingURL=data:application/json;charset=utf-8;base64,"+Buffer.from(JSON.stringify({version:3,names:["console","log"],sources:["double.js"],sourcesContent:[`console.log('hello world');
`],mappings:"AAAAA,OAAO,CAACC,GAAG,CAAC,aAAa,CAAC"})).toString("base64")]});let e=await i.runScript("double.js",{localRoot:(0,R.join)(h,"src"),remoteRoot:h});await e.dap.setBreakpoints({source:{path:(0,R.join)(h,"src","double.js")},breakpoints:[{line:1,column:1}]}),e.load(),await P(e),i.assertLog({substring:!0})}),g("does not adjust already correct",async({r:i})=>{await i.initialize;let e=(0,R.join)(L,"tsNode"),t=await i.runScript((0,R.join)(e,"index.js"));await t.dap.setBreakpoints({source:{path:(0,R.join)(e,"matching-line.ts")},breakpoints:[{line:3,column:1}]}),t.load(),await P(t),t.assertLog({substring:!0})})}),describe("lazy async stack",()=>{g("sets stack on pause",async({r:i})=>{let e=await i.launchUrl("asyncStack.html",{showAsyncStacks:{onceBreakpointResolved:32}});e.load(),await P(e),await P(e),e.assertLog()}),g("sets eagerly on bp",async({r:i})=>{let e=await i.launchUrl("asyncStack.html",{showAsyncStacks:{onceBreakpointResolved:32}}),t={path:e.workspacePath("web/asyncStack.js")};await e.dap.setBreakpoints({source:t,breakpoints:[{line:5,column:1}]}),e.load(),await P(e),await P(e),e.assertLog()})}),g("gets correct line number with babel code (#407)",async({r:i})=>{await i.initialize;let e=(0,R.join)(L,"babelLineNumbers"),t=await i.runScript((0,R.join)(e,"compiled.js"));await t.dap.setBreakpoints({source:{path:(0,R.join)(e,"compiled.js")},breakpoints:[{line:1}]}),await t.dap.setBreakpoints({source:{path:(0,R.join)(e,"app.tsx")},breakpoints:[{line:2}]}),t.load();let{threadId:r}=t.log(await t.dap.once("stopped"));await t.dap.continue({threadId:r}),await P(t),t.assertLog({substring:!0})}),g("vue projects",async({r:i})=>{let e=await i.launchUrl("vue/index.html");await e.dap.setBreakpoints({source:{path:e.workspacePath("web/src/App.vue")},breakpoints:[{line:9,column:1}]}),e.load();let{threadId:t}=e.log(await e.dap.once("stopped"));await e.logger.logStackTrace(t),e.dap.stepIn({threadId:t}),await P(e),e.assertLog()}),describe("breakpoint placement",()=>{let i=(0,R.join)(L,"sourceMapLocations");describe("first function stmt",()=>{["tsc","babel"].forEach(e=>g(e,async({r:t})=>{await t.initialize;let r=await t.runScript((0,R.join)(i,`${e}.js`));await r.dap.setBreakpoints({source:{path:(0,R.join)(i,"test.ts")},breakpoints:[{line:4,column:1}]}),r.load(),await P(r),r.assertLog({substring:!0})}))}),describe("end function stmt",()=>{["tsc","babel"].forEach(e=>g(e,async({r:t})=>{await t.initialize;let r=await t.runScript((0,R.join)(i,`${e}.js`));await r.dap.setBreakpoints({source:{path:(0,R.join)(i,"test.ts")},breakpoints:[{line:6,column:1}]}),r.load(),await P(r),r.assertLog({substring:!0})}))})}),describe("hit count",()=>{let i=async(t,r)=>{let o=await t.launchUrlAndLoad("index.html");o.cdp.Runtime.evaluate({expression:`
        function foo() {
          for (let i = 0; i < 10; i++) {
            console.log(i);
            console.log(i);
            console.log(i);
          }
        }
      `});let{source:n}=await o.waitForSource("eval");n.path=void 0,await r(o,n),o.assertLog()},e=async t=>{let{threadId:r}=await t.dap.once("stopped"),{id:o}=(await t.dap.stackTrace({threadId:r})).stackFrames[0];return await t.logger.logEvaluateResult(await t.dap.evaluate({expression:"i",frameId:o})),t.dap.continue({threadId:r})};g("works for valid",async({r:t})=>{await i(t,async(r,o)=>{t.log(await r.dap.setBreakpoints({source:o,breakpoints:[{line:4,hitCondition:"=5"}]}));let n=r.evaluate("foo();");await e(r),await n})}),g("implies equal (#1698)",async({r:t})=>{await i(t,async(r,o)=>{t.log(await r.dap.setBreakpoints({source:o,breakpoints:[{line:4,hitCondition:"5"}]}));let n=r.evaluate("foo();");await e(r),await n})}),g("can change after set",async({r:t})=>{await i(t,async(r,o)=>{t.log(await r.dap.setBreakpoints({source:o,breakpoints:[{line:4,hitCondition:"=5"}]})),t.log(await r.dap.setBreakpoints({source:o,breakpoints:[{line:4,hitCondition:"=8"}]}));let n=r.evaluate("foo();");await e(r),await n})}),g("does not validate or hit invalid breakpoint",async({r:t})=>{await i(t,async(r,o)=>{let n=r.dap.once("output");t.log(await r.dap.setBreakpoints({source:o,breakpoints:[{line:4,hitCondition:"potato"}]})),await t.log(await n),await r.evaluate("foo();")})})}),g("user defined bp on first line with stop on entry on .ts file reports as breakpoint",async({r:i})=>{await i.initialize;let e=(0,R.join)(L,"tsNodeApp"),t=await i.runScript((0,R.join)(e,"app.ts"),{stopOnEntry:!0,smartStep:!1});await t.dap.setBreakpoints({source:{path:(0,R.join)(e,"app.ts")},breakpoints:[{line:1,column:1}]}),t.load(),await P(t),t.assertLog({substring:!0})}),g("stop on entry on .ts file reports as entry",async({r:i})=>{await i.initialize;let e=(0,R.join)(L,"tsNodeApp"),t=await i.runScript((0,R.join)(e,"app.ts"),{stopOnEntry:!0,smartStep:!1});await t.dap.setBreakpoints({source:{path:(0,R.join)(e,"app.tsx")},breakpoints:[{line:2,column:1}]}),t.load(),await P(t),t.assertLog({substring:!0})}),g("resolves sourcemaps in paths containing glob patterns (vscode#166400)",async({r:i})=>{await i.initialize;let e=(0,R.join)(L,"glob(chars)"),t=await i.runScript((0,R.join)(e,"app.ts"),{stopOnEntry:!0,smartStep:!1,outFiles:[`${e}/**/*.js`],resolveSourceMapLocations:[`${e}/**/*.js`]});await t.dap.setBreakpoints({source:{path:(0,R.join)(e,"app.ts")},breakpoints:[{line:2,column:1}]}),t.load(),await P(t),t.assertLog({substring:!0})}),g("reevaluates breakpoints when new sources come in (#600)",async({r:i})=>{let e=await i.launchUrl("unique-refresh?v=1");e.load();let{source:t}=await e.waitForSource("hello.js");e.dap.setBreakpoints({source:t,breakpoints:[{line:2,column:1}]}),await P(e),e.cdp.Page.navigate({url:i.buildUrl("unique-refresh?v=2")}),await P(e),e.assertLog()}),g("can step in when first line of code is function",async({r:i})=>{T(h,{"test.js":["function double(x) {","  x *= 2;","  return x;","}","double(2)"]});let e=await i.runScript("test.js");await e.dap.setBreakpoints({source:{path:(0,R.join)(h,"test.js")},breakpoints:[{line:5,column:0}]}),e.load();let{threadId:t}=e.log(await e.dap.once("stopped"));await e.logger.logStackTrace(t),e.dap.stepIn({threadId:t}),await P(e),e.assertLog({process:RC})}),g("normalizes webpack nul byte (#1080)",async({r:i})=>{let e=(0,R.join)(L,"webpackNulByte"),t=await i.runScript((0,R.join)(e,"build/greeter.js"),{cwd:e});await t.dap.setBreakpoints({source:{path:(0,R.join)(e,"src/#hello/world.ts")},breakpoints:[{line:1,column:0}]}),t.load(),await P(t),t.assertLog({substring:!0})}),g("excludes callers",async({r:i})=>{let e=await i.launchAndLoad("blank");e.dap.evaluate({expression:`
        function foo() {
          bar();
        }

        function baz() {
          bar();
        }

        function bar() {
          debugger;
        }

        foo();
        baz();
        foo();
        baz();
      `}),await P(e,async t=>{let{stackFrames:[r,o]}=await e.dap.stackTrace({threadId:t});await e.dap.setExcludedCallers({callers:[{caller:{line:o.line,column:o.column,source:o.source},target:{line:r.line,column:r.column,source:r.source}}]})}),await P(e),await P(e),e.assertLog()}),g("ignores source url query string (#1225)",async({r:i})=>{let e=(0,R.join)(L,"sourceQueryString"),t=await i.runScript((0,R.join)(e,"output.js"),{cwd:e});t.load(),await P(t),t.assertLog({substring:!0})}),g("toggles source map stepping",async({r:i})=>{let e=await i.launchUrl("basic.html");await e.dap.setBreakpoints({source:{path:e.workspacePath("web/basic.ts")},breakpoints:[{line:12}]}),e.load();{let o=e.dap.once("breakpoint"),{threadId:n}=e.log(await e.dap.once("stopped"));await i.log(await o,"Initial breakpoint resolution"),await e.logger.logStackTrace(n)}e.dap.setSourceMapStepping({enabled:!1});let t=e.dap.once("breakpoint"),{threadId:r}=e.log(await e.dap.once("stopped"));await i.log(await t,"Demapped breakpoint"),await e.logger.logStackTrace(r),await e.dap.stepIn({threadId:r}),await P(e),e.assertLog()}),g("prefers file uris to url (#1598)",async({r:i})=>{let e=(0,R.join)(L,"web/script.html"),t=await i.launchUrl("script.html",{file:e});i._launchUrl=Do(e);let r={path:t.workspacePath("web/script.js")};await t.dap.setBreakpoints({source:r,breakpoints:[{line:9,column:0}]}),t.load(),await P(t),await P(t),t.assertLog()}),g("stepInTargets",async({r:i})=>{let e=await i.launchUrl("stepInTargets.html"),t=e.waitForSource("stepInTargets.js");await e.load(),await e.dap.setBreakpoints({source:(await t).source,breakpoints:[{line:4,column:1},{line:5,column:1}]});let r=e.dap.evaluate({expression:"doTest()"});{let{threadId:o}=e.log(await e.dap.once("stopped")),{stackFrames:n}=await e.dap.stackTrace({threadId:o}),{targets:s}=e.log(await e.dap.stepInTargets({frameId:n[0].id}),"stepInTargets line 3");e.log(await e.dap.stepIn({threadId:o,targetId:s[0].id}),"step in new Foo()"),await P(e)}{let{threadId:o}=e.log(await e.dap.once("stopped")),{stackFrames:n}=await e.dap.stackTrace({threadId:o}),{targets:s}=e.log(await e.dap.stepInTargets({frameId:n[0].id}),"stepInTargets line 4");e.log(await e.dap.stepIn({threadId:o,targetId:s[2].id}),"step in new Foo().bar()"),await P(e)}await r,e.assertLog()}),g("does not interrupt stepOver with instrumentation breakpoint (#1556)",async({r:i})=>{async function e(o){let{threadId:n}=o.log(await o.dap.once("stopped"));return await o.logger.logStackTrace(n),o.dap.next({threadId:n})}let t=await i.launchAndLoad(`
        <script>
          function test() {
            debugger;
            f=eval(\`
              (function (a, b) {
                c = a + b;
                return c;
              });
              //# sourceURL=foo.js
              //# sourceMappingURL=foo.js.map
            \`);
            f(1, 2);
          }
        </script>`),r=t.evaluate("test()");await e(t),await e(t),await P(t),await r,t.assertLog()}),g("does not interrupt stepIn with instrumentation breakpoint (#1665)",async({r:i})=>{let e=await i.launchAndLoad(`
        <script>
          function test() {
            debugger;
            f=eval(\`
              (function (a, b) {
                c = a + b;
                return c;
              });
              //# sourceURL=foo.js
              //# sourceMappingURL=foo.js.map
            \`);
            f(1, 2);
          }
        </script>`),t=e.evaluate("test()"),r=e.log(await e.dap.once("stopped"));await e.logger.logStackTrace(r.threadId),await e.dap.stepIn({threadId:r.threadId});let o=e.log(await e.dap.once("stopped"));await e.logger.logStackTrace(o.threadId),await e.dap.stepIn({threadId:o.threadId}),await P(e),await t,e.assertLog()}),g("deals with removed execution contexts (#1582)",async({r:i})=>{let e=await i.launchUrlAndLoad("iframe-1582/index.html"),t={path:e.workspacePath("web/iframe-1582/inner.js")};e.dap.setBreakpoints({source:t,breakpoints:[{line:3}]}),await P(e,async()=>{await e.dap.evaluate({expression:'document.getElementsByTagName("IFRAME")[0].src += ""',context:"repl"})}),await P(e,async()=>{await e.dap.setBreakpoints({source:t,breakpoints:[]})}),e.dap.setBreakpoints({source:t,breakpoints:[{line:3}]}),await P(e),e.assertLog()}),g("sets file uri breakpoints predictably (#1748)",async({r:i})=>{T(h,{"pages/main.html":'<script src="../scripts/hello.js"></script>',"scripts/hello.js":"console.log(42)"});let e=(0,R.join)(h,"pages/main.html"),t=await i.launchUrl(Do(e),{url:void 0,file:e}),r={path:(0,R.join)(h,"scripts/hello.js")};await t.dap.setBreakpoints({source:r,breakpoints:[{line:1}]}),t.load(),await P(t),t.assertLog()})})});var A_={};var ET=m(()=>{"use strict";_e();describe("frames",()=>{g("hierarchy",async({r:i})=>{i.setArgs(["--site-per-process"]);let e=await i.launchUrl("frames.html");e.load();let t=(r,o)=>{let n=" ".repeat(o);e.log(`${n}${r.type()} "${r.name()}" [thread "${r.scriptUrlToUrl("")}"]${r.fileName()?" @ "+r.fileName():""}`);let s=r.children();s.sort((a,c)=>a.name().localeCompare(c.name())),s.forEach(a=>t(a,o+2))};await new Promise(r=>{i.onSessionCreated(()=>{i.binder.targetList().length===11&&r()})}),i.binder.targetList().filter(r=>!r.parent()).forEach(r=>t(r,0)),e.assertLog()})})});var Dt,AT,Ee,FT,kp,MT=m(()=>{"use strict";Dt=require("chai"),AT=require("fs"),Ee=w(require("path")),FT=require("sinon");jl();Ws();ae();Er();M();ee();N();$();cm();rt();kp={lookup:async i=>Ee.join(h,"web","looked up",i),getVueHandling:i=>i.includes("lookup.vue")?1:i.includes("omit.vue")?2:0};describe("BrowserPathResolver",()=>{let i;before(()=>Xp(!1)),beforeEach(()=>{i=new se(AT.promises),(0,FT.stub)(i,"exists").callsFake(t=>{switch(t){case"c:\\Users\\user\\Source\\Repos\\Angular Project\\ClientApp\\src\\app\\app.component.html":return Promise.resolve(!0);case"c:\\Users\\user\\Source\\Repos\\Angular Project\\wwwroot\\src\\app\\app.component.html":return Promise.resolve(!1);default:return Promise.resolve(!1)}})}),after(()=>Qp()),describe("vue",()=>{let t=new yr(kp,i,{workspaceFolder:h,pathMapping:{"/":Ee.join(h,"web")},clientID:"vscode",baseUrl:"http://localhost:1234/",sourceMapOverrides:_o(Ee.join(h,"web")),localRoot:null,remoteRoot:null,resolveSourceMapLocations:null,remoteFilePrefix:void 0},E.null),r={metadata:{compiledPath:Ee.join(h,"web","bundle.js"),sourceMapUrl:Ee.join(h,"web","bundle.map.js")}};it("looks up vue paths",async()=>{(0,Dt.expect)(await t.urlToAbsolutePath({url:"lookup.vue",map:r})).to.equal(fe(Ee.join(h,"web","looked up","lookup.vue")))}),it("omits vue paths",async()=>{(0,Dt.expect)(await t.urlToAbsolutePath({url:"omit.vue",map:r})).to.be.undefined}),it("uses default handling",async()=>{(0,Dt.expect)(await t.urlToAbsolutePath({url:"whatever.vue",map:r})).to.equal(fe(Ee.join(h,"web","whatever.vue")))}),describe("VueFileMapper",()=>{let o=new Li(new Ht({rootPath:h,patterns:["**/*.vue"]}),{streamChildrenWithSourcemaps(){return Promise.resolve({values:[],state:void 0})},streamAllChildren(n,s){return Promise.all([s(Ee.join(h,"web","a.vue")),s(Ee.join(h,"web","b.vue"))])}});it("has correct vue handling",()=>{let n=new Map([["webpack:///hello.vue?f00d",1],["webpack:///./components/hello.vue?f00d",2],["webpack:///unrelated.js",0]]);for(let[s,a]of n.entries())(0,Dt.expect)(o.getVueHandling(s)).to.equal(a)}),it("maps basenames to disk",async()=>{(0,Dt.expect)(await o.lookup("webpack:///a.vue?f00d")).to.equal(Ee.join(h,"web","a.vue")),(0,Dt.expect)(await o.lookup("webpack:///q.vue?f00d")).to.be.undefined,(0,Dt.expect)(await o.lookup("webpack:///unrelated.js")).to.be.undefined})})});class e{exists(r){switch(r){case"c:\\Users\\user\\Source\\Repos\\Angular Project\\ClientApp\\src\\app\\app.component.html":return Promise.resolve(!0);case"c:\\Users\\user\\Source\\Repos\\Angular Project\\wwwroot\\src\\app\\app.component.html":return Promise.resolve(!1);default:throw Error(`Unknown path ${r}`)}}}describe("absolutePathToUrl",()=>{let t=(r={})=>new yr(kp,i,{workspaceFolder:h,pathMapping:{"/":Ee.join(h,"web"),"/sibling":Ee.join(h,"sibling-dir"),"https://example.com/abs":Ee.join(h,"abs")},clientID:"vscode",baseUrl:"http://localhost:1234/",sourceMapOverrides:_o(Ee.join(h,"web")),localRoot:null,remoteRoot:null,resolveSourceMapLocations:null,remoteFilePrefix:void 0,...r},E.null);it("selects webRoot correctly",()=>{let r="http://localhost:1234/foo/bar(\\.html)?";(0,Dt.expect)(t().absolutePathToUrlRegexp(Ee.join(h,"web","foo","bar.html"))).to.equal(Ge(r,[0,r.length-9]));let o="http://localhost:1234/sibling/foo/bar(\\.html)?";(0,Dt.expect)(t().absolutePathToUrlRegexp(Ee.join(h,"sibling-dir","foo","bar.html"))).to.equal(Ge(o,[0,o.length-9]))}),it("falls back if not in any webroot",()=>{let r="http://localhost:1234/../foo/bar(\\.html)?";(0,Dt.expect)(t().absolutePathToUrlRegexp(Ee.join(h,"foo","bar.html"))).to.equal(Ge(r,[0,r.length-9]))}),it("matches any path if no baseUrl is present",()=>{let r=Ee.join(h,"web","foo.js");(0,Dt.expect)(t({baseUrl:void 0}).absolutePathToUrlRegexp(r)).to.equal(Ge(W(r))+"|[hH][tT][tT][pP][sS]?:\\/\\/[^\\/]+\\/[fF][oO][oO]\\.[jJ][sS]($|\\?)")}),it("does not mangle absolute pathmapping",()=>{(0,Dt.expect)(t({baseUrl:void 0}).absolutePathToUrlRegexp(Ee.join(h,"abs","x.js"))).to.equal(Ge("https://example.com/abs/x.js"))}),it("allows overriding resolution of workspaceFolder (for #1308)",()=>{(0,Dt.expect)(t({pathMapping:{"/":Ee.join(h,"web"),"/override":Ee.join(h,"web")}}).absolutePathToUrlRegexp(Ee.join(h,"web","x.js"))).to.equal(Ge("http://localhost:1234/override/x.js"))})}),[["visualstudio","ClientApp"],["vscode","wwwroot"]].forEach(([t,r])=>{it(`returns ${r} for ${t} if the webroot path doesn't exist and the modified path does`,async()=>{let o="c:\\Users\\user\\Source\\Repos\\Angular Project\\wwwroot",n=new yr(kp,new e,{workspaceFolder:h,pathMapping:{"/":o},clientID:t,baseUrl:"http://localhost:60318/",sourceMapOverrides:_o(o),localRoot:null,remoteRoot:null,resolveSourceMapLocations:null,remoteFilePrefix:void 0},await E.test()),s="webpack:///src/app/app.component.html",a=await n.urlToAbsolutePath({url:s,map:Xo({metadata:{sourceMapUrl:"",compiledPath:"x"}})});(0,Dt.expect)(a).to.equal(`c:\\Users\\user\\Source\\Repos\\Angular Project\\${r}\\src\\app\\app.component.html`)})})})});var F_={};function NT(i){return new Da(kp,new se(OT.promises),{workspaceFolder:h,pathMapping:{"/":xp.default.join(h,"web")},clientID:"vscode",baseUrl:"http://localhost:1234/",sourceMapOverrides:_o(xp.default.join(h,"web")),localRoot:null,remoteRoot:null,resolveSourceMapLocations:null,remoteFilePrefix:i},E.null)}var bg,OT,xp,jT,BT,UT=m(()=>{"use strict";bg=require("chai"),OT=require("fs"),xp=w(require("path"));ae();Er();N();$();Oh();MT();rt();jT=process.platform==="win32",BT=jT?"C:":"/c";describe("BlazorSourcePathResolver.absolutePathToUrlRegexp",()=>{it("generates the correct regexp in local scenarios",async()=>{let i=xp.default.join(BT,"Users","digeff","source","repos","MyBlazorApp","MyBlazorApp","Pages","Counter.razor"),e=await NT(void 0).absolutePathToUrlRegexp(i);Xc()?(0,bg.expect)(e).to.equal("file:\\/\\/\\/c\\/Users\\/digeff\\/source\\/repos\\/MyBlazorApp\\/MyBlazorApp\\/Pages\\/Counter\\.razor($|\\?)|\\/c\\/Users\\/digeff\\/source\\/repos\\/MyBlazorApp\\/MyBlazorApp\\/Pages\\/Counter\\.razor($|\\?)|http:\\/\\/localhost:1234\\/\\.\\.\\/\\.\\.\\/\\.\\.\\/\\.\\.\\/\\.\\.\\/\\.\\.\\/\\.\\.\\/c\\/Users\\/digeff\\/source\\/repos\\/MyBlazorApp\\/MyBlazorApp\\/Pages\\/Counter\\.razor($|\\?)"):(0,bg.expect)(e).to.contain("[fF][iI][lL][eE]:\\/\\/\\/[cC]:\\/[uU][sS][eE][rR][sS]\\/[dD][iI][gG][eE][fF][fF]\\/[sS][oO][uU][rR][cC][eE]\\/[rR][eE][pP][oO][sS]\\/[mM][yY][bB][lL][aA][zZ][oO][rR][aA][pP][pP]\\/[mM][yY][bB][lL][aA][zZ][oO][rR][aA][pP][pP]\\/[pP][aA][gG][eE][sS]\\/[cC][oO][uU][nN][tT][eE][rR]\\.[rR][aA][zZ][oO][rR]($|\\?)|[cC]:\\\\[uU][sS][eE][rR][sS]\\\\[dD][iI][gG][eE][fF][fF]\\\\[sS][oO][uU][rR][cC][eE]\\\\[rR][eE][pP][oO][sS]\\\\[mM][yY][bB][lL][aA][zZ][oO][rR][aA][pP][pP]\\\\[mM][yY][bB][lL][aA][zZ][oO][rR][aA][pP][pP]\\\\[pP][aA][gG][eE][sS]\\\\[cC][oO][uU][nN][tT][eE][rR]\\.[rR][aA][zZ][oO][rR]($|\\?)")}),jT&&it("generates the correct regexp in codespace scenarios",async()=>{let i=xp.default.join(BT,"Users","digeff","AppData","Local","Temp","2689D069D40B1EFF4B570B2DB12506073980","5~~"),e=`${i}\\C$\\workspace\\NewBlazorWASM\\NewBlazorWASM\\Pages\\Counter.razor`,t=await NT(i).absolutePathToUrlRegexp(e);(0,bg.expect)(t).to.equal("dotnet://.*\\.dll/[cC]\\/[wW][oO][rR][kK][sS][pP][aA][cC][eE]\\/[nN][eE][wW][bB][lL][aA][zZ][oO][rR][wW][aA][sS][mM]\\/[nN][eE][wW][bB][lL][aA][zZ][oO][rR][wW][aA][sS][mM]\\/[pP][aA][gG][eE][sS]\\/[cC][oO][uU][nN][tT][eE][rR]\\.[rR][aA][zZ][oO][rR]($|\\?)")})})});var M_={};var Cp,WT=m(()=>{"use strict";Cp=require("chai");U();_e();describe("evaluate",()=>{g("default",async({r:e})=>{let t=await e.launchUrlAndLoad("index.html");await t.logger.evaluateAndLog("42"),t.log(""),await t.logger.evaluateAndLog("'foo'"),t.log(""),await t.logger.evaluateAndLog("1234567890n"),t.log(""),await t.logger.evaluateAndLog("throw new Error('foo')"),t.log(""),await t.logger.evaluateAndLog("throw {foo: 3, bar: 'baz'};"),t.log(""),await t.logger.evaluateAndLog("throw 42;"),t.log(""),await t.logger.evaluateAndLog("{foo: 3}"),t.log(""),await t.logger.evaluateAndLog("baz();"),t.log(""),await t.logger.evaluateAndLog("new Uint8Array([1, 2, 3]);"),t.log(""),await t.logger.evaluateAndLog("new Uint8Array([1, 2, 3]).buffer;"),t.log(""),await t.logger.evaluateAndLog("new Proxy({ a: 1 }, { get: () => 2 });"),t.log(""),await t.logger.evaluateAndLog("Object.create({ set foo(x) {} })",{depth:2}),t.log(""),await t.logger.evaluateAndLog("Object.create({ get foo() { return 42 } })",{depth:2}),t.log(""),await t.logger.evaluateAndLog("Object.create({ get foo() { throw 'wat'; } })",{depth:2}),t.log(""),await t.logger.evaluateAndLog("Object.create({ get [Symbol.toStringTag]() { return 42 } })",{depth:2}),t.log(""),t.evaluate("setTimeout(() => { throw new Error('bar')}, 0)"),await t.logger.logOutput(await t.dap.once("output")),t.log(""),t.dap.evaluate({expression:"setTimeout(() => { throw new Error('baz')}, 0)"}),await t.logger.logOutput(await t.dap.once("output")),t.log(""),await t.addScriptTag("browserify/bundle.js"),await t.logger.evaluateAndLog("window.throwError('error1')"),t.log(""),await t.logger.evaluateAndLog("window.throwValue({foo: 3, bar: 'baz'})"),t.log(""),t.dap.evaluate({expression:"setTimeout(() => { window.throwError('error2')}, 0)"}),await t.logger.logOutput(await t.dap.once("output")),t.log(""),t.assertLog()}),g("repl",async({r:e})=>{let t=await e.launchUrlAndLoad("index.html");await t.logger.evaluateAndLog("42",void 0,"repl"),t.log(""),await t.logger.evaluateAndLog("'foo'",void 0,"repl"),t.log(""),await t.logger.evaluateAndLog("1234567890n",void 0,"repl"),t.log(""),await t.logger.evaluateAndLog("throw new Error('foo')",void 0,"repl"),t.log(""),await t.logger.evaluateAndLog("throw {foo: 3, bar: 'baz'};",void 0,"repl"),t.log(""),await t.logger.evaluateAndLog("throw 42;",void 0,"repl"),t.log(""),await t.logger.evaluateAndLog("{foo: 3}",void 0,"repl"),t.log(""),await t.logger.evaluateAndLog("baz();",void 0,"repl"),t.log(""),await t.logger.evaluateAndLog("new Map([['hello', function() { return 'world' }]])",void 0,"repl"),t.log("");let[,r]=await Promise.all([t.logger.evaluateAndLog("setTimeout(() => { throw new Error('bar')}, 0); 42",void 0,"repl"),t.dap.once("output")]);await t.logger.logOutput(r),t.log("");let[,o]=await Promise.all([t.logger.evaluateAndLog("setTimeout(() => { throw new Error('baz')}, 0); 42",void 0,"repl"),t.dap.once("output")]);await t.logger.logOutput(o),t.log(""),await t.addScriptTag("browserify/bundle.js"),await t.logger.evaluateAndLog("window.throwError('error1')",void 0,"repl"),t.log(""),await t.logger.evaluateAndLog("window.throwValue({foo: 3, bar: 'baz'})",void 0,"repl"),t.log("");let[,n]=await Promise.all([t.logger.evaluateAndLog("setTimeout(() => { window.throwError('error2')}, 0); 42",void 0,"repl"),t.dap.once("output")]);await t.logger.logOutput(n),t.log(""),await t.logger.evaluateAndLog("new Uint8Array(100_000).fill(0)",{logInternalInfo:!0,depth:0},"repl"),t.log(""),t.assertLog()}),g("valueFormatter",async({r:e})=>{let t={hex:!0},r=await e.launchUrlAndLoad("index.html");await r.logger.evaluateAndLog("42",{format:t}),r.log(""),await r.logger.evaluateAndLog("123567891235678912356789123567891235678912356789n",{format:t}),r.log(""),await r.logger.evaluateAndLog("'hello world'",{format:t}),r.log(""),await r.logger.evaluateAndLog("({ a: 'hello', b: 42, c: true })",{format:t}),r.log(""),r.assertLog()});let i={"123n":"123n",NaN:"NaN",'{foo: "bar", baz: { a: [1, 2, 3, 4, 5, 6, 7, 8, 9], b: 123n, "complex key": true }}':`{
  foo: "bar",
  baz: {
    a: [
      1,
      2,
      3,
      4,
      5,
      6,
      7,
      8,
      9,
    ],
    b: 123n,
    "complex key": true,
  },
}`,"{\n  double(x) {\n    return x * 2;\n  },\n  triple: x => {\n    return x * 3\n  }\n}":`{
  double: function(x) {
    return x * 2;
  },
  triple: x => {
    return x * 3
  },
}`,'function hello() { return "world" }':'function hello() { return "world" }',"(() => { const n = { foo: true }; n.recurse = n; return n })()":`{
  foo: true,
  recurse: [Circular],
}`,"new Uint8Array([1, 2, 3])":"new Uint8Array([1, 2, 3])","new Uint8Array([1, 2, 3]).buffer":"new Uint8Array([1, 2, 3]).buffer","new Float32Array([1.5, 2.5, 3.5])":"new Float32Array([1.5, 2.5, 3.5])","1n << 100n":"1267650600228229401496703205376n","new Date(1665007127286)":'"2022-10-05T21:58:47.286Z"','(() => { const node = document.createElement("div"); node.innerText = "hi"; return node })()':"<div>hi</div>"};g("copy via function",async({r:e})=>{let t=await e.launchAndLoad("blank");t.dap.evaluate({expression:'var x = "hello"; copy(x)'}),(0,Cp.expect)((await t.dap.once("copyRequested")).text).to.equal("hello");for(let[r,o]of Object.entries(i)){t.dap.evaluate({expression:`copy(${r})`});let n=await t.dap.once("copyRequested");(0,Cp.expect)(n.text).to.equal(o,r)}}),g("copy via evaluate context",async({r:e})=>{let t=await e.launchAndLoad("blank");for(let[r,o]of Object.entries(i)){let n=await t.dap.evaluate({expression:r,context:"clipboard"});(0,Cp.expect)(n.result).to.equal(o,r)}}),g("inspect",async({r:e})=>{let t=await e.launchAndLoad("blank");t.dap.evaluate({expression:`function foo() {}; inspect(foo)
//# sourceURL=test.js`}),t.log(await t.dap.once("revealLocationRequested")),t.assertLog()}),g("queryObjects",async({r:e})=>{let t=await e.launchAndLoad("blank");await t.dap.evaluate({expression:`
      class Foo {
        constructor(value) {
          this.value = value;
        }
      }
      var foo1 = new Foo(1);
      var foo2 = new Foo(2);
    `}),t.dap.evaluate({expression:"queryObjects(Foo)"}),await t.logger.logOutput(await t.dap.once("output")),t.assertLog()}),g("topLevelAwait",async({r:e})=>{let t=await e.launchAndLoad(`
      <script>
        function foo(x) {
          return x;
        }

        function koo() {
          return Promise.resolve(4);
        }
      </script>
    `),r=["await Promise.resolve(1)","{a:await Promise.resolve(1)}","4","$_","let {a,b} = await Promise.resolve({a: 1, b:2}), f = 5;","a","b","let c = await Promise.resolve(2)","c","let d;","d","let [i,{abc:{k}}] = [0,{abc:{k:1}}];","i","k","var l = await Promise.resolve(2);","l","foo(await koo());","$_","const m = foo(await koo());","m",`const n = foo(await
koo());`,"n","`status: ${(await Promise.resolve({status:200})).status}`","for (let i = 0; i < 2; ++i) await i","for (let i = 0; i < 2; ++i) { await i }","await 0","await 0;function foo(){}","foo","class Foo{}; await 1;","Foo","await 0;function* gen(){}","for (var i = 0; i < 10; ++i) { await i; }","i","for (let j = 0; j < 5; ++j) { await j; }","j","gen","await 5; return 42;","let o = await 1, p","p","let q = 1, s = await 2","s","await {...{foo: 42}}"];for(let o of r)t.log(`Evaluating: '${o}'`),t.logger.logEvaluateResult(await t.dap.evaluate({expression:o,context:"repl"}),{depth:0});t.assertLog()}),g("escapes strings",async({r:e})=>{let t=await e.launchAndLoad("blank");for(let r of["watch","hover","repl"])t.log(`context=${r}`),await t.logger.evaluateAndLog(JSON.stringify(`1
2\r3	\\4`),{depth:0},r);t.assertLog({customAssert:r=>(0,Cp.expect)(r).to.equal(["context=watch","result: '1\\n2\\r3\\t\\\\4'","context=hover","result: '1\\n2\\r3\\t\\\\4'","context=repl",`
result: '1
2\r3	\\4'`,""].join(`
`))})}),g.skip("output slots",async({r:e})=>{let t=await e.launchAndLoad("blank"),r=await t.dap.evaluate({expression:"let i = 0; console.log(++i); ++i",context:"repl"}),o=await t.dap.once("output"),n=await t.dap.once("output");await t.logger.logEvaluateResult(r),await t.logger.logOutput(o),await t.logger.logOutput(n),t.assertLog()}),g.skip("output slots 2",async({r:e})=>{let t=await e.launchAndLoad("blank"),r=await t.dap.evaluate({expression:`
      let i = 0;
      setTimeout(() => {
        console.log(++i);
        throw {foo: ++i};
      }, 0);
      ++i
    `,context:"repl"}),o=await t.dap.once("output"),n=await t.dap.once("output"),s=await t.dap.once("output");await t.logger.logEvaluateResult(r),await t.logger.logOutput(o),await t.logger.logOutput(n),await t.logger.logOutput(s),t.assertLog()}),g("selected context",async({r:e})=>{let t=await e.launchUrlAndLoad("worker.html");t.log("--- Evaluating in page"),t.log("Pausing..."),t.dap.evaluate({expression:"window.w.postMessage('pause');",context:"repl"});let{threadId:r}=await t.dap.once("stopped");t.log("Paused");let{id:o}=(await t.dap.stackTrace({threadId:r})).stackFrames[0];await t.logger.logEvaluateResult(await t.dap.evaluate({expression:"isWorker",frameId:o}),{depth:0}),t.dap.continue({threadId:r}),await t.dap.once("continued"),t.log("Resumed"),t.log("--- Evaluating in worker"),t.dap.evaluate({expression:"window.w.postMessage('pauseWorker');",context:"repl"});let n=await e.worker(),{threadId:s}=await n.dap.once("stopped");t.log("Paused");let{id:a}=(await n.dap.stackTrace({threadId:s})).stackFrames[0];await n.logger.logEvaluateResult(await n.dap.evaluate({expression:"isWorker",frameId:a}),{depth:0}),n.dap.continue({threadId:s}),await n.dap.once("continued"),t.log("Resumed"),t.assertLog()}),g("cd",async({r:e})=>{let t=await e.launchUrlAndLoad("index.html");async function r(o){let n=await t.dap.completions(o),s=o.text.substring(0,o.column-1)+"|"+o.text.substring(o.column-1);t.log(n.targets.filter(a=>a.label.startsWith("cd")),`"${s}": `)}await x(50),await r({line:1,column:1,text:""}),await r({line:1,column:3,text:"cd"}),await r({line:1,column:4,text:"cd "}),await r({line:1,column:5,text:"cd t"}),await r({line:1,column:5,text:"cd h"}),await r({line:1,column:2,text:"cd"}),await r({line:1,column:3,text:"co"}),t.assertLog()}),g("returnValue",async({r:e})=>{let t=await e.launchAndLoad("blank"),r=async(o,n="$returnValue")=>{t.dap.evaluate({expression:`(function () {
          debugger;
          return ${o};
        })();`});let{threadId:s}=await t.dap.once("stopped");await t.dap.next({threadId:s}),await t.dap.once("stopped"),await t.dap.next({threadId:s}),await t.dap.once("stopped");let a=(await t.dap.stackTrace({threadId:s})).stackFrames[0].id;t.log(`return ${o}:
`),await t.logger.evaluateAndLog(n,{params:{frameId:a}}),await t.dap.continue({threadId:s})};await r("42"),await r("{ a: { b: true } }"),await r("undefined"),e.assertLog()}),g("supports bigint map keys (#1277)",async({r:e})=>{await(await e.launchUrlAndLoad("index.html")).logger.evaluateAndLog("new Map([[1n, 'one'], [2n, 'two']])"),e.assertLog()})})});var N_={};var wg,So,VT=m(()=>{"use strict";wg=require("chai"),So=require("path");Ur();rt();_e();describe("sources",()=>{async function i(e,t,r){e.log(`
Source event for `+r),e.log(t);let o=await e.dap.source({sourceReference:t.source.sourceReference,source:{path:t.source.path,sourceReference:t.source.sourceReference}});e.log(o.content),e.log("---------")}g("basic sources",async({r:e})=>{let t=await e.launchUrl("inlinescript.html");t.load(),await i(t,await t.waitForSource("inline"),"inline"),t.addScriptTag("empty.js"),await i(t,await t.waitForSource("empty.js"),"empty.js"),t.evaluate("17","doesnotexist.js"),await i(t,await t.waitForSource("doesnotexist"),"does not exist"),t.addScriptTag("dir/helloworld.js"),await i(t,await t.waitForSource("helloworld"),"dir/helloworld"),t.evaluate("42",""),await i(t,await t.waitForSource("eval"),"eval"),t.log(await t.dap.loadedSources({}),`
Loaded sources: `),t.assertLog()}),g("updated content",async({r:e})=>{let t=await e.launchUrlAndLoad("index.html");t.cdp.Runtime.evaluate({expression:"content1//# sourceURL=test.js"}),await i(t,await t.waitForSource("test"),"test.js"),t.cdp.Runtime.evaluate({expression:"content2//# sourceURL=test.js"}),await i(t,await t.waitForSource("test"),"test.js updated"),t.log(await t.dap.loadedSources({}),`
Loaded sources: `),t.assertLog()}),g("basic source map",async({r:e})=>{let t=await e.launchUrlAndLoad("index.html");t.addScriptTag("browserify/bundle.js");let r=await Promise.all([t.waitForSource("index.ts"),t.waitForSource("module1.ts"),t.waitForSource("module2.ts")]);for(let o of r)await i(t,o,"");t.assertLog()}),g("waiting for source map",async({r:e})=>{let t=await e.launchUrlAndLoad("index.html");await t.addScriptTag("browserify/bundle.js"),t.dap.evaluate({expression:"setTimeout(() => { window.throwError('error2')}, 0)"}),await t.logger.logOutput(await t.dap.once("output")),t.assertLog()}),g.skip("waiting for source map failure",async({r:e})=>{let t=await e.launchUrlAndLoad("index.html");t.adapter.sourceContainer.setSourceMapTimeouts({load:2e3,resolveLocation:0,output:0,sourceMapMinPause:0,sourceMapCumulativePause:0}),await t.addScriptTag("browserify/bundle.js"),t.dap.evaluate({expression:"setTimeout(() => { window.throwError('error2')}, 0)"}),await t.logger.logOutput(await t.dap.once("output")),t.assertLog()}),g("supports nested sourcemaps (#1390)",async({r:e})=>{await e.initialize;let t=(0,So.join)(L,"nestedSourceMaps"),r=await e.runScript((0,So.join)(t,"a/main.bundle.js"),{cwd:t});await r.dap.setBreakpoints({source:{path:(0,So.join)(L,"nestedSourceMaps","b","lib.js")},breakpoints:[{line:2,column:1}]}),r.load(),await P(r),r.assertLog({substring:!0})}),g("works with relative webpack sourcemaps (#479)",async({r:e})=>{let t=await e.launchUrl("webpack/relative-paths.html");await t.dap.setBreakpoints({source:{path:t.workspacePath("greet.js")},breakpoints:[{line:2,column:1}]}),await t.dap.setBreakpoints({source:{path:t.workspacePath("web/webpack/farewell.js")},breakpoints:[{line:2,column:1}]}),t.load(),await P(t),await P(t),t.assertLog()}),g("allows overrides for relative webpack paths (#479)",async({r:e})=>{let t=await e.launchUrl("webpack/relative-paths.html",{sourceMapPathOverrides:{"webpack:///./*":"${webRoot}/*","webpack:///../*":"${webRoot}/was-nested/*"}});await t.dap.setBreakpoints({source:{path:t.workspacePath("web/was-nested/greet.js")},breakpoints:[{line:2,column:1}]}),await t.dap.setBreakpoints({source:{path:t.workspacePath("web/webpack/farewell.js")},breakpoints:[{line:2,column:1}]}),t.load(),await P(t),await P(t),t.assertLog()}),g("url and hash",async({r:e})=>{let t=await e.launchUrlAndLoad("index.html");t.cdp.Runtime.evaluate({expression:`a
//# sourceURL=foo.js`}),await i(t,await t.waitForSource("foo.js"),"foo.js"),t.cdp.Runtime.evaluate({expression:`b
//# sourceURL=foo.js`}),await i(t,await t.waitForSource("foo.js"),"foo.js"),await t.cdp.Runtime.evaluate({expression:`a
//# sourceURL=foo.js`}),await t.cdp.Runtime.evaluate({expression:`b
//# sourceURL=foo.js`}),t.addScriptTag("empty.js"),await i(t,await t.waitForSource("empty.js"),"empty.js");let r=t.workspacePath("web/empty2.js");t.adapter.sourceContainer.setFileContentOverrideForTest(r,"123"),t.addScriptTag("empty2.js"),await i(t,await t.waitForSource("empty2.js"),"empty2.js"),t.log(await t.dap.loadedSources({}),`
Loaded sources: `),t.assertLog()}),g("allows module wrapper in node code",async({r:e})=>{let t=await e.runScript((0,So.join)(L,"moduleWrapper","index.js"));t.load();let r=await t.waitForSource("moduleWrapper/test.js");(0,wg.expect)(r.source.sourceReference).to.equal(0)}),g("verifies content when enableContentValidation=true",async({r:e})=>{let t=await e.runScript((0,So.join)(L,"moduleWrapper","customWrapper.js"));t.load();let r=await t.waitForSource("moduleWrapper/test.js");(0,wg.expect)(r.source.sourceReference).to.be.greaterThan(0)}),g("does not verify content when enableContentValidation=false",async({r:e})=>{let t=await e.runScript((0,So.join)(L,"moduleWrapper","customWrapper.js"),{enableContentValidation:!1});t.load();let r=await t.waitForSource("moduleWrapper/test.js");(0,wg.expect)(r.source.sourceReference).to.equal(0)}),g("allows shebang in node code",async({r:e})=>{T(h,{index:'require("./shebang-lf"); require("./shebang-crlf"); debugger;',"shebang-lf":`#!/bin/node
console.log("hello world")`,"shebang-crlf":`#!/bin/node\r
console.log("hello world")`});let t=await e.runScript((0,So.join)(h,"index"));t.load();let r=t.waitForSource("shebang-lf"),o=t.waitForSource("shebang-crlf");t.log(await r,void 0,[]),t.log(await o,void 0,[]),t.assertLog()}),g("removes any query from node paths (#529)",async({r:e})=>{let t=await e.runScript((0,So.join)(L,"simpleNode","simpleWebpackWithQuery.js"),{cwd:(0,So.join)(L,"simpleNode")});t.load(),t.log(await t.waitForSource("simpleWebpackWithQuery.ts"),void 0,[]),t.assertLog()}),describe("sourcemap error handling",()=>{g("logs initial parse errors",async({r:e})=>{let t=await e.launchUrlAndLoad("index.html"),r=t.dap.once("output",o=>o.category==="stderr");await t.evaluate(`//# sourceMappingURL=data:application/json;charset=utf-8;base64,ZGV2cw==
`),await t.logger.logOutput(await r),t.assertLog()}),g("logs not found errors",async({r:e})=>{let t=await e.launchUrlAndLoad("index.html"),r=t.dap.once("output",o=>o.category==="stderr");await t.evaluate(`//# sourceMappingURL=does-not-exist.js.map
`),await t.logger.logOutput(await r),t.assertLog()})})})});var B_={};var $T=m(()=>{"use strict";U();rt();_e();describe("stacks",()=>{async function i(e,t){let r=await e.dap.once("stopped");await e.logger.logStackTrace(r.threadId,t?1/0:0),await e.dap.continue({threadId:r.threadId})}g("eval in anonymous",async({r:e})=>{let t=await e.launchAndLoad("blank");t.cdp.Runtime.evaluate({expression:`

debugger;
//# sourceURL=eval.js`}),await i(t,!1),t.assertLog()}),g("anonymous initial script",async({r:e})=>{let t=await e.launch("<script>debugger;</script>");t.load(),await i(t,!1),t.assertLog()}),g("anonymous scopes",async({r:e})=>{let t=await e.launchAndLoad("blank");t.cdp.Runtime.evaluate({expression:`
      function paused() {
        let y = 'paused';
        debugger;
      }
      function chain(n) {
        if (!n)
          return paused;
        return function chained() {
          let x = 'x' + n;
          chain(n - 1)();
        };
      }
      chain(3)();
    `}),await i(t,!0),t.assertLog()}),g("async",async({r:e})=>{let t=await e.launchAndLoad("blank");t.cdp.Runtime.evaluate({expression:`
      function foo(n) {
        if (!n) {
          debugger;
          return;
        }
        setTimeout(() => {
          bar(n - 1);
        }, 0);
      }
      async function bar(n) {
        await Promise.resolve(15);
        await foo(n);
      }
      bar(1);
    `}),await i(t,!0),t.assertLog()}),g("async disables",async({r:e})=>{let t=await e.launchAndLoad("blank",{showAsyncStacks:!1});t.cdp.Runtime.evaluate({expression:`
      function foo(n) {
        if (!n) {
          debugger;
          return;
        }
        setTimeout(() => {
          bar(n - 1);
        }, 0);
      }
      async function bar(n) {
        await Promise.resolve(15);
        await foo(n);
      }
      bar(1);
    `}),await i(t,!0),t.assertLog()}),g("cross target",async({r:e})=>{let t=await e.launchUrlAndLoad("worker.html");t.cdp.Runtime.evaluate({expression:"window.w.postMessage('pause')"}),await i(t,!0),t.assertLog()}),g("source map",async({r:e})=>{let t=await e.launchUrlAndLoad("index.html");t.addScriptTag("browserify/pause.js"),await i(t,!0),t.assertLog()}),describe("smartStep",()=>{let t="//# sourceMappingURL=data:application/json;charset=utf-8;base64,"+Buffer.from(JSON.stringify({version:3,file:"source.js",sourceRoot:"",sources:["source.ts"],mappings:""})).toString("base64");g("simple stepping",async({r})=>{let o=await r.launchUrlAndLoad("index.html");o.addScriptTag("smartStep/async.js");let{threadId:n}=await o.dap.once("stopped");await o.dap.next({threadId:n}),await o.dap.once("stopped"),await o.logger.logStackTrace(n),await o.dap.stepIn({threadId:n}),await o.dap.stepIn({threadId:n}),await i(o,!1),o.assertLog()}),g("remembers step direction out",async({r})=>{let o=await r.launchUrlAndLoad("index.html");await o.addScriptTag("smartStep/directional.js"),await o.waitForSource("directional.ts"),await o.dap.setBreakpoints({source:{path:o.workspacePath("web/smartStep/directional.ts")},breakpoints:[{line:2,column:0}]});let n=o.evaluate(`doCall(() => { mapped1(); mapped2(); })
${t}`),{threadId:s}=await o.dap.once("stopped");await o.logger.logStackTrace(s),await o.dap.stepOut({threadId:s}),o.logger.logAsConsole(`
# stepping out
`),await o.dap.once("stopped"),await o.logger.logStackTrace(s),await o.dap.continue({threadId:s}),await n,o.assertLog()}),g("remembers step direction in",async({r})=>{let o=await r.launchUrlAndLoad("index.html");await o.addScriptTag("smartStep/directional.js"),await o.waitForSource("directional.ts"),await o.dap.setBreakpoints({source:{path:o.workspacePath("web/smartStep/directional.ts")},breakpoints:[{line:2,column:0}]});let n=o.evaluate(`doCall(() => { mapped1(); mapped2(); })
${t}`),{threadId:s}=await o.dap.once("stopped");await o.logger.logStackTrace(s);for(let a=0;a<2;a++)await o.dap.stepIn({threadId:s}),await o.dap.once("stopped");o.logger.logAsConsole(`
# stepping in
`),await o.logger.logStackTrace(s),await o.dap.continue({threadId:s}),await n,o.assertLog()}),g("does not smart step on exception breakpoints",async({r})=>{let o=await r.launchUrlAndLoad("index.html");await o.dap.setExceptionBreakpoints({filters:["uncaught","all"]}),o.addScriptTag("smartStep/exceptionBp.js"),await i(o,!1),o.assertLog()}),g("does not smart step manual breakpoints",async({r})=>{let o=await r.launchUrlAndLoad("index.html");await o.dap.setBreakpoints({source:{path:o.workspacePath("web/smartStep/exceptionBp.js")},breakpoints:[{line:9,column:0}]}),o.addScriptTag("smartStep/exceptionBp.js"),await i(o,!1),o.assertLog()}),g("does not step in sources missing maps",async({r})=>{let o=await r.launchUrlAndLoad("index.html");await o.addScriptTag("smartStep/missingMap.js");let n=o.evaluate(`debugger; doCallback(() => {
        console.log("hi");
      });`),s=(await o.dap.once("stopped")).threadId;await o.dap.stepIn({threadId:s}),s=(await o.dap.once("stopped")).threadId,await o.dap.stepIn({threadId:s}),await P(o),await n,o.assertLog()})}),g("return value",async({r:e})=>{let t=await e.launchAndLoad("blank");t.cdp.Runtime.evaluate({expression:`
      function foo() {
        debugger;
        return 42;
      }
      foo();
    `});let{threadId:r}=await t.dap.once("stopped");t.dap.next({threadId:r}),await t.dap.once("stopped"),t.dap.next({threadId:r}),await i(t,!0),t.assertLog()}),describe("skipFiles",()=>{async function e(t,r){let o=await t.dap.once("stopped");return await x(200),await t.logger.logStackTrace(o.threadId,r?1/0:0),o}g("single authored js",async({r:t})=>{let r=await t.launchUrl("script.html",{skipFiles:["**/script.js"]}),o={path:r.workspacePath("web/script.js")};await r.dap.setBreakpoints({source:o,breakpoints:[{line:6,column:0}]}),r.load(),await e(r,!1),r.assertLog()}),g("single compiled js",async({r:t})=>{let r=await t.launchUrlAndLoad("basic.html",{skipFiles:["**/basic.js"]}),o={path:r.workspacePath("web/basic.js")};await r.dap.setBreakpoints({source:o,breakpoints:[{line:3,column:0}]}),r.load(),await e(r,!1),r.assertLog()}),g("multiple authored ts to js",async({r:t})=>{let r=await t.launchUrlAndLoad("browserify/browserify.html",{skipFiles:["**/module*.ts"]}),o=r.dap.evaluate({expression:`window.callBack(() => { debugger });
console.log("out");`});await P(r),await o,r.assertLog()}),g("works with absolute paths (#470)",async({r:t})=>{let r=await t.launchUrl("basic.html",{skipFiles:[`${L}/web/basic.js`]}),o={path:r.workspacePath("web/basic.js")};await r.dap.setBreakpoints({source:o,breakpoints:[{line:3,column:0}]}),r.load(),await e(r,!1),r.assertLog()}),g("toggle authored ts",async({r:t})=>{let r=await t.launchUrlAndLoad("basic.html"),o=r.workspacePath("web/basic.ts"),n={path:o};await r.dap.setBreakpoints({source:n,breakpoints:[{line:21,column:0}]}),r.load();let s=await r.dap.once("stopped");await x(500),await r.logger.logStackTrace(s.threadId),r.log("----send toggle skipfile status request----"),await r.dap.toggleSkipFileStatus({resource:o}),await r.logger.logStackTrace(s.threadId),r.log("----send (un)toggle skipfile status request----"),await r.dap.toggleSkipFileStatus({resource:o}),await r.logger.logStackTrace(s.threadId),r.assertLog()})}),g("uses custom descriptions in frame names",async({r:e})=>{let t=await e.launchAndLoad("blank");t.cdp.Runtime.evaluate({expression:`
        class Bar {
          method2() {
            debugger;
          }

          toString() {
            return 'Custom';
          }
        }

        class Foo {
          method1() {
            return new Bar().method2();
          }
        }

        new Foo().method1();
      `}),await i(t,!1),t.assertLog()})})});var O_={};var qT=m(()=>{"use strict";U();_e();describe("threads",()=>{g("paused",async({r:i})=>{let e=await i.launchUrlAndLoad("index.html");e.cdp.Runtime.evaluate({expression:"debugger;"}),await e.dap.once("stopped"),e.log(await e.dap.threads({})),e.assertLog()}),g("not paused",async({r:i})=>{let e=await i.launchUrlAndLoad("index.html");e.log(await e.dap.threads({})),e.assertLog()}),describe("stepping",()=>{g("basic",async({r:e})=>{let t=await e.launchUrlAndLoad("index.html");t.evaluate(`
        function bar() {
          return 2;
        }
        function foo() {
          debugger;
          bar();
          bar();
        }
        foo();
      `);let{threadId:r}=t.log(await t.dap.once("stopped"));await t.logger.logStackTrace(r),t.log(`
step over`),t.dap.next({threadId:r}),t.log(await Promise.all([t.dap.once("continued"),t.dap.once("stopped")])),await t.logger.logStackTrace(r),t.log(`
step over`),t.dap.next({threadId:r}),t.log(await Promise.all([t.dap.once("continued"),t.dap.once("stopped")])),await t.logger.logStackTrace(r),t.log(`
step in`),t.dap.stepIn({threadId:r}),t.log(await Promise.all([t.dap.once("continued"),t.dap.once("stopped")])),await t.logger.logStackTrace(r),t.log(`
step out`),t.dap.stepOut({threadId:r}),t.log(await Promise.all([t.dap.once("continued"),t.dap.once("stopped")])),await t.logger.logStackTrace(r),t.log(`
resume`),t.dap.continue({threadId:r}),t.log(await t.dap.once("continued")),t.assertLog()}),g("cross thread",async({r:e})=>{let t=await e.launchUrlAndLoad("worker.html");t.cdp.Runtime.evaluate({expression:`debugger;
window.w.postMessage('message')
//# sourceURL=test.js`});let{threadId:r}=t.log(await t.dap.once("stopped"));await t.logger.logStackTrace(r),t.log(`
step over`),t.dap.next({threadId:r}),t.log(await Promise.all([t.dap.once("continued"),t.dap.once("stopped")])),await t.logger.logStackTrace(r),t.log(`
step in`),t.dap.stepIn({threadId:r}),t.log(await t.dap.once("continued"));let o=await e.worker(),{threadId:n}=t.log(await o.dap.once("stopped"));await o.logger.logStackTrace(n),t.log(`
resume`),o.dap.continue({threadId:n}),t.log(await o.dap.once("continued")),t.assertLog()}),g("cross thread constructor",async({r:e})=>{let t=await e.launchUrlAndLoad("index.html");t.cdp.Runtime.evaluate({expression:`
        debugger;
        window.w = new Worker('worker.js');
//# sourceURL=test.js`});let{threadId:r}=t.log(await t.dap.once("stopped"));await t.logger.logStackTrace(r),t.log(`
step over`),t.dap.next({threadId:r}),t.log(await Promise.all([t.dap.once("continued"),t.dap.once("stopped")])),await t.logger.logStackTrace(r),t.log(`
step in`),t.dap.stepIn({threadId:r}),t.log(await t.dap.once("continued"));let o=await e.worker(),{threadId:n}=t.log(await o.dap.once("stopped"));await o.logger.logStackTrace(n),t.log(`
resume`),o.dap.continue({threadId:n}),t.log(await o.dap.once("continued")),t.assertLog()}),g("cross thread skip over tasks",async({r:e})=>{let t=await e.launchUrlAndLoad("index.html");t.cdp.Runtime.evaluate({expression:`
        window.p = new Promise(f => window.cb = f);
        debugger;
        p.then(() => {
          var a = 1; // should stop here
        });
        window.w = new Worker('worker.js');
        window.w.postMessage('hey');
        window.w.addEventListener('message', () => window.cb());
        
//# sourceURL=test.js`});let{threadId:r}=t.log(await t.dap.once("stopped"));await t.logger.logStackTrace(r),t.log(`
step over`),t.dap.next({threadId:r}),t.log(await Promise.all([t.dap.once("continued"),t.dap.once("stopped")])),await t.logger.logStackTrace(r),t.log(`
step in`),t.dap.stepIn({threadId:r}),t.log(await t.dap.once("continued"));let{threadId:o}=t.log(await t.dap.once("stopped"));await t.logger.logStackTrace(o),t.log(`
resume`),t.dap.continue({threadId:o}),t.log(await t.dap.once("continued")),t.assertLog()});let i=async(e,t)=>{t.cdp.Runtime.evaluate({expression:`debugger;
window.w = new Worker('workerSourceMap.js');
//# sourceURL=test.js`});let{threadId:r}=t.log(await t.dap.once("stopped"));await t.logger.logStackTrace(r),t.log(`
step over`),t.dap.next({threadId:r}),t.log(await Promise.all([t.dap.once("continued"),t.dap.once("stopped")])),await t.logger.logStackTrace(r),t.log(`
step in`),t.dap.stepIn({threadId:r}),t.log(await t.dap.once("continued"));let o=await e.worker(),{threadId:n}=t.log(await o.dap.once("stopped"));await o.logger.logStackTrace(n),t.log(`
resume`),o.dap.continue({threadId:n}),t.log(await o.dap.once("continued")),t.assertLog()};g("cross thread constructor source map",async({r:e})=>{let t=await e.launchUrlAndLoad("index.html");await i(e,t)}),g("cross thread constructor source map predicted",async({r:e})=>{let t=await e.launchUrlAndLoad("index.html");await t.dap.setBreakpoints({source:{path:t.workspacePath("web/does-not-exist.html")},breakpoints:[{line:1,column:1}]}),await i(e,t)}),g("cross thread source map",async({r:e})=>{let t=await e.launchUrlAndLoad("index.html");t.cdp.Runtime.evaluate({expression:`
        window.w = new Worker('workerSourceMap.js');
        debugger;
        window.w.postMessage('hey');
//# sourceURL=test.js`});let{threadId:r}=t.log(await t.dap.once("stopped"));await t.logger.logStackTrace(r),t.log(`
step over`),t.dap.next({threadId:r}),t.log(await Promise.all([t.dap.once("continued"),t.dap.once("stopped")])),await t.logger.logStackTrace(r),t.log(`
step in`),t.dap.stepIn({threadId:r}),t.log(await t.dap.once("continued"));let o=await e.worker(),{threadId:n}=t.log(await o.dap.once("stopped"));await o.logger.logStackTrace(n),t.log(`
resume`),o.dap.continue({threadId:n}),t.log(await o.dap.once("continued")),t.assertLog()})}),describe("pause on exceptions",()=>{async function i(e){let t=e.log(await e.dap.once("stopped"));e.log(await e.dap.exceptionInfo({threadId:t.threadId})),e.log(await e.dap.continue({threadId:t.threadId}))}g("cases",async({r:e})=>{let t=await e.launchAndLoad("blank");t.log("Not pausing on exceptions"),await t.dap.setExceptionBreakpoints({filters:[]}),await t.evaluate("setTimeout(() => { throw new Error('hello'); })"),await t.evaluate("setTimeout(() => { try { throw new Error('hello'); } catch (e) {}})"),t.log("Pausing on uncaught exceptions"),await t.dap.setExceptionBreakpoints({filters:["uncaught"]}),await t.evaluate("setTimeout(() => { try { throw new Error('hello'); } catch (e) {}})"),t.evaluate("setTimeout(() => { throw new Error('hello'); })"),await i(t),t.log("Pausing on uncaught rejections"),t.evaluate("new Promise((res, rej) => rej(new Error('oh no!')))"),await i(t),t.log("Pausing on caught exceptions"),await t.dap.setExceptionBreakpoints({filters:["all"]}),t.evaluate("setTimeout(() => { throw new Error('hello'); })"),await i(t),t.evaluate("setTimeout(() => { try { throw new Error('hello'); } catch (e) {}})"),await i(t),t.log("Pausing on caught rejections"),t.evaluate("new Promise((res, rej) => rej(new Error('oh no!'))).catch(err => {})"),await i(t),t.assertLog()}),g("does not pause on exceptions in internals",async({r:e})=>{let t=await e.launchAndLoad("blank");await t.dap.setExceptionBreakpoints({filters:["all"]});let r=t.evaluate("console.log({ [Symbol.for('debug.description')]() { throw 'oops'; } })");await Promise.race([t.dap.once("stopped").then(()=>{throw new Error("should not stop")}),x(1e3)]),await r,t.assertLog()}),g("pauses on conditional exceptions",async({r:e})=>{let t=await e.launchAndLoad("blank");t.log("Pausing on caught exceptions"),await t.dap.setExceptionBreakpoints({filters:["all"],filterOptions:[{filterId:"all",condition:'error.message.includes("bye")'}]}),t.evaluate("setTimeout(() => { try { throw new Error('hello'); } catch (e) {} })"),t.evaluate("setTimeout(() => { try { throw new Error('goodbye'); } catch (e) {} })"),await i(t),t.log("Pausing on uncaught exceptions"),await t.dap.setExceptionBreakpoints({filters:["uncaught"],filterOptions:[{filterId:"uncaught",condition:'error.message.includes("bye")'}]}),t.evaluate("setTimeout(() => { throw new Error('hello'); })"),t.evaluate("setTimeout(() => { try { throw new Error('goodbye1'); } catch (e) {} })"),t.evaluate("setTimeout(() => { throw new Error('goodbye2'); })"),await i(t),t.assertLog()}),g("deals with syntax errors in conditional exception bps",async({r:e})=>{let t=await e.launchAndLoad("blank");t.dap.setExceptionBreakpoints({filters:["all"],filterOptions:[{filterId:"all",condition:'error.message.includes("bye'}]}),await t.logger.logOutput(await t.dap.once("output")),t.assertLog()}),g("configuration",async({r:e})=>{let t=await e.launch(`
        <script>
          try {
            throw new Error('this error is caught');
          } catch (e) {
          }
          throw new Error('this error is uncaught');
        </script>
      `);await t.dap.setExceptionBreakpoints({filters:["uncaught"]}),t.load(),await i(t),t.assertLog()})})})});var j_={};var HT,zT=m(()=>{"use strict";HT=require("chai");Eb();_e();describe("variables",()=>{describe("basic",()=>{g("basic object",async({r:i})=>{let e=await i.launchAndLoad("blank");await e.logger.evaluateAndLog("({a: 1})"),e.assertLog()}),g("simple log",async({r:i})=>{let e=await i.launch(`
        <script>
          console.log('Hello world');
        </script>`);e.load(),await e.logger.logOutput(await e.dap.once("output")),e.assertLog()}),g("clear console",async({r:i})=>{let e,t=new Promise(n=>e=n),r=Promise.resolve(),o=await i.launch(`
        <script>
        console.clear();
        console.log('Hello world');
        console.clear();
        console.clear();
        console.log('Hello world');
        console.clear();
        console.error('DONE');
        </script>`);o.load(),o.dap.on("output",async n=>{r=r.then(async()=>{n.category==="stderr"?e():await o.logger.logOutput(n)})}),await t,o.assertLog()})}),describe("object",()=>{g("simple array",async({r:i})=>{let e=await i.launchAndLoad("blank");await e.logger.evaluateAndLog("var a = [1, 2, 3]; a.foo = 1; a",{logInternalInfo:!0}),e.assertLog()}),g.skip("large array",async({r:i})=>{let e=await i.launchAndLoad("blank");await e.logger.evaluateAndLog("var a = new Array(110); a.fill(1); a",{logInternalInfo:!0}),e.assertLog()}),g("get set",async({r:i})=>{let e=await i.launchAndLoad("blank");await e.logger.evaluateAndLog(`
        const a = {};
        Object.defineProperty(a, 'getter', { get: () => {} });
        Object.defineProperty(a, 'setter', { set: () => {} });
        Object.defineProperty(a, 'accessor', { get: () => {}, set: () => {} });
        a;`),e.assertLog()}),g("private props",async({r:i})=>{let e=await i.launchAndLoad("blank");await e.logger.evaluateAndLog(`
        class A { #foo = 'bar' }
        new A();`),e.assertLog()}),g("deep accessor",async({r:i})=>{let e=await i.launchAndLoad("blank");await e.logger.evaluateAndLog(`
        class Foo { get getter() {} }
        class Bar extends Foo { }
        new Bar();`),e.assertLog()}),describe("customDescriptionGenerator",()=>{g("using function declaration",async({r:i})=>{let e=await i.launchAndLoad("blank",{customDescriptionGenerator:'function (def) { if (this.customDescription) return "using function: " + this.customDescription(); else return def }'});await e.logger.evaluateAndLog(`
          class Foo { get getter() {} }
          class Bar extends Foo { customDescription() { return 'Instance of bar'} }
          new Bar();`),e.assertLog()}),g("shows errors",async({r:i})=>{let e=await i.launchAndLoad("blank",{customDescriptionGenerator:'function (def) { if (this.customDescription) throw new Error("oh no!"); else return def }'});await e.logger.evaluateAndLog(`
          class Foo { get getter() {} }
          class Bar extends Foo { customDescription() { return 'Instance of bar'} }
          new Bar();`),e.assertLog()}),g("using statement syntax",async({r:i})=>{let e=await i.launchAndLoad("blank",{customDescriptionGenerator:'const hasCustomDescription = this.customDescription; "using statement: " + (hasCustomDescription ? this.customDescription() : defaultValue)'});await e.logger.evaluateAndLog(`
          class Foo { get getter() {} }
          class Bar extends Foo { customDescription() { return 'Instance of bar'} }
          new Bar();`),e.assertLog()}),g("using statement with return syntax",async({r:i})=>{let e=await i.launchAndLoad("blank",{customDescriptionGenerator:'const hasCustomDescription = this.customDescription; if (hasCustomDescription) { return "using statement return: " + this.customDescription() } else return defaultValue'});await e.logger.evaluateAndLog(`
          class Foo { get getter() {} }
          class Bar extends Foo { customDescription() { return 'Instance of bar'} }
          new Bar();`),e.assertLog()}),g("with arrays",async({r:i})=>{let e=await i.launchAndLoad("blank",{customDescriptionGenerator:`function (def) {
              return this.customDescription
                ? this.customDescription()
                : (Array.isArray(this)
                  ? "I'm an array"
                  : def); }`});await e.logger.evaluateAndLog(`
          class Foo { get getter() {} }
          class Bar extends Foo { customDescription() { return 'Instance of bar'} }
          [new Bar(), new Foo(), 5, "test"];`),e.assertLog()})}),describe("customPropertiesGenerator",()=>{g("works with customPropertiesGenerator method ",async({r:i})=>{let e=await i.launchAndLoad("blank",{customPropertiesGenerator:"function () { if (this.customPropertiesGenerator) return this.customPropertiesGenerator(); else return this; }"});await e.logger.evaluateAndLog(`
        class Foo { get getter() {} }
        class Bar extends Foo {
          constructor() {
            super();
            this.realProp = 'cc3';
          }

          customPropertiesGenerator() {
            const properties = Object.create(this.__proto__);
            return Object.assign(properties, this, { customProp1: 'aa1', customProp2: 'bb2' });
          }
        }
        new Bar();`),e.assertLog()})}),g("shows errors while generating properties",async({r:i})=>{let e=await i.launchAndLoad("blank",{customPropertiesGenerator:'function () { if (this.customPropertiesGenerator) throw new Error("Some error while generating properties"); else return this; }'});await e.logger.evaluateAndLog(`
      class Foo { get getter() {} }
      class Bar extends Foo {
        constructor() {
          super();
          this.realProp = 'cc3';
        }

        customPropertiesGenerator() {
          const properties = Object.create(this.__proto__);
          return Object.assign(properties, this, { customProp1: 'aa1', customProp2: 'bb2' });
        }
      }
      new Bar();`),e.assertLog()})}),describe("web",()=>{g("tags",async({r:i})=>{let e=await i.launchAndLoad(`<head>
        <meta name='foo' content='bar'></meta>
        <title>Title</title>
      </head>`);await e.logger.evaluateAndLog("document.head.children"),e.assertLog()})}),describe("multiple threads",()=>{g("worker",async({r:i})=>{let e=await i.launchUrlAndLoad("worker.html"),t=[];await Promise.all([(async()=>t.push({output:await e.dap.once("output"),logger:e.logger}))(),(async()=>{let r=await i.worker();t.push({output:await r.dap.once("output"),logger:r.logger}),t.push({output:await r.dap.once("output"),logger:r.logger})})()]),t.sort((r,o)=>{let n=r?.output?.source?.name,s=o?.output?.source?.name;return n&&s?n.localeCompare(s):0});for(let{output:r,logger:o}of t)await o.logOutput(r);e.assertLog()})}),describe("setVariable",()=>{g("basic",async({r:i})=>{let e=await i.launchAndLoad("blank"),t=await e.logger.evaluateAndLog("window.x = ({foo: 42}); x");e.log(`
Setting "foo" to "{bar: 17}"`);let r=await e.dap.setVariable({variablesReference:t.variablesReference,name:"foo",value:"{bar: 17}"}),o={...r,variablesReference:r.variablesReference||0,name:"<result>"};await e.logger.logVariable(o),e.log(`
Original`),await e.logger.logVariable(t),e.log(await e.dap.setVariable({variablesReference:t.variablesReference,name:"foo",value:"baz"}),`
setVariable failure: `),e.assertLog()}),g("setExpression",async({r:i})=>{let e=await i.launchAndLoad("blank");e.cdp.Runtime.evaluate({expression:`
        (function foo() {
          let a = { b: 1 }
          let c = 'e';
          debugger;
          console.log(a.b, c);
        })()
      `});let t=await e.dap.once("stopped"),r=await e.dap.stackTrace({threadId:t.threadId});e.log(await e.dap.setExpression({expression:"a.b",value:"42",frameId:r.stackFrames[0].id}),`
setExpression a: `),e.log(await e.dap.setExpression({expression:"c",value:'"hello " + "world"',frameId:r.stackFrames[0].id}),`
setExpression a: `),e.dap.continue({threadId:t.threadId}),e.log(`
 Vars:`),await e.logger.logOutput(await e.dap.once("output")),e.assertLog()}),g("scope",async({r:i})=>{let e=await i.launchAndLoad("blank");e.cdp.Runtime.evaluate({expression:`
        (function foo() {
          let y = 'value of y';
          let z = 'value of z';
          debugger;
        })()
      `});let t=e.log(await e.dap.once("stopped"),"stopped: "),r=await e.dap.stackTrace({threadId:t.threadId}),n=(await e.dap.scopes({frameId:r.stackFrames[0].id})).scopes[0],s={name:"scope",value:n.name,variablesReference:n.variablesReference,namedVariables:n.namedVariables,indexedVariables:n.indexedVariables};await e.logger.logVariable(s),e.log(`
Setting "y" to "z"`);let a=await e.dap.setVariable({variablesReference:s.variablesReference,name:"y",value:"z"}),c={...a,variablesReference:a.variablesReference||0,name:"<result>"};await e.logger.logVariable(c),e.log(`
Original`),await e.logger.logVariable(s),e.assertLog()}),g("name mapping",async({r:i})=>{let e=await i.launchUrlAndLoad("minified/index.html");e.cdp.Runtime.evaluate({expression:"test()"});let t=await e.dap.once("stopped"),r=await e.logger.logStackTrace(t.threadId,1/0);e.log(`
Preserves eval sourceURL (#1259):`),e.log(await e.dap.evaluate({expression:"arg1; thenSomethingInvalid()",context:"repl",frameId:r[0].id})),await e.dap.continue({threadId:t.threadId}),e.assertLog()}),g("evaluateName",async({r:i})=>{let e=await i.launchAndLoad("blank");e.cdp.Runtime.evaluate({expression:`
        (function foo() {
          let a = 'some string';
          let b = [1, 2, 3, 4];
          b.prop = '';
          let c = { $a: 1, _b: 2, c: 3, 'd d': 4, [42]: 5,
            e: { nested: [{ obj: true }]}, [Symbol('wut')]: 'wut' };
          debugger;
        })();
      `});let t=e.log(await e.dap.once("stopped"),"stopped: "),r=await e.dap.stackTrace({threadId:t.threadId}),n=(await e.dap.scopes({frameId:r.stackFrames[0].id})).scopes[0],s={name:"scope",value:n.name,variablesReference:n.variablesReference,namedVariables:n.namedVariables,indexedVariables:n.indexedVariables};await as(e.dap,s,(a,c)=>(e.log("  ".repeat(c)+a.evaluateName),!a.name.startsWith("__")&&!a.name.startsWith("[[")&&a.name!=="this")),e.assertLog()})}),g("map variable without preview (#1824)",async({r:i})=>{let e=await i.launchAndLoad("blank");await e.logger.evaluateAndLog(`
      class A { #bar = new Map([[1, 2]]) }
      new A();`),e.assertLog()}),g("readMemory/writeMemory",async({r:i})=>{let e=await i.launchAndLoad("blank");e.cdp.Runtime.evaluate({expression:`
        (function foo() {
          let $memA = new WebAssembly.Memory({ initial: 1, maximum: 1 });
          let $memB = $memA.buffer.slice(0, 12);
          let $memC = new Uint8Array($memB);
          let $memD = new DataView($memB);
          let $memE = new Uint8Array($memB, 3, 8);

          for (let i = 0; i < $memC.length; i++) {
            $memC[i] = i;
          }

          debugger;
          console.log($memA, $memB, $memC, $memD);
        })()
      `});let t=await e.dap.once("stopped"),r=await e.dap.stackTrace({threadId:t.threadId}),n=(await e.dap.scopes({frameId:r.stackFrames[0].id})).scopes[0],s={name:"scope",value:n.name,variablesReference:n.variablesReference,namedVariables:n.namedVariables,indexedVariables:n.indexedVariables},a,c;await as(e.dap,s,async(y,v)=>{if(!y.name.startsWith("$mem"))return v<2;y.name==="$memB"?a=y:y.name==="$memE"&&(c=y),(0,HT.expect)(y).to.have.property("memoryReference");let D=await e.dap.readMemory({count:20,memoryReference:y.memoryReference,offset:0});e.log(D,`${y.name} [0, 20]`);let Te=await e.dap.readMemory({count:10,memoryReference:y.memoryReference,offset:5});return e.log(Te,`${y.name} [5, 10]`),!1});let l=await e.dap.writeMemory({memoryReference:a.memoryReference,data:Buffer.from("hello").toString("base64"),offset:1});e.log(l,"write");let p=await e.dap.readMemory({count:10,memoryReference:a.memoryReference});e.log(p,"read outcome");let d=await e.dap.writeMemory({memoryReference:c.memoryReference,data:Buffer.from("helloworld").toString("base64"),offset:1});e.log(d,"write with offset");let b=await e.dap.readMemory({count:10,memoryReference:a.memoryReference});e.log(b,"read outcome"),e.assertLog()})})});var U_={};var GT=m(()=>{"use strict";$();Ur();rt();_e();describe("console format",()=>{g("string",async({r:i})=>{let e=await i.launchAndLoad(`
        <script>
          var array = ["test", "test2"];array.length = 10;
          array.foo = {};
          array[4] = "test4";
        </script>`);await e.logger.evaluateAndLog(["console.log(array)",'console.log("hello world".repeat(10000))','console.log("%o", array)','console.log("%O", array)','console.log("Test for zero \\"%f\\" in formatter", 0)','console.log("%% self-escape1", "dummy")','console.log("%%s self-escape2", "dummy")','console.log("%%ss self-escape3", "dummy")','console.log("%%s%s%%s self-escape4", "dummy")','console.log("%%%%% self-escape5", "dummy")','console.log("%%%s self-escape6", "dummy");']),e.assertLog()}),g("popular types",async({r:i})=>{let e=await i.launchAndLoad(`
        <p id="p"></p>
        <script>
          // Populate Globals
          var regex1 = /^url\\(\\s*(?:(?:"(?:[^\\\\\\"]|(?:\\\\[\\da-f]{1,6}\\s?|\\.))*"|'(?:[^\\\\\\']|(?:\\\\[\\da-f]{1,6}\\s?|\\.))*')|(?:[!#$%&*-~\\w]|(?:\\\\[\\da-f]{1,6}\\s?|\\.))*)\\s*\\)/i;
          var regex2 = new RegExp("foo\\\\\\\\bar\\\\sbaz", "i");
          var str = "test";
          var str2 = "test named \\"test\\"";
          var error = new Error;
          var errorWithMessage = new Error("my error message");
          var errorWithMultilineMessage = new Error("my multiline\\nerror message");
          var node = document.getElementById("p");
          var func = function() { return 1; };
          var multilinefunc = function() {
              return 2;
          };
          var num = 1.2e-1;
          var throwingLengthGetter = {get length() { throw "Length called"; }};
          var objectWithNonEnumerables = Object.create({ foo: 1 }, {
              __underscoreNonEnumerableProp: { value: 2, enumerable: false },
              abc: { value: 3, enumerable: false },
              getFoo: { value: function() { return this.foo; } },
              bar: { get: function() { return this.bar; }, set: function(x) { this.bar = x; } }
          });
          objectWithNonEnumerables.enumerableProp = 4;
          objectWithNonEnumerables.__underscoreEnumerableProp__ = 5;
          var negZero = 1 / Number.NEGATIVE_INFINITY;
          var arrayLikeFunction = function( /**/ foo/**/, /*/**/bar,
          /**/baz) {};
          arrayLikeFunction.splice = function() {};
          var tinyTypedArray = new Uint8Array([3]);
          var smallTypedArray = new Uint8Array(new ArrayBuffer(400));
          smallTypedArray["foo"] = "bar";
          var bigTypedArray = new Uint8Array(new ArrayBuffer(400 * 1000 * 1000));
          bigTypedArray["FAIL"] = "FAIL: Object.getOwnPropertyNames() should not have been run";
          var bigArray = [];
          bigArray.length = 200;
          bigArray.fill(1);
          var boxedNumberWithProps = new Number(42);
          boxedNumberWithProps[1] = "foo";
          boxedNumberWithProps["a"] = "bar";
          var boxedStringWithProps = new String("abc");
          boxedStringWithProps["01"] = "foo";
          boxedStringWithProps[3] = "foo";
          boxedStringWithProps["a"] = "bar";
          function domException()
          {
              var result = "FAIL";
              try {
                  var a = document.createElement("div");
                  var b = document.createElement("div");
                  a.removeChild(b);
              } catch(e) {
                  e.stack = "";
                  result = e;
              }
              return result;
          }
          //# sourceURL=console-format
        </script>`),r=["regex1","regex2","str","str2","error","errorWithMessage","errorWithMultilineMessage","func","multilinefunc","num","null","undefined","NaN","Number.POSITIVE_INFINITY","Number.NEGATIVE_INFINITY","{}","[function() {}]","objectWithNonEnumerables","negZero","Object.create(null)","Object","Object.prototype","new Number(42)",'new String("abc")',"arrayLikeFunction",'new Uint16Array(["1", "2", "3"])',"tinyTypedArray","smallTypedArray","bigTypedArray","throwingLengthGetter","domException()","bigArray","boxedNumberWithProps","boxedStringWithProps","false","true","new Boolean(true)","new Set([1, 2, 3, 4])","new Set([1, 2, 3, 4, 5, 6, 7, 8])",'new class { toString() { return "custom to string" } }','new class { toString() { return "long custom to string".repeat(500) } }','new class { [Symbol.for("debug.description")]() { return "some custom repr" } }','new class { [Symbol.for("nodejs.util.inspect.custom")]() { return "some node repr" } }'].map(o=>[`console.log(${o})`,`console.log([${o}])`]);await e.logger.evaluateAndLog([].concat(...r),{depth:0}),e.assertLog()}),g("custom toString",async({r:i})=>{let e=await i.launchAndLoad("blank");await e.logger.evaluateAndLog(`
      new class A {
        prop = new class B {
          toString() { return "hello b" }
        }
        toString() { return "hello a" }
      }
    `),e.assertLog()}),g("custom symbol",async({r:i})=>{let e=await i.launchAndLoad("blank");await e.logger.evaluateAndLog(`
      new class A {
        prop = new class B {
          [Symbol.for("debug.description")]() { return "hello b" }
        };
        [Symbol.for("debug.description")]() { return "hello a" }
      }
    `),e.assertLog()}),g("collections",async({r:i})=>{let e=await i.launchAndLoad(`
        <div style="display:none" class="c1 c2 c3">
          <form id="f">
              <select id="sel" name="sel">
                  <option value="1">one</option>
                  <option value="2">two</option>
              </select>
              <input type="radio" name="x" value="x1"> x1
              <input type="radio" name="x" value="x2"> x2
          </form>
        </div>
        <script>
          var formElement = document.getElementById("f");
          var selectElement = document.getElementById("sel");
          var spanElement = document.getElementById("span");

          // NodeList
          var nodelist = document.getElementsByTagName("select");
          var htmlcollection = document.head.children;
          var options = selectElement.options;
          var all = document.all;
          var formControls = formElement.elements;
          var radioNodeList = formElement.x;

          var arrayX = [1];
          var arrayY = [2, arrayX];
          arrayX.push(arrayY);

          var nonArray = new NonArrayWithLength();
          // Arguments
          function generateArguments(foo, bar)
          {
              return arguments;
          }

          var div = document.getElementsByTagName("div")[0];

          function NonArrayWithLength() {
              this.keys = [];
          }

          NonArrayWithLength.prototype.__defineGetter__("length", function() {
              console.log("FAIL: 'length' should not be called");
              return this.keys.length;
          });
        </script>`),r=["nodelist","htmlcollection","options","all","formControls","radioNodeList","arrayX","nonArray",'generateArguments(1, "2")',"div.classList"].map(o=>[`console.log(${o})`,`console.log([${o}])`]);await e.logger.evaluateAndLog([].concat(...r),{depth:0}),e.assertLog()}),g("es6",async({r:i})=>{let e=await i.launchAndLoad(`
        <script>
          var p = Promise.reject(-0);
          p.catch(function() {});

          var p2 = Promise.resolve(1);
          var p3 = new Promise(() => {});

          var smb1 = Symbol();
          var smb2 = Symbol("a");
          var obj = {
              get getter() {}
          };
          obj["a"] = smb1;
          obj[smb2] = 2;

          var map = new Map();
          var weakMap = new WeakMap();
          map.set(obj, {foo: 1});
          weakMap.set(obj, {foo: 1});

          var set = new Set();
          var weakSet = new WeakSet();
          set.add(obj);
          weakSet.add(obj);

          var mapMap0 = new Map();
          mapMap0.set(new Map(), new WeakMap());
          var mapMap = new Map();
          mapMap.set(map, weakMap);

          var setSet0 = new Set();
          setSet0.add(new WeakSet());
          var setSet = new Set();
          setSet.add(weakSet);

          var bigmap = new Map();
          bigmap.set(" from str ", " to str ");
          bigmap.set(undefined, undefined);
          bigmap.set(null, null);
          bigmap.set(42, 42);
          bigmap.set({foo:"from"}, {foo:"to"});
          bigmap.set(["from"], ["to"]);

          var genFunction = function *() {
              yield 1;
              yield 2;
          }
          var generator = genFunction();
        </script>`),r=["p","p2","p3","smb1","smb2","obj","map","weakMap","set","weakSet","mapMap0","mapMap","setSet0","setSet","bigmap","generator"].map(o=>[`console.log(${o})`,`console.log([${o}])`]);await e.logger.evaluateAndLog([].concat(...r),{depth:0}),e.assertLog()}),g("es6-2",async({r:i})=>{let e=await i.launchAndLoad(`
        <script>
          var map2 = new Map();
          map2.set(41, 42);
          map2.set({foo: 1}, {foo: 2});

          var iter1 = map2.values();
          iter1.next();

          var set2 = new Set();
          set2.add(41);
          set2.add({foo: 1});

          var iter2 = set2.keys();
          iter2.next();
        </script>`),r=["map2.keys()","map2.values()","map2.entries()","set2.keys()","set2.values()","set2.entries()","iter1","iter2"].map(o=>[`console.log(${o})`,`console.log([${o}])`]);await e.logger.evaluateAndLog([].concat(...r),{depth:0}),e.assertLog()}),g("array",async({r:i})=>{let e=await i.launchAndLoad(`
        <script>
          var a0 = [];
          var a1 = []; a1.length = 1;
          var a2 = []; a2.length = 5;
          var a3 = [,2,3];
          var a4 = []; a4.length = 15;
          var a5 = []; a5.length = 15; a5[8] = 8;
          var a6 = []; a6.length = 15; a6[0] = 0; a6[10] = 10;
          var a7 = [,,,4]; a7.length = 15;
          for (var i = 0; i < 6; ++i)
              a7["index" + i] = i;
          var a8 = [];
          for (var i = 0; i < 10; ++i)
              a8[i] = i;
          var a9 = [];
          for (var i = 1; i < 5; ++i) {
              a9[i] = i;
              a9[i + 5] = i + 5;
          }
          a9.length = 11;
          a9.foo = "bar";
          a10 = Object.create([1,2]);
        </script>`),t=new Array(11).fill(0).map((r,o)=>`console.log(a${o})`);await e.logger.evaluateAndLog(t,{depth:0}),e.assertLog()}),g("class",async({r:i})=>{let e=await i.launchAndLoad(`
        <script>
          var a0 = [];
          var a1 = []; a1.length = 1;
          var a2 = []; a2.length = 5;
          var a3 = [,2,3];
          var a4 = []; a4.length = 15;
          var a5 = []; a5.length = 15; a5[8] = 8;
          var a6 = []; a6.length = 15; a6[0] = 0; a6[10] = 10;
          var a7 = [,,,4]; a7.length = 15;
          for (var i = 0; i < 6; ++i)
              a7["index" + i] = i;
          var a8 = [];
          for (var i = 0; i < 10; ++i)
              a8[i] = i;
          var a9 = [];
          for (var i = 1; i < 5; ++i) {
              a9[i] = i;
              a9[i + 5] = i + 5;
          }
          a9.length = 11;
          a9.foo = "bar";
          a10 = Object.create([1,2]);
        </script>`),t=new Array(11).fill(0).map((r,o)=>`console.log(a${o})`);await e.logger.evaluateAndLog(t,{depth:0}),e.assertLog()}),g("groups",async({r:i})=>{let e=await i.launchAndLoad("blank");await e.logger.evaluateAndLog(["console.log('outer')","console.group()","console.log('in anonymous')","console.groupCollapsed('named')","console.log('in named')","console.group({ complex: true })","console.log('in complex')","console.groupEnd()","console.groupEnd()","console.log('back in anonymous')","console.groupEnd()"]),e.assertLog()}),g("colors",async({r:i})=>{let e=await i.launchAndLoad("blank");await e.logger.evaluateAndLog(["console.log('%cColors are awesome.', 'color: blue;')","console.log('%cColors are awesome.', 'background-color: red;')","console.log('%cColors are awesome.', 'background-color: red;', 'Do not apply to trailing params')","console.log('%cColors %care %cawesome.', 'color: red', 'color:green', 'color:blue')","console.log('%cBold text.', 'font-weight: bold')","console.log('%cItalic text.', 'font-style: italic')","console.log('%cUnderline text.', 'text-decoration: underline')"],{depth:0}),e.assertLog()}),g("error traces in source maps",async({r:i})=>{let e=await i.launchUrlAndLoad("browserify/browserify.html");await e.logger.evaluateAndLog(["try { throwError() } catch (e) { console.error(e) }"]),e.assertLog()}),g("adds error traces if they do not exist",async({r:i})=>{let e=await i.launchUrlAndLoad("browserify/browserify.html"),t=e.dap.once("output");await e.logger.evaluateAndLog(['setTimeout(() => { throw "asdf" }, 0) ']),e.log(await t),e.assertLog()}),g("applies skipfiles to logged stacks",async({r:i})=>{let e=await i.launchAndLoad(`
        <script>
        function doLog() { console.log.apply(console, arguments); }
        //# sourceURL=ignore-me.js
        </script>
      `,{skipFiles:["**/ignore-me.js"]}),t=e.dap.evaluate({expression:`doLog("hello world");
//# sourceURL=dont-ignore-me.js`,context:"watch"}),r=await e.dap.once("output");await t,e.log(`logged ${r.output} at ${r.source?.name}:${r.line}:${r.column}`),e.assertLog()}),g("EXT handling",async({r:i})=>{T(h,{"test.js":[`
          process.stdout.write('hello');
          debugger;
          process.stdout.write('world');
          debugger;
          process.stdout.write('new line\\r\\nasdf');
          debugger;
          process.stdout.write('now ext\\u0003this should be bulked');
          debugger;
          process.stdout.write('with this!\\u0003trailing');
        `]});let e=await i.runScript("test.js",{outputCapture:"std"}),t="";i.rootDap().on("output",r=>{t+=r.output}),e.dap.on("stopped",r=>{e.dap.continue({threadId:r.threadId})}),await e.load(),await i.rootDap().once("terminated"),i.log(JSON.stringify(t)),e.assertLog()})})});var W_={};var JT=m(()=>{"use strict";_e();describe("console api",()=>{describe("format",()=>{g("format string",async({r:i})=>{let e=await i.launchAndLoad("blank");await e.logger.evaluateAndLog(["console.log('Log')","console.info('Info')","console.warn('Warn')","console.error('Error')","console.assert(false, 'Assert')","console.assert(false)","console.trace('Trace')","console.count('Counter')","console.count('Counter')"]),e.assertLog()})}),g("format string",async({r:i})=>{let e=await i.launchAndLoad(`<script>
    var peopleObject = {
      one: ["John", "Smith"],
      two: ["Jane", "Doe"],
      three: ["Emily", "Jones"]
    };
    var peopleObject2 = {
      one: { name: "John", last: "Smith"},
      two: { name: "Jane", last: "Doe"},
      three: { name: "Emily", last: "Jones"}
    };
    var peopleLongHeader = {
      one: { "first name": "John", "last name": "Smith"},
      two: { "first name": "Jane", "last name": "Doe"},
      three: { "first name": "Emily", "last name": "Jones"}
    };
    var peopleArray= [
      ["John", "Smith"],
      ["Jane", "Doe"],
      ["Emily", "Jones"]
    ];
    var trimEmptyColumn = [
      ["John", "Smith", ""],
      ["Jane", "Doe", ""],
      ["Emily", "Jones", ""]
    ];
    var cellOverflow = {
      one: ["John", "Smith"],
      two: ["Jane Jane Jane Jane Jane Jane Jane Jane Jane Jane Jane Jane Jane Jane Jane Jane Jane Jane Jane Jane Jane Jane Jane Jane Jane Jane Jane Jane Jane Jane Jane Jane Jane ",
       "Doe Doe Doe Doe Doe Doe Doe DoeDoe DoeDoe Doe Doe DoeDoe DoeDoe DoeDoe Doe"],
      three: ["Emily", "Jones"]
    };
    var longTableOverflow = [
      new Array(1000).fill(0),
      new Array(1000).fill(1)
    ];
    </script>`);await e.logger.evaluateAndLog(["console.table(peopleObject)","console.table(peopleObject2)","console.table(peopleLongHeader)","console.table(peopleArray)","console.table(trimEmptyColumn)","console.table(cellOverflow)","console.table(longTableOverflow)"],{depth:0}),e.assertLog()})})});var q_={};ew(q_,{run:()=>$_});module.exports=oR(q_);var D_=new Map([["browser/browser-args.test.ts",()=>Promise.resolve().then(()=>(mw(),nR))],["browser/browser-launch.test.ts",()=>Promise.resolve().then(()=>(EC(),n_))],["browser/performance.test.ts",()=>Promise.resolve().then(()=>(AC(),s_))],["common/cancellation.test.ts",()=>Promise.resolve().then(()=>(FC(),a_))],["common/cdpTransport.test.ts",()=>Promise.resolve().then(()=>(BC(),c_))],["common/defaultBrowserProvider.test.ts",()=>Promise.resolve().then(()=>(UC(),l_))],["common/logging.test.ts",()=>Promise.resolve().then(()=>(VC(),p_))],["common/mapUsingProjection.test.ts",()=>Promise.resolve().then(()=>($C(),u_))],["common/pathUtils.test.ts",()=>Promise.resolve().then(()=>(qC(),d_))],["common/sourceMapOverrides.test.ts",()=>Promise.resolve().then(()=>(zC(),m_))],["common/sourceMapRepository.test.ts",()=>Promise.resolve().then(()=>(GC(),g_))],["completion/completion.test.ts",()=>Promise.resolve().then(()=>(JC(),f_))],["extension/extensionHostConfigurationProvider.test.ts",()=>Promise.resolve().then(()=>(XC(),h_))],["extension/nodeConfigurationProvider.test.ts",()=>Promise.resolve().then(()=>(eT(),b_))],["extension/pickAttach.test.ts",()=>Promise.resolve().then(()=>(nT(),w_))],["extension/profiling.test.ts",()=>Promise.resolve().then(()=>(aT(),y_))],["node/lease-file.test.ts",()=>Promise.resolve().then(()=>(cT(),v_))],["node/node-runtime.test.ts",()=>Promise.resolve().then(()=>(dT(),S_))],["node/node-source-path-resolver.test.ts",()=>Promise.resolve().then(()=>(gT(),I_))],["node/process-tree.test.ts",()=>Promise.resolve().then(()=>(bT(),k_))],["node/runtimeVersion.test.ts",()=>Promise.resolve().then(()=>(yT(),x_))],["resourceProvider/resourceProvider.test.ts",()=>Promise.resolve().then(()=>(vT(),C_))],["sources/pretty-print.test.ts",()=>Promise.resolve().then(()=>(ST(),T_))],["wasm/wasm.test.ts",()=>Promise.resolve().then(()=>(IT(),R_))]]),PT=D_;var Tp=w(require("mocha")),yg=require("path"),KT=w(xT());var UZ=require("reflect-metadata"),Kb=require("chai");(0,Kb.use)(require("chai-subset"));(0,Kb.use)(require("chai-as-promised"));function V_(){let i=require("nyc"),e=new i({cwd:(0,yg.join)("/home/benjamin/code/hobby/my-nixvim/config/dap/vscode-js-debug/src/test","..","..",".."),exclude:["**/test/**",".vscode-test/**"],reporter:["text","html"],all:!0,instrument:!0,hookRequire:!0,hookRunInContext:!0,hookRunInThisContext:!0});return e.reset(),e.wrap(),e}async function $_(){let i=process.env.COVERAGE?V_():null,e={timeout:10*1e3,color:!0,...JSON.parse(process.env.PWA_TEST_OPTIONS||"{}")};process.env.ONLY_MINSPEC==="true"&&(e.grep="node runtime");let t=e.grep||e.g;t&&(e.grep=new RegExp(String(t),"i")),e.reporter=KT.default,process.env.BUILD_ARTIFACTSTAGINGDIRECTORY&&(e.reporterOptions={reporterEnabled:"mocha-junit-reporter",mochaJunitReporterReporterOptions:{testsuitesTitle:`tests ${process.platform}`,mochaFile:(0,yg.join)(process.env.BUILD_ARTIFACTSTAGINGDIRECTORY,`test-results/TEST-${process.platform}-test-results.xml`)}});let r=new Tp.default(e),o=async(s,a)=>{r.suite.emit(Tp.default.Suite.constants.EVENT_FILE_PRE_REQUIRE,globalThis,s,r);let c=await a();r.suite.emit(Tp.default.Suite.constants.EVENT_FILE_REQUIRE,c,s,r),r.suite.emit(Tp.default.Suite.constants.EVENT_FILE_POST_REQUIRE,globalThis,s,r)};process.env.RETRY_TESTS&&r.retries(Number(process.env.RETRY_TESTS));let n=s=>(0,yg.join)("/home/benjamin/code/hobby/my-nixvim/config/dap/vscode-js-debug/src/test",`${s}.ts`);if(process.env.FRAMEWORK_TESTS)await o(n("framework/reactTest"),()=>Promise.resolve().then(()=>(DT(),L_)));else{await o(n("testIntegrationUtils"),()=>Promise.resolve().then(()=>(_e(),LC))),await o(n("infra/infra"),()=>Promise.resolve().then(()=>(LT(),__))),await o(n("breakpoints/breakpointsTest"),()=>Promise.resolve().then(()=>(_T(),E_))),await o(n("browser/framesTest"),()=>Promise.resolve().then(()=>(ET(),A_))),await o(n("browser/blazorSourcePathResolverTest"),()=>Promise.resolve().then(()=>(UT(),F_))),await o(n("evaluate/evaluate"),()=>Promise.resolve().then(()=>(WT(),M_))),await o(n("sources/sourcesTest"),()=>Promise.resolve().then(()=>(VT(),N_))),await o(n("stacks/stacksTest"),()=>Promise.resolve().then(()=>($T(),B_))),await o(n("threads/threadsTest"),()=>Promise.resolve().then(()=>(qT(),O_))),await o(n("variables/variablesTest"),()=>Promise.resolve().then(()=>(zT(),j_))),await o(n("console/consoleFormatTest"),()=>Promise.resolve().then(()=>(GT(),U_))),await o(n("console/consoleAPITest"),()=>Promise.resolve().then(()=>(JT(),W_)));for(let[s,a]of PT)await o(n(s),a)}try{await new Promise((s,a)=>r.run(c=>c?a(new Error(`${c} tests failed`)):s(void 0)))}finally{i&&(i.writeCoverageFile(),await i.report())}}0&&(module.exports={run});
//# sourceMappingURL=testRunner.js.map
